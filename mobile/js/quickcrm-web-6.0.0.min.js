var mobile_version="6.0.0",QAppName="QuickCRM",unlocked=true,init_done=false,home_created=false,LastViewed=[],Favorites=[],SugarSessionId="",RowsPerPage=20,RowsPerDashlet=5,RowsPerSubPanel=5,IconsLabels=true,tmpIconsLabels=false,CurrentUserId="",UserIsAdmin=false,CurrentUserName=Quser_name,CurrentProfileId="",CurrentUserTeams=[],CurrentUserRoles=[],CurrentUserRoleIds=[],CurrentUserReports=[],CurrentRecordValues={},CurrentRecordLinks=[],ActivitiesCurrentOffset=0,ActivitiesNextOffset=0,ActivitiesPrevOffset=0,PrevID=false,JJWG={},ForceLogin=false,shared_field="shared",add_prefixes=["alt","primary","billing","shipping"],HighlightedColor="fae9c7",ListColorsBool=["#F5F5F5","#"+HighlightedColor],ListColors=["rgb(255, 255, 255)","rgb(245, 245, 245)","rgb(255,255,225)","rgb(225,255,255)","rgb(255,230,255)","rgb(255,232,232)","rgb(232,255,232)","rgb(232,232,255)","rgb(245,225,190)","rgb(245,190,225)","rgb(225,190,245)","rgb(225,245,190)","rgb(190,225,245)","rgb(190,245,225)","rgb(255, 211, 155)"],FooterDef='<div data-role="footer" data-position="fixed" data-tap-toggle="false" data-theme="d">',EmptyFile={name:"",contents:"",mime_type:""},OptUpload=(!QCRM.OffLine&&window.File&&window.FileReader&&window.FileList&&typeof btoa==="function"?true:false),PagesCreated=false,AttachTo="",Pref={},edit_data={},dbgOption=false,dbgval="",regFindField=new RegExp("^(.*){(.+)}(.*)$",""),ListsPages=["Calendar","GS"],SearchPages=[],ViewPages=[],Qpattern=new RegExp('^(.+session":")("|[^"]+)(".+)$',""),button_defaults=' data-role="button" data-mini="true" data-inline="true" class="QCRMLinks"',de_entries=new Array,HiddenFields=["FromModule","FromId","FromName","FromLnk","FromAccountId","PrevPage","parentJJWG"],Beans={},SimpleBeans={},SugarFields={};QCRM.ServerVersion="1.0";QCRM.Ready=false;QCRM.AudioNotes=false;QCRM.WithIcons=true;QCRM.OffLineSupport=false;QCRM.minForFilter=15;QCRM.GooglePlacesSearch=false;QCRM.GooglePlacesMode="Autocomplete";QCRM.GooglePlacesTypes=[];QCRM.AddressSearchHere=false;if(typeof QServer!=="undefined"){QCRM.ServerVersion=QServer}if(db_type!=="mysql"){if(QCRM.ServerVersion>="4.1.1"){shared_field="shared_rec"}}if(typeof suitecrm!=="undefined"){QCRM.SuiteCRM=suitecrm}else{QCRM.SuiteCRM=false}QCRM.mode="mobile";try{if(navigator.userAgent.match(/ipad/gi)||(((screen.width/window.devicePixelRatio>=480)&&(screen.height/window.devicePixelRatio>=800))||((screen.width/window.devicePixelRatio>=800)&&(screen.height/window.devicePixelRatio>=480)))){QCRM.mode="tablet"}}catch(err){}QCRM.calendar={firstDay:0,dates:{},init:false,currDate:new Date(),viewmode:"list",weekmode:false,curUser:"",shared:true,modules:[{module:"Calls",start:"date_start",end:(sugar_mod_fields.Calls&&sugar_mod_fields.Calls.date_end)?"date_end":"date_start",hidden:[]},{module:"Meetings",start:"date_start",end:(sugar_mod_fields.Meetings&&sugar_mod_fields.Meetings.date_end)?"date_end":"date_start",hidden:[]}]};QCRM.hooks={init:[],before_sync:[],before_login:[],after_login:[]};QCRM.maxPickRelate=10;QCRM.maxDashlets=8;QCRM.presetDashlets=[];QCRM.DrawingSignature=true;QCRM.customInit=[];QCRM.ABindex=-1;QCRM.PickUsers=false;QCRM.ShowToday=(mobile_edition==="Pro");QCRM.AssignedMeetingsOnly=false;QCRM.telLink=(mobile_app)?"tel:":"callto:";QCRM.SavedSearches={};QCRM.Dashlets=[];QCRM.dashletsDiv=[];QCRM.searchIcons=[];QCRM.createIcons=[];QCRM.homepage={name:"",id:"",user:""};QCRM.homepage[shared_field]="0";QCRM.saveToCRM=false;QCRM.UpdButtons=true;QCRM.UpdFavIcons=true;QCRM.users_dropdown=true;QCRM.share_search="All";QCRM.native_cal=true;QCRM.native_cal_list=[];QCRM.PhoneStyle='data-theme="e"';QCRM.multiple_assigned=true;QCRM.DefIcons=["ProspectLists","Prospects","SugarFeed","FP_events","jjwg_Maps","jjwg_Markers","Accounts","AOS_Contracts","AOS_Invoices","AOS_Product_Categories","AOS_Products","AOS_Products_Quotes","AOR_Reports","asol_Reports","KReports","AOS_Quotes","Bugs","Calls","Campaigns","Cases","Contacts","Contracts","Documents","Emails","Employees","Leads","Meetings","Notes","Opportunities","Products","Project","ProjectTask","Quotes","Targets","Tasks","Users"];QCRM.CallAssignedOnly=false;QCRM.ProfileMode="ACLRoles";QCRM.Profiles={};QCRM.addressFields=["street","city","state","postalcode","country"];QCRM.google_addressFields=["street","city","state","postalcode","country"];QCRM.addressTemplate=Addresses_Template;QCRM.phoneModules=["Calls","Meetings","Tasks","Cases","Opportunities"];QCRM.fieldTypes={text:"memo",name:"text",varchar:"text","char":"text",iframe:"text",url:"text","enum":"select",multienum:"select",date:"date",datetime:"datetime",currency:"number","int":"number","float":"number",decimal:"number","double":"number",email:"email",phone:"phone",bool:"bool","boolean":"bool",relate:"relate",parent:"parent"};QCRM.imageFields={photo:false,image:false};QCRM.imageResolution=25;if(QCRM.ServerVersion>="4.5.8"){QCRM.imageFields.photo=true}if(QCRM.ServerVersion>="4.5.7"){QCRM.imageFields.image=true}QCRM.ShowCurrentLocation=false;QCRM.showEmptyFields=false;QCRM.globalSearchButton=false;QCRM.forceLock=false;QCRM.LockSetDrawing=false;QCRM.History=[];QCRM.ShowTotals={list:true,dashlets:true,subpanels:true};QCRM.TotalFunctions=["SUM","AVG","COUNT"];QCRM.Swipes={edit:{percent:-10,color:"#598bbe",text:sugar_app_strings.LBL_EDIT_BUTTON,icon:"fa-pencil",action:function(a,b){Beans[a.data("module")].Update(a.data("identity"),$("body").pagecontainer("getActivePage").attr("id"))},disabled:function(b,d){var a=!Beans[b.data("module")].acl.edit;if(!a&&b.data("edit")!=undefined){a=b.data("edit")==="0"}return a}},del:{percent:-50,color:"red",text:sugar_app_strings.LBL_DELETE_BUTTON_LABEL,icon:"fa-trash-o",action:function(b,d){var a=b.data("module"),e=b.data("identity");SugarCrmDelete(a,e,false,function(){d.remove(b)});if(QCRM.mode==="tablet"&&!Beans[a].fullPage&&$("#"+a+"DetailsList").data("identity")==e){$("#"+a+"DetailsList").html()}},disabled:function(b,d){var a=!Beans[b.data("module")].acl.del;if(!a&&b.data("del")!=undefined){a=b.data("del")==="0"}return a}},remove:{percent:-30,color:"crimson",text:sugar_app_strings.LNK_REMOVE,icon:"material-close",action:function(b,d){var a=b.data("from");ConfirmPopup(sugar_app_strings.NTC_REMOVE_CONFIRMATION||(sugar_app_strings.LNK_REMOVE+"?"),function(){QCRM.delete_relationship(a,Beans[a].CurrentId,b.data("relationship"),b.data("identity"),false);d.remove(b)})},disabled:function(b,d){var a=!Beans[b.data("module")].acl.del;if(!a&&b.data("del")!=undefined){a=b.data("del")==="0"}return a}},previous:{percent:5,color:"#598bbe",icon:"ion-android-remove",action:function(a,b){QCRM.TodayDashlet.update(-1)}},next:{percent:-5,color:"#598bbe",icon:"ion-android-add",action:function(a,b){QCRM.TodayDashlet.update(1)}}};QCRM.Menus={edit:{text:sugar_app_strings.LBL_EDIT_BUTTON,action:function(a){Beans[a.module].Update(a.identity,a.module+"ListPage")},disabled:function(a){return !Beans[a.module].acl.edit}},del:{text:sugar_app_strings.LBL_DELETE_BUTTON_LABEL,action:function(a){SugarCrmDelete(a.module,a.identity)},disabled:function(a){return !Beans[a.module].acl.del}}};QCRM.defaultSwipe=[QCRM.Swipes.edit,QCRM.Swipes.del];QCRM.defaultRelSwipe=[QCRM.Swipes.edit,QCRM.Swipes.remove,QCRM.Swipes.del];QCRM.moduleMenu={all:QCRM.Menus,nomenu:{}};QCRM.moduleSwipe={all:{stages:QCRM.defaultSwipe},today:{stages:[QCRM.Swipes.previous,QCRM.Swipes.next]},noswipe:{disabled:true,swipe:false,stages:[]}};QCRM.relationshipSwipe={all:{stages:QCRM.defaultRelSwipe},edit:{stages:[QCRM.Swipes.edit]},remove:{stages:[QCRM.Swipes.remove]},"delete":{stages:[QCRM.Swipes.del]},noswipe:{disabled:true,swipe:false}};QCRM.inlineStyle="padding-top:2px;padding-bottom:3px";QCRM.InAppExtensions=(iOS?/.+(wav|mp3|gif|png|jpg|jpeg|pdf)$/i:/.+(wav|mp3|gif|png|jpg|jpeg)$/i);QCRM.AudioExtensions=/.+(wav|mp3)$/i;QCRM.ExtWhiteList=/.+(wav|mp3|gif|png|jpg|jpeg|mp4|mpg|pdf|doc|docx|xls|xlsx|ppt|ppdx|odt|rtf|txt)$/i;QCRM.IEsavedContents="";QCRM.DrawingWidth=(QCRM.mode==="tablet")?600:300;QCRM.ActionsMenu=(QCRM.mode!=="tablet");QCRM.ScrollLists=mobile_app;QCRM.MaxGlobalSearch=5;QCRM.UserHasRole=function(b){if(CurrentUserRoles==""){return false}if((QCRM.sugaroutfitters||QCRM.usersTable)){return CurrentUserRoles.indexOf(b)>-1}else{for(var a in CurrentUserRoles){if(CurrentUserRoles[a].name==b){return true}}return false}};QCRM.UserHasTeam=function(b){if(!(QCRM.sugaroutfitters||QCRM.usersTable)){return false}else{for(var a in CurrentUserTeams){if(CurrentUserTeams[a].name==b){return true}}return false}};QCRM.UserIsAdmin=function(){return UserIsAdmin};QCRM.SetAppHook=function(b,a){if(QCRM.hooks[b]){QCRM.hooks[b].push(a)}};QCRM.SetModuleHook=function(a,d,b){if(Beans[a]&&Beans[a].hooks[d]){Beans[a].hooks[d].push(b)}};QCRM.SetFieldHook=function(a,e,d,b){if(sugar_mod_fields[a]&&sugar_mod_fields[a][e]){if(d=="noedit"&&b){if(Beans[a]){Beans[a].EditExcluded.push(e)}}else{sugar_mod_fields[a][e][d]=b}}};QCRM.GetFieldHook=function(a,d,b){if(sugar_mod_fields[a]&&sugar_mod_fields[a][d]&&sugar_mod_fields[a][d][b]){return sugar_mod_fields[a][d][b]}else{return false}};QCRM.ExistsFieldHook=function(a,d,b){return(sugar_mod_fields[a]&&sugar_mod_fields[a][d]&&(typeof sugar_mod_fields[a][d][b]!=="undefined"))};QCRM.CustomInstall=function(){};QCRM.SetFieldValue=function(b,g,d){if(sugar_mod_fields[b]&&sugar_mod_fields[b][g]){var e=sugar_mod_fields[b][g],a="#Edit"+b+"_"+g;switch(e.type){case"enum":set_enum_val(a,d);break;case"date":case"datetime":$(a).mobiscroll("setDate",d,true);break;case"bool":case"boolean":set_bool_val(a,g,d);break;default:$(a).val(d)}}};QCRM.GetFieldValue=function(b,e){if(sugar_mod_fields[b]&&sugar_mod_fields[b][e]){var d=sugar_mod_fields[b][e],a="#Edit"+b+"_"+e,g;switch(d.type){case"date":case"datetime":return $(a).mobiscroll("getDate");break;case"bool":case"boolean":g=$(ctrl+"div input:radio:checked").val();if(g==undefined||g=="0"){return false}return true;break;default:return $(a).val()}}};QCRM.GetDetailFieldId=function(a,b){return"#"+a+b+"V"};QCRM.DetailFieldShow=function(a,b){$("#"+a+b+"V").show()};QCRM.DetailFieldHide=function(a,b){$("#"+a+b+"V").hide()};QCRM.GetEditFieldId=function(a,b){return"#Edit"+a+"_"+b};QCRM.SetFieldReadonly=function(b,g,a){var h="#Edit"+b+"_"+g,e=sugar_mod_fields[b][g],d=a?"disable":"enable";switch(e.type){case"enum":case"radioenum":case"dynamicenum":case"multienum":$(h).attr("disabled",a);break;case"bool":case"boolean":$(h+"0").checkboxradio(d);$(h+"1").checkboxradio(d);break;case"date":case"datetime":$(h).mobiscroll(d);default:$(h).attr("readonly",a)}};QCRM.EditFieldShow=function(b,e){var d=sugar_mod_fields[b][e],a=e+(d.type=="bool"?"0":"");$("#Edit"+b+"_"+a).closest(".ui-field-contain").show()};QCRM.EditFieldHide=function(b,e){var d=sugar_mod_fields[b][e],a=e+(d.type=="bool"?"0":"");$("#Edit"+b+"_"+a).closest(".ui-field-contain").hide()};QCRM.SetRelationshipHook=function(b,a,e,d){if(Beans[b]&&Beans[b].Links&&Beans[b].Links[a]){Beans[b].Links[a][e]=d}};if(typeof QCRM.ajaxHeader==="undefined"){QCRM.ajaxHeader=function(a){}}QCRM.CustomRest=function(h,e,m,l,d,a,b){var g={url:ServerAddress+h,dataType:m,async:true,data:l,type:e,crossdomain:mobile_app,cache:false,error:function(o,p,n){if(!b){QCRM.CustomRest(h,e,m,l,d,a,true)}else{if(a===null){d(null)}else{a(null)}}},success:d};g.timeout=420000;if(QCRM.QBasicAuth){g.beforeSend=QCRM.ajaxHeader;g.dataType="jsonp";g.jsonp="jsoncallback"}$.ajax(g)};function QAjax(h,e,d,a,b){var g={url:proxy_url,dataType:"json",data:{method:h,input_type:"JSON",response_type:"JSON",rest_data:e},type:"post",crossdomain:mobile_app,cache:false,error:function(m,n,l){if(!b&&(h!="set_entry")){QAjax(h,e,d,a,true)}else{if(!a){d(null)}else{a(null)}}},success:d};g.timeout=360000;if(QCRM.QBasicAuth){g.beforeSend=QCRM.ajaxHeader;g.dataType="jsonp";g.jsonp="jsoncallback"}$.ajax(g)}function SugarQuery(h,d,g,a,e){function b(m){var o,n="",p="",q,l;if(m!==null&&m.name==="Invalid Session ID"&&h!=="logout"){if(h!=="login"){if(e===undefined){e=1}else{e++}if(e>6){return}SugarQuery("login",'[{"encryption":"PLAIN","password":"'+Qpwd+'","user_name":"'+Quser_name+'"},"",""]',function(r){d=d.replace(Qpattern,"$1")+SugarSessionId+d.replace(Qpattern,"$3");SugarQuery(h,d,g,a,e+1)},a,e)}else{g(m)}}else{if(m!==null&&h=="login"&&m.name_value_list!==undefined){SugarSessionId=m.id;CurrentUserId=m.name_value_list.user_id.value;UserIsAdmin=m.name_value_list.user_is_admin&&m.name_value_list.user_is_admin.value!==false;if(mobile_edition==="Pro"||ForceCE){if((QCRM.sugaroutfitters&&sugar_version>="6.3")||QCRM.usersTable){o=m.name_value_list.fulluser!==true;if(!o){if(m.name_value_list.roles.length>0){CurrentUserRoles=m.name_value_list.roles;n=JSON.stringify(m.name_value_list.roles)}localStorage.setItem(ServerAddress+"R"+CurrentUserId,n);if(m.name_value_list.role_ids&&m.name_value_list.role_ids.length>0){CurrentUserRoleIds=m.name_value_list.role_ids;p=JSON.stringify(m.name_value_list.role_ids);if(QCRM.ProfileMode!="SecurityGroups"){CurrentProfileId=m.name_value_list.role_ids[0];localStorage.setItem(ServerAddress+"SugarTeamId",CurrentProfileId);QCRM.setProfile()}}localStorage.setItem(ServerAddress+"RI"+CurrentUserId,p);if(m.name_value_list.teams){CurrentUserTeams=m.name_value_list.teams;localStorage.setItem(ServerAddress+"T"+CurrentUserId,JSON.stringify(CurrentUserTeams));if(QCRM.ProfileMode=="SecurityGroups"){for(l in m.name_value_list.teams){CurrentProfileId=m.name_value_list.teams[l].id;localStorage.setItem(ServerAddress+"SugarTeamId",CurrentProfileId);QCRM.setProfile();break}}}}}else{if(qusers===undefined){o=true}else{o=((qusers>0)&&(mobile_usr.indexOf(CurrentUserId)==-1))}}if(o){$.mobile.loading("hide");if(mobile_app){}else{mobile_edition="CE";AlertPopup(RES_ACCESS_DENIED_MSG);LogOutUser();return}}else{if(ForceCE){if("ce-"+ServerAddress in localStorage){localStorage.removeItem("ce-"+ServerAddress)}AppReload()}}}}g(m)}}QAjax(h,d,b,a)}function Array_unique(a){return a.filter(function(e,d,b){return b.indexOf(e)===d})}QCRM.get_available_modules=function(l){var e=localStorage.getItem("dis-"+ServerAddress+CurrentUserId),h=localStorage.getItem("acls-"+ServerAddress+CurrentUserId);function g(m){if(Beans[m]!==undefined){Beans[m].access="none"}}function d(m,n){if(Beans[m]!==undefined){if(n&&(n.exp===undefined)){n.exp=true}Beans[m].acl=n}}function b(p,r){var o,m=r.length,n=Beans[p].acl;for(o=0;o<m;o++){var s=r[o],q=s.action;switch(q){case"edit":n[q]=n[q]&&s.access;break;case"export":n.exp=n.exp&&s.access;break;case"list":case"view":n[q]=s.access;break;case"delete":n.del=n.del&&s.access;break;default:break}}return n}if(e===null||e===""||h===null||h===""){e=[];h=[];if(QCRM.OffLine){}else{SugarQuery("get_available_modules",'{"session":"'+SugarSessionId+'"'+(sugar_version>="6.3"?(',"filter":'+(sugar_version>="6.5"?'"all"':'"all"')):"")+"}",function(r){if(r&&r.modules){r=r.modules;var n,v,u=r.length,o=[],p=(QCRM.beans===undefined?["Contacts"]:QCRM.beans);if(QCRM.ServerVersion>="5.0"&&mobile_edition==="Pro"){p=p.concat("QCRM_Tracker")}for(n in p){var s=p[n],w=false;if(typeof r[0]==="string"){if(r.indexOf(s)===-1){o.push(s);g(s)}else{q={edit:true,view:true,list:true,exp:true,del:true};h.push({module:s,acls:q});d(s,q);break}}else{for(v=0;v<u;v++){var q;if(r[v].module_key===s){w=true;q=b(s,r[v].acls);h.push({module:s,acls:q});d(s,q);break}}if(!w&&!UserIsAdmin){o.push(s);g(s)}}}localStorage.setItem("dis-"+ServerAddress+CurrentUserId,JSON.stringify(o));localStorage.setItem("acls-"+ServerAddress+CurrentUserId,JSON.stringify(h))}l()},null)}}else{var a;e=jQuery.parseJSON(e);for(a in e){g(e[a])}h=jQuery.parseJSON(h);for(a in h){d(h[a].module,h[a].acls)}l()}};QCRM.set_note_attachment=function(e,a,b,d,h,g,l){if(QCRM.OffLine){}else{SugarQuery("set_note_attachment",'{"session":"'+SugarSessionId+'","note":{"id":"'+d+'","file":"'+e+'","filename":"'+b+'","related_module_name":"'+h+'","related_module_id":"'+g+'"}}',function(m){l(m)})}};QCRM.set_image=function(h,m,a,d,b,l,e,g,p){if(QCRM.OffLine){}else{var n="set_"+e,o={session:SugarSessionId,module_name:d,id:b,field:l,drawing:g?"":h,deleted:g,name:a};SugarQuery(n,JSON.stringify(o),function(q){},null)}};QCRM.get_image=function(e,m,h,d,a,l){var g="get_"+d,b={entry_list:{}};if(QCRM.OffLine){QCRM.webdb.read_attachment(e,m,h,d,a,function(n,o,p){b.entry_list.hasDrawing=true;b.entry_list.is_url=true;b.entry_list.contents=n;l(b)},function(){b.entry_list.hasDrawing=false;l(b)})}else{SugarQuery(g,'{"session":"'+SugarSessionId+'","module_name":"'+e+'","id":"'+m+'","field":"'+h+'","name":"'+name+'"}',l)}};QCRM.get_entry=function(a,d,b){if(QCRM.OffLine){}else{SugarQuery("get_entry",'{"session":"'+SugarSessionId+'","module_name":"'+a+'","id":"'+d+'","select_fields":"","link_name_to_fields_array":""}',b)}};QCRM.get_entry_list=function(a,e,g,n,d,b,l,m){if(QCRM.OffLine){}else{var h=Beans[a].LimitWhere;if(h!=""){e=h.replace(/@table/g,Beans[a].table)+((e==="")?"":(" AND ("+e+")"))}SugarQuery("get_entry_list",'{"session":"'+SugarSessionId+'","module_name":"'+a+'","query":"'+e+'","order_by":"'+l+'","offset":'+d+',"select_fields":'+g+',"link_name_to_fields_array":'+(n===""?'""':n)+',"max_results":'+b+',"deleted":0}',function(r){if(r&&r.entry_list){var p,o=r.entry_list.length;for(p=0;p<o;p++){var q=r.entry_list[p];q.name_value_list.id={name:"id",value:q.id}}}m(r)},null)}};QCRM.get_totals=function(g,b,a,e,d,l){if(QCRM.OffLine){}else{var h={session:SugarSessionId,module_name:g,query:b,select_fields:a,total_fields:e,group_by:d};SugarQuery("get_totals",JSON.stringify(h),l)}};QCRM.get_S_entry_list=function(g,e,a,d,l,b,h,m){if(QCRM.OffLine){}else{SugarQuery("get_entry_list",'{"session":"'+SugarSessionId+'","module_name":"'+g+'","query":"'+e+'","order_by":"'+h+'","offset":'+l+',"select_fields":["'+a.join('","')+'"],"link_name_to_fields_array":'+(d===""?'""':d)+',"max_results":'+b+',"deleted":0}',m,null)}};QCRM.get_relationships=function(d,a,b,o,l,n,s,p,h,e,r){if(QCRM.OffLine){QCRM.webdb.get_relationships(d,a,b,o,l,jQuery.parseJSON(n),p,h,e,r)}else{var g="",q="asc",m;if(p!==""&&QCRM.ServerVersion<"4.6"){m=p.split(" ");g=m[0];if(m[1]==="desc"){q="desc"}}else{g=p}SugarQuery("get_relationships",'{"session":"'+SugarSessionId+'","module_name":"'+d+'","module_id":"'+b+'","link_field_name":"'+o+'","related_module_query":"'+l+'","related_fields":'+n+',"related_module_link_name_to_fields_array":'+(s===""?'""':s)+',"deleted":0,"order_by":"'+g+'","offset":"'+h+'","limit":"'+(e?e:"")+'"}',function(u){if(u&&u.entry_list&&q==="desc"){u.entry_list.reverse()}r(u)},null)}};QCRM.get_relationships_totals=function(d,a,b,m,h,l,p,g,o){if(QCRM.OffLine){}else{var n=Beans[a],e={session:SugarSessionId,module_name:d,module_id:b,link_field_name:m,related_module_query:h,related_fields:QCRM.ListFieldsToSelect(a,["id"]),total_fields:p,group_by:g};SugarQuery("get_relationships_totals",JSON.stringify(e),o)}};QCRM.set_entry=function(a,e,b,d){if(a==="Calls"||a==="Meetings"){QCRM.calendar.init=false}if(e===""){if(b.assigned_user_id===undefined||b.assigned_user_id.value===""){b.assigned_user_id={name:"assigned_user_id",value:CurrentUserId}}}else{if(b.id===undefined||b.id.value!==e){b.id={name:"id",value:e}}}if(QCRM.OffLine){}else{SugarQuery("set_entry",JSON.stringify({session:SugarSessionId,module_name:a,name_value_list:b},null,2),d,null)}};QCRM.delete_entry=function(a,d,b){if(a==="Calls"||a==="Meetings"){QCRM.calendar.init=false}if(QCRM.OffLine){}else{SugarQuery("set_entry",'{"session":"'+SugarSessionId+'","module_name":"'+a+'","name_value_list":[{"name":"id","value":"'+d+'"},{"name":"deleted","value":"1"}]}',b,null)}};QCRM.set_relationship=function(e,b,a,d){if(QCRM.OffLine){}else{SugarQuery("set_relationship",'{"session":"'+SugarSessionId+'","module_name":"'+e+'","module_id":"'+b+'","link_field_name":"'+a+'","related_ids":"'+d+'","name_value_list":"","deleted":0}',function(g){},null)}};QCRM.delete_relationship=function(e,b,a,d,g){if(QCRM.OffLine){}else{if(!g){SugarQuery("set_relationship",'{"session":"'+SugarSessionId+'","module_name":"'+e+'","module_id":"'+b+'","link_field_name":"'+a+'","related_ids":["'+d+'"],"name_value_list":"","deleted":1}',function(h){},null)}}};QCRM.search_by_module=function(b,g,d,a,e){if(QCRM.OffLine){}else{SugarQuery("search_by_module",'{"session":"'+SugarSessionId+'","search_string":"'+g+'","modules":["'+b.join('","')+'"],"offset":'+d+',"max_results":'+a+"}",e,null)}};QCRM.AddToListFields=function(e,a){var d,g,b=Beans[e];if(!b){return}if(typeof a==="string"){a=[a]}for(d in a){g=a[d];if(b.ListFields.indexOf(g)===-1){b.ListFields.push(g)}}};QCRM.AddToSelectFields=function(b,a){QCRM.AddToListFields(b,a)};function sugarLabel(b,a){if(!sugar_mod_strings[b]){return""}return sugar_mod_strings[b][a]||a}function matchStringOp(e,b){var a,d=b.trim().replace('"','\\"');switch(e){case"partial":a="%"+d+"%";break;case"exact":a=d;break;case"start":a=d+"%";break;default:a=(Pref.PartialSearch?"%":"")+d+"%";break}return"LIKE '"+a+"'"}function matchString(e,d,b){var a="";if(b!==""){a="("+d+" "+matchStringOp(e,b.replace(/'/g,QCRM.OffLine?"&#039;":"''"))+")"}return a}function matchName(a,g,d){var b="",e=d.replace(/'/g,QCRM.OffLine?"&#039;":"''");if(d!==""){if(a.SearchArray){return a.SearchArray.replace(/@@/g,matchStringOp(g,e))}else{return matchString(g,a.SearchName,e)}}return b}function enableButton(b,a){if(a){$("#"+b).removeClass("ui-disabled")}else{$("#"+b).addClass("ui-disabled")}}function CreateExtLink(b,d){var a=$("<a/>",{href:"#",style:"text-decoration:none;color:#444;"+QCRM.inlineStyle+d});a.click({url:b},function(e){e.preventDefault();window.open(HTMLDecode(e.data.url).replace(/"/g,"%22"),"_system")});return a}function OpenDownloadLink(e,m,d,b){var g=(e==="Notes")?"get_note_attachment":"get_document_revision",l=d.extension,a=d.filename,h=d.mime_type;$.mobile.loading("show");if(QCRM.OffLine&&Pref.SyncModules[e].attachments){}SugarQuery(g,'{"session":"'+SugarSessionId+'","id":"'+d.sugar_id+'"}',function(n){$.mobile.loading("hide");if(!n){return}var p=(e==="Notes")?n.note_attachment.file:n.document_revision.file,o=(l==="pdf")?"embedPDF":"embedIMG";if(mobile_app&&d.inApp&&!b){}else{if(mobile_app){}else{$("#DownloadDiv").html('<embed  class="'+o+'" type="'+h+'" src="data:'+h+";base64,"+escape(p)+'"></embed>');$("#DownloadPageTitle").html(data.name.value)}}},null)}function getFileInfo(b,l,g){var h=(b==="Documents")?(g.last_rev_mime_type?g.last_rev_mime_type.value:""):(g.file_mime_type?g.file_mime_type.value:""),a=(g.filename?g.filename.value:""),e=/(?:\.([^.]+))?$/,d=h.match(QCRM.InAppExtensions);if(h==""){return}if(d){extension=h.replace(QCRM.InAppExtensions,"$1")}else{d=a.match(QCRM.InAppExtensions);if(d){extension=a.replace(QCRM.InAppExtensions,"$1")}else{extension=e.exec(a)[1]}}extension=extension.toLowerCase();if(extension==="pdf"){h="application/pdf"}else{if(d){if(a.match(QCRM.AudioExtensions)){h="audio/"+extension}else{h="image/"+extension}}}h=h.replace("jpg","jpeg");return{inApp:d?true:false,filename:a,extension:extension,mime_type:h,sugar_id:(b==="Documents"?g.document_revision_id.value:l)}}function CreateDownloadLink(e,m,h,g,d){var b=getFileInfo(e,m,h),a;if(!b){return""}if(mobile_app||b.inApp){a=$("<a/>",{href:"#"+((mobile_app)?"":"DownloadPage"),"data-theme":"c","data-link":"attach","data-module":e,"data-fileinfo":encodeObject(b),"data-identity":m,"data-external":d?"true":"false",style:"text-decoration:none;color:#444;"+g})}else{a=CreateExtLink(ServerAddress+"index.php?entryPoint=download&id="+m+"&type="+e,g)}return a}function AddPhonePopup(d){var b=$('<ul id="Phone'+d+'L" data-role="listview" data-inset="true" data-theme="d"/>'),a=$('<div data-role="popup" data-history="false" data-corner="true" data-shadow="true" data-theme="a" id="Phone'+d+'"/>');a.append(b);$("#"+d).append(a)}function enableMenuAction(d,a){var b=$("#"+$("body").pagecontainer("getActivePage").attr("id")+' [data-link="'+d+'"]');if(QCRM.ActionsMenu){b=b.parent()}if(a){b.show()}else{b.hide()}}function AddTotalsPopup(e,d,b){var a=$('<div data-role="popup" data-overlay-theme="b" data-history="false" data-corner="false" data-shadow="true" id="TotalsPopup'+(d||"")+b+'"/>');a.append('<h3 class="GroupField"/>');a.append('<div class="GroupTable" style="margin:0 10px 10px 10px;"/>');$("#"+e).append(a)}function AddMenuPopup(a,g){var z,A,v,d=Beans[a],u=$('<ul id="Menu'+a+'L" data-role="listview" data-inset="true"/>'),o=!QCRM.ActionsMenu||(!d.acl.edit&&!d.acl.del),s=$('<div data-role="popup" data-history="false" data-corner="false" data-shadow="true" id="PopupMenu'+a+'"/>'),h=QCRM.ActionsMenu?"":button_defaults,b='<a data-link="editcurrent" '+h+">"+sugar_app_strings.LBL_EDIT_BUTTON+"</a>",B='<a data-rel="back" data-link="delcurrent" '+h+">"+sugar_app_strings.LBL_DELETE_BUTTON_LABEL+"</a>",p='<a data-link="dupcurrent" '+h+">"+sugar_app_strings.LBL_DUPLICATE_BUTTON+"</a>",e=$("#"+a+"DetailsBtn"),q=d.access=="edit";function r(l){if(QCRM.ActionsMenu){u.append($('<li data-icon="false"/>').append(l))}else{e.append(l)}}if(q&&d.acl.edit){r(b)}if(q&&d.acl.del){r(B)}if(q&&mobile_edition=="Pro"&&d.acl.edit&&d.DuplicateButton){r(p)}var w='<a href="#" data-link="createcurrent" '+h+'><span class="md-icon mbsc-ic mbsc-ic-ion-android-add">&nbsp;'+sugar_app_strings.LBL_CREATE_BUTTON_LABEL+"</span></a>";if(QCRM.mode!=="tablet"&&mobile_edition=="Pro"&&d.acl.edit&&d.DuplicateButton){r(w)}for(v in d.hooks.actions){var z=d.hooks.actions[v],n=z.label,A;if(z.icon){n='<span class="md-icon mbsc-ic '+z.icon+'">&nbsp;'+n+"</span>"}A=$('<a id="'+z.id+'" '+(z.link?('data-link="'+z.link+'" '):"")+h+">"+n+"</a>");if(!z.link){A.click({action:z.action,module:a},function(l){l.preventDefault();l.data.action(Beans[l.data.module].CurrentId,l.data.module);return false})}r(A);if(QCRM.ActionsMenu){o=false}}if(o){$("#"+a+"ActMenu").hide()}else{s.append(u);$("#"+a+g).append(s)}}function AddMapPopup(e){var d=$('<div id="Map'+e+'D"/>'),b='<a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>',a=$('<div data-role="popup" data-corner="true" data-shadow="true" data-theme="d" id="Map'+e+'"/>');a.append(b);a.append(d);$("#"+e+(Beans[e].fullPage?"DP":"ListPage")).append(a)}function QuickCRMAddDetailsPage(b){if(ViewPages.indexOf(b)!==-1){return}ViewPages=ViewPages.concat(b);var d=b+"DP",a="#Edit"+b;$("#"+d).on("pagebeforecreate",function(){var l,g=Beans[b];AddPhonePopup(d);AddTotalsPopup(d,b,"D");AddMenuPopup(b,"DP");if(g.HasAddress()){AddMapPopup(b)}var h=g.CustomLinks||g.Links;for(var n in h){var e=(g.CustomLinks&&g.CustomLinks[0]!==undefined)?h[n]:n;if(g.Links[e]!==undefined){var m=g.Links[e].module;if(sugar_app_list_strings.moduleList[m]!==undefined&&(Beans[m]===undefined||(Beans[m].Enabled()))){$("#"+b+"Links").append('<ul id="'+d+e+'Ul"  data-role="listview" data-theme="c" data-split-theme="b" data-inset="true" /><div class="CRMTotals SubpanelTotals" id="'+d+e+'Tt"/>')}}}if(!g.ShowTab){$("#"+b+"SearchBtn").hide()}if(!g.acl.edit){enableButton(b+"EditBtn",false)}if(!g.acl.del){enableButton(b+"DelBtn",false)}for(l in g.hooks.init_view){g.hooks.init_view[l]()}});$("#"+d).on("pageshow",function(){QCRM.History.push("#"+d);Beans[b].ViewDetails()});$(a).on("pagebeforecreate",function(){$(a+"Title").text(sugar_app_list_strings.moduleListSingular[b]);var g,e=Beans[b];if(e.Predefined.indexOf("Edit")!==-1){$(a+"CancelTopBtn").text(sugar_app_strings.LBL_CANCEL_BUTTON_LABEL);$(a+"ConfirmTopBtn").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL);$(a+"CancelBottomBtn").text(sugar_app_strings.LBL_CANCEL_BUTTON_LABEL);$(a+"ConfirmBottomBtn").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL)}if(e.access==="edit"){e.InitEditForm();for(g in e.hooks.init_edit){try{e.hooks.init_edit[g]()}catch(h){AlertPopup("Error found in "+b+" init_edit:/n"+h)}}}})}function QuickCRMAddListPage(d){if(SearchPages.indexOf(d)!==-1){return}SearchPages=SearchPages.concat(d);ListsPages=ListsPages.concat(d);var a=Beans[d],b;a.AddBtn=true;$("#"+d+"ListPage").on("pagebeforecreate",function(){var g=a.CustomLinks||a.Links;AddPhonePopup(d+"ListPage");AddTotalsPopup(d+"ListPage",d,"L");if(QCRM.mode==="tablet"&&!a.fullPage){AddMenuPopup(d,"ListPage");for(var l in g){var e=(a.CustomLinks&&a.CustomLinks[0]!==undefined)?g[l]:l;if(a.Links[e]!==undefined){var h=a.Links[e].module;if(sugar_app_list_strings.moduleList[h]!==undefined&&(Beans[h]===undefined||(Beans[h].Enabled()))){$("#"+d+"Links").append('<ul id="'+d+"DP"+e+'Ul"  data-role="listview" data-theme="c" data-divider-theme="b" data-split-theme="b" data-inset="true" /><div class="CRMTotals SubpanelTotals" id="'+d+e+'Tt"/>')}}}for(b in a.hooks.init_view){a.hooks.init_view[b]()}}$("#SForm"+d).submit(function(m){m.preventDefault();$("input").blur();$("#"+d+"Panel").panel("close");setTimeout(function(){StartSearch(d)},(QCRM.platform=="android")?150:10)});if(a.basic_search&&a.basic_search.length>0){$("#"+d+"basic_search").empty();init_search_fields(d,a.basic_search,"basic_search")}if(mobile_edition=="Pro"){init_search_form(d,a.SearchFields);for(b in a.hooks.init_list){a.hooks.init_list[b]()}for(b in a.hooks.init_search){a.hooks.init_search[b]()}}else{$("#"+d+"DivMoreOptions").append("<p>"+RES_UNAVAILABLE+"</p>")}});$("#"+d+"ListPage").on("pageshow",function(){var g="#"+d+"ListPage";if(QCRM.mode==="tablet"&&!a.fullPage){a.ViewDetails()}QCRM.History.push(g);LoadMyItems(d);a.GetList(a.CurrentOffset);if(mobile_edition=="Pro"){var e=$("#"+d+"SI").val();if(e==="0"){SavedSearchEnum(d,"");SavedSearchToggle(d);$("#"+d+"SI").val("1")}}})}function toDBConcatName(b,a){if(QCRM.OffLine){return"(IFNULL("+b+",'') || ' ' || "+a+")"}else{if(db_type==="mysql"){return"CONCAT(IFNULL("+b+",''),' ',"+a+")"}else{return"ISNULL("+b+",'')+' '+"+a}}}function cleanup_phone(a){return a.replace("(","").replace(")","").replace(/\s/g,"").replace(/-/g,"").replace(/\./g,"")}function create_input_form(o,d,p,n,m,g,h){var l=$("<div class='ui-field-contain'"+(m?' data-mini="true"':"")+"/>"),b=n?"<em>* </em>":"",e="<label for='"+d+"'>"+b+p+"</label>",a=$("<input data-theme='d' id='"+d+"' type='"+o+"'"+(h?" autocomplete='off' autocorrect='off' spellcheck='false' ":"")+(g?" data-clear-btn='true'":"")+">");l.append(e);l.append(a);return l}function create_picker(m,d,o,l,g,n){var h=$("<div class='ui-field-contain' id='"+d+"D' />"),b=l?"<em>* </em>":"",e="<label for='"+d+"'>"+b+o+"</label>",a=$("<input class='qcrm' id='"+d+"' name='Pick"+d+"'>");if(n){a.addClass(n)}h.append(e);h.append(a);return h}function create_text_form(b,d,g,a,e){return create_input_form("text",b,d,g,false,(a===undefined||a),e)}function create_date_form(b,d,e,a){return create_picker("date",b,d,e,a)}function create_datetime_form(b,d,e,a){return create_picker("datetime",b,d,e,a)}function create_number_form(b,d,e,a){return create_input_form("number",b,d,e,false,a)}function create_number_decimal_form(b,d,e,a){return create_input_form("number",b,d,e,false,a)}function create_phone_form(b,d,e,a){return create_input_form("tel",b,d,e,false,a)}function create_email_form(b,d,e,a){return create_input_form("email",b,d,e,false,a)}function create_textarea_form(a,b,e){var d=$("<div class='ui-field-contain' />");d.append("<label for='"+a+"'>"+(e?"<em>* </em>":"")+b+"</label>");d.append("<textarea name='"+a+"' id='"+a+"'/>");d.append("<input type='hidden' id='"+a+"old'/>");d.append("<input type='hidden' id='"+a+"chng'/>");d.append("<div style='display:none'><br><div id='"+a+"txt'/></div>");return d}function get_select_options(m,g,h){var b,d="",e=false,l="---",n=[],a=true;if(h||m[""]!==undefined){if(m[""]!==undefined){l=m[""];e=true}d+="<option "+(g==="EMPTY"?'selected="selected" ':"")+'value="EMPTY">'+l+"</option>"}for(b in m){if(b!==""&&isNaN(+b)){a=false;break}}if(a){for(b in m){if(b!==""||!e){n.push([b,m[b]])}}n.sort(function(p,o){return(+p[0])<(+o[0])?-1:1});for(option in n){b=n[option][0];d+="<option "+(g===b?'selected="selected" ':"")+'value="'+b+'">'+m[b]+"</option>"}}else{for(b in m){if(b!==""||!e){d+="<option "+(g===b?'selected="selected" ':"")+'value="'+b+'">'+m[b]+"</option>"}}}return d}function create_select(b,l,d,e,a,h,m){var g="<select name='"+b+"' id='"+b+"' "+((a||h||m)?"data-native-menu='false' ":"")+(a===true?"multiple ":"")+(m?"data-link='"+m+"' ":"")+(e===true?"data-mini='true' ":"")+"data-theme='c'>";if(l[""]!==undefined){g+="<option "+(d==="EMPTY"?'selected="selected" ':"")+'value="EMPTY">'+l[""]+"</option>"}$.each(l,function(o,n){if(o!==""){g+="<option "+(d===o?'selected="selected" ':"")+'value="'+o+'">'+n+"</option>"}});g+="</select>";return g}function create_enum_form(b,m,n,o,h,g,l){if(l===undefined){l=false}var e=$("<div class='ui-field-contain'"+(g?' data-mini="true"':"")+"/>"),a=h?"<em>* </em>":"",d="<label for='"+b+"' class='select'>"+a+m+"</label>";if(m!==""){e.append(d)}e.append(create_select(b,n,l,g,o));return e}function create_multienum_form2(a,b,g,e,d){return create_enum_form(a,b,g,true,e,d,"")}function create_multienum_form(d,n,o,l,h){function b(q,r,p){q.append('<input type="checkbox" name="'+d+"_"+r+'" id="'+d+"_"+r+'" class="custom" data-theme="c"><label for="'+d+"_"+r+'">'+(p===""?"&nbsp;":p)+"</label>")}var e=$('<div id="'+d+'"_group data-role="controlgroup"'+(h?' data-mini="true"':"")+"/>"),a=l?"<em>* </em>":"",m="<legend>"+a+n+"</legend>";if(n!==""){e.append(m)}if(o[""]!==undefined){b(e,"",o[""])}$.each(o,function(g,p){if(g!==""){b(e,g.replace(/\s+/g,"").replace(/\.+/g,"").replace(/\/+/g,""),p)}});return e}function DelUpload(a,b,d){sugar_mod_fields[b][d].TmpFile=EmptyFile;$(a+"D").val("1");$(a+"I").val("");$(a).val("");$(a+"O").empty();show_upload(a,true)}function CamUpload(a,b,d){function g(){}function e(m){try{var h="picture.jpeg";$(a+"D").val("0");sugar_mod_fields[b][d].TmpFile={name:escape(h),contents:"data:image/jpeg;base64,"+m};$(a).val(h);show_upload(a,false);$(a+"O").html(['<img class="thumb" src="',"data:image/jpeg;base64,"+m,'" title="',h,'"/>'].join(""))}catch(l){}}navigator.camera.getPicture(e,g,{quality:QCRM.imageResolution,destinationType:Camera.DestinationType.DATA_URL,correctOrientation:true})}function handleUpload(e,g,m,b){var h=b.target.files;sugar_mod_fields[g][m].TmpFile=EmptyFile;if(!h.length){return}var l=h[0];if(l.type.match("image.*")){var a=new FileReader();a.onload=(function(n){return function(o){$(e+"O").html(['<img class="thumb" src="',o.target.result,'" title="',escape(n.name),'"/>'].join(""))}})(l);a.readAsDataURL(l);var d=new FileReader();d.onload=(function(n){return function(p){var o=btoa(p.target.result);$(e+"D").val("0");sugar_mod_fields[g][m].TmpFile={name:escape(n.name),contents:o,mime_type:l.type};$(e).val(n.name);show_upload(e,false);if(!l.type.match("image.*")){}}})(l);d.readAsBinaryString(l)}else{$(e).val("");$(e+"I").val("");$(e+"O").html("Not an image: "+l.type);sugar_mod_fields[g][m].TmpFile=EmptyFile}}function show_upload(b,a){if(a){$(b+"DBtn").hide();if(!mobile_app){$(b+"I").show()}if(mobile_app){$(b+"C").show()}}else{$(b+"DBtn").show();if(!mobile_app){$(b+"I").hide()}if(mobile_app){$(b+"C").hide()}}}function create_upload(g,a,b,l,h,e){if(!OptUpload||!QCRM.imageFields[h.type]){return false}var d='<div class="ui-field-contain"><label for="'+g+'">'+a+'</label><input type="text" name="'+g+'" id="'+g+'" readonly="readonly" data-theme="c" ><input type="hidden" id="'+g+'D"></div><div class="ui-field-contain"><label for="'+g+'C"></label>';if(mobile_app){}if(!mobile_app){d+='<input type="file" name="'+g+'I" id="'+g+'I" data-theme="c" >'}d+='<a id="'+g+'DBtn" href="javascript:DelUpload(\'#'+g+"','"+b+"','"+l+'\');" data-role="button" data-mini="true" data-theme="c" data-inline="true" >'+sugar_app_strings.LBL_DELETE_BUTTON_LABEL+"</a>";d+='</div><output id="'+g+'O"></output>';if(e){d="<form>"+d+"</form>"}h.TmpFile=EmptyFile;h.add_listener=function(){if(mobile_app){}else{document.getElementById(g+"I").addEventListener("change",function(m){handleUpload("#"+g,b,l,m)},false)}};h.after_save=function(o,n){var m=$("#"+g+"D").val()=="1";if(m||($("#"+g+"D").val()!=""&&h.TmpFile.contents!="")){QCRM.set_image((m?"":h.TmpFile.contents),h.TmpFile.mime_type,n[l].value,b,o,l,h.type,m,function(p){});return true}return false};return d}function create_drawing(b,d,l){var a=(l.height==="")?250:parseInt(l.height.replace("px",""),10),e=(l.width==="")?300:parseInt(l.width.replace("px",""),10),h,g;if(e>QCRM.DrawingWidth){a=Math.round(a*QCRM.DrawingWidth/e);e=QCRM.DrawingWidth}h=70+a;g='<div class="drawing_block" id="@@_wrapper"><div class="drawing_top_tools"><span class="drawing_tool_general">&nbsp;</span><a id="@@_tool_clear" class="drawing_tool_general drawing_tool_clear" href="#" title="'+sugar_app_strings.LBL_DRAWING_CLEAR+'">&nbsp;</a><a id="@@_tool_reinit" class="drawing_tool_general drawing_tool_reinit" href="#" title="'+sugar_app_strings.LBL_DRAWING_REINIT+'">&nbsp;</a><a id="@@_tool_undo" class="drawing_tool_general drawing_tool_undo" href="#" title="'+sugar_app_strings.LBL_DRAWING_UNDO+'">&nbsp;</a>&nbsp;&nbsp;&nbsp;<a id="@@_tool_eraser" class="drawing_tool_brush drawing_tool_eraser" href="#" title="'+sugar_app_strings.LBL_DRAWING_ERASER+'">&nbsp;</a><a id="@@_tool_hand" class="drawing_tool_brush drawing_tool_hand drawing_tool_selected" href="#" title="'+sugar_app_strings.LBL_DRAWING_HAND+'">&nbsp;</a><a id="@@_tool_line" class="drawing_tool_brush drawing_tool_line drawing_nosign" href="#" title="'+sugar_app_strings.LBL_DRAWING_LINE+'">&nbsp;</a><a id="@@_tool_rect" class="drawing_tool_brush drawing_tool_rect drawing_nosign" href="#" title="'+sugar_app_strings.LBL_DRAWING_RECT+'">&nbsp;</a><a id="@@_tool_ellipse" class="drawing_tool_brush drawing_tool_ellipse drawing_nosign" href="#" title="'+sugar_app_strings.LBL_DRAWING_ELLIPSE+'">&nbsp;</a><a id="@@_tool_text" class="drawing_tool_brush drawing_tool_text" href="#" title="'+sugar_app_strings.LBL_DRAWING_TEXT+'">&nbsp;</a></div><div class="drawing" style="width:'+e.toString()+"px;height:"+h.toString()+'px"><div class="drawing_left_tools"><span class="drawing_tool_font">'+sugar_app_strings.LBL_DRAWING_TEXTINPUT+'&nbsp;&nbsp;</span><input id="@@_tool_textinput" class="drawing_tool_font" value="" ><br/><span class="drawing_tool_font">'+sugar_app_strings.LBL_DRAWING_FONTSIZE+'&nbsp;&nbsp;</span><a id="@@_tool_fontsmall" class="drawing_tool_font" href="#">'+sugar_app_strings.LBL_DRAWING_FONTSMALL+'</a><a id="@@_tool_fontmedium" class="drawing_tool_font drawing_tool_selected" href="#">'+sugar_app_strings.LBL_DRAWING_FONTMEDIUM+'</a><a id="@@_tool_fontlarge" class="drawing_tool_font" href="#">'+sugar_app_strings.LBL_DRAWING_FONTLARGE+'</a></div><br/><canvas id="@@_canvas" name="@@_canvas" class="drawing_canvas" style="width:'+e.toString()+"px;height:"+a.toString()+'px"></canvas></div><div style="clear:both"/><div class="drawing_right_tools drawing_nosign"><span class="drawing_tool_width">'+sugar_app_strings.LBL_DRAWING_STROKEWIDTH+'</span><a id="@@_tool_width1" class="drawing_tool_width" href="#">'+sugar_app_strings.LBL_DRAWING_WIDTH1+'</a><a id="@@_tool_width3" class="drawing_tool_width drawing_tool_selected " href="#">'+sugar_app_strings.LBL_DRAWING_WIDTH3+'</a><a id="@@_tool_width5" class="drawing_tool_width" href="#">'+sugar_app_strings.LBL_DRAWING_WIDTH5+'</a><a id="@@_tool_width10" class="drawing_tool_width" href="#">'+sugar_app_strings.LBL_DRAWING_WIDTH10+'</a><span class="drawing_tool_color">'+sugar_app_strings.LBL_DRAWING_STROKECOLORS+'</span><a id="@@_tool_black" class="drawing_tool_color drawing_tool_black drawing_tool_selected" href="#" title="'+sugar_app_strings.LBL_DRAWING_BLACK+'">&nbsp;</a><a id="@@_tool_red" class="drawing_tool_color drawing_tool_red" href="#" title="'+sugar_app_strings.LBL_DRAWING_RED+'">&nbsp;</a><a id="@@_tool_green" class="drawing_tool_color drawing_tool_green" href="#" title="'+sugar_app_strings.LBL_DRAWING_GREEN+'">&nbsp;</a><a id="@@_tool_blue" class="drawing_tool_color drawing_tool_blue" href="#" title="'+sugar_app_strings.LBL_DRAWING_BLUE+'">&nbsp;</a><span class="drawing_tool_fillcolor">'+sugar_app_strings.LBL_DRAWING_FILLCOLORS+'</span><a id="@@_tool_fillnone" class="drawing_tool_fillcolor drawing_tool_none" href="#" title="'+sugar_app_strings.LBL_DRAWING_FILLNONE+'">&nbsp;</a><a id="@@_tool_fillblack" class="drawing_tool_fillcolor drawing_tool_black drawing_tool_selected" href="#" title="'+sugar_app_strings.LBL_DRAWING_FILLBLACK+'">&nbsp;</a><a id="@@_tool_fillred" class="drawing_tool_fillcolor drawing_tool_red" href="#" title="'+sugar_app_strings.LBL_DRAWING_FILLRED+'">&nbsp;</a><a id="@@_tool_fillgreen" class="drawing_tool_fillcolor drawing_tool_green" href="#" title="'+sugar_app_strings.LBL_DRAWING_FILLGREEN+'">&nbsp;</a><a id="@@_tool_fillblue" class="drawing_tool_fillcolor drawing_tool_blue" href="#" title="'+sugar_app_strings.LBL_DRAWING_FILLBLUE+'">&nbsp;</a></div><input type="hidden" id="@@" name="@@" value="" ><input type="hidden" id="@@_delete" name="@@_delete" value="0" ></div><div style="clear:left"/>',f=$("<div class='ui-field-contain'/>"),lab="<label for='"+b+"'>"+d+"</label>",ctrl=g.replace(/@@/g,b);f.append(lab);f.append(ctrl);return f}function init_labels(e,a){for(var d in a){var b="",g=a[d];if(sugar_mod_fields[e][g]!==undefined&&sugar_mod_fields[e][g].req){b="<em>* </em>"}$('label[for="Edit'+e+"_"+g+'"]').html(b+display_label(e,g))}}function CopyFieldsFromRelated(d,b,g,a){function e(l,h,n){if(n==="duration_minutes"||n==="duration_hours"){l.selectmenu("refresh")}else{var m=sugar_mod_fields[h][n];if(m){if(m.type==="enum"){l.selectmenu("refresh")}}}}$.each(d,function(q,p){var l;if(add_prefixes.indexOf(p.from)!==-1&&add_prefixes.indexOf(p.copy)!==-1){for(var o in QCRM.addressFields){var s="_address_"+QCRM.addressFields[o],u=p.from+s,n=g.replace("#","")+p.copy+s;l=$("#"+n);l.val("");if(b[u]){var r=HTMLDecode(b[u].value);l.val(r);l.textinput()}}}else{l=$(g+p.copy);if(l){var h=true;try{if(typeof p.compute==="function"){l.val(p.compute(b))}else{if(typeof p.fnct==="function"){l.val(p.fnct(b))}else{if(b[p.from]){l.val(HTMLDecode(b[p.from].value));try{l.textinput()}catch(m){}}else{h=false}}}if(h){e(l,a,p.copy)}}catch(m){}}}})}function CopyFieldsToRelated(b,a,d){$.each(b,function(e,n){var h;if(add_prefixes.indexOf(n.from)!==-1&&add_prefixes.indexOf(n.copy)!==-1){for(var o in QCRM.addressFields){var m=QCRM.addressFields[o],g=n.from+"_address_"+m;h=$(d+n.copy+"_address_"+m);if(h&&h.val()!==""){a[g]={name:g,value:h.val()}}}}else{h=$(d+n.copy);if(h){try{if(typeof n.compute==="function"){}else{if(typeof n.fnct==="function"){}else{if(h.val()!==""){a[n.from]={name:n.from,value:h.val()}}}}}catch(l){}}}})}function pickRelate(p,h,n,o,d,g,b,m,z){var v=(b==="Search"),a="#"+(b===""||b==="Search"?(b+p+"_"):b),w=$(a+n),r=w.val(),s=$(a+n+"L"),e=Beans[o],l=[],q;if(z===undefined){z=1}$(a+h).val("");$("#"+p+"parentJJWG").val("");function u(D,C,B){$(a+h).val(D);if(b!=="Search"){CopyFieldsFromRelated(g,C,a,o);if(p=="Meetings"&&JJWG.modules.indexOf(p)!=-1&&JJWG.modules.indexOf(o)!=-1&&C.jjwg_maps_geocode_status_c){JJWG.encodeFields(p,p+"parentJJWG",C)}}w.val(HTMLDecode(B));if(!iOS){if(document.activeElement){document.activeElement.blur()}}s.html("");s.listview("refresh");if(m!==undefined){m(D,r)}}function A(H){if(!H){return}var D=H.entry_list,F=D.length;s.empty();for(var E=0;E<F;E++){var G=$('<li data-icon="false"/>'),J=D[E].name_value_list,B=$("<a/>",{href:"#"}),C=e.DisplayTitle(J),I=e.DisplayTitleExtended(J);B.click({id:D[E].id,nvl:J,name:C},function(K){u(K.data.id,K.data.nvl,K.data.name)});B.append(I);G.append(B);s.append(G)}s.listview().listview("refresh")}if(r.length<z){s.empty();if(m!==undefined){m("","")}}else{if(e===undefined){e=SimpleBeans[o];e.search(r,A)}else{q=matchName(e,"default",r.replace(/'/g,"''"));if(typeof d==="function"){d=d("#"+b)}if(d){q+=(d!==""?((q==""?"":" AND ")+"("+d+")"):"")}QCRM.get_entry_list(o,q,e.ListFieldsToSelect(l),"",0,QCRM.maxPickRelate,e.OrderBy,A)}}}function get_parent_types(b){var e={},a=sugar_app_list_strings.parent_type_display,d;if(b&&b.options&&sugar_app_list_strings[b.options]){a=sugar_app_list_strings[b.options]}$.each(a,function(h,g){if(h!==""){if(Beans[h]!==undefined&&Beans[h].Enabled()){e[h]=g}}});return e}function init_google_address(e,d,a){var g=sugar_mod_strings[e]["LBL_"+d.toUpperCase()+"_ADDRESS"].replace(":","")+": "+RES_SEARCH_LABEL+" (Google)";c=$("<div class='ui-grid-a my-breakpoint'/>"),c1=$("<div class='ui-block-a'/>"),c2=$("<div class='ui-block-b'/>"),search='<input id="'+e+d+'autocomplete" placeholder="'+g+'" type="text">',here=$('<a id="'+e+d+'here" href="#" data-icon="location" '+button_defaults+">&nbsp;"+RES_HERE+"&nbsp;</a>"),google_empty_results={street:"",city:"",state:"",country:"",postalcode:""};function b(m){var p={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",country:"long_name",postal_code:"short_name"},h={street_number:"",route:"",locality:"",administrative_area_level_1:"",country:"",postal_code:""},o=google_empty_results;for(var n=0;n<m.length;n++){var l=m[n].types[0];if(p[l]){var q=m[n][p[l]];h[l]=q}}o={street:h.route,city:h.locality,state:h.administrative_area_level_1,country:h.country,postalcode:h.postal_code};if(h.street_number!=""){o.street=h.street_number+" "+o.street}return o}a.append(c);if(QCRM.GooglePlacesSearch){c1.append(search);c.append(c1);if(QCRM.GooglePlacesMode=="SearchBox"){JJWG.autocomplete[e+d]=new google.maps.places.SearchBox((document.getElementById(e+d+"autocomplete")),{});JJWG.autocomplete[e+d].addListener("places_changed",function(){var l=JJWG.autocomplete[e+d].getPlaces(),h,n=google_empty_results;if(l.length==0){return}for(var m in l){h=l[m];if(h&&h.address_components){n=b(h.address_components);break}}for(var o in n){QCRM.SetFieldValue(e,d+"_address_"+o,n[o])}$("#"+e+d+"autocomplete").val("")})}else{JJWG.autocomplete[e+d]=new google.maps.places.Autocomplete((document.getElementById(e+d+"autocomplete")),{types:QCRM.GooglePlacesTypes});JJWG.autocomplete[e+d].addListener("place_changed",function(){var h=JJWG.autocomplete[e+d].getPlace(),l=google_empty_results;if(h&&h.address_components){l=b(h.address_components)}for(var m in l){QCRM.SetFieldValue(e,d+"_address_"+m,l[m])}$("#"+e+d+"autocomplete").val("")})}}if(QCRM.AddressSearchHere){c2.append(here);c.append(c2);here.click(function(){QCRM.CurrentLocationDetails(function(l,h){if(h===google.maps.GeocoderStatus.OK||h===google.maps.GeocoderStatus.APPROXIMATE){l=b(l[1].address_components);for(var m in l){QCRM.SetFieldValue(e,d+"_address_"+m,l[m])}}})})}}function init_add_form(a,G,s,e,C){var M=C&&C.substring(0,3)=="IE_";if(s===undefined){s=[]}if(e===undefined){e=$("#Edit"+a+"Additional")}if(C===undefined){C="Edit"+a+"_"}for(var L in G){var J=G[L],v=sugar_mod_fields[a][J],H=false,u=false;if(J.substring(0,4)==="$ADD"){var O=J.substring(4);init_add_form(a,getAddressFields(O,a),[],e,C);continue}if(v===undefined){continue}if(v.readonly!==undefined&&(v.readonly===true||v.type==="readonly")){u=true}if((v.source==="non-db"&&v.type!=="Drawing")||s.indexOf(J)!==-1){continue}if(v.create_edit){v.create_edit(a,J,e,C);continue}if(SugarFields[v.type]&&SugarFields[v.type].create_edit){SugarFields[v.type].create_edit(a,J,e,C);continue}if(J==="duration_minutes"){continue}if(J==="duration_hours"){init_add_form_duration(a,"duration_hours","duration_minutes",RES_DURATION_LABEL,e,C);continue}var q=C+J,r;if(v.init_form!==undefined){H=v.init_form()}else{switch(v.type){case"name":case"varchar":case"char":case"iframe":case"url":H=create_text_form(q,display_label(a,J),v.req,!u);break;case"enum":H=create_enum_form(q,display_label(a,J),sugar_app_list_strings[v.options],false,v.req,false);if(v.parentenum!==undefined){if(Beans[a].AdditionalFields.indexOf(v.parentenum)!==-1){$("#"+C+v.parentenum).bind("change",{m:a,f:v.parentenum,subf:J},function(b){updateDynamicEnum(b.data.m,b.data.f,b.data.subf)})}}break;case"date":H=create_date_form(q,display_label(a,J),v.req,!u);break;case"datetime":H=create_datetime_form(q,display_label(a,J),v.req,!u);break;case"int":H=create_number_form(q,display_label(a,J),v.req,!u);break;case"Rate":H=create_number_form(q,display_label(a,J),v.req,!u);break;case"currency":case"float":case"decimal":case"double":H=create_number_decimal_form(q,display_label(a,J),v.req,!u);break;case"bool":case"boolean":H=$("<div class='ui-field-contain' id='"+C+J+"div'/>");var n=v.req?"<em>* </em>":"",F=$('<fieldset data-role="controlgroup" data-type="horizontal" data-mini="true"/>');r="<legend>"+n+sugar_mod_strings[a][sugar_mod_fields[a][J].label]+'</legend><input type="radio" name="'+C+J+'" id="'+C+J+'0" value="0" checked="checked"  data-theme="c"><label for="'+C+J+'0">'+RES_NO_LABEL+'</label><input type="radio" name="'+C+J+'" id="'+C+J+'1" value="1" data-theme="c"><label for="'+C+J+'1">'+RES_YES_LABEL+"</label>";F.html(r);H.append(F);break;case"text":case"TextOperators":H=create_textarea_form(q,display_label(a,J),v.req);break;case"email":H=create_email_form(q,display_label(a,J),v.req,!u);break;case"phone":H=create_phone_form(q,display_label(a,J),v.req,!u);break;case"relate":var l=v.module,m=C+v.id_name,B=(l==="Accounts"&&C==("Edit"+a+"_")),N=a+J+"C",p,D,h=v.copyfields===undefined?[]:v.copyfields,I=(M||Q_API<"3.0")?"":v.initial_filter;if(Beans[l]!==undefined&&Beans[l].Enabled()){H=create_text_form(q,display_label(a,J),v.req,!u,true);H.append('<ul id="'+C+J+'L" data-role="listview" data-inset="true" data-theme="c"/><input type="hidden" name="'+C+v.id_name+'" id="'+C+v.id_name+'">');if(B){D=$('<div id="'+N+'G" data-role="controlgroup" data-type="horizontal"><legend>&nbsp;</legend></div>');p=$('<a id="'+N+'" href="#" '+button_defaults+">"+sugar_mod_strings[l].NEW+"</a>");p.click({newmod:l,field:J,mod:a,idfield:v.id_name},function(b){CreateFromEditForm(b.data.newmod,b.data.mod,b.data.field,b.data.idfield)});D.append(p);H.append(D)}H.on("input",(function(d,P,T,R,S,b,g,Q){return function(V){var U;if(g){U=$("#"+d+T+"CG");U.show()}pickRelate(d,P,T,R,Q,S,b,function(X,W){if(g){if(X==""&&W!=""){U.show()}else{U.hide()}}})}})(a,v.id_name,J,v.module,h,C,B,I||""))}else{if(SimpleBeans[l]!==undefined){r={};if((J!=="assigned_user_name")&&!v.req){r[""]=" ---- "}for(var o in SimpleBeans[v.module].List){r[o]=SimpleBeans[v.module].List[o]}H=create_enum_form(q,display_label(a,J),r,false,v.req,false)}}break;case"parent":H=$("<div class='ui-field-contain'/>");var K=$("<div class='ui-grid-a'/>"),A=$("<div class='ui-block-a'/>"),z=$("<div class='ui-block-b'/>"),E=$(create_select(C+v.id_type,get_parent_types(v),"Accounts",true)),w=$('<input type="text" id="'+C+J+'">');E.bind("change",{m:a,n:J,i:v.id_name},function(b){$("#"+C+b.data.n).val("");$("#"+C+b.data.i).val("")});w.on("input",(function(d,g,R,P,Q,b){return function(T){var U=$("#"+C+P).val(),S=(Q!==undefined&&Q[U]!==undefined)?Q[U]:[];pickRelate(d,g,R,U,"",S,b)}})(a,v.id_name,J,v.id_type,v.copyfields,C));A.append(E);z.append(w);K.append(A);K.append(z);H.html('<label for="prefix+fielddef.id_type">'+(v.req?"<em>* </em>":"")+sugar_mod_strings[a][sugar_mod_fields[a][J].label]+"</label>");H.append(K);H.append('<input type="hidden" name="'+C+v.id_name+'" id="'+C+v.id_name+'"><ul id="'+C+J+'L" data-role="listview" data-inset="true" data-theme="c"/>');break;case"multienum":H=create_multienum_form(q,display_label(a,J),sugar_app_list_strings[v.options],v.req,false);break;case"Drawing":if(M){H=create_drawing(q,display_label(a,J),v)}break;case"image":case"photo":H=create_upload(q,display_label(a,J),a,J,v,M);break;default:break}}if(H!==false){e.append(H);if(u){QCRM.SetFieldReadonly(a,J,true)}if(v.add_listener){v.add_listener()}if(v.type==="text"&&v.html){$("#"+q).bind("input propertychange",(function(b){return function(){$("#"+b+"chng").val("1")}})(q))}}}}function init_add_form_duration(e,q,o,p,r,l){var n=$("<div class='ui-field-contain'/>"),m=$("<fieldset data-role='controlgroup' data-mini='true' data-type='horizontal'/>"),b="";m.append("<legend><em>* </em>"+p+"</legend>");var h="<label for='"+l+q+"' class='select'>"+b+display_label(e,q)+"</label>",d=$("<select name='"+l+q+"' id='"+l+q+"' data-theme='c'/>");for(var a in ["0","1","2","3","4","5","6","7","8"]){d.append($("<option value='"+a+"'/>").append(a+" h"))}m.append(h);m.append(d);h="<label for='"+l+o+"' class='select'>"+b+display_label(e,o)+"</label>";d=create_select(l+o,sugar_app_list_strings.duration_intervals,"0",false,false);m.append(h);m.append(d);n.append(m);r.append(n)}function onChangeDateEnum(a){if($("#"+a+"E").val()=="between"){$("#"+a+"FromTo").show()}else{$("#"+a+"FromTo").hide()}}function init_search_fields(g,h,o){var B,n=$("#"+g+"DivMoreOptions");if(o){n=$("#"+g+o)}for(B in h){var z=h[B],p=sugar_mod_fields[g][z],w,m,a="Search"+g+"_"+z;if(p==undefined){continue}else{if(p.init_search){w=p.init_search(g)}else{switch(p.type){case"name":case"varchar":case"char":case"text":case"TextOperators":case"email":case"phone":w=create_text_form(a,display_label(g,z),false,true,true);break;case"enum":case"dynamicenum":case"multienum":if(p.singleSelect){w=create_enum_form(a,display_label(g,z),sugar_app_list_strings[p.options],false,true)}else{w=create_multienum_form2(a,display_label(g,z),sugar_app_list_strings[p.options],false,true)}break;case"date":case"datetime":m=create_enum_form(a+"E",display_label(g,z),sugar_app_list_strings.date_search,false,false,true,"=");m.change({ctrl:a},function(b){onChangeDateEnum(b.data.ctrl)});w=$("<div/>");w.append(m);m=$('<div id="'+a+'FromTo" class="from-to-div" style="display: none;"/>');m.append(create_picker("date",a+"From",RES_SEARCH_FROM,false,true,"qcrm_fromto"));m.append(create_picker("date",a+"To",RES_SEARCH_TO,false,true,"qcrm_fromto"));w.append(m);break;case"currency":case"int":case"ua_rating":case"Rate":case"float":case"decimal":case"double":m="<legend>"+display_label(g,z)+"</legend>";w=$('<div id="Search'+g+"_"+z+'"_group data-role="controlgroup" data-mini="true" />');w.append(m);w.append(create_number_form(a+"From",">=",false,true));w.append(create_number_form(a+"To","<=",false,true));break;case"bool":case"boolean":w=create_enum_form(a,sugar_mod_strings[g][sugar_mod_fields[g][z].label],{"":" --- ","1":RES_YES_LABEL,"0":RES_NO_LABEL},false,false,true," ");break;case"relate":if(z==="assigned_user_name"&&QCRM.multiple_assigned){w=create_enum_form(a,sugar_mod_strings[g][sugar_mod_fields[g][z].label],SimpleBeans[p.module].List,true,false,true,"")}else{if(Beans[p.module]===undefined){m={};m[""]=" ---- ";for(var l in SimpleBeans[p.module].List){m[l]=SimpleBeans[p.module].List[l]}w=create_enum_form(a,sugar_mod_strings[g][sugar_mod_fields[g][z].label],m,false,false,true,"")}else{w=create_text_form(a,display_label(g,z),false,true,true);var e="Search"+g+"_"+p.id_name;w.append('<ul id="Search'+g+"_"+z+'L" data-role="listview" data-inset="true" data-theme="c"/><input type="hidden" name="'+e+'" id="'+e+'">');if(Q_API<"3.0"&&p.source=="non-db"){w.hide()}else{w.on("input",(function(b,d,D,C){return function(E){pickRelate(b,d,D,C,"",[],"Search")}})(g,p.id_name,z,p.module))}}}break;case"parent":w=$("<div class='ui-field-contain'/>");var u="Search"+g+"_",A=$("<div class='ui-grid-a'/>"),s=$("<div class='ui-block-a'/>"),r=$("<div class='ui-block-b'/>"),v=$(create_select(u+p.id_type,get_parent_types(p),"Accounts",true)),q=$('<input type="text" id="'+u+z+'">');s.append(v);r.append(q);A.append(s);A.append(r);w.html("<p>"+(p.req?"<em>* </em>":"")+sugar_mod_strings[g][sugar_mod_fields[g][z].label]+"</p>");w.append(A);w.append('<input type="hidden" name="'+u+p.id_name+'" id="'+u+p.id_name+'"><ul id="'+u+z+'L" data-role="listview" data-inset="true" data-theme="c"/>');if(Q_API<"3.0"){w.hide()}else{v.bind("change",{m:g,n:z,i:p.id_name},function(b){$("#"+u+b.data.n).val("");$("#"+u+b.data.i).val("")});q.on("input",(function(b,d,D,C){return function(E){var F=$("#"+u+C).val();pickRelate(b,d,D,F,"",[],"Search")}})(g,p.id_name,z,p.id_type))}break;default:break}}}n.append(w);if(p.type==="date"||p.type==="datetime"){init_picker("#"+a+"From","date","");init_picker("#"+a+"To","date","")}}}function init_search_form(e,l){var a,h=$("#"+e+"DivMoreOptions");init_search_fields(e,l);h.append(createSortOrderDropdown("SOrder"+e,RES_SORTORDER,e));var g,m;h.append(create_text_form(e+"SaveAs",RES_SAVESEARCH,false,false));m=$('<div class="ui-grid-b" id="'+e+'SBtns" style="display:none;"/>');if(Beans.QCRM_SavedSearch!==undefined){if(!sugar_app_strings.LBL_SHARE_PRIVATE){sugar_app_strings.LBL_SHARE_PRIVATE="Private"}m.append($("<div id='PUBD"+e+"' class='ui-block-a'/>").append('<select name="PUB'+e+'" id="PUB'+e+'" data-mini="true" data-role="slider" data-track-theme="c" data-theme="d"><option value="0">'+sugar_app_strings.LBL_SHARE_PRIVATE+'</option><option value="1">'+sugar_app_strings.LBL_SHARE_PUBLIC+"</option></select>"))}m.append($("<div class='ui-block-b'/>").append('<a id="'+e+'SSaveBtn" href="#" '+button_defaults+">"+sugar_app_strings.LBL_SAVE_BUTTON_LABEL+'</a><span id="'+e+'SaveSaved" style="color:red;display:none;">'+sugar_app_strings.LBL_SAVED+"</span>"));h.append(m);m=$('<div id="'+e+'HSavedT" style="display:none;"/>');g=$('<div data-role="controlgroup" data-type="horizontal" data-mini="true" />');g.append("<legend>"+RES_HOME_LABEL+'</legend><input type="radio" name="'+e+'HSavedS" id="HSavedN'+e+'"  value="N" checked="checked" data-theme="c"><label for="HSavedN'+e+'">'+RES_NONE+'</label><input type="radio" name="'+e+'HSavedS" id="HSavedI'+e+'"  value="I" data-theme="c"><label for="HSavedI'+e+'">'+RES_ICON+'</label><input type="radio" name="'+e+'HSavedS" id="HSavedD'+e+'"  value="D" data-theme="c"><label for="HSavedD'+e+'">Dashlet</label>');m.append($('<div class="ui-field-contain"/>').append(g));h.append(m);$("#"+e+"SaveAs").bind("keyup change",function(){ClearSavedSearch(e,true)});$("#"+e+"SSaveBtn").click({val:e},function(b){SaveSearch(b.data.val)});$("input[name='"+e+"HSavedS']").bind("change",function(d){var b=$("#"+e+"ES").val();if(b!=="0"&&QCRM.SavedSearches[b]){updateIconOrDashlet(e,b);SaveHomePageDef();updateDashlets()}QCRM.UpdFavIcons=true})}function SavedSearchToggle(b,e){var d=$("#"+b+"SBtns"),a=$("#"+b+"ES").val();if($("#"+b+"SaveAs").val().trim().length>0&&!e){d.show()}else{d.hide()}if(a!==undefined&&a!=="0"){$("#"+b+"HSavedT").show()}else{$("#"+b+"HSavedT").hide()}if(Beans.QCRM_SavedSearch!==undefined){if((db_type!=="mssql")&&(UserIsAdmin||QCRM.share_search==="All"||(typeof QCRM.share_search==="object"&&QCRM.share_search.indexOf(CurrentUserId)!==-1))){$("#PUBD"+b).show()}else{$("#PUBD"+b).hide()}}}function getSavedSearchList(b,h){var e=QCRM.SavedSearches,g=true,l={"0":" --- "};if(h){l.ALL=sugar_app_strings.LBL_LISTVIEW_ALL||"All"}for(var a in e){var d=e[a];if(d&&d.type===b&&d.name&&d.name!==""){g=false;l[a]=d.name}}if(g){return false}else{return l}}function SavedSearchEnum(d,a){var l,b=$("#"+d+"SS"),m=$("#filters"+d);lstopt=getSavedSearchList(d);lstopt2=getSavedSearchList(d,true);if(lstopt===false){b.hide();m.hide()}else{b.empty();m.empty();var h=create_enum_form(d+"ES",RES_SAVEDSEARCH+" ",lstopt,false,false,true,a),g=$(create_select(d+"EL",lstopt2,a,true,false,false,false));h.change(function(e,n){onChangeSearch(d);$("#"+d+"EL").val($(this).val())});g.change(function(e,o){var n=$(this).val();$("#"+d+"ES").val(n);if(n!="0"){if(n=="ALL"){clearSearchValues(d)}onChangeSearch(d);SaveLastSearch(d)}StartSearch(d)});m.append(g);b.append(h);h=$('<div id="'+d+'SSDN"/>');l=$("<a/>",{href:"#",click:function(){DelCurrentSavedSearch(d)}});l.text(sugar_app_strings.LBL_DELETE_BUTTON_LABEL);h.append(l);h.append("&nbsp;&nbsp;&nbsp;");l=$("<a/>",{href:"#Rename",click:function(){OpenRename($("#"+d+"SaveAs").val(),d,"",RenCurrentSavedSearch)}});l.text(RES_RENAME);h.append(l);b.append(h);if(a===""){h.hide()}else{h.show()}b.show();m.show()}}function StartSearch(d){var a=Beans[d],b=readSortOrderDropdown("SOrder"+d,d);a.CurrentSearchValues=readSearchValues(d);if(b!==a.CurrentSearchOrder){a.CurrentSearch=false;a.CurrentSearchOrder=b}SaveMyItems(d,$("#"+d+"MyItems").is(":checked"));if($("body").pagecontainer("getActivePage").attr("id")==(d+"ListPage")){a.GetList(a.CurrentOffset)}else{$("body").pagecontainer("change","#"+d+"ListPage")}}function SaveSearch(b){var d=$("#"+b+"SaveSaved"),a;SaveMyItems(b,$("#"+b+"MyItems").is(":checked"));a=updateSavedSearch(b,readSearchValues(b),readSortOrderDropdown("SOrder"+b,b));SavedSearchEnum(b,a===false?"":a);SavedSearchToggle(b);d.show();setTimeout(function(){d.hide()},2000)}function SaveLastSearch(b){var a={values:readSearchValues(b),order:readSortOrderDropdown("SOrder"+b,b)};localStorage.setItem(ServerAddress+"LS"+b,JSON.stringify(a))}function LoadLastSearch(b){var a=localStorage.getItem(ServerAddress+"LS"+b);if(a!==null&&a!=""){a=jQuery.parseJSON(a);loadSearchFields(b,a.values,a.order);Beans[b].CurrentSearchValues=a.values;Beans[b].CurrentSearchOrder=a.order}}function readSearchValues(e){var a=[],h=e+"DivMoreOptions",d=e+"basic_search",g=e+"SaveAs";var b="Settings"+e+"Search";a.push({field:b,type:"txt",val:$("#"+b).val()});$("#"+h+" [type=checkbox], #"+d+" [type=checkbox]").each(function(m,l){a.push({field:this.id,type:"chk",val:$(this).is(":checked")})});$("#"+h+" input[type!=checkbox], #"+d+" input[type!=checkbox]").each(function(m,l){var o=$(this).val();if(this.name!==""&&o!==""&&this.name.substring(0,4)==="Pick"){var n=$(this).mobiscroll("getDate");if(n!==null&&l!==""){o=toDBDate(n)}}if(this.id.substring(0,3)!=="HSa"&&this.id!==g){a.push({field:this.id,type:"txt",val:o})}});$("#"+h+" select, #"+d+" select").each(function(m,l){a.push({field:this.id,type:"sel",val:$(this).val()})});return a}function clearSearchValues(e){var l=e+"DivMoreOptions",d=e+"basic_search",a=Beans[e].SearchFields.concat(Beans[e].basic_search),b,h,g;$("#"+l+" [type=checkbox], #"+d+" [type=checkbox]").each(function(n,m){$(this).prop("checked",false).checkboxradio("refresh")});$("#"+l+" input[type!=checkbox], #"+d+" input[type!=checkbox]").each(function(n,m){if(this.name&&this.name.substring(0,4)==="Pick"){$(this).mobiscroll("setDate",new Date(),false)}else{$(this).val("")}});$("#"+l+" select, #"+d+" select").each(function(n,m){$("#"+this.id+" option").prop("selected",false);$("#"+this.id+" option:first").prop("selected","selected");if(this.id===("PUB"+e)){$(this).slider("refresh")}else{try{$(this).selectmenu("refresh")}catch(o){}}});for(b in a){h=a[b];g=sugar_mod_fields[e][h];if(g!==undefined&&((h==="assigned_user_name"&&QCRM.multiple_assigned)||g.type==="enum"||g.type==="multienum")){set_multienum_val("#Search"+e+"_"+h,[])}}ClearSavedSearch(e);loadSortOrderDropdown(e,Beans[e].OrderBy);$("#SForm"+e+" .from-to-div").hide()}function SavedSearchDisplayType(a){if(QCRM.DashletMember(QCRM.Dashlets,a)){return"D"}else{if(QCRM.DashletMember(QCRM.searchIcons,a)){return"I"}}return"N"}function loadSearchFields(b,g,d){var l=b+"SaveAs",n="PUB"+b;for(var m in g){var h=g[m];if(h.field!==l&&(h.field!==n)){try{var a=$("#"+h.field);if(h.type==="chk"){a.prop("checked",h.val).checkboxradio("refresh")}else{if(h.val!==""&&a.attr("name")!==undefined&&a.attr("name").substring(0,4)==="Pick"){a.mobiscroll("setDate",fromDBDate(h.val),true)}else{if(h.type==="sel"){if(h.field===("Search"+b+"_assigned_user_name")&&h.val&&typeof h.val==="string"){h.val=[h.val]}a.val(h.val).selectmenu("refresh")}else{a.val(h.val)}}}}catch(e){}}}loadSortOrderDropdown(b,d)}function loadSearchValues(d,b){var a=QCRM.SavedSearches[b],e=SavedSearchDisplayType(b),g=d+"SaveAs";loadSearchFields(d,a.fields,a.sort_order);$("#HSavedN"+d).prop("checked",(e==="N")).checkboxradio("refresh");$("#HSavedI"+d).prop("checked",e==="I").checkboxradio("refresh");$("#HSavedD"+d).prop("checked",e==="D").checkboxradio("refresh");$("#"+g).val(a.name);if(Beans.QCRM_SavedSearch!==undefined){$("#PUB"+d).val(a[shared_field]);$("#PUB"+d).slider("refresh")}}function onChangeSearch(d){var m=$("#"+d+"ES").val(),h=true,b=true,g=$("#"+d+"SSDN");if(m!==undefined&&m!==" "&&m!=="0"){var a=QCRM.SavedSearches,e=a[m];loadSearchValues(d,m);loadSortOrderDropdown(d,e.sort_order);h=!UserIsAdmin&&e.assigned_user_id!==CurrentUserId;b=h}SavedSearchToggle(d,h);if(b){g.hide()}else{g.show()}}function ListSavedSearch(b){var d=QCRM.SavedSearches[b],a=d.type;Beans[a].CurrentSearchValues=d.fields;Beans[a].CurrentOffset=0;$("body").pagecontainer("change","#"+a+"ListPage")}function getHomePageDef(){var a={name:QCRM.homepage.name,assigned_user_id:QCRM.homepage.assigned_user_id,id:QCRM.homepage.id,icons:QCRM.searchIcons.slice(),dashlets:QCRM.Dashlets.slice(),today:Pref.Today,hidden:Pref.Hidden.slice(),creates:Pref.Creates.slice()};a[shared_field]=QCRM.homepage[shared_field];return a}function SaveHomePageDef(a){var b=getHomePageDef();if(QCRM.saveToCRM){b.saveToCRM=true}localStorage.setItem(ServerAddress+"Homepage",JSON.stringify(b));if(a&&(Beans.QCRM_SavedSearch!==undefined)&&!QCRM.OffLine){Beans.QCRM_Homepage.SaveAll()}}function LoadHomePageDef(){var a=localStorage.getItem(ServerAddress+"Homepage");if(a!==null&&a!=""){a=jQuery.parseJSON(a);Pref.Today=a.today;QCRM.searchIcons=a.icons;QCRM.Dashlets=a.dashlets;Pref.Hidden=a.hidden;Pref.Creates=a.creates;QCRM.homepage={name:a.name,id:a.id,assigned_user_id:a.assigned_user_id};QCRM.homepage[shared_field]=a[shared_field];if(a.saveToCRM){QCRM.saveToCRM=true}}else{$.each(QCRM.beans,function(b,d){if(!Beans[d].HomeIcon){Pref.Hidden=Pref.Hidden.concat(d)}})}}function SaveSearchesAndHomePage(a){localStorage.setItem(ServerAddress+"SavedSearch",JSON.stringify(QCRM.SavedSearches));SaveHomePageDef(a)}function ClearSavedSearch(b,a){if(!a){$("#"+b+"SaveAs").val("")}$("#"+b+"ES").val("0");if(Beans.QCRM_SavedSearch!==undefined){$("#PUB"+b).val("0");$("#PUB"+b).slider("refresh")}$("#HSavedN"+b).prop("checked",true).checkboxradio("refresh");$("#HSavedI"+b).prop("checked",false).checkboxradio("refresh");$("#HSavedD"+b).prop("checked",false).checkboxradio("refresh");SavedSearchToggle(b)}function RenCurrentSavedSearch(){var a=$("#RenInitModule").val(),d=$("#"+a+"ES").val(),b=$("#RenNewText").val().trim();if(d!==undefined&&d!==" "&&d!=="0"){if(UserIsAdmin||QCRM.SavedSearches[d].assigned_user_id===CurrentUserId){if(b!==$("#RenInitText").val()&&b!==""){QCRM.SavedSearches[d].name=b;SavedSearchEnum(a,d);QCRM.UpdFavIcons=true;updateDashlets();StoreSavedSearch(d,false);SaveSearchesAndHomePage(true);$("#"+a+"SaveAs").val(b)}}}}function DelCurrentSavedSearch(a){var b=$("#"+a+"ES").val();if(b!==undefined&&b!==" "&&b!=="0"){if(UserIsAdmin||QCRM.SavedSearches[b].assigned_user_id===CurrentUserId){ConfirmPopup(sugar_app_strings.NTC_DELETE_CONFIRMATION,function(){delete QCRM.SavedSearches[b];QCRM.DashletRemove(QCRM.Dashlets,b);QCRM.DashletRemove(QCRM.searchIcons,b);SavedSearchEnum(a,"");SaveSearchesAndHomePage();ClearSavedSearch(a);QCRM.UpdFavIcons=true;updateDashlets();if(Beans.QCRM_SavedSearch!==undefined){QCRM.delete_entry("QCRM_SavedSearch",b,function(d){})}return},"")}}}function DisplaySavedSearches(){var g,e,d=QCRM.SavedSearches,m=$("#SavedSearchList");m.empty();for(g in QCRM.beans){var h=true,b=QCRM.beans[g],a=sugar_app_list_strings.moduleList[b];if(Beans[b].ShowTab&&Beans[b].Enabled()){for(var e in d){var o=d[e],n=SavedSearchDisplayType(e);if(o.type===b){if(h){m.append('<li data-role="list-divider">'+a+"</li>");h=false}m.append('<li><div data-id="'+e+'" data-display="'+n+'" class="ms-line">'+o.name+"</div></li>")}}}}}function createDashlets(){var e=true,g,m=0,h=$("#dashletsLEFT"),a=$("#dashletsRIGHT"),d,l,b,n;h.empty();a.empty();for(m=0;m<QCRM.maxDashlets+((Pref.Today&&QCRM.ShowToday)?1:0);m++){d=e?h:a;g="dashlet"+m+"Div";b=$('<ul id="'+g+'" data-role="listview" data-inset="true" data-theme="c" data-filter="false" style="display:none"/>');l=getNavButtons(g);b.append("<li "+((Pref.Today&&QCRM.ShowToday&&m===0)?'data-type="today"':"")+">"+l+"</li>");n=$("<div/>");n.append(b);n.append('<div class="CRMTotals DashletTotals" style="display:none;" id="dtotals'+m+'"/>');d.append(n);if(m==0&&Pref.Today&&QCRM.ShowToday){$("#"+g+"L").click(function(o){QCRM.TodayDashlet.update(-1)});$("#"+g+"R").click(function(o){QCRM.TodayDashlet.update(1)})}else{$("#"+g+"L").click({val:m},function(o){display1Dashlet(o.data.val,QCRM.dashletsDiv[o.data.val].prev_offset)});$("#"+g+"R").click({val:m},function(o){display1Dashlet(o.data.val,QCRM.dashletsDiv[o.data.val].next_offset)})}e=!e}if(Pref.Today&&QCRM.ShowToday){$("#dashlet0DivT").on("tap",function(o){QCRM.TodayDashlet.handleTapHold();return false})}}function updateDashlets(){function g(h,m,l){$("#dashlet"+h+"Div").show();$("#dashlet"+h+"DivT").html(l);QCRM.dashletsDiv.push({index:h,savedsearch:m,current_offset:0,next_offset:0,result_count:0,total_count:false})}var b,a=0;QCRM.dashletsDiv=[];if(Pref.Today&&QCRM.ShowToday){g(a,-1,sugar_app_list_strings.date_search.today);QCRM.TodayDashlet.div="dashlet"+a+"Div";a++}else{}for(b in QCRM.Dashlets.slice()){var e=QCRM.SavedSearches[QCRM.Dashlets[b].id];if(e){var d=e.type;if(Beans[d]&&Beans[d].Enabled()){g(a,QCRM.Dashlets[b].id,e.name);a++}}else{QCRM.DashletRemove(QCRM.SavedSearches,QCRM.Dashlets[b].id)}}for(a;a<QCRM.maxDashlets+((Pref.Today&&QCRM.ShowToday)?1:0);a++){$("#dashlet"+a+"Div").hide();$("#dtotals"+a).hide()}}function display1Dashlet(h,d,l){var a=QCRM.dashletsDiv[h],g="dashlet"+a.index+"Div";QCRM.dashletsDiv[h].current_offset=d;if(h==0&&Pref.Today&&QCRM.ShowToday){if(l){QCRM.TodayDashlet.display()}}else{if(QCRM.SavedSearches[a.savedsearch]){var n=QCRM.SavedSearches[a.savedsearch],b=n.type,e=get_where(b,n.fields),m=Beans[b];if(m&&m.Enabled()){$.mobile.loading("show");ShowBeansList(b,"",e,RowsPerDashlet,n.sort_order?n.sort_order:Beans[b].OrderBy,g,"HomePage",d,function(o){var p="#dtotals"+h;$.mobile.loading("hide");a.next_offset=o.next_offset;a.result_count=o.result_count;a.total_count=o.total_count;a.prev_offset=d-RowsPerDashlet;if(a.prev_offset<0){a.prev_offset=0}enableButton(g+"L",d!==0);enableButton(g+"R",!((a.result_count===0)||(a.total_count&&a.next_offset>=a.total_count)));if(QCRM.ShowTotals.dashlets&&m.ListTotals&&m.ShowTotals.dashlets){if(d==0){QCRM.getTotals(b,false,e,p,"H",n.fields)}}else{$(p).empty()}})}}}}function displayDashlets(a){var b;for(b in QCRM.dashletsDiv){if(b<QCRM.maxDashlets+((Pref.Today&&QCRM.ShowToday)?1:0)){display1Dashlet(b,0,a)}}}QCRM.DashletMember=function(b,d){var a;for(a in b){if(b[a].id===d){return true}}return false};QCRM.DashletAdd=function(a,b){a.push(b)};QCRM.DashletRemove=function(b,d){var a;for(a in b){if(b[a].id===d){b.splice(a,1);return}}return};function Dashlet(a,e,b,d){this.name=a;this.id=e;this.div="";this.type="Search";this.mode="Dashlet";this.navigation=(d==="Dashlet")}QCRM.TodayDashlet=new Dashlet(function(){return(toDBDate(this.CurDate)===toDBDate(CurrentDate))?sugar_app_list_strings.date_search.today:jQuery.mobiscroll.formatDate(date_format,this.CurDate)},"Today","Preset","Dashlet");QCRM.TodayDashlet.CurDate=new Date();QCRM.TodayDashlet.handleTapHold=function(){var d=$("#"+this.div+"T"),b="#todayN",a=create_picker("date","todayN","",false,true);QCRM.IEsavedContents=d.html();d.empty();d.append(a);init_picker(b,"date",QCRM.TodayDashlet.CurDate,{onSelect:function(g,e){QCRM.TodayDashlet.CurDate=$(b).mobiscroll("getDate");QCRM.TodayDashlet.display()},onCancel:function(g,e){d.html(QCRM.IEsavedContents)}});$(b).mobiscroll("show")};QCRM.TodayDashlet.display=function(n){var g=toDBDate(QCRM.TodayDashlet.CurDate),m=this.div,e=$("#"+m),a,l,h;$("#"+m+"T").html(this.name());GetCalendarMarked(QCRM.TodayDashlet.CurDate,0,0,function(d,b){$("#"+m+" li:gt(0)").remove();if(d[g]!==undefined){for(a=0;a<d[g].elements.length;a++){l=d[g].elements[a];h=(l.type=="native")?getCalendarLink(l.id,l.name_value_list):AddLinkWithIcon(l.type,l.id,"",l.name_value_list,l.phones,"HomePage",true,"");e.append(h)}}e.listview("refresh");if(mobile_app){}if(n!==undefined){n()}})};QCRM.TodayDashlet.update=function(a){if(Pref.Today&&QCRM.ShowToday){$.mobile.loading("show");if(a){QCRM.TodayDashlet.CurDate.addHours(24*a)}QCRM.TodayDashlet.display(function(){$.mobile.loading("hide")})}};function removeFromArray(b,d){var a=b.indexOf(d);if(a!==-1){b.splice(a,1)}}function StoreSavedSearch(d,b){var a=Record2NVL(QCRM.SavedSearches[d],Beans.QCRM_SavedSearch.ListFields);a.fields.value=btoa(JSON.stringify(a.fields.value));if(b){a.new_with_id={name:"new_with_id",value:"1"}}QCRM.set_entry("QCRM_SavedSearch",d,a,function(e){})}function updateIconOrDashlet(d,b){var g=$("input[name='"+d+"HSavedS']:checked").val(),e={id:b,type:"Search",module:d},a=(Beans.QCRM_SavedSearch!==undefined)&&!QCRM.OffLine;if(g!=="D"){QCRM.DashletRemove(QCRM.Dashlets,b)}if(g!=="I"){QCRM.DashletRemove(QCRM.searchIcons,b)}if(g==="D"){if(!QCRM.DashletMember(QCRM.Dashlets,b)){QCRM.DashletAdd(QCRM.Dashlets,e)}}if(g==="I"){if(!QCRM.DashletMember(QCRM.searchIcons,b)){QCRM.DashletAdd(QCRM.searchIcons,e)}}if(a){Beans.QCRM_Homepage.SaveAll(false)}}function cleanUpIconAndDashlet(){function a(b){var d,e,g=[];for(d in b){e=b[d];if(QCRM.SavedSearches[e.id]){g.push(e)}}return g}QCRM.Dashlets=a(QCRM.Dashlets);QCRM.searchIcons=a(QCRM.searchIcons)}function updateSavedSearch(e,p,h){var d,b=false,a=false,q=$("#"+e+"SaveAs").val().trim().replace('"',""),g=false,o=(Beans.QCRM_SavedSearch!==undefined);if(q!==""){var m=QCRM.SavedSearches;for(var n in m){var r=m[n];if(r.type===e&&q===r.name.trim()&&(r[shared_field]=="0"||r.assigned_user_id==CurrentUserId)){a=n;break}}if(o){g=$("#PUB"+e).val()}if(a){QCRM.SavedSearches[a].fields=p;QCRM.SavedSearches[a].sort_order=h;QCRM.SavedSearches[a][shared_field]=g}else{a=QCreateId();b=true;d=toDBDateTime(new (Date));QCRM.SavedSearches[a]={id:a,date_modified:d,date_entered:d,name:q,type:e,fields:p,sort_order:h,assigned_user_id:CurrentUserId};QCRM.SavedSearches[a][shared_field]=g}updateIconOrDashlet(e,a);SaveSearchesAndHomePage();QCRM.UpdFavIcons=true;updateDashlets();if(o){StoreSavedSearch(a,b)}}return a}function get_where(e,F){var s="",q=false,l=Beans[e],I=l.table,n=l.SearchFields,E=[];if(l.basic_search){n=n.concat(l.basic_search)}if(!F){}else{for(var H in F){E[F[H].field]={type:F[H].type,val:F[H].val}}if(true){for(var L in n){var J=n[L],C=sugar_mod_fields[e][J],w="",z="",A,D,g;if(C===undefined){continue}A=((C.source===null||C.source===undefined)?"":C.source);D="Search"+e+"_"+J;g=I+A+"."+J;if(C.get_where){try{if(E[D]&&E[D].val){w=E[D].val}s+=C.get_where(g,w,E)}catch(p){}}else{try{switch(C.type){case"name":case"varchar":case"char":case"text":case"TextOperators":case"phone":case"readonly":w=E[D].val;if(w!==""){s+=matchString(C.searchmode,g,w)}break;case"enum":case"dynamicenum":case"multienum":w=E[D].val;if(C.singleSelect){w=[w]}var G,a,r="",m=false,o="";for(G in w){a=w[G];if(a===""||(C.singleSelect&&a==="EMPTY")){m=true}else{if(C.type==="enum"){r+="'"+a+"'"}else{r+="("+g+" LIKE '%^"+a+"^%')"}}}if(m&&!C.singleSelect){o="("+g+" IS NULL OR "+g+"= '' OR "+g+" ='^^')"}if(r!==""){if(C.type==="enum"){r=r.replace(/''/g,"','");r="("+g+" in ("+r+"))"}else{r="("+r.replace(/\)\(/g,") OR (")+")"}r=r.replace(/'EMPTY'/g,"''");if(o!==""){s+="("+o+" OR "+r+")"}else{s+=r}}else{s+=o}break;case"date":case"datetime":var h=E[D+"E"].val,K=new Date(),B=new Date();if(h==="between"){w=E[D+"From"].val;z=E[D+"To"].val}else{if(h!=="="){var u=1900+K.getYear();switch(h){case"today":break;case"yesterday":K.setDate(K.getDate()-1);B.setDate(B.getDate()-1);break;case"tomorrow":K.setDate(K.getDate()+1);B.setDate(B.getDate()+1);break;case"past":K="";B.setDate(B.getDate()-1);break;case"future":K.setDate(K.getDate()+1);B="";break;case"next_7_days":B.setDate(K.getDate()+7);break;case"next_30_days":B.setDate(K.getDate()+30);break;case"last_7_days":K.setDate(K.getDate()-7);break;case"last_30_days":K.setDate(K.getDate()-30);break;case"this_year":K=new Date(u,0,1);B=new Date(u,11,31);break;case"next_year":K=new Date(u+1,0,1);B=new Date(u+1,11,31);break;case"last_year":K=new Date(u-1,0,1);B=new Date(u-1,11,31);break;case"this_month":K.setDate(1);B=new Date(u,K.getMonth()+1,0);break;case"next_month":B=new Date(u,K.getMonth()+2,0);K=new Date(u,K.getMonth()+1,1);break;case"last_month":B=new Date(u,K.getMonth(),0);K=new Date(u,K.getMonth()-1,1);break;default:break}if(C.type==="date"){w=toDBDate(K);z=toDBDate(B)}else{if(K===""){w=""}else{K.setHours(0);K.setMinutes(0);w=toDBDateTime(K)}if(B===""){z=""}else{B.setHours(23);B.setMinutes(59);z=toDBDateTime(B)}}}}if(w!==""){s+="("+g+" >= '"+w+"')"}if(z!==""){s+="("+g+" <= '"+z+"')"}break;case"currency":case"int":case"ua_rating":case"Rate":case"float":case"decimal":case"double":w=E[D+"From"].val;z=E[D+"To"].val;if(w!==""){s+="("+g+" >= "+w+")"}if(z!==""){s+="("+g+" <= "+z+")"}break;case"bool":case"boolean":w=E[D].val;if(w==="1"){s+="("+g+"=1 OR "+g+"='1')"}else{if(w==="0"){s+="("+g+"=0 OR "+g+" IS NULL)"}}break;case"relate":g=I+A+"."+C.id_name;if(J==="assigned_user_name"&&QCRM.multiple_assigned){w=E[D].val;if(w){if(typeof w==="object"){s+="("+g+" IN ('"+w.join("','")+"'))";break}}else{break}}else{if(Beans[C.module]===undefined){w=E[D].val}else{if(C.search==="non-db"){g=C.id_name}w=E["Search"+e+"_"+C.id_name].val}}if(w!==" "&&w!==""&&w!=="EMPTY"){s+="("+g+"='"+w+"')"}break;case"email":w=E[D].val;if(w!==""){if(QCRM.OffLine){s+=matchString(C.searchmode,g,w)}else{s+="("+I+".id in (SELECT eabr.bean_id FROM email_addr_bean_rel eabr JOIN email_addresses ea ON (ea.id = eabr.email_address_id) WHERE eabr.deleted=0 AND ea.email_address "+matchStringOp(C.searchmode,w)+"))"}}break;case"parent":g=C.id_name;w=E["Search"+e+"_"+C.id_name].val;if(w!==" "&&w!==""&&w!=="EMPTY"){s+="("+g+"='"+w+"' and "+C.id_type+"='"+E["Search"+e+"_"+C.id_type].val+"')"}break;case"custom":s+=C.get_where(e,E);break;default:break}}catch(p){}}}s=s.replace(/\)\(/g,") AND (")}}if(E[e+"MyItems"]){q=E[e+"MyItems"].val}else{if(QCRM.defaultMyItems){q=localStorage.getItem(e+"MyItems")!=="0"}else{q=localStorage.getItem(e+"MyItems")==="1"}}if(q){if(s!==""){s+=" and"}s+=" "+l.MyItemsQuery()}if(Pref.FilterOldDate!==""&&Pref.FilterOld.indexOf(e)!==-1){if(s!==""){s+=" and"}s+=" "+I+".date_entered > '"+Pref.FilterOldDate+"'"}return s}function SaveMyItems(b,a){localStorage.setItem(b+"MyItems",(a?1:0))}function LoadMyItems(b){var a=localStorage.getItem(b+"MyItems");if(a==="1"){$("#"+b+"MyItems").prop("checked",true).checkboxradio("refresh")}else{$("#"+b+"MyItems").prop("checked",false).checkboxradio("refresh")}}function setDefaultMyItems(a){QCRM.defaultMyItems=a;for(var b in QCRM.beans){SaveMyItems(QCRM.beans[b],a)}}function AlertPopup(a){a=HTMLDecode(a);if(mobile_app&&navigator.notification){}else{alert(a)}}function ConfirmPopup(a,d,b){a=HTMLDecode(a);if(mobile_app&&navigator.notification){}else{if(confirm(a)){d()}}}function getPhoneValues(m,v,e){var b=[],s=0,q,h,p=Beans[e].PhoneFields,z=false;for(q in p){if(m[p[q]]!==undefined&&m[p[q]].value!==""){if(z===false){z={module:e,id:m.id?m.id.value:"",name:Beans[e].DisplayTitle(m),records:[]}}s++;z.records.push({phone:m[p[q]].value,type:p[q]})}}if(z!==false){b.push(z)}if(v&&v.length>0){for(h=0;h<v.length;h++){var u=v[h],o=u.name,d=Beans[e].Links[o].module,w=e!=="Calls"&&Beans[e].Links.calls===undefined;p=Beans[d].PhoneFields;for(var a=0;a<u.records.length;a++){var n=u.records[a];if(n&&n.link_value){n=n.link_value;z=false;for(q in p){var g=p[q];if(n[g]!==undefined&&n[g].value!==""){if(s<6){if(z===false){z={module:d,name:Beans[d].DisplayTitle(n),records:[]};if(w){z.id=n.id.value}}z.records.push({phone:n[p[q]].value,type:g})}}}}if(z!==false){b.push(z)}}}}return b}function AjaxErr(){$("body").pagecontainer("change","#LoginPage");$("#LoginLoading").html("Login failed. Please check permissions on custom/QuickCRM directory")}function MobileInit(m){function e(){QCRM.get_available_modules(function(){var r="#HomePage";if(m!==undefined){r=m}else{if(init_module!==""&&init_record!==""&&Beans[init_module]!==undefined){Beans[init_module].CurrentId=init_record;r="#"+init_module+"DP";init_module="";init_record=""}}QCRM.Ready=true;AfterLogin(r,(!mobile_app))})}if(mobile_edition==="CE"){QCRM.enableBeans(["Accounts","Contacts","Opportunities","Leads","Calls","Meetings","Tasks","Cases","Project","ProjectTask","Notes"])}if(!((mobile_edition==="Pro")&&(offline_max_days>0)&&mobile_app&&(sugar_version>"6.3")&&(typeof openDatabase!=="undefined"))){$("#OffLineContainer").remove()}if(QCRM.OffLine){localStorage.setItem("reminder"+ServerAddress,"no")}else{localStorage.setItem("reminder"+ServerAddress,"")}if(typeof QCRM.OptionsDefaults==="function"){QCRM.OptionsDefaults()}defaultPreferences();updatePreferences(true);init_done=true;if(mobile_app){}try{var n=$.mobile.urlHistory.stack[0];if(n.hash==="#HomePage"||n.pageUrl==="HomePage"){$("#HomePage").trigger("pagebeforecreate");var d=$("#HomeBar").html();$("#HomeBar").remove();$("#HomeHeader").append('<div id="HomeBar" data-role="navbar" data-mini="true" >'+d+"<div>");$("#HomeBar").navbar();$("body").pagecontainer("change","#LoginPage");$("#AllModulesPopupDiv").listview("refresh")}}catch(g){}var b=new Date();if(!b.isDST()){TimeZoneOffset++}var q=Quser_name,a=Qpwd,o='<div class="CenterBtns"><a id="LoginButton" href="javascript:LoginUser();" data-role="button" data-mini="true" data-inline="true" style="color:#FFF;text-decoration:none;">'+RES_LOGIN_TITLE+"</a></div>",l;l=GetLanguage();try{QCRM.calendar.firstDay=(l==="en")?0:jQuery.mobiscroll.i18n[l].firstDay}catch(g){QCRM.calendar.firstDay=0}if(QCRM.OffLine){}else{if(mobile_app&&!ForceLogin&&q!==null&&q!==""&&a!==null&&a!==""){}else{if(!mobile_app){$("#LoginForm").append(o);InitLoginPage();$("#LoginButton").button();$("#LoginLoading").hide();$("#LoginForm").show()}}}if(typeof QuickCRMInit==="function"){QuickCRMInit()}for(var h in QCRM.hooks.init){QCRM.hooks.init[h]()}if(QCRM.webdb){t=getCookie("OffLineNb");if(t===null||t===""){Pref.OffLineNb=QCRM.webdb.MaxRecords}}}$(document).on("pageinit","#HomePage",function(){$.event.special.swipe.horizontalDistanceThreshold=60;$.event.special.swipe.verticalDistanceThreshold=40;$("#HomeTop").on("swiperight swipeleft",function(a){if($("body").pagecontainer("getActivePage").jqmData("panel")!=="open"){if(a.type==="swiperight"){$("#HomePanel").panel("open")}}else{if(a.type==="swipeleft"){$("#HomePanel").panel("close")}}})});$("#HomePage").on("pagebeforecreate",function(){var a=QCRM.beans;AddPhonePopup("HomePage");AddTotalsPopup("HomePage","","H");if(mobile_edition==="CE"){$("#AboutPro").show()}if(!init_done){MobileInit()}$.mobile.page.prototype.options.backBtnTheme="a";$("#HomePageTitle").text(QAppName);if(typeof HomePageInit==="function"){HomePageInit()}if(!mobile_app){}else{}$("#NotifyClear").text(RES_CLEAR);if(IconsLabels){$("#AdminPageLinkLabel").text(RES_OPTIONS);$("#CalendarLinkLabel").text(RES_CALENDAR);$("#AllModulesLinkLabel").text(RES_ALLMODULES);$("#LastViewedLinkLabel").text(sugar_app_strings.LBL_LAST_VIEWED);$("#MapsLinkLabel").text(RES_MAPS_TITLE)}$("#LastViewedPanelDiv li").remove();GetBeansList(LastViewed,"LastViewedPanelDiv",true,sugar_app_strings.LBL_LAST_VIEWED,false,true);UpdateFavoritesPanel(false);$("#PanelSearchText").attr("placeholder",RES_SEARCH_LABEL);GetAllModulesList("AllModulesPopupDiv");$("#AllModulesPopupDiv").listview("refresh");if(!QCRM.JJWG){$("#MapsContainer").remove()}if(!Beans.Meetings.Enabled()&&!Beans.Calls.Enabled()){$("#CalendarContainer").remove();QCRM.ShowToday=false}});QCRM.handleOpenURL=function(){var a=sessionStorage.getItem("OpenURL");return false};function HomepageRefresh(p){var h=true,o='<div class="IconContainer" style="padding:5px;">',r='<div class="TextContainer" style="padding:5px;">',e='<div class="ui-body-c" style="background:#ddd !important;color:#222;text-shadow:none;padding:3px;min-height:38px;">',b=$("#Favorites"),n=QCRM.searchIcons.slice();if(mobile_app&&mobile_edition==="Pro"&&sugar_version>"6.3"&&QCRM.webdb&&typeof openDatabase!=="undefined"){}if(QCRM.UpdButtons){var l=$("#Creates");l.empty();$.each(QCRM.beans,function(s,u){if(Beans[u].Enabled()&&Pref.Hidden.indexOf(u)===-1&&Beans[u].ShowTab&&(!QCRM.OffLine||Pref.SyncModules[u].sync!=="None")){$("#Icon"+u).show()}else{$("#Icon"+u).hide()}if(Pref.Creates.indexOf(u)!==-1&&Beans[u].Enabled()){var w=$(o+"</div>");var v=$(e+'<a href="#" class="ui-link">'+sugar_mod_strings[u].NEW+"</a></div>");v.click({mod:u},function(d){Beans[d.data.mod].Create()});w.append(v);l.append(w);h=false}});l.css({"padding-bottom":(h?"0":"10")+"px"})}if(mobile_edition==="Pro"){if(QCRM.UpdFavIcons){b.empty();h=true;for(var g in n){var q=QCRM.SavedSearches[n[g].id];if(q&&Beans[q.type]!==undefined&&Beans[q.type].Enabled()){var m=$(r+"</div>"),a=$(e+'<a href="#" class="ui-link">'+q.name+"</a></div>");a.click({ind:n[g].id},function(u){var s=QCRM.SavedSearches[u.data.ind],d=s.type;Beans[d].CurrentSearchValues=s.fields;Beans[d].CurrentSearchOrder=s.sort_order?s.sort_order:"";$("body").pagecontainer("change","#"+d+"ListPage")});m.append(a);b.append(m);h=false}}b.css({"padding-bottom":(h?"0":"10")+"px"});QCRM.UpdFavIcons=false}displayDashlets(p);enableButton("SettingsIcon",!QCRM.OffLine);if((offline_max_days>0)&&mobile_app&&(sugar_version>"6.3")&&(typeof openDatabase!=="undefined")){}}RequestPassword();QCRM.UpdButtons=false}$("#HomePage").on("pageshow",function(d,b){QCRM.History.push("#HomePage");if(!init_done){MobileInit()}home_created=true;if(SugarSessionId===""&&!QCRM.OffLine){$("body").pagecontainer("change","#LoginPage")}try{HomepageRefresh(true)}catch(a){$("#HomeWarning").html("Unexpected Error")}try{if(!iOS&&mobile_app&&typeof b.prevPage[0]!=="undefined"&&b.prevPage[0].id=="LoginPage"){}}catch(a){}});function checkForceLock(){return !QCRM.forceLock||Pref.AppLock}function PasswordEntered(){if($("#EnterPassword").val()===Pref.AppLock){unlocked=true;localStorage.setItem("WrongPwd",0)}else{$("#PwdErr").text(RES_WRONG_PWD);var a=parseInt(localStorage.getItem("WrongPwd",0),10)+1;if(a>4){if(QCRM.OffLine){}AlertPopup("All data have been erased and your password has been removed from settings");localStorage.setItem("Spassword","");localStorage.removeItem("AppLock");localStorage.setItem("WrongPwd",0);AppReload()}else{localStorage.setItem("WrongPwd",a)}}}function RequestPassword(){if(Pref&&(Pref.AppLock!==false)&&!unlocked){setTimeout('$("#lnkPwd").click();',150)}}function SaveLockPage(){if(Pref.AppLock===false){var a=$("#DefPassword").val();if(a!==""){if(a===$("#DefPassword2").val()){localStorage.setItem("AppLock",a);localStorage.setItem("WrongPwd",0);Pref.AppLock=a;$("#LockPageCancelBtn").click()}else{$("#LockErr").text(RES_PWD_MISMATCH)}}}else{if($("#RemoveLock").val()===Pref.AppLock){localStorage.removeItem("AppLock");Pref.AppLock=false;$("#LockPageCancelBtn").click()}else{$("#LockErr").text(RES_WRONG_PWD)}}}$("#EnterPwdPage").on("pagebeforecreate",function(){$("#EnterPasswordLabel").html(RES_ENTER_LOCK);$("#EnterPwdConfirmBtn").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL)});$("#EnterPwdPage").on("pageshow",function(){$("#EnterPassword").val("");$("#PwdErr").text("")});function DisplayLockState(){if(Pref.AppLock!==false){$("#AppLocked").show();$("#AppUnlocked").hide()}else{$("#AppLocked").hide();$("#AppUnlocked").show()}}$("#LockPage").on("pagebeforecreate",function(){$("#LockPageTitle").text(RES_TITLE_LOCK);$("#AppDefLockTitle").text(RES_DEF_LOCK);$("#AppUnlockTitle").text(RES_UNLOCK);$("#DefPasswordLabel").html(RES_ENTER_LOCK);$("#DefPassword2Label").html(RES_ENTER2_LOCK);$("#RemoveLockLabel").html(RES_ENTER_LOCK);$("#LockPageConfirmBtn").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL);$("#LockPageCancelBtn").text(sugar_app_strings.LBL_CANCEL_BUTTON_LABEL)});$("#LockPage").on("pageshow",function(){DisplayLockState();$("#DefPassword").val("");$("#DefPassword2").val("");$("#RemoveLock").val("");$("#LockErr").text("")});QCRM.ErrorLog=function(a){if(QCRM.debug){$("#DebugLog").append(a)}};function OptionsBackBtn(a){$("#"+a+" .OptionsBackBtn").each(function(d,b){var e=$(this);if(iOS){e.attr("data-icon","arrow-l");e.attr("data-iconpos","notext");e.attr("data-iconshadow","false");e.addClass("ui-nodisc-icon");e.addClass("ui-alt-icon")}else{e.html(sugar_app_strings.LBL_SAVE_BUTTON_LABEL)}})}$("#AllOptions").on("pagebeforecreate",function(){var d=((mobile_edition==="Pro"&&!GetDemo())?((QTrial==="")?(" P"+QProKey):(" T"+QTrial)):""),a=(mobile_app?app_version:("web app "+mobile_version)),b=(mobile_edition!=="Pro");if(typeof GetDemo==="function"){if(GetDemo()&&!iOS){b=true}}if(mobile_app&&!iOS&&window.plugins&&window.plugins.calendar){}$("#AllOptionsTitle").text(RES_OPTIONS);$("#OptionsGeneralLnk").text(RES_OPT_GENERAL);$("#OptionsHomeLnk").text(RES_HOME_LABEL);$("#OptionsSortOrderLnk").text(RES_SORTORDER);if(mobile_edition==="Pro"){$("#OptionsFilterOldLnk").text(RES_FILTEROLD);$("#OptionsActLnk").text(RES_OPT_CALL_MEET)}else{$("#OptActDiv").remove();$("#OptFilterOldDiv").remove()}$("#OptSSDiv").remove();if(b){$("#OptGetProLnk").text(RES_UNAVAILABLE);$("#OptGetProLnk").click({url:"http://www.quickcrm.fr/mobile"+(GetLanguage().substr(0,2)==="fr"?"/fr":"")},function(e){e.preventDefault();window.open(e.data.url,"_system")})}else{$("#OptGetPro").remove()}$("#ContactNSTEAMContainer").html('<a href="mailto:support@quickcrm.fr?subject=Support Request from '+a+d+'">support@quickcrm.fr</a>');if((offline_max_days>0)&&mobile_app&&(sugar_version>"6.3")&&(typeof openDatabase!=="undefined")&&!QCRM.OffLine&&navigator.onLine){}else{$("#OptSyncDiv").remove()}});$("#OptionsGeneral").on("pagebeforecreate",function(){var a,b,d={};OptionsBackBtn("OptionsGeneral");$("#OptionsGeneralTitle").text(RES_OPT_GENERAL);$('label[for="OptRowsPerPage"]').text(RES_ROWS_PER_PAGE);$('label[for="OptRowsPerSubpanel"]').text(RES_ROWS_PER_SUBPANEL);if(mobile_edition==="Pro"){$('label[for="OptRowsPerDashlet"]').text(RES_ROWS_PER_DASHLET)}else{$("#RowsPerDashlet").hide()}$("#OptSearchLbl").text(RES_SEARCH_LABEL);$('label[for="OptPartialSearch"]').text(RES_PARTIAL_SEARCH);if(mobile_app){$("#OptNativeCalLbl").text(RES_CALENDAR)}if(mobile_app&&iOS){$('label[for="OptNativeCal"]').text(RES_NATIVE_CAL)}$("#OptToolbarLbl").text(RES_TOOLBAR);$('label[for="OptIconsLabels"]').text(RES_SHOWLABELS);$("#OptAlertsLbl").text(RES_ALERTS);$('label[for="OptAlerts"]').text(RES_UPDATED);$("#OptHideEmptySubPLbl").text(RES_SUBPANELS);$('label[for="OptHideEmptySubP"]').text(RES_HIDEEMPTY);if(!mobile_app&&mobile_edition!=="Pro"){$("#OptAlertDiv").hide()}});$("#OptionsGeneral").on("pageshow",function(){$("#OptRowsPerPage").val(RowsPerPage).slider("refresh");$("#OptRowsPerSubpanel").val(RowsPerSubPanel).slider("refresh");if(mobile_edition==="Pro"){$("#OptRowsPerDashlet").val(RowsPerDashlet).slider("refresh")}$("#OptIconsLabels").prop("checked",tmpIconsLabels).checkboxradio("refresh");if(mobile_app){}$("#OptPartialSearch").prop("checked",Pref.PartialSearch).checkboxradio("refresh");if(mobile_edition==="Pro"||mobile_app){$("#OptAlerts").prop("checked",Pref.Alerts).checkboxradio("refresh")}$("#OptHideEmptySubP").prop("checked",Pref.HideEmptySubP).checkboxradio("refresh")});function OptionsGeneralSave(){var a=false,b;RowsPerPage=$("#OptRowsPerPage").val();RowsPerSubPanel=$("#OptRowsPerSubpanel").val();RowsPerDashlet=$("#OptRowsPerDashlet").val();if((mobile_edition==="Pro"||mobile_app)&&!QCRM.OffLine&&d!=Pref.Alerts){var d=Pref.Alerts;Pref.Alerts=$("#OptAlerts").is(":checked");if(d!=Pref.Alerts){if(Pref.Alerts){CronAlerts()}else{StopAlerts()}}}Pref.HideEmptySubP=$("#OptHideEmptySubP").is(":checked");Pref.PartialSearch=$("#OptPartialSearch").is(":checked");if(IconsLabels!==$("#OptIconsLabels").is(":checked")){a=true;tmpIconsLabels=$("#OptIconsLabels").is(":checked")}updatePreferences(false);setCookie("OptRowsPerPage",RowsPerPage,365);setCookie("OptRowsPerSubpanel",RowsPerSubPanel,365);if(mobile_edition==="Pro"){setCookie("OptRowsPerDashlet",RowsPerDashlet,365)}setCookie("OptIconsLabels",($("#OptIconsLabels").is(":checked")?1:0),365);localStorage.setItem("Alerts",(Pref.Alerts?"1":"0"));localStorage.setItem("PartialSearch",(Pref.PartialSearch?"1":"0"));localStorage.setItem("HideEmptySubP",(Pref.HideEmptySubP?"1":"0"));if(a){ConfirmPopup(RES_AVAILABLE_NEXT_LOGIN,function(){LogOutUser()},"")}return true}$("#OptionsHome").on("pagebeforecreate",function(){OptionsBackBtn("OptionsHome");var h=$("#OptHomeIcons");$("#OptionsHomeTitle").text(RES_HOME_LABEL);if(mobile_edition=="Pro"){$('label[for="OptToday"]').html(sugar_app_list_strings.date_search.today)}else{$("#TodayDiv").remove()}$("#HPBtns").remove();for(var g in QCRM.beans){var e=QCRM.beans[g],d=sugar_app_list_strings.moduleList[e];if(Beans[e].ShowTab&&Beans[e].Enabled()){if(mobile_edition=="Pro"){var b=$('<div class="ui-field-contain"/>'),a=$('<div data-role="controlgroup" data-type="horizontal" data-mini="true"/>');a.append("<legend>"+d+'</legend><input type="checkbox" name="Home'+e+'" id="Home'+e+'" data-theme="c" checked="checked"><label for="Home'+e+'">'+RES_ICON+'</label><input type="checkbox" name="Create'+e+'" id="Create'+e+'" data-theme="c"><label for="Create'+e+'">'+sugar_app_strings.LBL_CREATE_BUTTON_LABEL+"</label>");b.append(a);h.append(b)}else{h.append('<input type="checkbox" name="Home'+e+'" id="Home'+e+'" data-theme="c" checked="checked"><label for="Home'+e+'">'+d+"</label>")}}}});function refreshOptionsHome(){$("#OptToday").prop("checked",Pref.Today).checkboxradio("refresh");for(var a in QCRM.beans){var b=QCRM.beans[a];if(Beans[b].ShowTab&&Beans[b].Enabled()){$("#Home"+b).prop("checked",(Pref.Hidden.indexOf(b)===-1)&&Beans[b].HomeIcon).checkboxradio("refresh");if(mobile_edition==="Pro"){$("#Create"+b).prop("checked",(Pref.Creates.indexOf(b)!==-1)).checkboxradio("refresh")}}}}$("#OptionsHome").on("pageshow",refreshOptionsHome);function OptionsHomeSave(){var m,n="",h=[],b="",l=[];QCRM.UpdButtons=true;if(mobile_edition=="Pro"){m=Pref.Today;Pref.Today=$("#OptToday").is(":checked");if(m!==Pref.Today){updateDashlets()}setCookie("OptToday",(Pref.Today?1:0),365)}for(var d in QCRM.beans){var a=QCRM.beans[d],g=false,e=false;if(Beans[a].ShowTab){if(Beans[a].Enabled()){if(!$("#Home"+a).is(":checked")){g=true}if($("#Create"+a).is(":checked")){e=true}}else{if(Pref.Hidden.indexOf(a)!==-1){g=true}if(Pref.Creates.indexOf(a)!==-1){e=true}}if(g){h=h.concat(a);n+=(n===""?"":",")+a}else{Beans[a].HomeIcon=true}if(e){l=l.concat(a);b+=(b===""?"":",")+a}}}Pref.Hidden=h;Pref.Creates=l;updatePreferences(false);SaveHomePageDef(true);return true}$("#OptionsSavedSearch").on("pagebeforecreate",function(){OptionsBackBtn("OptionsSavedSearch");$("#OptionsSavedSearchTitle").text(RES_SAVEDSEARCH)});$("#OptionsSavedSearch").on("pageshow",function(){DisplaySavedSearches()});function OptionsSavedSearchSave(){}function createSortOrderDropdown(e,s,d){var h="",u=true,v=Beans[d].OrderBy,w="asc",m="desc";if(typeof RES_ASC!=="undefined"){w=RES_ASC;m=RES_DESC}if(v!==""){v=v.split(" ");h=v[0];if(v.length>1){u=v[1]==="asc"}}var q=$("<div class='ui-field-contain'/>"),p=$("<div data-role='controlgroup' data-type='horizontal'/>");p.append("<legend>"+s+"</legend>");var b=$("<select name='"+e+"field' id='"+e+"field' data-mini='true' data-theme='c'/>"),o=[""].concat(Array_unique(Beans[d].AllOrderFields().concat(["date_entered","date_modified"]))),z="";for(var a in o){var r=o[a],n=display_label(d,r);n=(n===""?"&nbsp;":n);z+="<option value='"+(r===""?"EMPTY":r)+"'"+(r===h?" selected='selected'":"")+">"+n+"</option>"}b.append(z);p.append(b);b=$("<select name='"+e+"order' id='"+e+"order' data-mini='true' data-theme='c'/>");b.append("<option value='asc'"+(u?" selected='selected'":"")+">"+w+"</option><option value='desc'"+(!u?" selected='selected'":"")+">"+m+"</option>");p.append(b);q.append(p);return q}function readSortOrderDropdown(a,b){var d=$("#"+a+"field").val();return((d===""||d==="EMPTY"||d===undefined)?"":(d+" "+$("#"+a+"order").val()))}function loadSortOrderDropdown(e,b){var d,h,g="asc",a="SOrder"+e;if(b&&b!==""){d=b.split(" ");h=d[0];if(d.length>1){g=d[1]}}else{h="EMPTY"}if(h==""){h="EMPTY"}set_enum_val("#"+a+"field",h);set_enum_val("#"+a+"order",g)}$("#OptionsSortOrder").on("pagebeforecreate",function(){OptionsBackBtn("OptionsSortOrder");$("#OptionsSortOrderTitle").text(RES_SORTORDER);var a=$("#ModulesListSort");for(var e in SearchPages){var b=SearchPages[e];if(Beans[b].Enabled()){var g=$("<li/>");a.append(g.append(createSortOrderDropdown("Order"+b,sugar_app_list_strings.moduleList[b],b)))}}});$("#OptionsSortOrder").on("pageshow",function(){});function OptionsSortOrderSave(){var d="";for(var b in SearchPages){var a=SearchPages[b];if(!Beans[a].Enabled()){continue}var e=readSortOrderDropdown("Order"+a,a);Beans[a].OrderBy=e;d+=(d===""?"{":",")+'"'+a+'":"'+e+'"'}d+=(d===""?"":"}");setCookie("SortOrder",d,365);return true}$("#OptionsFilterOld").on("pagebeforecreate",function(){OptionsBackBtn("OptionsFilterOld");$("#OptionsFilterOldTitle").text(RES_FILTEROLD);$("#FilterOldDiv").append(create_picker("date","OptOldDate",RES_MINDATE,false,true));var b=$("#ModulesListOld");for(var e in QCRM.beans){var d=QCRM.beans[e],a=sugar_app_list_strings.moduleList[d];if(Beans[d].Enabled()){b.append('<input type="checkbox" name="Old'+d+'" id="Old'+d+'" data-theme="c"><label for="Old'+d+'">'+a+"</label>")}}});$("#OptionsFilterOld").on("pageshow",function(){var d=Pref.FilterOldDate;init_picker("#OptOldDate","date",(!d||d==="")?false:fromDBDate(d));for(var a in QCRM.beans){var b=QCRM.beans[a];if(Beans[b].Enabled()){$("#Old"+b).prop("checked",(Pref.FilterOld.indexOf(b)!==-1)).checkboxradio("refresh")}}});function OptionsFilterOldSave(){var g=$("#OptOldDate");var d=g.mobiscroll("getDate");if(d===null||g.val()===""){Pref.FilterOldDate=""}else{Pref.FilterOldDate=toDBDate(d)}var e="";Pref.FilterOld=[];for(var b in QCRM.beans){var a=QCRM.beans[b];if($("#Old"+a).is(":checked")){Pref.FilterOld=Pref.FilterOld.concat(a);e+=(e===""?"":",")+a}}localStorage.setItem("FilterOldDate",Pref.FilterOldDate);localStorage.setItem("FilterOld",e);return true}$("#OptionsAct").on("pagebeforecreate",function(){OptionsBackBtn("OptionsAct");$("#OptionsActTitle").text(RES_OPT_CALL_MEET);$('label[for="OptLogCalls"]').text(RES_LOG_CALLS);$("#OptLogCallsLbl").text(sugar_app_list_strings.moduleList.Calls);$('label[for="OptActMyItems"]').text(sugar_app_strings.LBL_CURRENT_USER_FILTER);$("#OptActMyItemsLbl").text(sugar_app_strings.LBL_ASSIGNED_TO);$('label[for="ActivitiesFrom"]').text(RES_OPT_FROM);$('label[for="ActivitiesTo"]').text(RES_OPT_TO);$("#OptActStatusLbl").text(sugar_mod_strings.Meetings?sugar_mod_strings.Meetings.LBL_STATUS:(sugar_mod_strings.Calls?sugar_mod_strings.Calls.LBL_STATUS:"Status"));var a=sugar_app_list_strings.meeting_status_dom?sugar_app_list_strings.meeting_status_dom:{Planned:"Planned",Held:"Held","Not Held":"Not Held"};$('label[for="ActStatus_planned"]').text(a.Planned);$('label[for="ActStatus_held"]').text(a.Held);$('label[for="ActStatus_not_held"]').text(a["Not Held"])});$("#OptionsAct").on("pageshow",function(){$("#ActivitiesTo").val(Pref.ActivitiesTo).slider("refresh");$("#ActivitiesFrom").val(Pref.ActivitiesFrom).slider("refresh");$("#OptActMyItems").prop("checked",Pref.ActivitiesMine).checkboxradio("refresh");$("#OptLogCalls").prop("checked",Pref.LogCalls).checkboxradio("refresh");$("#ActStatus_planned").prop("checked",Pref.Activities_planned).checkboxradio("refresh");$("#ActStatus_held").prop("checked",Pref.Activities_held).checkboxradio("refresh");$("#ActStatus_not_held").prop("checked",Pref.Activities_not_held).checkboxradio("refresh")});function OptionsActSave(){Pref.ActivitiesTo=$("#ActivitiesTo").val();Pref.ActivitiesFrom=$("#ActivitiesFrom").val();Pref.ActivitiesMine=$("#OptActMyItems").is(":checked");Pref.Activities_planned=$("#ActStatus_planned").is(":checked");Pref.Activities_held=$("#ActStatus_held").is(":checked");Pref.Activities_not_held=$("#ActStatus_not_held").is(":checked");Pref.LogCalls=$("#OptLogCalls").is(":checked");updatePreferences(false);setCookie("ActivitiesTo",Pref.ActivitiesTo,365);setCookie("ActivitiesFrom",Pref.ActivitiesFrom,365);setCookie("OptLogCalls",(Pref.LogCalls?1:0),365);setCookie("OptActMyItems",(Pref.ActivitiesMine?1:0),365);setCookie("ActStatus_planned",(Pref.Activities_planned?1:0),365);setCookie("ActStatus_held",(Pref.Activities_held?1:0),365);setCookie("ActStatus_not_held",(Pref.Activities_not_held?1:0),365);return true}$("#OptionsSync").on("pagebeforecreate",function(){var d,a,n=sugar_app_strings.LBL_LISTVIEW_ALL,l=RES_MY_ITEMS.replace(":",""),p,m=$("#OffLineModules"),e=$("#OffLineUsers");OptionsBackBtn("OptionsSync");$("#OptionsSyncTitle").text(RES_SYNC);$('label[for="OffLineNb"]').text("Max.");if(n===undefined){n="All"}p={None:RES_NONE,Rel:RES_RELATED,MineOnly:l,Mine:(l+" + "+RES_RELATED),List:sugar_app_list_strings.moduleList.Users,All:n};for(d in QCRM.beans){a=QCRM.beans[d];if(Beans[a].access==="none"||Pref.SyncModules[a].preset){continue}if(Pref.SyncModules[a].sync==="all"){Pref.SyncModules[a].sync="All"}var g=$('<div class="ui-field-contain"/>'),h=$('<div data-role="controlgroup" data-type="horizontal" data-mini="true"/>'),b=(Pref.SyncModules[a]===undefined?"Mine":Pref.SyncModules[a].sync),o=((Pref.SyncModules[a]===undefined)||Pref.SyncModules[a].max)?' checked="checked" ':"";h.append("<legend>"+sugar_app_list_strings.moduleList[a]+"</legend>"+create_select("SyncOpt"+a,p,b,false,false)+'<input type="checkbox" id="Max'+a+'" '+o+' data-theme="c"><label for="Max'+a+'">Lim.</label>');g.append(h);m.append(g)}e.append('<label for="SyncList">'+sugar_app_list_strings.moduleList.Users+"</label>"+create_select("SyncList",SimpleBeans.Users.List,CurrentUserId,true,true));$("#SyncList").val(Pref.SyncModules.UsersList);$("#OffLineNb").val(Pref.OffLineNb)});$("#OptionsSync").on("pageshow",function(){$("#OffLineNb").val(Pref.OffLineNb).slider("refresh")});function SyncUsersUpdate(){var b,d=[],a;for(b in Pref.SyncModules.UsersList){a=Pref.SyncModules.UsersList[b];if(SimpleBeans.Users.List[a]!==undefined){d.push(a)}}if(d.length>0){Pref.SyncModules.UsersList=d}else{Pref.SyncModules.UsersList=[CurrentUserId]}}function OptionsSyncSave(){if(!QCRM.OffLine){for(var b in QCRM.beans){var a=QCRM.beans[b];if(Pref.SyncModules[a]===undefined){Pref.SyncModules[a]={}}if(Pref.SyncModules[a].preset){continue}Pref.SyncModules[a].max=$("#Max"+a).is(":checked");Pref.SyncModules[a].sync=$("#SyncOpt"+a).val()}if(Pref.SyncModules.Documents&&Pref.SyncModules.Documents.sync!=="None"){Pref.SyncModules.Documents.attachments=true}Pref.SyncModules.UsersList=$("#SyncList").val();localStorage.setItem("SyncModules"+ServerAddress,JSON.stringify(Pref.SyncModules));Pref.OffLineNb=$("#OffLineNb").val();localStorage.setItem("OffLineNb",Pref.OffLineNb)}return true}function GetActivitiesList(h){$.mobile.loading("show");ActivitiesCurrentOffset=h;var b=new Array(),g=$("#CalendarSubMenu input:radio:checked").val(),d,l,e,a;if(g==="missed"){l=toDBDate(CurrentDate);d=0}else{if(g==="today"){d=toDBDate(CurrentDate);l=toDBDate(new Date(CurrentDate.getTime()+86400000))}else{if(g==="7days"){d=toDBDate(CurrentDate);l=toDBDate(new Date(CurrentDate.getTime()+8*86400000))}else{if(g==="30days"){d=toDBDate(CurrentDate);l=toDBDate(new Date(CurrentDate.getTime()+31*86400000))}}}}e="(meetings.assigned_user_id = '"+CurrentUserId+"') AND (meetings.status='Planned') AND (meetings.date_start < '"+l+"')";if(d!==0){e+=" AND (meetings.date_start >= '"+d+"')"}a=e.replace(/meetings/g,"calls");QCRM.get_entry_list("Meetings",e,Beans.Meetings.ListFieldsToSelect(),Beans.Meetings.link_phone_fields,h,100,"date_start desc",function(q){if(q!=undefined){$("#AllActivitiesListDiv li").remove();if(q!=undefined&&q.entry_list!=undefined&&Beans.Meetings.Enabled()){var n,m=q.entry_list.length;for(n=0;n<m;n++){var p=q.entry_list[n],o={};o.name_value_list=p.name_value_list;o.type="Meetings";o.id=p.id;if(q.relationship_list&&q.relationship_list[n]&&q.relationship_list[n].link_list){o.phones=q.relationship_list[n].link_list}else{o.phones=[]}b.push(o)}}QCRM.get_entry_list("Calls",a,Beans.Calls.ListFieldsToSelect(),Beans.Calls.link_phone_fields,h,100,"date_start desc",function(v){if(v!=undefined){if(v!=undefined&&v.entry_list!=undefined&&Beans.Calls.Enabled()){var u=0,r=v.entry_list.length;for(u=0;u<r;u++){var s=v.entry_list[u],z={};z.name_value_list=s.name_value_list;z.type="Calls";z.id=s.id;if(v.relationship_list&&v.relationship_list[u]&&v.relationship_list[u].link_list){z.phones=v.relationship_list[u].link_list}else{z.phones=[]}b.push(z)}}b.sort(function(C,B){return(C.name_value_list.date_start.value>B.name_value_list.date_start.value)?1:-1});for(n=0;n<b.length;n++){var A=b[n];var w=AddLinkWithIcon(A.type,A.id,"",A.name_value_list,A.phones,"CalendarListPage",true,"");$("#AllActivitiesListDiv").append(w)}$("#AllActivitiesListDiv").listview("refresh")}})}$.mobile.loading("hide")})}QCRM.calendar.moduleDef=function(b){var a;for(a in QCRM.calendar.modules){if(QCRM.calendar.modules[a].module===b){return QCRM.calendar.modules[a]}}return false};QCRM.calendar.ColorOfDay=function(a){return a.color==="red"?"rgb(217,0,116)":"rgb(0,138,0)"};function getCalendarModule(a,e,o,b,l,m){var n="(XX.assigned_user_id = '"+e+"')",d,q=QCRM.calendar.moduleDef(a),g="(XX."+q.end+" >= '"+toDBDateTime(o)+"') AND (XX."+q.start+" < '"+toDBDateTime(b)+"')",h=toDBDate(b.addHours(24));function p(r,L,s,K){if(L&&L.entry_list!==undefined){var G=0,E=L.entry_list.length;for(G=0;G<E;G++){var D=L.entry_list[G],H={},v,z=D.name_value_list[q.start].value,I=fromDBDateTime(z),v=toDBDate(I),A=toDBDate(fromDBDateTime(D.name_value_list[q.end].value).addHours(-0.17));H.name_value_list=D.name_value_list;H.start=z;H.date=v;H.type=r;H.id=D.id;if(L.relationship_list&&L.relationship_list[G]){if(!s&&(L.relationship_list[G].link_list)){H.phones=L.relationship_list[G].link_list}else{if(s){var C=[],u=L.relationship_list[G],F,B,J;for(F=0;F<u.length;F++){var w={name:u[F].name,records:[]};B=u[F].records;for(J=0;J<B.length;J++){w.records.push({link_value:B[J]})}C.push(w)}H.phones=C}}}else{H.phones=[]}l.push(H);while(v<A&&v<=h){I.addHours(24);v=toDBDate(I);l.push({date:v,name_value_list:H.name_value_list,type:r,id:H.id,phones:H.phones})}}}K()}if(!Beans[a].Enabled()){m();return}if(a!=="Meetings"||QCRM.AssignedMeetingsOnly||(sugar_version<"6.2")){d=n+" AND "+g;d=d.replace(/XX/g,Beans[a].table);QCRM.get_entry_list(a,d,Beans[a].ListFieldsToSelect(),Beans[a].link_phone_fields,0,1000,"",function(r){p(a,r,false,m)})}else{if(!QCRM.OffLine&&QCRM.ServerVersion<"4.5.8"){d=g;d=d.replace(/XX/g,Beans[a].table);QCRM.get_relationships("Users","Meetings",e,"meetings",d,Beans[a].ListFieldsToSelect("id"),Beans[a].link_phone_fields,"",0,false,function(r){p(a,r,true,m)})}else{if(QCRM.OffLine){}else{n="("+n+" OR (m_u.user_id ='"+e+"'))"}d=n+" AND "+g;d=d.replace(/XX/g,Beans[a].table);QCRM.get_entry_list(a,d,Beans[a].ListFieldsToSelect(),Beans[a].link_phone_fields,0,1000,"",function(r){p(a,r,false,m)})}}}function GetCalendarMarked(u,p,o,w){var q,l=[],a=[],r,g,h,s={},v=CurrentUserId;function n(z,A,C,b,B,D){if(QCRM.calendar.modules[z]!==undefined){getCalendarModule(QCRM.calendar.modules[z].module,A,C,b,B,function(){n(z+1,A,C,b,B,D)})}else{D()}}if(mobile_app||mobile_edition==="Pro"){if(u){r=new Date();r.setTime(u.getTime());r.setHours(0);r.setMinutes(0);g=new Date();g.setTime(r.getTime()+(24*3600000))}else{r=new Date(p,o-1,1,0,0);g=new Date(p,o+2,1,0,0);v=QCRM.calendar.curUser}var m=function(b){$.each(b,function(B,C){var D,A,z=toDBDateTime(fromDBDateTime(C.startDate,true)),E=toDBDateTime(fromDBDateTime(C.endDate,true));A=C.startDate.substring(0,10);D={start:z,name_value_list:{name:{value:C.title},date_start:{value:z},date_end:{value:E}},phones:[],type:"native",date:A,id:""};l.push(D)})};var e=function(b){$.each(b,function(B,C){var D,A,z=toDBDateTime(new Date(C.dtstart)),E=toDBDateTime(new Date(C.dtend));if(Pref.NativeCal===true||Pref.NativeCal.indexOf(C.calendar_id)!==-1){A=toDBDate(new Date(C.dtstart));D={start:z,name_value_list:{name:{value:C.title},date_start:{value:z},date_end:{value:E}},phones:[],type:"native",date:A,id:""};l.push(D)}})};var d=function(b){};n(0,v,r,g,l,function(){l.sort(function(A,z){if(A.name_value_list.date_start.value>z.name_value_list.date_start.value){return 1}if(A.name_value_list.date_start.value<z.name_value_list.date_start.value){return -1}return 0});for(q=0;q<l.length;q++){var b=l[q];if(s[b.date]===undefined){s[b.date]={color:"none",elements:[]}}s[b.date].elements.push(b);if(b.name_value_list.status&&b.name_value_list.status.value==="Planned"){s[b.date].color="red"}}$.each(s,function(B,A){var z=QCRM.calendar.ColorOfDay(A);if(z!==false){a.push({d:fromDBDate(B),color:z})}});w(s,a)})}}function GetCalendarWeekDays(b){var h=$("#calendarMOBI").mobiscroll("getValues"),g,a,e;if(!h||h.length<7||!h[0]){h=[];a=b.getDay();if(a<QCRM.calendar.firstDay){a+=7}for(e=0;e<7;e++){g=new Date();g.setTime(b.getTime());h.push(g.addHours((e+QCRM.calendar.firstDay-a)*24))}}return h}function GetCalendarDayList(m){var n=toDBDate(m),p=[m],o,e=$("#calendarList"),h=[];$("#calendarList li").remove();if(QCRM.calendar.weekmode){p=GetCalendarWeekDays(m)}for(var b in p){n=toDBDate(p[b]);if(QCRM.calendar.dates[n]!==undefined){e.append('<li data-role="list-divider" data-theme="d">'+jQuery.mobiscroll.formatDate(date_format,p[b])+"</li>");for(o=0;o<QCRM.calendar.dates[n].elements.length;o++){var l=QCRM.calendar.dates[n].elements[o],a={id:l.id,nvl:l.name_value_list},g=(l.type==="native")?getCalendarLink(l.id,l.name_value_list):AddLinkWithIcon(l.type,l.id,Beans[l.type].DisplayCalendarElt(l.name_value_list),l.name_value_list,l.phones,"CalendarListPage",true,"");e.append(g);if(l.type==="Meetings"){h.push(a)}}e.listview("refresh")}}}function GetCalendarDayMap(b){var h=toDBDate(b),n=[b],a,g=[];if(QCRM.calendar.weekmode){n=GetCalendarWeekDays(b)}for(var l in n){h=toDBDate(n[l]);if(QCRM.calendar.dates[h]!==undefined){for(a=0;a<QCRM.calendar.dates[h].elements.length;a++){var m=QCRM.calendar.dates[h].elements[a];if(m.type==="Meetings"){g.push(m.id)}}}}if(g.length==0){$("#calendar_canvas").html(sugar_app_strings.MSG_LIST_VIEW_NO_RESULTS_BASIC)}else{if(mobile_edition=="Pro"){var e="(meetings.id IN ('"+g.join("','")+"') AND meetings_cstm.jjwg_maps_geocode_status_c IN ('OK','APPROXIMATE'))";QCRM.get_entry_list("Meetings",e,Beans.Meetings.ListFieldsToSelect(),"",0,150,"",function(s){if(s){var q=s.entry_list,p=q.length,r,o,d;if(p>0){q.sort(function(v,u){if(v.name_value_list.date_start.value>u.name_value_list.date_start.value){return 1}return -1});r=q[p==1?0:p%2].name_value_list;o={lat:r.jjwg_maps_lat_c.value,lng:r.jjwg_maps_lng_c.value,id:r.id,module:"Meetings",name:"",addr:""};d=JJWG.ShowBeansInMap("Meetings",q,o,"calendar_canvas",true,!QCRM.calendar.weekmode);if(Beans.jjwg_Markers&&$("#cal_markers_opt").is(":checked")){JJWG.ShowMarkersInMap(d,JJWG.get_where("jjwg_Markers",50,o,"miles"),o)}}else{$("#calendar_canvas").html(sugar_app_strings.MSG_LIST_VIEW_NO_RESULTS_BASIC)}}})}}}function GetCalendarTrackersNext(){Beans.QCRM_Tracker.offset+=Beans.QCRM_Tracker.nbRecords;GetCalendarTrackers(Beans.QCRM_Tracker.currentDay)}function GetCalendarTrackersPrev(){Beans.QCRM_Tracker.offset-=Beans.QCRM_Tracker.nbRecords;GetCalendarTrackers(Beans.QCRM_Tracker.currentDay)}function GetCalendarTrackers(a){var m=[a],g=new Date(2100,11,31),h=new Date(1900,0,1),b="assigned_user_id ='"+QCRM.calendar.curUser+"' ";saveModule=Beans.QCRM_Tracker.saveModule;Beans.QCRM_Tracker.currentDay=a;for(var e in m){var l=m[e];if(l<g){g=new Date(l)}if(l>h){h=new Date(l)}}g.setHours(0);g.setMinutes(0);h.setHours(23);h.setMinutes(59);b+="AND date_entered >= '"+toDBDateTime(g)+"' AND date_entered <= '"+toDBDateTime(h)+"'";QCRM.get_entry_list(saveModule,b,Beans[saveModule].ListFieldsToSelect(),"",Beans.QCRM_Tracker.offset,Beans.QCRM_Tracker.nbRecords,"date_entered",function(s){if(s){var p=s.entry_list,o=p.length,r,n;if(o>0){$("#CalNav").show();var u=s.next_offset,q=Beans.QCRM_Tracker.offset-Beans.QCRM_Tracker.nbRecords;if(q<0){q=0}enableButton("TrackNext",u<s.total_count);enableButton("TrackPrev",Beans.QCRM_Tracker.offset>0);r=p[o==1?0:o%2].name_value_list;n={lat:r.jjwg_maps_lat_c.value,lng:r.jjwg_maps_lng_c.value,id:r.id,module:"Meetings",name:"",addr:""};var d=JJWG.ShowBeansInMap(saveModule,p,n,"calendar_canvas",true,true)}else{$("#CalNav").hide();$("#calendar_canvas").html(sugar_app_strings.MSG_LIST_VIEW_NO_RESULTS_BASIC)}}})}function GetCalendarDay(a){if(QCRM.calendar.viewmode=="track"){GetCalendarTrackers(a)}else{if(QCRM.calendar.viewmode=="map"){GetCalendarDayMap(a)}else{GetCalendarDayList(a)}}}function DateFromCalendar(d){var b=new Date(),a=$("#calendarMOBI").mobiscroll("getDate");if(a){a.setHours(b.getHours())}else{a=b}init_picker(d,"datetime",a)}function CallFromCalendar(){Beans.Calls.Create("","","CalendarListPage");DateFromCalendar("#EditCalls_date_start")}function MeetingFromCalendar(){Beans.Meetings.Create("","","CalendarListPage");DateFromCalendar("#EditMeetings_date_start")}function CalendarShow(){var a=QCRM.calendar.currDate,b=a.getFullYear(),e=a.getMonth(),d;if(!QCRM.calendar.init){GetCalendarMarked(false,b,e,function(h,g){QCRM.calendar.dates=h;GetCalendarDay(a);QCRM.calendar.init=true;d={display:"inline",layout:"liquid",selectType:QCRM.calendar.weekmode?"week":"day",defaultValue:a,theme:iOS?"ios":"android-holo-light",markedDisplay:"bottom",startYear:(b-1),endYear:(b+1),lang:getMobiscrollLanguage(),controls:["calendar"],marked:g,firstDay:QCRM.calendar.firstDay,onMonthChange:function(l,n,m){GetCalendarMarked(false,l,n,function(o,p){QCRM.calendar.dates=o;m.settings.marked=p;setTimeout(function(){m.refresh()},(QCRM.OffLine?500:150))})},onDayChange:function(l,m){QCRM.calendar.currDate=l.date;GetCalendarDay(l.date)},onShow:function(){$(window).off("focusin")}};if(QCRM.calendar.weekmode){d.selectedValues=GetCalendarWeekDays(QCRM.calendar.currDate)}$("#calendarMOBI").mobiscroll().calendar(d)})}}$("#CalendarListPage").on("pagebeforecreate",function(){$("#CalendarListPageTitle").text(RES_CALENDAR);AddPhonePopup("CalendarListPage");QCRM.calendar.curUser=CurrentUserId;if(!QCRM.OffLine&&Beans.QCRM_Tracker&&Beans[Beans.QCRM_Tracker.saveModule]&&Beans[Beans.QCRM_Tracker.saveModule].acl.list&&QCRM.TrackerMode&&QCRM.TrackerMode!="none"){$("#CalDispS").append('<input type="radio" name="CalDisp" id="CalDispT" data-mini="true" data-icon="user" value="track" class="custom" data-theme="c"/><label for="CalDispT"><span class="ui-icon-user ui-btn-icon-notext inlineIcon">&nbsp;</span></label>')}if(!mobile_app&&mobile_edition=="CE"){$('label[for="ActPeriod_missed"]').html(RES_MISSED);$('label[for="ActPeriod_today"]').html(sugar_app_list_strings.date_search.today);$('label[for="ActPeriod_7days"]').html(RES_7DAYS);$('label[for="ActPeriod_30days"]').html(RES_7DAYS.replace("7","30"));$("#CalendarSubMenu input:radio").change(function(d,e){GetActivitiesList(ActivitiesCurrentOffset)})}else{$("#CalendarSubMenu").remove();$("#AllActivitiesListDiv").remove();var b=create_enum_form("CalUser","",SimpleBeans.Users.List,false,false,true,CurrentUserId);$("#calendarLEFT").prepend(b);b.css("margin-top","0px");if(!QCRM.calendar.shared){b.hide()}else{b.change(function(d,e){QCRM.calendar.curUser=$("#CalUser").val();QCRM.calendar.init=false;if(QCRM.calendar.viewmode=="track"){GetCalendarTrackers(QCRM.calendar.currDate)}else{CalendarShow()}})}$('label[for="CalMode_day"]').html(RES_DAY);$('label[for="CalMode_week"]').html(RES_WEEK);$("#CalModeS input:radio").change(function(d,e){QCRM.calendar.weekmode=!QCRM.calendar.weekmode;QCRM.calendar.init=false;CalendarShow()});if(!Beans.jjwg_Markers||!Beans.jjwg_Markers.Enabled()){$("#cal_markers_div").hide()}else{$('label[for="cal_markers_opt"]').html(sugar_app_list_strings.moduleList.jjwg_Markers)}function a(d){if(QCRM.calendar.viewmode=="track"){GetCalendarTrackers(QCRM.calendar.currDate)}else{if(d){QCRM.calendar.init=false;CalendarShow()}}if(QCRM.calendar.viewmode=="list"){$("#CalList").show();$("#CalMap").hide()}else{$("#CalList").hide();$("#CalMap").show()}if(QCRM.calendar.viewmode=="track"){$("#CalNav").show()}else{$("#CalNav").hide()}}if(QCRM.JJWG&&(JJWG.modules.indexOf("Meetings")!==-1||mobile_edition=="CE")){$("#CalDispS input:radio").change(function(e,g){var d=QCRM.calendar.viewmode!=$(this).val();QCRM.calendar.viewmode=$(this).val();a(d)});$("#cal_markers_opt").change(function(d,e){a(true)});if(mobile_edition=="CE"){$("#CalMap").html(RES_UNAVAILABLE)}}else{$("#CalDispS").hide()}}if(!Beans.Meetings.Enabled()){$("#CalendarMeetingDiv").remove()}if(!Beans.Calls.Enabled()){$("#CalendarCallDiv").remove()}if(QCRM.calendar.init_calendar){QCRM.calendar.init_calendar()}});$("#CalendarListPage").on("pageshow",function(){QCRM.History.push("#CalendarListPage");if(QCRM.OffLine&&!Pref.NativeCal){$("#CalendarRefresh").hide()}else{$("#CalendarRefresh").show()}if(mobile_app||mobile_edition=="Pro"){CalendarShow()}else{GetActivitiesList(ActivitiesCurrentOffset)}if(QCRM.calendar.display){QCRM.calendar.display()}});$("#LastViewedListPage").on("pagebeforecreate",function(){$("#LastViewedListPageTitle").text(sugar_app_strings.LBL_LAST_VIEWED)});$("#AllModulesListPage").on("pagebeforecreate",function(){$("#AllModulesListPageTitle").text(RES_ALLMODULES);GetAllModulesList("AllModulesListDiv")});$("#AllModulesListPage").on("pageshow",function(){$("#AllModulesListDiv").listview("refresh")});$("#LastViewedListPage").on("pageshow",function(){GetLastViewedList()});function ShowHideToolbarLabels(){var o="",m,e=(IconsLabels?RES_HOME_LABEL:""),h=(IconsLabels?sugar_app_strings.LBL_CREATE_BUTTON_LABEL:o),l=(IconsLabels?sugar_app_strings.LBL_BACK:o),p=(IconsLabels?RES_ALLMODULES:o),g=(IconsLabels?sugar_app_strings.LBL_EDIT_BUTTON:o),s=(IconsLabels?sugar_app_strings.LBL_DELETE_BUTTON_LABEL:o),v=(IconsLabels?sugar_app_strings.LBL_LAST_VIEWED:o),n=(IconsLabels?RES_CALENDAR:o),u=(IconsLabels?sugar_app_strings.LBL_SEARCH_BUTTON_LABEL:o),r=(IconsLabels?sugar_app_strings.LNK_LIST_NEXT:o),a=(IconsLabels?sugar_app_strings.LNK_LIST_PREVIOUS:o);for(m in ListsPages){var q="#"+ListsPages[m];$(q+"ListPageHomeBtn").text(e);$(q+"AllModulesBtn").text(p);$(q+"CalendarBtn").text(n);$(q+"GSBtn").text(u);$(q+"LBackBtn").text(l);$(q+"LastViewedBtn").text(v)}for(m in SearchPages){var d="#"+SearchPages[m];$(d+"SHomeBtn").text(e);$(d+"ListPageSearchBtn").text(u);$(d+"PreviousBtn").text(a);$(d+"SBackBtn").text(l);$(d+"NextBtn").text(r);if(Beans[SearchPages[m]].AddBtn){$(d+"ListPageAddBtn").text(h);$(d+"SAddBtn").text(h)}}for(m in ViewPages){var b="#"+ViewPages[m];$(b+"HomeBtn").text(e);$(b+"SearchBtn").text(IconsLabels?sugar_app_strings.LBL_SEARCH_BUTTON_LABEL:o);$(b+"BackBtn").text(l)}if(sugar_mod_strings.Calls){$("#CalendarCallBtn").text(IconsLabels?sugar_mod_strings.Calls.NEW:o)}if(sugar_mod_strings.Meetings){$("#CalendarMeetingBtn").text(IconsLabels?sugar_mod_strings.Meetings.NEW:o)}}function seamlessLogin(d,b){if(!b&&QCRM.OffLine){d(null)}else{var a={auth:{encryption:"PLAIN",password:Qpwd,user_name:Quser_name},application:"",name_value_list:[{name:"language",value:getSugarLanguage(sugar_languages,default_language)}]}}SugarQuery("login",JSON.stringify(a),function(e){if(e!==null&&mobile_app&&e.name!==undefined){delete a.auth.encryption;a.auth.password=$.md5(Qpwd);SugarQuery("login",JSON.stringify(a),d,null)}else{d(e)}},null)}function BuildColorLegend(b){var n=Beans[b],l=$("<div/>");function m(q,p){l.append('<div style="float:left;margin-left:10px;"><span style="text-shadow:none !important;">&nbsp;'+q+'</span><div style="border:1px solid #ddd;float:left;margin-left:5px;width:16px;height:16px;background:'+p+'"></div></div>')}l.empty();if(n.ColoredField!==""){QCRM.AddToListFields(b,[n.ColoredField]);var e=n.ColoredField,d=n.CustomColors,g=sugar_mod_fields[b][e];if(g&&g.options!==undefined){if(d.length===0){d=ListColors}var o=sugar_app_list_strings[g.options],h=0;if(o!==undefined){for(var a in o){m(o[a],d[h%d.length]);h++}}}else{if(d.length===0){d=ListColorsBool}l.append('<span style="float:left;margin-left:10px;">'+((e==="assigned_user_id")?RES_MY_ITEMS:sugar_mod_strings[b][sugar_mod_fields[b][e].label])+"&nbsp;&nbsp;</span>");m(RES_NO_LABEL,d[0]);m(RES_YES_LABEL,d[1])}if(QCRM.mode==="tablet"){$("#"+b+'ListPage [data-role="footer"]').prepend(l)}else{$("#"+b+"lLegend").append(l)}}}function BuildMapLegend(b,m){var n=Beans[b],h=$("#map_legend");function l(q,p){h.append('<div style="float:left;margin-left:10px;"><span>&nbsp;'+((q===""||q===" ")?"---   ":q)+'</span><div style="float:left;margin-left:5px;width:30px;height:30px;"><img src="images/marker_'+((p+1)%25).toString()+'.png"></img></div></div>')}h.empty();if(n.ColoredField!==""&&!m){QCRM.AddToListFields(b,[n.ColoredField]);var d=n.ColoredField,e=sugar_mod_fields[b][d];if(e&&e.options!==undefined){var o=sugar_app_list_strings[e.options],g=0;if(o!==undefined){for(var a in o){l(o[a],g);g++}}}else{h.append('<span style="float:left;margin-left:10px;">'+((d==="assigned_user_id")?RES_MY_ITEMS:sugar_mod_strings[b][sugar_mod_fields[b][d].label])+"&nbsp;&nbsp;</span>");l(RES_NO_LABEL,0);l(RES_YES_LABEL,1)}}}function AfterLogin(g,q){var v,u,r;function n(D){var E=null;function b(){if($("#PanelSearchText").val().length<1){$("#PanelSearchDiv").html("").listview("refresh")}else{GlobalSearch("PanelSearchText","PanelSearchDiv","",QCRM.MaxGlobalSearch,true)}}$("#PanelSearchText").bind("keyup change",function(){if(E){window.clearTimeout(E)}E=window.setTimeout(function(){E=null;b()},D)})}SimpleBeans.Users.DefValue=CurrentUserId;if(!QCRM.OffLine){SimpleBeans.Users.Init()}for(v in SimpleBeans){SimpleBeans[v].Load(SimpleBeans[v].AfterLoad)}if(mobile_edition!=="Pro"){Beans.Accounts.Fields=["phone_office","website","email1","description","assigned_user_name"];Beans.Contacts.Fields=["title","account_name","email1","phone_work","phone_mobile","description","assigned_user_name"];Beans.Leads.Fields=["title","account_name","status","email1","phone_work","phone_mobile","description","assigned_user_name"];Beans.Opportunities.Fields=["amount","date_closed","sales_stage","account_name","description","assigned_user_name"];Beans.Calls.Fields=["direction","status","date_start","duration_hours","duration_minutes","description","parent_name","assigned_user_name"];Beans.Meetings.Fields=["status","date_start","duration_hours","duration_minutes","description","parent_name","assigned_user_name"];Beans.Tasks.Fields=["status","date_start","date_due","priority","description","parent_name","assigned_user_name"];Beans.Notes.Fields=["description","filename"];Beans.Accounts.Addresses=["billing","shipping"];Beans.Contacts.Addresses=["primary","alt"];Beans.Leads.Addresses=["primary","alt"];Beans.Cases.Fields=["case_number","type","status","priority","account_name","description"];Beans.Project.Fields=["status","priority","description"];Beans.ProjectTask.Fields=["status","priority","percent_complete","assigned_user_name","project_name","description"];for(v in SearchPages){var a=SearchPages[v],o=Beans[a];o.AdditionalFields=o.Fields.slice();if(o.Addresses){for(var l in o.Addresses){var s=o.Addresses[l];o.AdditionalFields.push("$ADD"+s)}}}}if(QCRM.globalSearchButton){$("#searchbtndiv").show();$("#PanelSearchText").bind("keyup change",function(){if($("#PanelSearchText").val().length<1){$("#PanelSearchDiv").html("").listview("refresh")}})}else{n(200)}try{sugar_app_list_strings.date_search.today=sugar_app_list_strings.date_search.today.charAt(0).toUpperCase()+sugar_app_list_strings.date_search.today.slice(1);var A=["","on","isnull","greater_than","less_than","before","after","not_equal"];for(u in A){if(sugar_app_list_strings.date_search[A[u]]!==undefined){delete sugar_app_list_strings.date_search[A[u]]}}sugar_app_list_strings.date_search["="]=" --- ";if(sugar_version<"6.2"){r=sugar_app_list_strings.date_search.between_dates;sugar_app_list_strings.date_search.between=r;delete sugar_app_list_strings.date_search.between_dates}sugar_app_list_strings.date_search.past=RES_PAST;sugar_app_list_strings.date_search.future=RES_FUTURE}catch(h){}for(v in SearchPages){var a=SearchPages[v],z=Beans[a];if(z.template==="file"&&z.access!="none"){Beans[a].access="view"}if(sugar_mod_fields[a]===undefined||z.access==="none"){Beans[a].access="none";$("#Icon"+a).remove()}}if(sugar_app_list_strings.parent_type_display===undefined){sugar_app_list_strings.parent_type_display=sugar_app_list_strings.moduleList;delete sugar_app_list_strings.parent_type_display.Users}if(Beans.QCRM_SavedSearch!==undefined){Beans.QCRM_SavedSearch.Init();u=localStorage.getItem(ServerAddress+"SavedSearch");if(u===null||u===""){Beans.QCRM_SavedSearch.LoadAll(true,false)}else{Beans.QCRM_SavedSearch.LoadAll(false,true)}}if(Beans.Favorites!==undefined){Beans.Favorites.Init()}for(v in ViewPages){var u,B=ViewPages[v],d=Beans[B],m=d.AllFields();for(var w in m){var C=m[w],p=sugar_mod_fields[B][C];if(p!==undefined&&p.type==="phone"&&C!=="phone_fax"){d.PhoneFields.push(C);QCRM.AddToListFields(B,C)}}BuildColorLegend(B);if(typeof QCRM[B+"Setup"]==="function"){QCRM[B+"Setup"]()}for(u in d.hooks.install){try{d.hooks.install[u]()}catch(h){AlertPopup("Error found in "+g+" init_edit:/n"+h)}}d.CreateHook()}for(v in js_plugins){var e=QCRM[js_plugins[v].substr(0,js_plugins[v].length-3)];if(typeof e==="function"){e()}}for(v in QCRM.customInit){QCRM.customInit[v]()}for(v in QCRM.hooks.after_login){try{QCRM.hooks.after_login[v]()}catch(h){AlertPopup("Error found in after_login:/n"+h)}}if((mobile_edition==="Pro"||mobile_app)&&Pref.Alerts&&!QCRM.OffLine){CronAlerts()}if(QCRM.JJWG){JJWG.jjwg_init()}QCRM.updateBeans();updateDashlets();if(g!==""){setTimeout(function(){$.mobile.pageContainer.pagecontainer("change",g)})}$.mobile.loading("hide");if(QCRM.OffLine&&typeof QuickCRMAfterLogin=="function"){}if(!QCRM.OffLine&&typeof CustomCron=="function"){CustomCronStart()}if(Beans.QCRM_Tracker){Beans.QCRM_Tracker.enable()}if(!QCRM.OffLine&&QCRM.webdb&&QCRM.webdb.db){}if(!QCRM.OffLine&&QCRM.saveToCRM&&Beans.QCRM_SavedSearch!==undefined){Beans.QCRM_SavedSearch.SaveAll(true)}if(QCRM.forceLock&&!Pref.AppLock){setTimeout(function(){$("#LockBtn").click()},100)}}function onResume(){var a=toDBDate(CurrentDate);if(mobile_edition==="Pro"&&sugar_version>"6.3"&&QCRM.webdb&&typeof openDatabase!=="undefined"){QCRM.webdb.resume()}if(!QCRM.OffLine){seamlessLogin(function(b){if(b&&b.id&&b.name_value_list!==undefined){SugarSessionId=b.id;if(Pref.Alerts){CronAlerts()}}if(typeof CustomCron=="function"){CustomCronStart()}})}QCRM.calendar.init=false;CurrentDate=new Date();if(a!==toDBDate(CurrentDate)){QCRM.TodayDashlet.CurDate=new Date();QCRM.reminders.update()}unlocked=(Pref.AppLock===false);RequestPassword()}function onPause(){if(!QCRM.OffLine){if(Pref.Alerts){StopAlerts()}if(typeof CustomCron=="function"){CustomCronStop()}}}function LoginUser(h,g){var l=$("#SettingsUsername").val(),d,b=$("#SettingsPassword").val(),e=false,a="";$.mobile.loading("show");if(!h){if(sugar_version>="6.3"){a='"encryption":"PLAIN",'}else{b=$.md5(b)}d=b}setTimeout(function(){if(!e){AjaxErr()}},4000);SugarQuery("login","[{"+a+'"password":"'+b+'","user_name":"'+l+'"},"",""]',function(m){e=true;if(m){if(m.name!==undefined){$.mobile.loading("hide");h===undefined?LoginUser(true):AlertPopup(RES_WRONG_PASWD)}else{SugarSessionId=m.id;CurrentUserId=m.name_value_list.user_id.value;getUserFormats(m.name_value_list);$("#SettingsUsername").val("");$("#SettingsPassword").val("");localStorage.setItem("SugarId",CurrentUserId);AfterLogin(g===undefined?"#HomePage":g)}}else{AlertPopup("An unexpected error occurred logging in.");$.mobile.loading("hide")}},null)}function Disconnect(){}function LogOutUser(){ForceLogin=(!mobile_app);SugarQuery("logout",'[{"session":"'+SugarSessionId+'"}]',function(){AppReload()},null)}function GetBeansList(s,w,p,n,v,A){var z,q=s.length;if(n!==undefined&&n!==""){$("#"+w).append('<li data-role="list-divider">'+n+"</li>")}for(z=0;z<q;z++){var u=s[z],o=$("<li"+(p&&!A?' data-icon="false"':"")+"/>"),a=u.module;if(Beans[a]!==undefined&&Beans[a].Enabled()){var r=u.name,h=createLink(a,u.id),g=createEditLink(a,u.id,A);if(p){h.css({"font-size":"12px"})}h.addClass(u.module+"SIcon");h.css({"padding-left":"20px"});h.append(r);o.append(h);if(A){o.append(g)}$("#"+w).append(o)}}try{if(v===undefined||v===true){$("#"+w).listview("refresh")}else{$("#"+w).listview().listview("refresh")}}catch(m){}}function GetBeansListIds(l,h){var e,a=l.length,g=[];for(e=0;e<a;e++){var m=l[e];if(m.module===h){g.push(m.id)}}return g}function Remove1FromList(b,e){var d,a=b.length;for(d=0;d<a;d++){if(b[d].id===e){b.splice(d,1);break}}}function SaveList(d,b){var e="a",g,a=d.length;for(g=0;g<a;g++){e+="@@"+d[g].id+"@@"+d[g].module+"@@"+d[g].name}localStorage.setItem(b,e)}function LoadList(g){var e=localStorage.getItem(g);var h=[];if(e!==null&&e!==""&&e!=="a"){e=e.split("@@");var d,a=(e.length-1)/3;for(d=0;d<a;d++){h[d]={id:e[3*d+1],module:e[3*d+2],name:e[3*d+3]}}}return h}function PushViewed(b,d,a){Remove1FromLastviewed(b,d);LastViewed.unshift({module:b,id:d,name:a});if(LastViewed.length>10){LastViewed.pop()}SaveLastviewed()}function GetLastViewedList(){$.mobile.loading("show");$("#LastViewedListDiv li").remove();GetBeansList(LastViewed,"LastViewedListDiv",false,"",true,true);$.mobile.loading("hide")}function SaveLastviewed(){SaveList(LastViewed,"LastViewed");$("#LastViewedPanelDiv li").remove();GetBeansList(LastViewed,"LastViewedPanelDiv",true,sugar_app_strings.LBL_LAST_VIEWED,true,true);$("#HomePanel").trigger("updatelayout")}function Remove1FromLastviewed(a,b){Remove1FromList(LastViewed,b)}function RemoveFromLastviewed(a,b){Remove1FromLastviewed(a,b);SaveLastviewed()}function PushFavorites(b,d,a){Remove1FromFavorites(b,d);Favorites.unshift({module:b,id:d,name:a});if(Favorites.length>20){LastViewed.pop()}SaveFavorites()}function UpdateFavoritesPanel(b){$("#FavoritesPanelDiv li").remove();var a="Favorites";if(sugar_app_strings.LBL_FAVORITES&&sugar_app_strings.LBL_FAVORITES!="LBL_FAVORITES"){a=sugar_app_strings.LBL_FAVORITES}GetBeansList(Favorites,"FavoritesPanelDiv",true,a,b,true)}function SaveFavorites(){SaveList(Favorites,"Favorites");UpdateFavoritesPanel(true);$("#HomePanel").trigger("updatelayout")}function Remove1FromFavorites(a,b){Remove1FromList(Favorites,b)}function RemoveFromFavorites(a,b){Remove1FromFavorites(a,b);SaveFavorites()}function isFavorite(b,e){var d,a=Favorites.length;for(d=0;d<a;d++){if(Favorites[d].id===e&&Favorites[d].module===b){return true}}return false}function showFavoriteStatus(e,g,d){var b=$("."+e+"Fav"),a=isFavorite(e,g);if(Beans[e].Favorites){b.data("name",d);b.data("favorite",a);b.show();if(a){b.addClass("FavSet");b.removeClass("FavUnset")}else{b.removeClass("FavSet");b.addClass("FavUnset")}}}$("#GSListPage").on("pagecreate",function(){$("#GSPageTitle").text(RES_SEARCH_LABEL)});$("#GlobalSearch").on("pagecreate",function(){$("#GlobalSearchTitle").text(RES_SEARCH_LABEL);$("#GSSubmit").text(sugar_app_strings.LBL_SEARCH_BUTTON_LABEL);enableButton("GSSubmit",false);$("#GSSearchText").bind("keyup",function(a,b){enableButton("GSSubmit",$("#GSSearchText").val().length>=2)})});QCRM.GSBeans=[];QCRM.updateBeans=function(){var a=["Accounts","Contacts","Leads","Opportunities","Cases","Project"];QCRM.name_tpl="{first_name} {last_name}";QCRM.GSBeans=[];if(QCRM.UnifiedSearch){a=QCRM.UnifiedSearch}else{if(sugar_version>"6.5"){a.push("Tasks")}}$.each(a,function(b,d){if(Beans[d]!==undefined&&Beans[d].Enabled()){QCRM.GSBeans.push(d)}});if(QCRM.name_format){QCRM.name_format=QCRM.name_format.replace("s ","");QCRM.name_tpl=QCRM.name_format.replace("f","{first_name}").replace("l","{last_name}")}$.each(QCRM.beans,function(n,m){var p=Beans[m],b,q;if(p&&p.Enabled()&&sugar_mod[m]){var e,h,o;if(sugar_mod){if(p.GroupTotals&&typeof p.GroupTotals!=="string"){p.GroupTotals=p.GroupTotals[0]}if(p.GroupTotals&&p.GroupTotals!=""){if(p.SearchFields.indexOf(p.GroupTotals)===-1){p.SearchFields.push(p.GroupTotals)}}if(p.OrderBy&&p.OrderBy!=""){var g=p.OrderBy.split(" ")[0];if(!sugar_mod_fields[m][g]){p.OrderBy=""}}sugar_mod_fields[m].id={type:"id",label:"ID"};q=p.template;b=(q==="person");if(m!="Documents"&&q!="file"){if(!sugar_mod_fields[m].name){sugar_mod_fields[m].name={type:"name",label:RES_NAME_LABEL}}sugar_mod_fields[m].name.get_where=function(s,r,l){return matchName(p,"default",r)}}else{if(m!="Documents"&&q=="file"){QCRM.AddToListFields(m,["file_ext","file_mime_type","uploadfile"])}}if(p.highlighted&&p.highlighted.length>0){o="<h4>";e=p.highlighted;for(h in e){var d="{"+((h>0)?"-":"")+e[h]+"}";if(b&&e[h]=="name"){d=QCRM.name_tpl;QCRM.AddToListFields(m,["first_name","last_name"])}else{QCRM.AddToListFields(m,[e[h]])}o+=((h>0)?" ":"")+d}o+="</h4><p>"}else{o="<h4>"+(b?QCRM.name_tpl:((m==="Documents"||q==="file")?"{document_name}":"{name}"))+"</h4><p>"}e=p.CustomListFields;if(e&&e.length>0){for(h in e){var d="{"+((h>0&&h!=3)?"-":"")+e[h]+"}";if(b&&e[h]=="name"){d=QCRM.name_tpl;QCRM.AddToListFields(m,["first_name","last_name"])}else{QCRM.AddToListFields(m,[e[h]])}if(Pref.FieldsLabels){o+=((h>0)?" - ":"")+display_label(m,e[h])+" {"+e[h]+"}"}else{o+=(h==3?"<br>":"")+d}}}o+="</p>";if(Beans[m].CustomListViewTpl===false){Beans[m].ListViewTpl=o}else{Beans[m].ListViewTpl=Beans[m].CustomListViewTpl}if(b){Beans[m].TitleTpl=QCRM.name_tpl}Beans[m].TableViewTpl=p.CustomListFields}}});if(typeof CustomUpdateBean==="function"){$.each(QCRM.beans,function(b,d){if(Beans[d]!==undefined&&Beans[d].Enabled()){CustomUpdateBean(d)}})}$.each(QCRM.beans,function(b,e){var d=Beans[e];if(d!==undefined&&d.Enabled()){ComputeFieldsToUpdate(e)}});$.each(QCRM.phoneModules,function(b,d){if(Beans[d]&&Beans[d].Enabled()){ComputePhoneFields(d)}})};function GlobalSearch(b,e,h,a,d){var g=[],l=((Pref.PartialSearch&&!QCRM.ExactGlobalSearch)?"%":"")+$("#"+b).val().replace('"','\\"');if(l.length<2||QCRM.GSBeans.length===0){return}if(h!=""){$("body").pagecontainer("change","#"+h)}$.mobile.loading("show");$("#"+e+" li").remove();QCRM.search_by_module(QCRM.GSBeans,l,0,a,function(u){if(u&&u.entry_list!==undefined){var o,p=u.entry_list.length;if(p>0){$("#"+e+" li").remove()}for(o=0;o<p;o++){var n=u.entry_list[o],q=n.records.length,s;for(s=0;s<q;s++){g.push({module:n.name,id:n.records[s].id.value,name:getFromTemplate(n.name,n.records[s],Beans[n.name].GlobalSearchTpl)})}}GetBeansList(g,e,d,"",true,"alt-icon")}$.mobile.loading("hide")})}var LastModified=[],tmpLastModified=[],cronLastModifiedId=false,customCronId=false,cronGPSId=false;if(mobile_edition==="Pro"||mobile_app){function CronGPS(){if(QCRM.JJWG&&mobile_app){setTimeout(JJWG.getCurrentPosition,1000);if(cronGPSId===false){cronGPSId=setInterval(JJWG.getCurrentPosition,300000)}}}function StopCronGPS(){if(cronGPSId!==false){clearInterval(cronGPSId);cronGPSId=false}}function CronAlerts(){setTimeout(SearchLastModified,2000);if(cronLastModifiedId===false){cronLastModifiedId=setInterval(SearchLastModified,300000)}}function StopAlerts(){if(cronLastModifiedId!==false){clearInterval(cronLastModifiedId);cronLastModifiedId=false}}function CustomCronStart(){setTimeout(CustomCron,2000);if(customCronId===false){customCronId=setInterval(CustomCron,CustomCronInterval)}}function CustomCronStop(){if(customCronId!==false){clearInterval(customCronId);customCronId=false}}function SearchLastModified(){function e(l,n){var m=l.toLowerCase()+".";var h=m+"date_modified > '"+n+"' AND "+m+"modified_user_id != '1' AND "+m+"modified_user_id != '"+CurrentUserId+"' AND "+m+"assigned_user_id = '"+CurrentUserId+"'";SugarQuery("get_entry_list",'{"session":"'+SugarSessionId+'","module_name":"'+l+'","query":"'+h+'","order_by":"date_modified desc","offset":"","select_fields":'+Beans[l].ListFieldsToSelect()+',"link_name_to_fields_array":"","max_results":5,"deleted":0}',function(z){if(z&&z.entry_list!==undefined){var p;for(p=0;p<z.entry_list.length;p++){var w=z.entry_list[p],u={},v=Beans[l],s=false;for(var q in tmpLastModified){var r=tmpLastModified[q];if(r.id===w.id&&r.module===l){s=true;break}}if(!s){if(l==="Calls"||l==="Meetings"){QCRM.calendar.init=false}tmpLastModified.unshift({module:l,id:w.id,name:v.DisplayTitle(w.name_value_list)});if(tmpLastModified.length>10){tmpLastModified.pop()}}}}},null)}tmpLastModified=LastModified;var g=localStorage.getItem(ServerAddress+"ModifiedStamp"),b=new Date();if(g===null||g===""){g=new Date();g=toDBDateTime(g.addHours(-48))}localStorage.setItem(ServerAddress+"ModifiedStamp",toDBDateTime(new Date(b.getTime()-300000)));var d=["Calls","Meetings","Contacts","Leads","Cases","Tasks"];for(var a in d){if(Beans[d[a]].Enabled()){e(d[a],g)}}setTimeout(GetNotificationList,1000)}function ClearLastModified(){LastModified=[];$("#HomeNotify").popup("close");$("#NotifyHomeBtn").hide();SaveList(LastModified,"LastModified")}function GetNotificationList(){LastModified=tmpLastModified;if(LastModified.length>0){$("#NotifyListDiv li").remove();GetBeansList(LastModified,"NotifyListDiv",true);$("#NotifyClear").button();$("#NotifyHomeBtn").show()}else{$("#NotifyHomeBtn").hide()}SaveList(LastModified,"LastModified")}}function GetAllModulesList(m){$("#"+m+" li").remove();SearchPages=SearchPages.sort(function(e,d){return sugar_app_list_strings.moduleList[e]<sugar_app_list_strings.moduleList[d]?-1:1});var g,a=SearchPages.length;for(g=0;g<a;g++){var q=SearchPages[g];if(Beans[q].Enabled()&&Beans[q].ShowTab){var n=$("<li data-split-theme='d'/>"),p=sugar_app_list_strings.moduleList[Beans[q].name],h=$("<a/>",{href:"#"+Beans[q].name+"ListPage"});h.addClass(Beans[q].name+"SIcon");h.css({"padding-left":"20px"});h.append(p);n.append(h);var o=$('<a data-icon="plus" data-role="button" class="ui-alt-icon ui-nodisc-icon"/>',{href:"#"});o.click({page:SearchPages[g]},function(b){Beans[b.data.page].Create("","","HomePage")});n.append(o);$("#"+m).append(n)}}$("#"+m).listview()}function LogCall(d,a,n,g,e){if((mobile_edition=="Pro")&&Beans.Calls.Enabled()&&Pref.LogCalls&&(d!=="Employees")&&(d!=="Users")){var o,q="",h="",m=!Beans.Calls.fullPage,l=$("body").pagecontainer("getActivePage").attr("id");for(o in Beans.Calls.Links){if(Beans.Calls.Links[o].module===d){q=o;break}}for(o in Beans[d].Links){if(Beans[d].Links[o].module==="Calls"){h=o;break}}if(d==="Calls"&&!e){QCRM.set_entry("Calls",a,{status:{name:"status",value:"Held"}},function(r){Beans.Calls.CurrentId=a;$("body").pagecontainer("change","#Calls"+(m?"ListPage":"DP"));if(m){Beans.Calls.ViewDetails()}})}if(d!=="Calls"){seamlessLogin(function(r){});var b={},p="";if(g&&d!=="Accounts"&&g!==""){p=g}else{if(d==="Accounts"&&a!==""){p=a}}if(p!==""){b.parent_id={name:"parent_id",value:p};b.parent_type={name:"parent_type",value:"Accounts"}}else{b.parent_id={name:"parent_id",value:a};b.parent_type={name:"parent_type",value:d}}$.extend(b,Beans.Calls.LoggedCall(b,n));if(Beans.Calls.CustomLoggedCall){$.extend(b,Beans.Calls.CustomLoggedCall(b,n))}$.extend(b,Beans.Calls.CustomValues(b,true));QCRM.set_entry("Calls","",b,function(r){if(!r||((r.name!==undefined)&&(r.name==="Access Denied"))){return}Beans.Calls.CurrentId=r.id;if(d!=="Accounts"&&q!==""){QCRM.set_relationship("Calls",Beans.Calls.CurrentId,q,a)}if(h!==""){QCRM.set_relationship(d,a,h,Beans.Calls.CurrentId)}if(sugar_version>="6.1"){QCRM.set_relationship("Calls",Beans.Calls.CurrentId,"users",CurrentUserId)}$("body").pagecontainer("change","#Calls"+(m?"ListPage":"DP"));if(m){Beans.Calls.ViewDetails()}})}}}function defaultPreferences(){var u,E,I,F,v,C,L,b,g,r,L,A,h,w,D,o,G,e={},q={},n=false,p=[],a=[],J;if(mobile_edition==="Pro"){Pref={AudioNotes:mobile_app&&QCRM.AudioNotes,PDFInApp:mobile_app,Reminders:true,NativeCal:QCRM.native_cal,Today:true,PartialSearch:true,AppLock:false,LogCalls:true,Alerts:mobile_app,FilterOldDate:"",FilterOld:[],FieldsLabels:false,HideEmptySubP:true,Creates:[],Hidden:[],Disabled:[],SyncModules:{},OffLineNb:400,ActivitiesWhere:"",ActivitiesFrom:0,ActivitiesTo:0,Activities_planned:true,Activities_held:true,Activities_not_held:true,ActivitiesMine:false}}else{Pref={AudioNotes:false,PDFInApp:mobile_app,Reminders:true,NativeCal:mobile_app,Today:false,PartialSearch:true,AppLock:false,LogCalls:false,Alerts:mobile_app,FilterOldDate:"",FilterOld:[],FieldsLabels:false,HideEmptySubP:true,Creates:[],Hidden:[],Disabled:[],SyncModules:{},ActivitiesWhere:"",ActivitiesFrom:0,ActivitiesTo:0,Activities_planned:true,Activities_held:true,Activities_not_held:true,ActivitiesMine:false}}LastViewed=LoadList("LastViewed");Favorites=LoadList("Favorites");LastModified=LoadList("LastModified");u=getCookie("OptIconsLabels");if(u==="1"){IconsLabels=true}else{if(u==="0"){IconsLabels=false}}tmpIconsLabels=IconsLabels;if(mobile_edition==="Pro"){u=getCookie("ActivitiesTo");if(u!==null&&u!==""){Pref.ActivitiesTo=u;Pref.ActivitiesFrom=getCookie("ActivitiesFrom");Pref.LogCalls=(getCookie("OptLogCalls")==="1");Pref.ActivitiesMine=(getCookie("OptActMyItems")==="1");Pref.Activities_planned=(getCookie("ActStatus_planned")==="1");Pref.Activities_held=(getCookie("ActStatus_held")==="1");Pref.Activities_not_held=(getCookie("ActStatus_not_held")==="1")}createDashlets();if((QuickCRMAddress+"SavedSearches") in localStorage){u=localStorage.getItem(QuickCRMAddress+"SavedSearches");localStorage.setItem(ServerAddress+"SavedSearches",u);localStorage.removeItem(QuickCRMAddress+"SavedSearches")}if((QuickCRMAddress+"ModifiedStamp") in localStorage){u=localStorage.getItem(QuickCRMAddress+"ModifiedStamp");localStorage.setItem(ServerAddress+"ModifiedStamp",u);localStorage.removeItem(QuickCRMAddress+"ModifiedStamp")}}u=getCookie("SortOrder");if(u!==null&&u!==""){u=jQuery.parseJSON(u);for(var B in u){if(Beans[B]!==undefined){Beans[B].OrderBy=u[B]}}}if(mobile_app){}u=getCookie("OptRowsPerPage");if(u!==null&&u!==""){RowsPerPage=parseInt(u,10)}u=getCookie("OptRowsPerSubpanel");if(u!==null&&u!==""){RowsPerSubPanel=parseInt(u,10)}if(mobile_edition==="Pro"){u=getCookie("OptRowsPerDashlet");if(u!==null&&u!==""){RowsPerDashlet=parseInt(u,10)}u=localStorage.getItem("SyncModules"+ServerAddress);if(u!==null&&u!==""){Pref.SyncModules=jQuery.parseJSON(u)}else{u=localStorage.getItem("SyncModules");if(u!==null&&u!==""){localStorage.getItem("SyncModules"+ServerAddress,u);localStorage.removeItem("SyncModules");Pref.SyncModules=jQuery.parseJSON(u)}}$.each(QCRM.beans,function(d,m){if(Beans[m].SyncOptions){Pref.SyncModules[m]={preset:true,sync:Beans[m].SyncOptions.sync,max:Beans[m].SyncOptions.max}}else{if(Pref.SyncModules[m]===undefined){Pref.SyncModules[m]=Beans[m].SyncDefaults}Pref.SyncModules[m].preset=false}});if(Pref.SyncModules.Documents&&Pref.SyncModules.Documents.sync!=="None"){Pref.SyncModules.Documents.attachments=true}if(QCRM.webdb&&QCRM.webdb.MaxRecords){Pref.OffLineNb=QCRM.webdb.MaxRecords}u=getCookie("OffLineNb");if(u!==null&&u!==""){Pref.OffLineNb=u}u=getCookie("OptToday");if(u==="1"){Pref.Today=true}else{if(u==="0"){Pref.Today=false}}}u=localStorage.getItem(ServerAddress+"NativeCal");if(u==="1"){Pref.NativeCal=true}else{if(u==="0"){Pref.NativeCal=false}else{if(u!==null&&u!==""){Pref.NativeCal=jQuery.parseJSON(u)}}}if(mobile_app&&iOS&&mobile_edition=="Pro"){}u=localStorage.getItem("PartialSearch");if(u==="1"){Pref.PartialSearch=true}else{if(u==="0"){Pref.PartialSearch=false}}if(mobile_edition==="Pro"||mobile_app){u=localStorage.getItem("Alerts");if(u==="1"){Pref.Alerts=true}else{if(u==="0"){Pref.Alerts=false}}u=localStorage.getItem("HideEmptySubP");if(u==="1"){Pref.HideEmptySubP=true}else{if(u==="0"){Pref.HideEmptySubP=false}}}u=localStorage.getItem("FilterOldDate");if(u!==null){Pref.FilterOldDate=u}u=localStorage.getItem("FilterOld");if(u!==null){Pref.FilterOld=[];if(u!==""){u=u.split(",");for(var B in u){if(QCRM.beans.indexOf(u[B])!==-1){Pref.FilterOld=Pref.FilterOld.concat(u[B])}}}}if(Beans.Emails!==undefined){Beans.Emails.HomeIcon=false}if(mobile_edition==="Pro"){u=localStorage.getItem(ServerAddress+"SavedSearches");if(u!==null&&u!==""){p=jQuery.parseJSON(u);for(v in p){C=p[v];n=true;if(C.v>=2){break}L=C.module;b=Beans[L].SearchFields;A=C.fields;D="Search"+C.module;G=D.length;for(F in A){h=A[F];if(h.field.substring(0,G)===D&&h.type==="chk"){for(E in b){I=b[E];w=sugar_mod_fields[L][I];o=D+"_"+I;if(h.field.substring(0,o.length)===o&&w!==undefined&&(w.type==="enum"||w.type==="multienum")){r=sugar_app_list_strings[w.options];for(g in r){if(D+"_"+I+"_"+g.replace(/\s+/g,"").replace(/\.+/g,"").replace(/\/+/g,"")===h.field.replace(/\s+/g,"").replace(/\.+/g,"").replace(/\/+/g,"")){if(q[v]===undefined){q[v]=[]}q[v].push(F);if(e[v]===undefined){e[v]={}}if(e[v][I]===undefined){e[v][I]={field:D+"_"+I,type:"sel",val:[]}}if(h.val){e[v][I].val.push(g)}break}}}}}}}if(n){for(v in p){C=p[v];L=C.module;b=Beans[L].SearchFields;A=C.fields;D="Search"+C.module;if(q[v]===undefined){C.v=2;a.push(C)}else{J={v:2,module:C.module,name:C.name,fields:[],home:C.home,order:C.order};for(F in A){h=A[F];if(q[v].indexOf(F)===-1){J.fields.push(h)}}for(F in e[v]){h=e[v][F];J.fields.push(h)}a.push(J)}}localStorage.removeItem(ServerAddress+"SavedSearches")}for(v in a){var K=p[v],z=QCreateId(),l=toDBDateTime(new (Date)),H={id:z,type:"Search",module:K.module};QCRM.SavedSearches[z]={id:z,date_modified:l,date_entered:l,name:K.name.trim(),type:K.module,fields:K.fields,sort_order:K.order,assigned_user_id:CurrentUserId};QCRM.SavedSearches[z][shared_field]=false;if(K.home===true||K.home==="I"){QCRM.DashletAdd(QCRM.searchIcons,H)}else{if(K.home==="D"){QCRM.DashletAdd(QCRM.Dashlets,H)}}}}else{}}u=getCookie(ServerAddress+"Icons");if(u!==null){if(u!==""){n=true;u=u.split(",");for(var B in u){if(QCRM.beans.indexOf(u[B])!==-1){Pref.Hidden=Pref.Hidden.concat(u[B])}}}}else{$.each(QCRM.beans,function(d,m){if(!Beans[m].HomeIcon){Pref.Hidden=Pref.Hidden.concat(m)}})}u=getCookie("Creates");if(mobile_edition==="Pro"&&u!==null){if(u!==""){u=u.split(",");for(var B in u){if(QCRM.beans.indexOf(u[B])!==-1){Pref.Creates=Pref.Creates.concat(u[B])}}n=true}}if(n){QCRM.saveToCRM=true;SaveSearchesAndHomePage();if((ServerAddress+"SavedSearches") in localStorage){localStorage.removeItem(ServerAddress+"SavedSearches")}if((ServerAddress+"Icons") in localStorage){localStorage.removeItem(ServerAddress+"Icons")}if("Creates" in localStorage){localStorage.removeItem("Creates")}}else{u=localStorage.getItem(ServerAddress+"SavedSearch");if(u!==null&&u!==""){QCRM.SavedSearches=jQuery.parseJSON(u)}LoadHomePageDef()}}function updatePreferences(d){if(d){ShowHideToolbarLabels()}if(mobile_edition==="Pro"){var b="";Pref.ActivitiesWhere="";if(Pref.ActivitiesFrom>0){var a=new Date(CurrentDate.getTime()-Pref.ActivitiesFrom*86400000);Pref.ActivitiesWhere+="(date_start >= '"+toDBDate(a)+"')"}if(Pref.ActivitiesTo>0){var e=new Date(CurrentDate.getTime()+Pref.ActivitiesTo*86400000);Pref.ActivitiesWhere+="(date_start <= '"+toDBDate(e)+"')"}if((Pref.Activities_planned||Pref.Activities_held||Pref.Activities_not_held)&&(!Pref.Activities_planned||!Pref.Activities_held||!Pref.Activities_not_held)){if(Pref.Activities_planned){b+="(status='Planned')"}if(Pref.Activities_held){b+="(status='Held')"}if(Pref.Activities_not_held){b+="(status='Not Held')"}Pref.ActivitiesWhere+="("+b.replace(/\)\(/g,")or(")+")"}if(Pref.ActivitiesMine){Pref.ActivitiesWhere+="(assigned_user_id = '"+CurrentUserId+"')"}Pref.ActivitiesWhere=Pref.ActivitiesWhere.replace(/\)\(/g,")and(")}}QCRM.getModuleString=function(d,e,a){var b=a?a:"";if(sugar_mod_strings&&sugar_mod_strings[d]&&sugar_mod_strings[d][e]){b=sugar_mod_strings[d][e]}return b};function display_label(d,e,g){var a=sugar_mod_fields[d];if(a[e]===undefined){return e}if((a[e].type==="boolean")||(a[e].type==="bool")){return""}var b=a[e].label;b=sugar_mod_strings[d][b]||b;if(g){b='<span class="SugarLabel">'+b+"<span>"}return b}function display_value(d,h,a){var e=a[h].value,b="Custom_"+d+"_"+h;if(sugar_mod_fields[d]===undefined){return""}var g=sugar_mod_fields[d][h];if(g===undefined||!SugarFields[g.type]){return e}else{if(typeof g.display==="function"){return g.display(e,a)}else{if(typeof QCRM[b]==="function"){return QCRM[b](e,a)}else{return SugarFields[g.type].display(d,h,e,a)}}}}function display_default(a,d){if(sugar_mod_fields[a]===undefined){return""}else{if(sugar_mod_fields[a][d]===undefined){return""}else{if(d=="assigned_user_id"){return""}}}var b=sugar_mod_fields[a][d];return b.def||""}function address_values(u,d,h){var b="",e="",a="+",o=getAddressValues(d,h,u),p=false,l=QCRM.addressTemplate,r=o.street,n=o.city,q=o.state,m=o.postalcode,g=o.country;if(QCRM.addressTemplate.indexOf("prefix")>=0){l=QCRM.addressTemplate.replace(/\$prefix/g,h+"_address");p=true}if(r!==""||n!==""||q!==""||m!==""||g!==""){if(g===""){g=JJWG.defCountry}if(p){e=getFromTemplate(d,u,l)}else{e=QCRM.addressTemplate.replace("$street",r).replace("$postalcode",m).replace("$state",q).replace("$city",n).replace("$country",g).replace(/\\r/g,"").replace(/\\n/g,"<br>").replace(/\n/g,"<br>").replace(/<br>$/g,"").replace(/^<br>/g,"")}b=(r+a+n+a+(q!==""?(q+a):"")+m).replace("<br>"," ").replace(/\n/g,a).replace(/&#039;/g,"'")}return{google:b,display:e}}function getAddressFields(e,d){var b,a=[];for(b in QCRM.addressFields){a.push(e+"_address_"+QCRM.addressFields[b])}return a}function getAddressValues(b,m,a){var h,l={},n,d,e=QCRM.google_addressFields,g=["street","city","state","postalcode","country"];for(h in e){n=m+"_address_"+e[h];if(a[n]){d=display_value(b,n,a)}else{d=""}l[g[h]]=d}return l}function init_picker(d,g,m,e){var b=new Date(),l=m,h={text:RES_CLEAR,handler:function(n,o){$(d).val("");$(d).mobiscroll("cancel")}},a={preset:g,minDate:new Date(b.getFullYear()-80,0,1),maxDate:new Date(b.getFullYear()+20,11,31),theme:iOS?"ios":"android-holo-light",display:"modal",stepMinute:5,lang:getMobiscrollLanguage()};a.buttons=["cancel","now",h,"set"];if(e){$.extend(a,e)}$(d).mobiscroll(a);var l=m;if(m===false){l=new Date();if(g==="datetime"){l.setMinutes(15*Math.round(l.getMinutes()/15))}}if(m!==""){$(d).mobiscroll("setDate",l,(m!==false))}if(m===false){$(d).val("")}}function updateDynamicEnum(a,h,l){var e="Edit"+a+"_";l=e+l;if(document.getElementById(l)!=null){var b=document.getElementById(l),o=$("#"+e+h).val(),n;var g=[];for(var d=0;d<b.length;d++){if(b.options[d].selected){g.push(b.options[d].value)}}if(de_entries[l]==null){de_entries[l]=new Array;for(var d=0;d<b.options.length;d++){de_entries[l][b.options[d].value]=b.options[d].text}}document.getElementById(l).innerHTML="";for(var m in de_entries[l]){if(m.indexOf(o+"_")==0){if(!n){n=m}b.options[b.options.length]=new Option(de_entries[l][m],m)}}for(var m in g){for(var d=0;d<b.length;d++){if(b.options[d].value==g[m]){b[d].selected=true;n=g[m];break}}}$("#"+l).selectmenu("refresh")}}function set_enum_val(a,b){$(a).val(b);$(a+" option").prop("selected",false);if(b===""){b="EMPTY"}$(a+" option[value='"+b+"']").prop("selected",true);$(a).selectmenu().selectmenu("refresh")}function set_multienum_val(a,b){$(a).val(b).selectmenu("refresh")}function set_bool_val(a,d,b){$(a+"0").prop("checked",!b).checkboxradio().checkboxradio("refresh");$(a+"1").prop("checked",b).checkboxradio().checkboxradio("refresh")}function init_dynamic_enum(b,e,a){if(e.parentenum!==undefined){var d=e.parentenum;if(Beans[b].AdditionalFields.indexOf(d)!==-1){updateDynamicEnum(b,d,a)}}}function init_form_field(d,b,l,e,g,z,q){var u="",r=sugar_mod_fields[d][b],s=false,w=z+b,F=((g[b]===undefined||e)?false:g[b].value),D;if(!r){return}if(SugarFields[r.type]){s=SugarFields[r.type]}if(r.source==="non-db"&&r.type!=="Drawing"){return}if(F===false&&e&&typeof r.default_value==="function"){F=r.default_value(q)}if(r.init_value){r.init_value(e,g,z,q);return}if(s&&s.init_value){s.init_value(d,b,e,g,z,q);return}if(b==="user_sync"){if(e||(F==="0")){$(w).val("0")}else{$(w).val("1")}return}if(b==="duration_hours"){if(e){set_enum_val(w,"0")}else{set_enum_val(w,F)}return}if(b==="duration_minutes"){if(e){set_enum_val(w,"15")}else{set_enum_val(w,F)}return}if(g.id&&r.type==="Drawing"){SugarQuery("get_drawing",'{"session":"'+SugarSessionId+'","module_name":"'+d+'","id":"'+g.id.value+'","field":"'+b+'"}',function(I){var G=false,H=null;if(I){G=mobile_app&&I.entry_list.hasDrawing;if(G){drawingInit("edit",d,w.replace(/#/g,""),"data:image/png;base64,"+I.entry_list.contents)}}if(!G){drawingInit("edit",d,w.replace(/#/g,""),"")}},null);return}if(F===false){if(r.type==="enum"||r.type==="dynamicenum"){D=r.def;if(r.def===undefined){var p=sugar_app_list_strings[r.options];if(p[""]!==undefined){set_enum_val(w,"")}else{for(var h in sugar_app_list_strings[r.options]){set_enum_val(w,h);break}}}else{set_enum_val(w,r.def)}init_dynamic_enum(d,r,b)}else{if(r.type==="relate"&&Beans[r.module]===undefined){if(SimpleBeans[r.module]){set_enum_val(w,SimpleBeans[r.module].DefValue)}}else{if(b==="assigned_user_name"){$(z+"assigned_user_id").val(CurrentUserId);$(w).val(CurrentUserName);$(w+"L").html("")}else{if(r.type==="relate"){$(w).val("");$(z+r.id_name).val("");$(w+"L").html("")}else{if(r.type==="parent"){$(w).val("");$(z+r.id_name).val("");set_enum_val(z+r.id_type,"Accounts")}else{if(r.type==="multienum"){var A=0,p=sugar_app_list_strings[r.options];for(var a in p){$(w+"_"+a.replace(/\s+/g,"").replace(/\.+/g,"").replace(/\/+/g,"")).prop("checked",false).checkboxradio().checkboxradio("refresh");A++}}else{if(r.type==="date"){init_picker(w,"date",false)}else{if(r.type==="datetime"){init_picker(w,"datetime",false)}else{if((r.type==="bool"||r.type==="boolean")){set_bool_val(w,b,false)}else{if((r.type==="text")||(r.type==="TextOperators")){$(w).val("");$(w+"old").val("")}else{$(w).val((!e||(r.def===undefined))?"":r.def);if((r.type==="image"||r.type==="photo")&&QCRM.imageFields[r.type]){$(w+"D").val("0");$(w+"I").val("");$(w+"O").empty();show_upload(w,true)}}}}}}}}}}}}else{switch(r.type){case"varchar":case"char":case"name":$(w).val(HTMLDecode(F));break;case"text":case"TextOperators":if(!r.html){$(w).val(HTMLDecode(F.replace(/\\n/g,"\n").replace(/\\r/g,"\r")))}else{var E,C,B=HTMLDecode(F),n=(B.indexOf("<p>")>=0||B.indexOf("<br")>=0),o=r.html_mode||SugarFields.text.html_mode;if(n){C=B}else{C=F.replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/<br>/g,"\n")}$(w+"old").val(C);if(o=="readonly_html"){o=n?"readonly":"strip_tags"}if(n){if(o=="show_html"){E=B}else{E=$("<div/>").html(B).text()}}else{E=C}$(w).val(E);if(o=="readonly"){$(w+"txt").html(C);$(w+"txt").parent().show();$(w).hide()}else{$(w+"txt").parent().hide();$(w).show()}}break;case"datetime":init_picker(w,"datetime",(!F||F==="")?false:fromDBDateTime(F));break;case"date":init_picker(w,"date",(!F||F==="")?false:fromDBDate(F));break;case"enum":case"dynamicenum":set_enum_val(w,F);init_dynamic_enum(d,r,b);break;case"relate":if(Beans[r.module]===undefined){set_enum_val(w,g[r.id_name].value)}else{$(w).val(F.replace(/&#039;/g,"'").replace(/\r/g,""));var v="";if(g[r.id_name]){v=g[r.id_name].value}$(z+r.id_name).val(v);$(w+"L").html("")}break;case"parent":$(w).val(HTMLDecode(F));if(g[r.id_type].value===""){g[r.id_type].value==="Accounts"}$(z+r.id_name).val(HTMLDecode(g[r.id_name].value));set_enum_val(z+r.id_type,g[r.id_type].value);break;case"multienum":var A=0,p=sugar_app_list_strings[r.options],m;for(var a in p){if(a===""){if(F.length<2){m=false}else{if(F.length===2){m=true}else{m=(F.indexOf("^^^")>=0)}}}else{m=(F.indexOf("^"+a+"^")>=0)}$(w+"_"+a.replace(/\s+/g,"").replace(/\.+/g,"").replace(/\/+/g,"")).prop("checked",m).checkboxradio("refresh");A++}break;case"bool":case"boolean":set_bool_val(w,b,(F==="1"));break;case"currency":if(F!==""){if(typeof F==="string"){F=parseFloat(F)}$(w).val(F.toFixed(2))}else{$(w).val(F)}break;case"image":case"photo":if(QCRM.imageFields[r.type]){$(w+"O").empty();$(w+"I").val("");$(w+"D").val("0");show_upload(w,F=="")}default:$(w).val(F);break}}if(r.readonly&&(r.type=="date"||r.type=="datetime")){QCRM.SetFieldReadonly(d,b,true)}else{if(r.type=="text"||(r.type==="TextOperators")){$(w).textinput("refresh");$(w+"chng").val("0")}}}QCRM.toDBField=function(d,o,g){var e,n=sugar_mod_fields[d][o],a=g+o;if(n===undefined){return $(a).val()}if(n.toDBField!==undefined){return n.toDBField(g)}if(SugarFields[n.type]&&SugarFields[n.type].toDBField!==undefined){return SugarFields[n.type].toDBField(d,o,g)}switch(n.type){case"bool":case"boolean":e=$(a+"div input:radio:checked").val();if(e===undefined){if(Beans[d].CurrentId===""){e="0"}else{e=CurrentRecordValues[o].value}}return e;break;case"date":case"datetime":e=$(a).mobiscroll("getDate");if(e===null||$(a).val()===""){return""}else{if(n.type==="datetime"){return toDBDateTime(e)}else{return toDBDate(e)}}break;case"multienum":var l=0,p=sugar_app_list_strings[n.options],m="";for(var b in p){if($(g+o+"_"+b.replace(/\s+/g,"").replace(/\.+/g,"").replace(/\/+/g,"")).is(":checked")){m+=(m===""?"":",")+"^"+b+"^"}l++}return m;break;case"relate":return $(a).val();break;case"float":case"decimal":case"currency":case"double":e=$(a).val();if(e===null||e===""){return""}try{e=document.getElementById(a.replace("#","")).valueAsNumber;if(typeof e==="number"&&!isNaN(e)){if(QCRM.OffLine){return e}return e.formatNumber(sig_digits,decimal_separator,"")}}catch(h){}e=$(a).val();return e;break;default:e=$(a).val();if(e===null){return""}else{if(typeof e==="string"){e=e.trim()}}return e;break}};function getEditField(b,e){var d=sugar_mod_fields[b][e],a=e;if(d===undefined){return e}if(d.type==="relate"&&Beans[d.module]===undefined){a=d.id_name}else{if((d.type==="relate"||d.type==="parent")&&$("#Edit"+b+"_"+d.id_name).val()!==undefined){a=d.id_name}}return"#Edit"+b+"_"+a}function checkFormField(b,g,e){var d=sugar_mod_fields[b][g],l="",h=$(e+g).val();if(h&&typeof h==="string"){h=h.trim()}if(d!==undefined){var a=sugar_mod_strings[b][d.label];if(d.req&&d.type==="multienum"){}else{if(d.req&&d.type==="parent"){if($(e+d.id_name).val()===""){l=": "+RES_REQUIRED_MSG}}else{if(d.req&&d.type==="Drawing"){}else{if(d.req&&(h===""||h==="EMPTY")){l=": "+RES_REQUIRED_MSG}else{if((d.type==="email")&&!check_email(h)){l=RES_INVALID_EMAIL_MSG}else{if(((d.type==="relate"&&Beans[d.module]!==undefined)||d.type==="parent")&&h!==""){if($(e+d.id_name).val()===""){l=" - "+RES_UNDEFINED_FIELD+" "+h}}else{if(g==="duration_hours"){if(h==="0"&&$(e+"duration_minutes").val()==="0"){return RES_DURATION_LABEL+": "+RES_REQUIRED_MSG}}}}}}}}if(l!==""){a=a===undefined?g:a.replace("&#039;","'");return a+l}}return""}function check_email(a){if(a===""){return(true)}return(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,15})+$/.test(a))}function getRelatedList(e,p){var g=Beans[e].CurrentId,b=Beans[e],q=Beans[e].Links[p],d=q.module,u=(Beans[d]===undefined?SimpleBeans[d]:Beans[d]),r="#"+e+"DP"+p+"Ul";if(u.Enabled()){$(r).empty();if(q.display!==undefined){q.display(g);return}var s=(u!==undefined)&&(mobile_app||mobile_edition=="Pro")&&q.select&&(["Calls","Meetings","Tasks","Notes","Emails"].indexOf(d)===-1),w=(Beans[d]!==undefined)&&(mobile_edition=="Pro"||Beans[d].available_CE)&&u.access==="edit"&&q.create,v,h,o,a=sugar_app_list_strings.moduleList[d];if(b.CustomLinks&&b.CustomLinks[p]&&b.CustomLinks[p].title!==undefined){var l=b.CustomLinks[p].title;if(sugar_mod_strings[e][l]!==undefined){a=sugar_mod_strings[e][l]}else{if(l!==q.module){a=l}}}if(s||w){v=$("<li data-icon='"+(s?"search":"plus")+"'"+((w&&s)?" data-split-theme='b' class='ui-nodisc-icon'":"")+" data-theme='b'/>");if(w){h=$("<a/>",{href:"#",click:function(){Beans[d].Create(e,p)}});h.append(a+(s?'<span style="font-weight:bold;font-size:larger;float:right;">+</span>':""));v.append(h)}if(s){o=$("<a/>",{href:"javascript:void(0)","data-icon":"search","data-link":"add-rel","data-mod":d,"data-frommod":e,"data-fromid":g,"data-fromlnk":p,"data-filter":(q.filter&&CurrentRecordValues[q.filter.value_field]&&CurrentRecordValues[q.filter.value_field]!=="")?(q.filter.field+" LIKE '"+CurrentRecordValues[q.filter.value_field].value+"'"):""});if(!w){o.append(a)}v.append(o)}}else{v=$("<li data-theme='b' data-icon='false'/>");v.append('<a href="javascript:void(0)">'+a+"</a>")}$(r).append(v);var n=u.DisplaySubpanelFilter(),m=ShowRelatedBeansList;if(QCRM.ServerVersion>="4.6"&&d!=="Emails"){m=ShowRelatedBeansList2}if(Beans[d]!==undefined&&Pref.FilterOldDate!==""&&Pref.FilterOld.indexOf(d)!==-1){n+=(n===""?"":" AND ")+"date_entered>'"+Pref.FilterOldDate+"'"}if(q.where){n+=(n===""?"":" AND ")+q.where}m(e,d,g,p,n,u.OrderBy,r.replace("#",""),0,RowsPerSubPanel,Pref.HideEmptySubP&&!w&&!s)}}function ShowRelatedBeansList(p,s,r,C,n,m,e,g,l,o){var a=(Beans[s]===undefined?SimpleBeans[s]:Beans[s]),D=$("#"+e),A,z,v=Beans[p].Links[C],b=getNavButtons(e),q=a.OrderBy.split(" "),d,h=q[0],B=(q[1]===undefined||q[1]==="asc")?1:-1;function w(E,G){try{return(parseFloat(E.name_value_list[h].value)>parseFloat(G.name_value_list[h].value))?B:-B}catch(F){return E.name_value_list[h]?B:-B}}function u(E,G){try{return(E.name_value_list[h].value.toUpperCase()>G.name_value_list[h].value.toUpperCase())?B:-B}catch(F){return E.name_value_list[h]?B:-B}}D.hide();$("#"+e+" li:gt(0)").remove();QCRM.get_relationships(p,s,r,C,n,a.ListFieldsToSelect([h,"id"]),"","",0,false,function(L){if(L&&L.entry_list!=undefined){if(L.entry_list.length>g){if(h!==""&&Beans[s]!==undefined){d=sugar_mod_fields[s][h].type;if(d==="currency"||d==="int"||d==="decimal"||d==="float"||d==="double"){L.entry_list.sort(w)}else{L.entry_list.sort(u)}}var I=g,G=L.entry_list.length,F=g+l,J,M;if(F>G){F=G}for(I;I<F;I++){var K=L.entry_list[I],E,H;if(Beans[s]!==undefined){if(s=="Documents"&&sugar_version<"6.3"){$.extend(L.entry_list[I].name_value_list,Beans[s].get_file_info(L.entry_list[I].name_value_list.document_name.value.replace(" ","_")))}H=Beans[s].DisplaySubpanelRecord(K.id,K.name_value_list,p+(Beans[p].fullPage?"DP":"ListPage"),p,C)}else{H=$("<li/>");E=SimpleBeans[s].DisplaySubpanelElt(K.name_value_list);H.append(E)}D.append(H)}if(G>l){M=g-l;if(M<0){M=0}J=g+l;D.append($("<li/>").append(b));$("#"+e+"L").unbind("click");$("#"+e+"L").click({offset:M},function(N){ShowRelatedBeansList(p,s,r,C,n,m,e,N.data.offset,l,false)});$("#"+e+"R").unbind("click");$("#"+e+"R").click({offset:J},function(N){ShowRelatedBeansList(p,s,r,C,n,m,e,N.data.offset,l,false)});enableButton(e+"L",g!==0);enableButton(e+"R",G>J)}D.listview().listview("refresh");if(mobile_app){}D.show()}else{if(!o){D.listview().listview("refresh");D.show()}}}else{D.listview("refresh")}})}function ShowRelatedBeansList2(p,s,r,B,n,m,e,g,l,o){var a=(Beans[s]===undefined?SimpleBeans[s]:Beans[s]),C=$("#"+e),w,v,u=Beans[p].Links[B],b=getNavButtons(e),q=a.OrderBy.split(" "),d,A="#"+p+B+"Tt",h=q[0],z=(q[1]===undefined||q[1]==="asc")?1:-1;C.hide();$(A).hide();$("#"+e+" li:gt(0)").remove();QCRM.get_relationships(p,s,r,B,n,a.ListFieldsToSelect([h,"id"]),"",a.OrderBy,g,l,function(K){if(K&&K.entry_list!=undefined){if(K.entry_list.length>0){var H=0,F=K.entry_list.length,I,M=0,E=K.total_count,L="#"+p+B+"Tt";for(H;H<F;H++){var J=K.entry_list[H],D,G;if(Beans[s]!==undefined){if(s=="Documents"&&sugar_version<"6.3"){$.extend(K.entry_list[H].name_value_list,Beans[s].get_file_info(K.entry_list[H].name_value_list.document_name.value.replace(" ","_")))}G=Beans[s].DisplaySubpanelRecord(J.id,J.name_value_list,p+(Beans[p].fullPage?"DP":"ListPage"),p,B)}else{G=$("<li/>");D=SimpleBeans[s].DisplaySubpanelElt(J.name_value_list);G.append(D)}C.append(G)}if(QCRM.ShowTotals.subpanels&&E>0&&Beans[s].ListTotals&&Beans[s].ShowTotals.subpanels&&!u.hideTotals){if(g==0){QCRM.getRelationshipTotals(p,s,r,B,n,L)}}if(E>l){M=g-l;if(M<0){M=0}I=g+l;C.append($("<li/>").append(b));$("#"+e+"L").unbind("click");if(g>0){$("#"+e+"L").click({offset:M},function(N){ShowRelatedBeansList2(p,s,r,B,n,m,e,N.data.offset,l,false)})}$("#"+e+"R").unbind("click");if(I<E){$("#"+e+"R").click({offset:I},function(N){ShowRelatedBeansList2(p,s,r,B,n,m,e,N.data.offset,l,false)})}enableButton(e+"L",g!==0);enableButton(e+"R",I<E)}C.listview().listview("refresh");if(mobile_app){}C.show()}else{if(!o){C.listview().listview("refresh");C.show()}}}else{C.listview("refresh")}})}$("#InlineEdit").on("pagecreate",function(){$("#IECancel").text(sugar_app_strings.LBL_CANCEL_BUTTON_LABEL);$("#IESave").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL);$("#IESaved").text(sugar_app_strings.LBL_SAVED)});function IESetNewval(d,a,h){var m=$("#IESaved"),g,b={},o=false,n=(d!==undefined),e=false,l=false;if(!n){d=$("#IEModule").val();h=$("#IEFields").val().split(",");a=$("#IEId").val();g="#IE_";m=$("#IESaved")}else{g="#IE_"+d+h[0];m=$("#SdIE_"+d+h[0])}$.each(h,function(q,u){var r=checkFormField(d,u,g),s=sugar_mod_fields[d][u];if(r!==""){o=r}else{if(s&&s.type==="Drawing"){e=u;$(g+u+"_canvas").jqScribble.save(null);l=$(g+u+"_delete").val()==="1"&&$(g+u).val()===""}addEnteredVal(b,d,u,g)}});if(o){m.html(o);m.show();setTimeout(function(){m.hide()},3000);return}if(e&&(b[e].value!==""||l)){var p={session:SugarSessionId,module_name:d,id:a,field:e,drawing:l?"":b[e].value,deleted:l?1:0};SugarQuery("set_drawing",JSON.stringify(p),function(q){Beans[d].ViewDetails()},null)}else{$.mobile.loading("show");QCRM.set_entry(d,a,b,function(q){var z=sugar_app_strings.LBL_SAVED,r=false,u,w=Beans[d],s=false;if(!q||q.id===undefined){r=true;var z="Save Error. Please check your server log";$.mobile.loading("hide");if(q&&q.name!==undefined){if(q.name==="Access Denied"){z=RES_ACCESS_DENIED_MSG}else{z=q.name}}}else{$.each(h,function(B,D){var C=sugar_mod_fields[d][D],A;if(C.after_save){A=C.after_save(q.id,b);s=A||s}});try{w.AfterSave(a,false,b);for(u in w.hooks.after_save){w.hooks.after_save[u](a,false,b)}}catch(v){}}if(r){$.mobile.loading("hide");m.text(z);m.show();setTimeout(function(){m.hide()},3000)}else{if(!n){setTimeout(function(){$.mobile.loading("hide")},50)}else{setTimeout(function(){$.mobile.loading("hide");Beans[d].ViewDetails()},s?8000:50)}}})}}function IECancel(){$(".inlineEditActive").html(QCRM.IEsavedContents);try{$(".inlineEditActive").css("padding","0px");$(".inlineEditActive").blur()}catch(a){}$(".inlineEditActive").removeClass("inlineEditActive");QCRM.IEsavedContents=""}function handleTapHold(p,q,d,n,a,s,m){var b="#IENew",h,l="IE_",g,o=Beans[d].EditExcluded,r=sugar_mod_fields[d],e=[];q.preventDefault();if(m==="inline"){if(QCRM.IEsavedContents!==""){return}h=$(p);l+=d+n[0]}else{h=$("#IENew")}if(mobile_edition==="Pro"){if(Beans[d].CheckEdit(s)){$.each(n,function(u,w){var v=r[w];if(v&&o.indexOf(w)===-1){if((v.type!=="readonly")&&(v.type!=="file")&&(v.readonly===undefined||v.readonly===false)&&((v.type!=="Drawing")||!QCRM.OffLine)){if(QCRM.LockSetDrawing&&v.type!=="Drawing"&&$("#"+l+w+"HD").val()==="1"){return}e.push(w)}}});if(e.length===0){return}QCRM.IEsavedContents=h.html();h.addClass("inlineEditActive");AttachTo="";h.empty();init_add_form(d,e,[],h,l);if(m==="inline"){h.append('<form><input type="button" class="ui-alt-icon ui-nodisc-icon" id="C'+l+'"  data-icon="delete" data-iconpos="notext" data-inline="true" data-theme="a" style="margin-right:40px"><input id="S'+l+'" type="button" data-inline="true" data-icon="check" data-iconpos="notext" data-theme="b"><span id="Sd'+l+'" style="color:red;display:none;"></span></form>');h.find('[type="button"]').button();if(QCRM.DrawingSignature){$(".drawing_nosign").hide()}g=r[n[0]];$(document).one("click","#C"+l,function(u){IECancel()});$("#S"+l).click(function(){$(this).parent().hide();IESetNewval(d,a,n)})}h.find("textarea").textinput();h.find('[type="text"]').textinput();h.find('[type="number"]').textinput();h.find('[type="tel"]').textinput();h.find('[type="email"]').textinput();h.find("select").selectmenu();h.find("[data-role=controlgroup]").controlgroup().trigger("create");h.find('[type="radio"]').checkboxradio();$.each(e,function(u,v){init_form_field(d,v,"",false,s,"#"+l,"")});if(m!=="inline"){$("#IEModule").val(d);$("#IEFields").val(n.join(","));$("#IEId").val(a);setTimeout(function(){$("#IE"+d).click()},50)}else{h.parent().listview("refresh");if(g.type==="Drawing"){$("html, body").animate({scrollTop:h.offset().top},100)}else{if(g.type!=="datetime"&&g.type!=="date"){$(":input:enabled:visible:not([readonly]):first").focus()}else{$("#"+l+n[0]).mobiscroll("show")}}}}}else{AlertPopup(RES_UNAVAILABLE)}}function addInlineEdit(b,a,h,d,g,e){g.off("taphold");g.on("taphold",function(l){handleTapHold(this,l,b,a,h,d,e);return false})}function displayFields(h,d,l,a){var b=Beans[d].DetailExcluded;for(var m in l){var g=l[m],e=sugar_mod_fields[d][g];if(e&&e.type&&SugarFields[e.type]&&b.indexOf(g)==-1){SugarFields[e.type].addFieldContainer(a,d,g,h)}}}function SaveNote(){var e=Beans.Notes,b=(e.CurrentId===""),h=e.AllEditFields(),d=$("#NotesFromLnk").val(),a=$("#NotesFromModule").val();if(CheckAllFields("Notes",h)>0){return}$.mobile.loading("show");var p=Beans.Notes.EditValues("#EditNotes_"),l={};var g="",n="",m="";if(b){var o="";if(a==="Contacts"&&Beans.Contacts.CurrentId!==""&&Beans.Contacts.CurrentParentId!==""){o=Beans.Contacts.CurrentParentId}else{if(a==="Accounts"&&Beans.Accounts.CurrentId!==""){o=Beans.Accounts.CurrentId}}if(o!==""){g="Accounts";n=o}else{if(a!=="Contacts"&&a!==""&&Beans[a]!==undefined&&Beans[a].CurrentId!==""){g=a;n=Beans[a].CurrentId}}if(g!==""){p.parent_type={name:"parent_type",value:g};p.parent_id={name:"parent_id",value:n}}if(a==="Contacts"&&Beans.Contacts.CurrentId!==""){p.contact_id={name:"contact_id",value:Beans.Contacts.CurrentId};m=Beans.Contacts.CurrentId}}else{}if($("#DelAttach").val()=="1"){p.file_mime_type={name:"file_mime_type",value:""};p.filename={name:"filename",value:""}}QCRM.set_entry("Notes",Beans.Notes.CurrentId,p,function(r){var v;if((r.name!==undefined)&&(r.name==="Access Denied")){AlertPopup(RES_ACCESS_DENIED_MSG);return}var q=e.AllEditFields(),u=false;for(var v in q){var z=q[v],w=sugar_mod_fields.Notes[z],s;if(w.after_save){s=w.after_save(r.id,p);u=s||u}}if(Beans.Notes.CurrentId===""){if(g!==""){QCRM.set_relationship(g,n,d,r.id)}if(m!==""){QCRM.set_relationship("Contacts",m,"notes",r.id)}}e.AfterSave(r.id,b,p);for(v in e.hooks.after_save){e.hooks.after_save[v](r.id,b,p)}if($("#DelAttach").val()!="1"&&Beans.Notes.TmpFile.name!==""){u=true;QCRM.set_note_attachment(Beans.Notes.TmpFile.contents,Beans.Notes.TmpFile.mime_type,Beans.Notes.TmpFile.name,r.id,g,n,function(A){})}setTimeout(function(){Beans.Notes.TmpFile=EmptyFile;Beans.Notes.AfterSaveLandingPage(r.id,Beans.Notes.CurrentId==="")},u?6000:200)})}function createLink(a,b){return $("<a/>",{href:"#","data-identity":b,"data-module":a,"data-link":"bean"})}function createEditLink(a,d,b){return'<a data-role="button" data-link="editlist" data-icon="edit" data-identity="'+d+'" data-module="'+a+'" class="'+(b==true?"":"ui-alt-icon ")+'ui-nodisc-icon"/>'}function getCalendarLink(h,e){var d=fromDBDateTime(e.date_start.value),a=$("<a/>",{href:"#","data-link":"nativecal","data-date":e.date_start.value,"class":"nativeSIcon"}),b="<h4>"+e.name.value+"</h4><p>"+jQuery.mobiscroll.formatDate(datetime_format,d)+" - &shy;"+jQuery.mobiscroll.formatDate(datetime_format,fromDBDateTime(e.date_end.value))+"</p>";var g=$('<li data-icon="false"/>');a.css({"padding-left":"30px"});a.append(b);g.append(a);return g}$(document).on("click",'[data-link="search"]',function(b){var a=$(this).closest("form").data("module");SaveLastSearch(a);StartSearch(a);return false});$(document).on("click",'[data-link="clearsearch"]',function(a){clearSearchValues($(this).closest("form").data("module"));return false});$(document).on("click",'[data-link="create"]',function(a){Beans[$(this).closest("ul").data("module")].Create();return false});$(document).on("click",'[data-link="createcurrent"]',function(){var a=$("body").pagecontainer("getActivePage");Beans[a.data("module")].Create();return false});$(document).on("tap",'[data-link="previous"]',function(b){var d=$(this),a=d.closest("ul").data("module");d.removeClass("ui-btn-active");d.removeClass("ui-btn-up-d");Beans[a].GetList(Beans[a].PrevOffset);return false});$(document).on("tap",'[data-link="next"]',function(b){var d=$(this),a=d.closest("ul").data("module");d.removeClass("ui-btn-active");d.removeClass("ui-btn-up-d");Beans[a].GetList(Beans[a].NextOffset);return false});$(document).on("click",'[data-link="edit"]',function(){Beans[$(this).closest("ul").data("module")].Update("",$("body").pagecontainer("getActivePage").attr("id"));return false});$(document).on("click",'[data-link="editcurrent"]',function(){var a=$("body").pagecontainer("getActivePage");Beans[a.data("module")].Update("",a.attr("id"));return false});$(document).on("click",'[data-link="dupcurrent"]',function(){var b=$("body").pagecontainer("getActivePage"),a=Beans[b.data("module")];a.Duplicate(a.CurrentId);return false});$(document).on("click",'[data-link="delcurrent"]',function(){var a=$("body").pagecontainer("getActivePage"),b=a.data("module");SugarCrmDelete(b,Beans[b].CurrentId,b+"ListPage");return false});$(document).on("click",'[data-link="editlist"]',function(){var a=$(this);Beans[a.data("module")].Update(a.data("identity"),"HomePage");return false});$(document).on("click",'[data-link="delete"]',function(b){var a=$(this).closest("ul").data("module");SugarCrmDelete(a,Beans[a].CurrentId,a+"ListPage");return false});$(document).on("tap",'[data-link="back"]',function(b){var a=QCRM.History.pop();if(a==("#"+$("body").pagecontainer("getActivePage").attr("id"))){a=QCRM.History.pop()}$("body").pagecontainer("change",a,{reverse:true});return false});$(document).on("tap",'[data-link="CSback"]',function(a){$("#CSCancelBtn").click()});$(document).on("click",'[data-link="save"]',function(){var a=$(this);a.addClass("ui-disabled");setTimeout(function(){a.removeClass("ui-disabled")},2000);Beans[a.closest("div").data("module")].Save();return false});$(document).on("click",'[data-link="editbtn"]',function(){$(this).closest("li").taphold();return false});$(document).on("click",'[data-link="add-rel"]',function(){var a=$(this);$("#CSSearchTextL").empty();OpenSelect(a.data("mod"),a.data("frommod"),a.data("fromid"),a.data("fromlnk"),a.data("filter"));setTimeout('$("#'+a.data("frommod")+'CS").click();',150);return false});$(document).on("click",'[data-link="nativecal"]',function(a){window.plugins.calendar.openCalendar(fromDBDateTime($(this).data("date")));return false});$(document).on("click",'[data-link="html"]',function(b){var a="<html><body>"+$(this).html()+"</body></html>";b.preventDefault();SaveFile(a,"temp.html","temp","text/html",true,function(e,g,d){OpenURL(e,d)},function(d){});return false});$(document).on("click",'[data-link="phone"]',function(A){var z=$(this),b=z.data("module"),u=z.data("identity"),m=z.data("account"),p=z.data("page"),a=z.data("new"),g=decodeObject(z.data("phone")),o=$(p+"L");A.preventDefault();$(p+"L li").remove();for(var q in g){var w=g[q],C=w.module,e=w.id,B=w.name;o.append($('<li data-theme="a"/>').append("<h4>"+B+"</h4>"));for(var s=0;s<w.records.length;s++){var v,d=w.records[s],h=b,n=u;if(e){n=e;h=C}v=SugarFields.phone.link_button(p,d.phone,d.type,h,n,C,e,w.name,m,a);o.append($("<li "+QCRM.PhoneStyle+' data-icon="phone"/>').append(v))}}o.listview("refresh");setTimeout(function(){$(p).popup("open",{positionTo:z})},50);return false});$(document).on("click",'[data-link="attach"]',function(){var b=$(this);function a(){var d=QCRM.OpenDownloadLink||OpenDownloadLink;d(b.data("module"),b.data("identity"),decodeObject(b.data("fileinfo")),b.data("external"))}a();return false});$(document).on("click",'[data-link="zoom"]',function(b){var a=$(this).html();if(mobile_app){}return false});$(document).on("click",'[data-link="favorite"]',function(){var b=$(this),d=$("body").pagecontainer("getActivePage"),g=d.data("module"),h=Beans[g].CurrentId,e=b.data("name"),a=b.data("favorite");a=!a;if(a){PushFavorites(g,h,e)}else{RemoveFromFavorites(g,h)}showFavoriteStatus(g,h,e);return false});$(document).on("tap",'[data-link="bean"]',function(){var d=$(this),g=d.data("module"),b=Beans[g],m=d.data("identity"),e=$("body").pagecontainer("getActivePage").attr("id"),a=!b.fullPage,h=((e==g+"ListPage"&&a)||e==g+"DP");b.CurrentId=d.data("identity");if(a){d.addClass("listselected");if(!iOS){if(document.activeElement){document.activeElement.blur()}}}if(h){b.ViewDetails()}else{$("body").pagecontainer("change","#"+g+(a?"ListPage":"DP"))}return false});$(document).on("change",'[data-link="list"]',function(e){var d,h=$(this),a=h.closest("td"),b=a.data("module"),m=QCRM.moduleMenu[b]||QCRM.moduleMenu.all,g=m[h.val()];e.stopPropagation();if(g){if(!g.disabled(a.data())){g.action(a.data());h.val("EMPTY")}}return false});function AddLinkWithIcon(d,s,r,E,w,h,l,u,a){var C=getPhoneValues(E,w,d),e=Beans[d]||SimpleBeans[d],n=(d==="Notes"?"filename":(d==="Documents"?(E.filename?"filename":"document_name"):false)),z=n&&E[n]&&E[n].value&&E[n].value.match(QCRM.ExtWhiteList),A=((C.length>0)&&(!QCRM.CallAssignedOnly||E.assigned_user_id.value===CurrentUserId)),v=e.CustomListStyle(E,l),B=d==="SugarFeed"?{}:{href:"javascript:void(0)",style:"text-shadow:none !important;padding-top:4px;padding-bottom:6px;"+v,"data-from":u,"data-link":"bean","data-module":d,"data-identity":s},g=d==="SugarFeed"?{}:{"data-module":d,"data-from":u,"data-identity":s,"data-type":(a?Beans[u].Links[a].swipeType:e.swipeType)},o=(r==="")?e.DisplaySubpanelElt(E):r,D,q;if(a){g["data-relationship"]=a}if(E.edit_access==undefined){E.edit_access=true}else{if(typeof(E.edit_access)=="object"){E.edit_access=E.edit_access.value}}if(E.delete_access==undefined){E.delete_access=E.edit_access}else{if(typeof(E.delete_access)=="object"){E.delete_access=E.delete_access.value}}g["data-edit"]=E.edit_access?"1":"0";g["data-del"]=E.delete_access?"1":"0";if(A){g["data-icon"]="phone"}else{if(z){g["data-icon"]="paperclip"}}if(A||z){g["data-split-theme"]="c"}else{g["data-icon"]="false"}if(e.ListData){$.extend(g,e.ListData(E))}q=$("<li/>",g);D=$(d==="SugarFeed"?"<span/>":"<a/>",B);h="#Phone"+h;if(l){D.addClass(d+"SIcon");D.css({"padding-left":"25px"})}D.append(o);q.append(D);if(A){if(v!==""){v=Beans[d].CustomListStyle(E,false);if(v===""){v="background:#eee;"}}else{if(l){v="background:#eee;"}}var b=(d!=="Calls"||(E.status&&E.status.value==="Held")),m="",p;if(h==="#PhoneAccountsDP"){m=Beans.Accounts.CurrentId}else{if(E.account_id){m=E.account_id.value}}p=$("<a/>",{href:"#","class":"ui-alt-icon ui-nodisc-icon","data-theme":"c","data-rel":"popup","data-link":"phone","data-page":h,"data-module":d,"data-identity":s,"data-account":m,"data-new":b?"true":"false","data-phone":encodeObject(C),style:v});q.append(p)}else{if(z){q.append(CreateDownloadLink(d,s,E,v))}}return q}function AddLinkTablet(e,b,g){var n=Beans[e],d={href:"javascript:void(0)","data-link":"bean","data-icon":"false","data-module":e,"data-identity":b,style:"text-shadow:none !important;padding-top:2px;padding-bottom:3px;padding-left:30px !important;"+n.CustomListStyle(g,false)},l={"data-module":e,"data-identity":b,"data-type":n.swipeType},h=n.DisplaySubpanelElt(g),a,m;m=$("<li/>",l);a=$("<a/>",d);a.append(h);m.append(a);return m}function SugarCrmDelete(a,e,b,d){if(mobile_edition=="Pro"||Beans[a].available_CE){if(Beans[a].CheckDelete(CurrentRecordValues)){ConfirmPopup(sugar_app_strings.NTC_DELETE_CONFIRMATION,function(){$.mobile.loading("hide");QCRM.delete_entry(a,e,function(h){var g,l=Beans[a],n=$("body").pagecontainer("getActivePage").attr("id");if(h&&h.name!==undefined){var m=h.name;if(m==="Access Denied"){m=RES_ACCESS_DENIED_MSG}AlertPopup(m);return}l.CurrentId="";if(b&&n!=b){$("body").pagecontainer("change","#"+b,{reverse:false,changeHash:false})}else{if(n==="HomePage"){displayDashlets()}else{$("body").pagecontainer("getActivePage").trigger("pageshow")}}l.AfterDelete(e);for(g in l.hooks.after_delete){l.hooks.after_delete[g](e)}RemoveFromLastviewed(a,e);RemoveFromFavorites(a,e);if(d){d(true)}})},"#HomePage")}}else{AlertPopup(RES_UNAVAILABLE)}}function setCookie(a,e,b){if(mobile_app){localStorage.setItem(a,e);return}var g=new Date();g.setDate(g.getDate()+b);var d=escape(e)+((b===null)?"":"; expires="+g.toUTCString());document.cookie=a+"="+d}function getCookie(b){if(mobile_app){var e=localStorage.getItem(b);if(e===0){e="0"}else{if(e===1){e="1"}}return e}var d,a,h,g=document.cookie.split(";");for(d=0;d<g.length;d++){a=g[d].substr(0,g[d].indexOf("="));h=g[d].substr(g[d].indexOf("=")+1);a=a.replace(/^\s+|\s+$/g,"");if(a==b){return unescape(h)}}return""}(function(l){var q=function(d,a){var r,s,e,m,b;e=d&2147483648;m=a&2147483648;r=d&1073741824;s=a&1073741824;b=(d&1073741823)+(a&1073741823);if(r&s){return b^2147483648^e^m}return r|s?b&1073741824?b^3221225472^e^m:b^1073741824^e^m:b^e^m},h=function(d,a,r,s,e,m,b){d=q(d,q(q(a&r|~a&s,e),b));return q(d<<m|d>>>32-m,a)},p=function(d,a,r,s,e,m,b){d=q(d,q(q(a&s|r&~s,e),b));return q(d<<m|d>>>32-m,a)},n=function(d,a,r,s,e,m,b){d=q(d,q(q(a^r^s,e),b));return q(d<<m|d>>>32-m,a)},o=function(d,a,r,s,e,m,b){d=q(d,q(q(r^(a|~s),e),b));return q(d<<m|d>>>32-m,a)},g=function(b){var a="",d="",e;for(e=0;e<=3;e++){d=b>>>e*8&255;d="0"+d.toString(16);a+=d.substr(d.length-2,2)}return a};l.extend({md5:function(w){var u=[],d,e,a,b,v,s,r,m;u=w;u=u.replace(/\x0d\x0a/g,"\n");w="";for(d=0;d<u.length;d++){e=u.charCodeAt(d);if(e<128){w+=String.fromCharCode(e)}else{if(e>127&&e<2048){w+=String.fromCharCode(e>>6|192)}else{w+=String.fromCharCode(e>>12|224);w+=String.fromCharCode(e>>6&63|128)}w+=String.fromCharCode(e&63|128)}}u=w=w;w=u.length;d=w+8;e=((d-d%64)/64+1)*16;a=Array(e-1);for(v=b=0;v<w;){d=(v-v%4)/4;b=v%4*8;a[d]|=u.charCodeAt(v)<<b;v++}d=(v-v%4)/4;b=v%4*8;a[d]|=128<<b;a[e-2]=w<<3;a[e-1]=w>>>29;u=a;v=1732584193;s=4023233417;r=2562383102;m=271733878;for(w=0;w<u.length;w+=16){d=v;e=s;a=r;b=m;v=h(v,s,r,m,u[w+0],7,3614090360);m=h(m,v,s,r,u[w+1],12,3905402710);r=h(r,m,v,s,u[w+2],17,606105819);s=h(s,r,m,v,u[w+3],22,3250441966);v=h(v,s,r,m,u[w+4],7,4118548399);m=h(m,v,s,r,u[w+5],12,1200080426);r=h(r,m,v,s,u[w+6],17,2821735955);s=h(s,r,m,v,u[w+7],22,4249261313);v=h(v,s,r,m,u[w+8],7,1770035416);m=h(m,v,s,r,u[w+9],12,2336552879);r=h(r,m,v,s,u[w+10],17,4294925233);s=h(s,r,m,v,u[w+11],22,2304563134);v=h(v,s,r,m,u[w+12],7,1804603682);m=h(m,v,s,r,u[w+13],12,4254626195);r=h(r,m,v,s,u[w+14],17,2792965006);s=h(s,r,m,v,u[w+15],22,1236535329);v=p(v,s,r,m,u[w+1],5,4129170786);m=p(m,v,s,r,u[w+6],9,3225465664);r=p(r,m,v,s,u[w+11],14,643717713);s=p(s,r,m,v,u[w+0],20,3921069994);v=p(v,s,r,m,u[w+5],5,3593408605);m=p(m,v,s,r,u[w+10],9,38016083);r=p(r,m,v,s,u[w+15],14,3634488961);s=p(s,r,m,v,u[w+4],20,3889429448);v=p(v,s,r,m,u[w+9],5,568446438);m=p(m,v,s,r,u[w+14],9,3275163606);r=p(r,m,v,s,u[w+3],14,4107603335);s=p(s,r,m,v,u[w+8],20,1163531501);v=p(v,s,r,m,u[w+13],5,2850285829);m=p(m,v,s,r,u[w+2],9,4243563512);r=p(r,m,v,s,u[w+7],14,1735328473);s=p(s,r,m,v,u[w+12],20,2368359562);v=n(v,s,r,m,u[w+5],4,4294588738);m=n(m,v,s,r,u[w+8],11,2272392833);r=n(r,m,v,s,u[w+11],16,1839030562);s=n(s,r,m,v,u[w+14],23,4259657740);v=n(v,s,r,m,u[w+1],4,2763975236);m=n(m,v,s,r,u[w+4],11,1272893353);r=n(r,m,v,s,u[w+7],16,4139469664);s=n(s,r,m,v,u[w+10],23,3200236656);v=n(v,s,r,m,u[w+13],4,681279174);m=n(m,v,s,r,u[w+0],11,3936430074);r=n(r,m,v,s,u[w+3],16,3572445317);s=n(s,r,m,v,u[w+6],23,76029189);v=n(v,s,r,m,u[w+9],4,3654602809);m=n(m,v,s,r,u[w+12],11,3873151461);r=n(r,m,v,s,u[w+15],16,530742520);s=n(s,r,m,v,u[w+2],23,3299628645);v=o(v,s,r,m,u[w+0],6,4096336452);m=o(m,v,s,r,u[w+7],10,1126891415);r=o(r,m,v,s,u[w+14],15,2878612391);s=o(s,r,m,v,u[w+5],21,4237533241);v=o(v,s,r,m,u[w+12],6,1700485571);m=o(m,v,s,r,u[w+3],10,2399980690);r=o(r,m,v,s,u[w+10],15,4293915773);s=o(s,r,m,v,u[w+1],21,2240044497);v=o(v,s,r,m,u[w+8],6,1873313359);m=o(m,v,s,r,u[w+15],10,4264355552);r=o(r,m,v,s,u[w+6],15,2734768916);s=o(s,r,m,v,u[w+13],21,1309151649);v=o(v,s,r,m,u[w+4],6,4149444226);m=o(m,v,s,r,u[w+11],10,3174756917);r=o(r,m,v,s,u[w+2],15,718787259);s=o(s,r,m,v,u[w+9],21,3951481745);v=q(v,d);s=q(s,e);r=q(r,a);m=q(m,b)}return(g(v)+g(s)+g(r)+g(m)).toLowerCase()}})})(jQuery);function CheckAllFields(d,a){var l="";var g=0;for(var b in a){var h=a[b];var e=checkFormField(d,h,"#Edit"+d+"_");if(e!==""){g+=1;l+=e}}if(g>0){AlertPopup(l)}return g}function getFromTemplate(b,p,n){var g=n,d=g.match(/\{[-\(\+\,\[\s]?\w+[\)\]]?\}/gi);if(!p){return""}for(var e in d){var o=d[e],q="",h="",r="",m;o=o.substr(1,o.length-2);m=o.substr(0,1);switch(m){case"-":h=" - ";break;case",":h=", ";break;case"+":case" ":h=m;break;case"(":h=" (";r=")";break;case"[":h=" [";r="]";break;default:break}if(h.length>0){o=o.substr(1,o.length-(r.length+1))}if(p[o]!==undefined&&p[o].value!==undefined){q=display_value(b,o,p);if(q!==""){q=h+q+r}}g=g.replace(d[e],q)}return g}function getNavButtons(a){return'<div style="text-align:center;" ><a id="'+a+'L" href="#" class="navLeftIcon mbsc-ic mbsc-ic-arrow-left"></a><span id="'+a+'T">&nbsp;</span><a id="'+a+'R" href="#" class="navRightIcon mbsc-ic mbsc-ic-arrow-right"/></div>'}function ShowBeansList(a,m,e,b,h,g,l,d,o){if(!init_done){MobileInit();return}var n=Beans[a],p=$("#"+g);if(m!==""){p.append('<li data-theme="d" style="background: #dddddd">'+m+"</li>")}QCRM.get_entry_list(a,e,n.ListFieldsToSelect(),n.link_phone_fields,d,b,h,function(z){if(m!==""){$("#"+g+" li").remove()}else{$("#"+g+" li:gt(0)").remove()}if(z&&z.entry_list!==undefined){if(z.next_offset===0||z.result_count===0){p.append("<li>"+RES_NO_MORE_RECORDS+"</li>")}else{var q=0,v=z.entry_list.length;for(q=0;q<v;q++){var w=z.entry_list[q],r=w.module_name;var u=AddLinkWithIcon(r,w.id,"",w.name_value_list,(z.relationship_list&&z.relationship_list[q]&&z.relationship_list[q].link_list)?z.relationship_list[q].link_list:[],l,false,"");p.append(u)}}try{p.listview("refresh")}catch(s){}if(mobile_app){}o({next_offset:z.next_offset,result_count:z.result_count,total_count:(z.total_count!==undefined?z.total_count:false)})}else{o({next_offset:0,result_count:0,total_count:false})}})}function SetSelect(){var b=$("#CS_LinkedId").val(),d=$("#CSFromModule").val(),e=Beans[d],a=$("#CSFromId").val(),g=$("#CSLnk").val();if(b!==""){QCRM.set_relationship(d,a,g,b)}setTimeout(function(){var h=$("#CSPrevPage").val();$("#"+h+" .ui-header a").click();if(b!==""&&!e.fullPage){getRelatedList(d,g)}},200)}function PickSelect(a){pickRelate("","LinkedId","SearchText",$("#CSToModule").val(),$("#CSWhere").val(),[],"CS_",function(b){enableButton("CSSelect",b!=="")},0)}function OpenSelect(d,e,b,g,a){a=a||"";enableButton("CSSelect",false);$("#CreateSelectModule").text(sugar_app_list_strings.moduleListSingular[d]);$("#CS_SearchText").val("");$("#CSFromModule").val(e);$("#CSPrevPage").val($("#CSSelect").attr("href","#"+$("body").pagecontainer("getActivePage").attr("id")));$("#CSFromId").val(b);$("#CSToModule").val(d);$("#CSWhere").val(a);$("#CSLnk").val(g);$("#CS_LinkedId").val("");PickSelect()}$("#CreateSelect").on("pagecreate",function(){$("#CSSelect").text(sugar_app_strings.LBL_LINK_SELECT);$("#CSCancelBtn").text(sugar_app_strings.LBL_CANCEL_BUTTON_LABEL);$("#CS_SearchText").on("input",PickSelect);$("#CS_SearchText").attr("placeholder",RES_SEARCH_LABEL)});$("#CreateSelect").on("pageshow",function(){PickSelect()});function CreateFromEditForm(l,a,h,g){var m="#Edit"+a+"_",b={name:{name:"name",value:$(m+h).val()}},e=sugar_mod_fields[a][h],d=e.copyfields===undefined?[]:e.copyfields;$("#"+a+h+"CG").hide();CopyFieldsToRelated(d,b,m);QCRM.set_entry(l,"",b,function(n){if(!n||((n.name!==undefined)&&(n.name==="Access Denied"))){return}$("#Edit"+a+"_"+g).val(n.id)})}function OpenRename(a,b,e,d){$("#RenInitText").val(a);$("#RenInitModule").val(b);$("#RenInitId").val(e);$("#RenNewText").val("");$("#RenConfirm").unbind("click");$("#RenConfirm").click(d);$("#RenConfirm").attr("href","#"+b+"Search")}$("#Rename").on("pagecreate",function(){$("#RenameTitle").text(RES_RENAME);$("#RenConfirm").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL)});function QCRM_Reminder(d,b,a){this.datetime=d;this.cron=null;this.active=Pref.Reminders;this.module=b;this.id=a}QCRM_Reminder.prototype.set=function(){};QCRM_Reminder.prototype.unset=function(){};QCRM_Reminder.prototype.display=function(a){};QCRM_Reminder.prototype.repeat=function(a){};function QCM_RemindersList(){this.date=CurrentDate;this.modules=[];this.list=[];this.update=function(){};this.findReminder=function(e,d){var g=false,a,b;for(a in this.list){b=this.list[a];if(b.module===e&&b.id===d){g=b;break}}return g}}QCRM.reminders=new QCM_RemindersList();QCRM.FieldProperty=function(b,a,e){var d=sugar_mod_fields[a][e];if(d[b]!=undefined){return d[b]}if(SugarFields[d.type]&&SugarFields[d.type][b]!=undefined){return SugarFields[d.type][b]}return false};function SugarType(a,b){this.name=a;this.input_type="text";this.show_empty=false;this.after_save=false;this.add_listener=false;this.inline_btn=false;this.inline_edit=true;this.readonly_not_empty=false;this.whitespace=false;this.has_link=b==true;this.icon=""}function generatedLink(a,e,d){var h=sugar_mod_fields[a][e].def;try{h=h.substring(0,4)!=="http"?("http://"+h):h;var g=h.replace(regFindField,"$2");while(g!==h){h=h.replace(regFindField,"$1")+d[g].value+h.replace(regFindField,"$3");g=h.replace(regFindField,"$2")}}catch(b){}return h}SugarType.prototype.readonly=function(a,b){if(sugar_mod_fields[a][b]){return sugar_mod_fields[a][b].readonly}return false};SugarType.prototype.required=function(a,b){if(sugar_mod_fields[a][b]){return sugar_mod_fields[a][b].req}return false};SugarType.prototype.displayEmpty=function(a,b){};SugarType.prototype.isEmptyField=function(a,d,b){if(b[d]&&b[d].value!=""){return false}return true};SugarType.prototype.displayField=function(e,n,p,d){var m=$("<p/>"),o,l,b,a=$('<h4 style="white-space:normal;"/>'),g,h=sugar_mod_fields[e][n];if(QCRM.mode==="tablet"){b=$('<table width="100%"/>');l=$("<tr/>");g=$('<td style="vertical-align:top"/>');o=$('<td width="110em" style="vertical-align:top"/>');m=$("<p/>");b.append(l);g.append(a);o.append(m)}else{l=$("<div/>");b=l;g=a;o=m}l.append(o);l.append(g);if(this.label){o=this.label(e,n,p,d)}else{o=display_label(e,n,true)}if(o&&o!=""){m.append(o)}if(h.Details){a.append(h.Details(d))}else{if(this.thumbnail){a.append(this.thumbnail(e,n,p,d))}a.append(this.displayValue(e,n,p,d))}return b};SugarType.prototype.display=function(a,e,d,b){return d};SugarType.prototype.display_link=function(a,e,d,b){return false};SugarType.prototype.displayValue=function(a,g,d,b){var e=sugar_mod_fields[a][g];if(e.display){return e.display(d,b)}return this.display(a,g,d,b)};SugarType.prototype.displayLink=function(a,g,d,b){var e=sugar_mod_fields[a][g];if(e.display_link){return e.display_link(d,b)}return this.display_link(a,g,d,b)};SugarType.prototype.field_container=function(b,g){var e=sugar_mod_fields[b][g];if(e.field_container){return e.field_container(b,g)}var d=QCRM.FieldProperty("icon",b,g),a="id='"+b+g+"V' style='"+(QCRM.FieldProperty("has_link",b,g)?"":"padding-top:0px;padding-bottom:0px;")+(QCRM.FieldProperty("whitespace",b,g)?"white-space:normal!important;":"")+"'";if(g.indexOf("mobile")!==-1){a+=" data-icon='comment'  class='ui-alt-icon ui-nodisc-icon' data-split-theme='d'"}else{if(d!==""){a+=' data-icon="'+d+'" class="ui-alt-icon ui-nodisc-icon"'}}return $("<li "+a+"/>")};SugarType.prototype.addFieldContainer=function(g,d,r,b){var u=d+r+"V",s=b[r]?b[r].value:"",l=sugar_mod_fields[d][r],p=QCRM.FieldProperty("inline_btn",d,r),n=QCRM.FieldProperty("show_empty",d,r),q=this.displayLink(d,r,s,b),h=this.isEmptyField(d,r,b),e;if(h){if(n){e=$('<li id="'+u+'" isempty="0"/>')}else{e=$('<li id="'+u+'" isempty="1" style="display:none;"/>')}e.append("<p>"+display_label(d,r,true)+"</p>")}else{var o=this.displayField(d,r,s,b),e=this.field_container(d,r),a;if(q){q.css("padding-top","2px");q.css("padding-bottom","3px");q.append(o);e.append(q);if(this.display_link2){var m=this.display_link2(d,r,s,b);if(m!=""){e.append(m)}}}else{o.css("padding-top","2px");o.css("padding-bottom","3px");e.append(o);if(iOS){e.click=function(v){v.preventDefault();return false}}}}$(g).append(e);if(mobile_edition=="Pro"&&!l.readonly&&!l.no_inline_edit&&SugarFields[l.type]&&SugarFields[l.type].inline_edit){if(p){e.append('<input type="button" class="ui-alt-icon ui-nodisc-icon" id="E'+d+r+'" data-link="editbtn" href="#" data-icon="edit" data-iconpos="notext" data-theme="c">');$("#E"+d+r).button()}addInlineEdit(d,this.inlineFields(d,r,b),b.id.value,b,e,"inline")}return e};SugarType.prototype.after_set_edit_val=function(d,a,b){};SugarType.prototype.saveValue=function(a,d,b){};SugarType.prototype.deleteValue=function(a,d,b){};SugarType.prototype.inlineFields=function(a,d,b){return[d]};SugarFields.custom=new SugarType("custom");SugarFields.hidden=new SugarType("hidden");SugarFields.hidden.addFieldContainer=function(d,a,e,b){return false};SugarFields.name=new SugarType("name");SugarFields.id=new SugarType("id");SugarFields.varchar=new SugarType("varchar");SugarFields["char"]=new SugarType("char");SugarFields.html=new SugarType("html");SugarFields.html.inline_edit=false;SugarFields.html.isEmptyField=function(a,d,b){return sugar_mod_fields[a][d].def==""};SugarFields.html.display=function(a,g,e,b){var h=$('<div style="margin-left:20px;" data-enhance="false"/>'),d=sugar_mod_fields[a][g].def||"";h.append(e==""?d.replace("_blank","_system"):e);return h};SugarFields.html.readonly=function(a,b){return true};SugarFields.readonly=new SugarType("readonly");SugarFields.readonly.readonly=function(a,b){return true};SugarFields.readonly.inline_edit=false;SugarFields.iframe=new SugarType("iframe");SugarFields.iframe.isEmptyField=function(a,e,b){var d=sugar_mod_fields[a][e];if(d.gen===1){return false}if(b[e]&&b[e].value!=""&&b[e].value!="http://"){return false}return true};SugarFields.iframe.display=function(a,g,d,b){var e=sugar_mod_fields[a][g];if(e.gen===1){lnk=generatedLink(a,g,b)}else{lnk=d}return $('<iframe id="'+a+g+'I" src="'+lnk+'" width="95%" height="'+e.height+'"></iframe>')};function OpenAddressLink(d,g,a,b){var h,e;if(!mobile_app||QCRM.internalMap||mobile_edition!="Pro"){if(QCRM.JJWG&&JJWG.googlemaps&&g.jjwg_maps_geocode_status_c&&(g.jjwg_maps_geocode_status_c.value==="OK"||g.jjwg_maps_geocode_status_c.value==="APPROXIMATE")){h=$("<a/>",{href:"#JJWG",style:QCRM.inlineStyle});JJWG.AddMapLink(h,d,g)}else{h="https://maps.google.com/?q="+a+"&t=m&z=13&iwloc=near&output=html";h=CreateExtLink(h,"");if(!mobile_app){h.attr("target","_blank")}}}else{}return h}SugarFields.jjwgaddress=new SugarType("jjwgaddress",true);SugarFields.jjwgaddress.icon="location";SugarFields.jjwgaddress.display_link=function(a,e,d,b){return OpenAddressLink(a,b,b[e].value,null)};SugarFields.address=new SugarType("address",true);SugarFields.address.icon="location";SugarFields.address.display_link=function(a,g,d,b){var e=sugar_mod_fields[a][g],h=address_values(b,a,e.key),l;if(h.google!==""){return OpenAddressLink(a,b,h.google,e.key)}return""};SugarFields.address.isEmptyField=function(a,e,b){var d=sugar_mod_fields[a][e],g=address_values(b,a,d.key);return(g.google=="")};SugarFields.address.inlineFields=function(a,d,b){return getAddressFields(sugar_mod_fields[a][d].key,a)};SugarFields.address.display=function(a,g,d,b){var e=sugar_mod_fields[a][g],h=address_values(b,a,e.key);if(h.google!==""){return h.display}return""};SugarFields.url=new SugarType("url",true);SugarFields.url.isEmptyField=SugarFields.iframe.isEmptyField;SugarFields.url.display_link=function(b,h,e,d){var g=sugar_mod_fields[b][h],a,m=e.substring(0,4)!=="http"?("http://"+e):e;if(g.gen===1){return $('<a href="'+generatedLink(b,h,d)+'" class="QCRMLinks" />')}else{if(m===""||m==="http://"){return""}else{a=$('<a href="#" class="QCRMLinks" />');a.click(function(){OpenURL(m)});return a}}};SugarFields.url.display=function(a,g,d,b){var e=sugar_mod_fields[a][g];if(e.gen===1){lnk=generatedLink(a,g,b)}else{lnk=d}return lnk};SugarFields["enum"]=new SugarType("enum");SugarFields["enum"].display=function(a,l,d,b){var h=sugar_mod_fields[a][l];if(h.options===undefined){return d}var g=sugar_app_list_strings[h.options][d];return(g===undefined?d:g)};SugarFields.multienum=new SugarType("multienum");SugarFields.multienum.display=function(b,n,o,a){var d=sugar_mod_fields[b][n],h=o.substr(1,o.length-2).replace(/\^,\^/g,"%").replace(/\^\^/g,"%").split("%"),m="<ul>",l=h.length,g;for(g=0;g<l;g++){var e;e=sugar_app_list_strings[d.options][h[g]];m+="<li>"+(e===undefined?h[g]:e)+"</li>"}return m+"</ul>"};SugarFields.date=new SugarType("date");SugarFields.date.display=function(a,e,d,b){if(!d||d.length<10){return""}return jQuery.mobiscroll.formatDate(date_format,fromDBDate(d))};SugarFields.datetime=new SugarType("datetime");SugarFields.datetime.display=function(a,e,d,b){if(!d||d.length<14){return""}return jQuery.mobiscroll.formatDate(datetime_format,fromDBDateTime(d))};SugarFields.bool=new SugarType("bool");SugarFields.bool.displayField=function(a,e,d,b){var g=$("<h4/>");g.append(sugar_mod_strings[a][sugar_mod_fields[a][e].label]+"&nbsp;");g.append('<input type="checkbox" disabled="disabled" '+((d===1||d==="1")?'checked="checked"':"")+">");return g};SugarFields.bool.display=function(b,g,e,d){var a=sugar_mod_strings[b][sugar_mod_fields[b][g].label];if(e===1||e==="1"){return a}else{return'<span style="text-decoration:line-through">'+a+"</span>"}};SugarFields.bool.isEmptyField=function(a,d,b){return false};SugarFields["int"]=new SugarType("int");SugarFields.ua_rating=new SugarType("ua_rating");SugarFields.Rate=new SugarType("Rate");SugarFields.autoincrement=new SugarType("autoincrement");SugarFields.autoincrement.dbType="int";SugarFields.autoincrement.readonly=function(a,b){return true};SugarFields.currency=new SugarType("currency");SugarFields.currency.display=function(a,g,e,b){if(e===""){e="0"}var d=default_currency_symbol;if(b&&b.currency_symbol&&b.currency_symbol.value!==undefined){d=b.currency_symbol.value}return parseFloat(e).formatCurrency(currency_digits,decimal_separator,number_separator,d)};SugarFields["float"]=new SugarType("float");SugarFields["float"].display=function(a,e,d,b){if(d===""){return""}else{return parseFloat(d).formatNumber(2,decimal_separator,number_separator)}};SugarFields.text=new SugarType("text");SugarFields.text.html_mode="strip_tags";SugarFields.text.toDBField=function(a,e,b){var d=sugar_mod_fields[a][e],h=d.html_mode||this.html_mode,g=$(b+e).val();if($(b+e+"chng").val()=="0"&&d.html){g=$(b+e+"old").val()}else{if(g===null){return""}else{g=g.trim()}if(d.html&&h!="show_html"){g=g.replace("\n","<br>")}}return g};SugarFields.text.display=function(b,g,e,d){if(sugar_mod_fields[b][g].html){var a=HTMLDecode(e);if(a.indexOf("<p>")>=0||a.indexOf("<br")>=0){return a}}return e.replace(/\n/g,"<br>")};SugarFields.text.after_set_edit_val=function(d,a,b){$(d).textinput("refresh");$(d+"chng").val("0")};SugarFields.TextOperators=SugarFields.text;SugarFields.email=new SugarType("email",true);SugarFields.email.display_link=function(a,e,d,b){d=d.trim();if(d===""||(b.email_opt_out&&b.email_opt_out.value==="1")){return""}return $('<a href="mailto:'+d+'" rel="external" target="_blank" class="QCRMLinks" />')};SugarFields.email.display=function(a,e,d,b){d=d.trim();if(d===""){return""}else{if(b.email_opt_out&&b.email_opt_out.value==="1"){return'<span style="text-decoration:line-through">'+d+"</span>"}}return d};SugarFields.email.icon="mail";SugarFields.phone=new SugarType("phone",true);SugarFields.phone.link_button=function(g,q,p,n,o,a,h,m,r,b){var e=cleanup_phone(q);var d=$("<a/>",{"class":"ui-alt-icon ui-nodisc-icon",href:QCRM.telLink+e,rel:"external",click:function(l){setTimeout(function(){try{$(g).popup("close")}catch(s){}LogCall(n,o,m,r,b)},50)},style:"text-decoration:none;color:#444;"});d.append(display_label(a,p)+" "+q);return d};SugarFields.phone.display_link=function(a,e,d,b){var g=cleanup_phone(d);return $("<a/>",{href:QCRM.telLink+g,rel:"external",style:"text-decoration:none;color:#444;"+QCRM.inlineStyle,click:function(h){LogCall(a,b.id?b.id.value:Beans[a].CurrentId,Beans[a].DisplayTitle(b),(b.account_id?b.account_id.value:""),(a!=="Calls"||(b.status&&b.status.value==="Held")));return true}})};SugarFields.phone.display_link2=function(a,e,d,b){if(e.indexOf("mobile")!==-1){return($("<a/>",{href:"sms:"+cleanup_phone(d),rel:"external",title:"SMS",style:"text-decoration:none;color:#444;"}))}return""};SugarFields.phone.icon="phone";SugarFields.phone.icon2="comment";SugarFields.relate=new SugarType("relate",true);SugarFields.relate.display_link=function(b,l,g,d){var h=sugar_mod_fields[b][l],e=h.module,a=h.id_name;if(ViewPages.indexOf(e)===-1||d[a]===undefined){return""}else{return $("<a/>",{href:"#","data-module":e,"data-link":"bean","data-identity":d[a].value,style:"text-decoration:none;color:#444;"+QCRM.inlineStyle})}};SugarFields.parent=new SugarType("parent",true);SugarFields.parent.display_link=function(b,l,g,d){var h=sugar_mod_fields[b][l],e=d[h.id_type].value,a=h.id_name;if(ViewPages.indexOf(e)===-1||d[a]===undefined){return""}else{return $("<a/>",{href:"#","data-module":e,"data-link":"bean","data-identity":d[a].value,style:"text-decoration:none;color:#444;"+QCRM.inlineStyle})}};SugarFields.parent.thumbnail=function(b,l,g,d){var h=sugar_mod_fields[b][l],e=d[h.id_type].value,a=h.id_name;return"<img style='top:50%;margin-top:-9px;margin-right:8px;' src='"+Beans[e].icon()+"' width='16' height='16'/>"};SugarFields.Drawing=new SugarType("Drawing");SugarFields.Drawing.inline_btn=false;SugarFields.Drawing.whitespace=true;SugarFields.Drawing.isEmptyField=function(a,d,b){return false};SugarFields.Drawing.display=function(d,m,n,b){var g=sugar_mod_fields[d][m],e=d+m+"PV",l="ED"+d+m,h=d+m+"HD",a='<div class="DrawingDisplay" id="'+e+'"/>';$("#"+e).remove();SugarQuery("get_drawing",'{"session":"'+SugarSessionId+'","module_name":"'+d+'","id":"'+b.id.value+'","field":"'+m+'"}',function(u){if(!u){return}var p=u.entry_list.hasDrawing,q='<input type="hidden" id="'+h+'" >',s="",o=(g.height==="")?250:parseInt(g.height.replace("px",""),10),r=(g.width==="")?300:parseInt(g.width.replace("px",""),10);if(r>QCRM.DrawingWidth){o=Math.round(o*QCRM.DrawingWidth/r);r=QCRM.DrawingWidth}if(!p||!QCRM.LockSetDrawing){q+='<input type="button" id="'+l+'" data-link="editbtn" href="#" data-icon="edit" data-iconpos="notext" data-inline="true" data-theme="d"></a>'}if(p){s=" width="+r.toString()+"px height="+o.toString()+"px";q+='<img type="image/png"'+s+' src="data:image/png;base64,'+escape(u.entry_list.contents)+'">'}$("#"+e).html(q);$("#"+l).button();$("#"+h).val(p?"1":"0")},null);return a};SugarFields.image=new SugarType("image");SugarFields.image.counter=0;SugarFields.image.show_empty=true;SugarFields.image.inline_btn=true;SugarFields.image.whitespace=true;SugarFields.image.display=function(d,l,n,b){var g=sugar_mod_fields[d][l],e=d+l+"PV"+this.counter.toString(),h=d+l+"HD",a='<div class="ImageDisplay" id="'+e+'"><em>... Loading ...</em></div>',m="get_"+g.type;this.counter++;if(!QCRM.imageFields[g.type]){return""}SugarQuery(m,'{"session":"'+SugarSessionId+'","module_name":"'+d+'","id":"'+b.id.value+'","field":"'+l+'","name":"'+n+'"}',function(u){if(!u){return}var p=u.entry_list.hasDrawing,q='<input type="hidden" id="'+h+'" >',s="",o=(!g.height||g.height==="")?(g.type=="image"?50:0):parseInt(g.height.replace("px",""),10),r=(!g.width||g.width==="")?(g.type=="image"?200:0):parseInt(g.width.replace("px",""),10);if(r>QCRM.DrawingWidth){o=Math.round(o*QCRM.DrawingWidth/r);r=QCRM.DrawingWidth}if(p){if(g.type=="image"){s=' style="max-width:'+r.toString()+"px;height="+o.toString()+'px"'}else{if(r==0){s=' style="max-width:'+QCRM.DrawingWidth.toString()+"px"}else{s=' style="width:'+r.toString()+"px"}if(o==0){s+='"'}else{s+=";height:"+o.toString()+'px"'}}q+='<img type="image/png"'+s+' src="data:image/png;base64,'+escape(u.entry_list.contents)+'">'}$("#"+e).html(q);$("#"+h).val(p?"1":"0")},null);return a};SugarFields.photo=new SugarType("photo");SugarFields.photo.show_empty=true;SugarFields.photo.inline_btn=true;SugarFields.photo.whitespace=true;SugarFields.photo.counter=0;SugarFields.photo.display=SugarFields.image.display;SugarFields.file=new SugarType("file");SugarFields.file.display_link=function(a,e,d,b){return CreateDownloadLink(a,b.id.value,b)};SugarFields.file.display=function(a,g,e,d){try{return decodeURI(e)}catch(b){return decodeURI(unescape(e))}return e};SugarFields.file.icon="tag";SugarFields.file.inline_edit=false;SugarFields.decimal=SugarFields["float"];SugarFields["double"]=SugarFields["float"];SugarFields["boolean"]=SugarFields.bool;SugarFields.radioenum=SugarFields["enum"];SugarFields.dynamicenum=SugarFields["enum"];function SugarLink(g,d,l,b,h,a,e){this.name=g;this.from=d;this.module=l;this.id_name=b;this.create=h;this.select=a;this.hideTotals=false;this.swipePos=10;if(e!==undefined&&e!==false){this.swipeType="noswipe"}else{this.swipeType="all"}}SugarLink.prototype.addSwipe=function(b){var a=this.from+this.name;this.swipeType=a;if(!QCRM.relationshipSwipe[a]){QCRM.relationshipSwipe[a]={}}if(!QCRM.relationshipSwipe[a].stages){QCRM.relationshipSwipe[a].stages=QCRM.defaultRelSwipe.slice()}b.percent=this.swipePos;QCRM.relationshipSwipe[a].stages.push(b);this.swipePos+=15};SugarLink.prototype.DisplayRecord=function(d,b,a){Beans[this.module].DisplaySubpanelRecord(d,b,a,this.from,this.name)};QCRM.CheckDuplicateAccount=function(a,b){return false};QCRM.CheckDuplicatePerson=function(a,b){return false};function SugarBean(a,d,b,g,e){var h=this;QCRM.custom[a]={};if(typeof b==="boolean"){e=g;g=b;b="basic"}else{if(b===undefined){b="basic"}if(g===undefined){g=false}}this.available_CE=true;this.template=b;this.Fields=[];this.link_fields="";this.link_phone_fields="";this.name=a;this.table=d;this.Predefined=[];this.HomeIcon=true;this.ShowTab=true;this.LastViewed=true;this.Favorites=false;this.CurrentId="";this.CurrentName="";this.CurrentData={};this.CurrentCustomData={};this.CurrentParentId="";this.CurrentParentType="";this.CurrentParentName="";this.LimitWhere="";this.CurrentOffset=0;this.PrevOffset=0;this.NextOffset=0;this.CurrentSearch=false;this.CurrentSearchValues=false;this.CurrentSearchOrder=false;this.SearchFields=[];this.SyncOrderBy=d+".date_entered desc";this.SyncDefaults={sync:"Mine",max:true};this.TableViewTpl=[];this.CustomListViewTpl=false;this.ListData=false;this.CheckDuplicates=false;this.DuplicateButton=true;this.ShowTotals={list:true,dashlets:true,subpanels:true};this.GlobalSearchTpl="{name}";this.basic_search=["name"];switch(this.template){case"person":this.TitleFields=["first_name","last_name"];this.TitleTpl="{first_name} {last_name}";this.OrderBy="last_name";this.SearchName=toDBConcatName(d+".first_name",d+".last_name");this.Favorites=true;break;case"file":this.TitleFields=["document_name"];this.TitleTpl="{document_name}";this.OrderBy="document_name";this.SearchName=d+".document_name";this.GlobalSearchTpl="{document_name}";this.basic_search=["document_name"];break;case"company":this.Favorites=true;default:this.TitleFields=["name"];this.TitleTpl="{name}";this.OrderBy="name";this.SearchName=d+".name";break}this.ListFields=this.TitleFields.slice();this.highlighted=[];this.ListViewTpl="<h4>"+this.TitleTpl+"</h4>";this.AdditionalFields=[];this.PhoneFields=[];this.EditExcluded=["created_by_name","modified_by_name","date_entered","date_modified"];this.DetailExcluded=[];this.Links={};this.CustomLinks=false;this.CustomListFields=[];this.fullPage=(QCRM.mode!=="tablet");this.swipePos=10;this.swipeType="all";this.ColoredField="";this.CustomColors=[];this.AddBtn=false;this.enablePDF=false;this.hasIconClass=false;this.icon=function(){var l=froot+"images/",m="svg";if(QCRM.CRM_Icons){l=ServerAddress+"index.php?entryPoint=getImage&imageName=icon_"+a+"_32."+m}else{if(QCRM.DefIcons.indexOf(a)>=0){l+="icon_"+a+"_32."+m}else{l+=this.template+"_32.svg"}}return l};this.icon32=this.icon();this.hooks={install:[],actions:[],init_view:[],init_list:[],init_search:[],init_edit:[],check_edit:[],confirm_before_save:[],check_before_save:[],check_delete:[],after_retrieve:[],before_display:[],before_edit:[],before_create:[],before_update:[],after_display:[],before_save:[],after_save:[],after_delete:[]};this.access=((mobile_app)?(typeof sugar_mod==="undefined"?"edit":"none"):"view");this.acl={list:true,view:true,edit:true,exp:true,del:true};this.toUpdate=false;this.toUpdateFields={};this.link_name_to_fields={};this.OLExtraFields=[];this.CreateHook=function(){};this.CreateBtnHook=function(){};this.UpdateBtnHook=function(){};this.StoreFieldsSaved=[];this.AllFieldsSaved=[];this.DisplaySubpanelElt=function(l){return getFromTemplate(this.name,l,this.ListViewTpl)};this.DisplayCalendarElt=function(l){return getFromTemplate(this.name,l,this.CalendarViewTpl||this.ListViewTpl)};this.DefaultRelate=false;this.DefaultParent=false;this.SaveFields=function(l){return""};this.MyItemsQuery=function(){return"("+this.table+".assigned_user_id = '"+CurrentUserId+"')"}}QCRM.SetSearchNameFields=function(g,b){if(!sugar_mod_fields[g]){return}var a=Beans[g],e,m=[],l,h,d;for(e in b){l=b[e];h=sugar_mod_fields[g][l];if(l=="default"){m.push("("+a.SearchName+" @@)")}else{if(h){if(a.ListFields.indexOf(l)===-1){a.ListFields.push(l)}d=((QCRM.OffLine||h.source===null||h.source===undefined)?"":h.source);if(!QCRM.OffLine&&h.type=="email"){m.push("("+a.table+".id in (SELECT eabr.bean_id FROM email_addr_bean_rel eabr JOIN email_addresses ea ON (ea.id = eabr.email_address_id) WHERE eabr.deleted=0 AND ea.email_address @@))")}else{m.push("("+a.table+d+"."+l+" @@)")}}}}a.SearchArray="("+m.join(" OR ")+")"};QCRM.SetSearchTemplateFields=function(e,b){if(!sugar_mod_fields[e]){return}var a=Beans[e],d,g;for(d in b){g=b[d];if(!sugar_mod_fields[e][g]){continue}if(a.ListFields.indexOf(g)===-1){a.ListFields.push(g)}g=" {-"+g+"}";a.ExtendedTitleTpl+=g;a.GlobalSearchTpl+=g}};QCRM.SetTitleFields=function(g,b){var e,h,d=Beans[g],l=[];if(!d){return}if(typeof b=="string"){b=[b]}for(e in d.TitleFields){h=d.TitleFields[e];if(d.EditExcluded.indexOf(h)===-1){d.EditExcluded.push(h)}}d.TitleFields=b;for(e in b){var h=b[e];if(d.ListFields.indexOf(h)===-1){d.ListFields.push(h)}var a=d.AdditionalFields.indexOf(h);if(a!==-1){d.AdditionalFields.splice(a,1)}l.push("{"+h+"}")}d.TitleTpl=l.join(" ")};SugarBean.prototype.updateSearchName=function(a){QCRM.SetSearchNameFields(this.name,a)};SugarBean.prototype.addSwipe=function(a){this.swipeType=this.name;if(!QCRM.moduleSwipe[this.name]){QCRM.moduleSwipe[this.name]={}}if(!QCRM.moduleSwipe[this.name].stages){QCRM.moduleSwipe[this.name].stages=QCRM.defaultSwipe.slice()}a.percent=this.swipePos;QCRM.moduleSwipe[this.name].stages.push(a);this.swipePos+=15};SugarBean.prototype.addMenu=function(a){if(!QCRM.moduleMenu[this.name]){QCRM.moduleMenu[this.name]={}}QCRM.moduleMenu[this.name].push(a)};SugarBean.prototype.get_entry=function(b,a){if(QCRM.OffLine){}else{SugarQuery("get_entry",'{"session":"'+SugarSessionId+'","module_name":"'+this.name+'","id":"'+b+'","select_fields":"","link_name_to_fields_array":'+JSON.stringify(this.link_name_to_fields)+"}",a)}};SugarBean.prototype.set_entry=function(d,a,b){QCRM.set_entry(this.name,d,a,b)};SugarBean.prototype.get_entry_list=function(e,a,d,h,b,g,l){QCRM.get_entry_list(this.name,e,a,d,h,b,g,l)};SugarBean.prototype.StoreFields=function(h,b){var a;if(this.StoreFieldsSaved.length>0){a=this.StoreFieldsSaved}else{var l=["assigned_user_id","date_entered","date_modified"];if(this.name!="Favorites"){l.push("assigned_user_name")}a=this.AllFields().concat(this.RelateFields(true));for(var e in l){if(a.indexOf(l[e])===-1){a.push(l[e])}}this.StoreFieldsSaved=a}this.CurrentData={};a=a.concat(["jjwg_maps_geocode_status_c","jjwg_maps_address_c","jjwg_maps_lat_c","jjwg_maps_lng_c"]);for(var d in a){var g=a[d];if(h[g]){this.CurrentData[g]=h[g]}}this.CurrentName=b;this.CurrentParentType="";if(this.DefaultParent){if(h[this.DefaultParent.field]){this.CurrentParentName=h[this.DefaultParent.field].value}if(h[this.DefaultParent.id_name]){this.CurrentParentId=h[this.DefaultParent.id_name].value}if(h[this.DefaultParent.module]){this.CurrentParentType=h[this.DefaultParent.module].value}}};SugarBean.prototype.AllFields=function(){if(this.AllFieldsSaved.length>0){return this.AllFieldsSaved}var g,l,d=this.TitleFields.concat(this.Fields),a;if(this.Addresses!==undefined){for(var l in this.Addresses){var e=this.Addresses[l];for(var h in QCRM.addressFields){d.push(e+"_address_"+QCRM.addressFields[h])}}}a=this.AdditionalFields.concat(this.SearchFields,this.basic_search,this.DetailFields||[]);for(l in a){g=a[l];if(g.substring(0,4)==="$ADD"){var e=g.substring(4);for(var h in QCRM.addressFields){var b=e+"_address_"+QCRM.addressFields[h];d.push(b)}}else{d.push(g)}}d=Array_unique(d);this.AllFieldsSaved=d;return d};SugarBean.prototype.AllOrderFields=function(){var a=this.AllFields(),b=[];for(var e in a){if(sugar_mod_fields[this.name][a[e]]===undefined){continue}var d=sugar_mod_fields[this.name][a[e]].type;if(d&&d!=="relate"&&d!=="email"&&d!=="bool"&&d!=="parent"){b.push(a[e])}}return b};SugarBean.prototype.HasAddress=function(){if(this.Addresses!==undefined&&this.Addresses[0]!==undefined){return true}for(var b in this.AdditionalFields){var a=this.AdditionalFields[b];if(a.substring(0,4)==="$ADD"){return true}}return false};SugarBean.prototype.AllEditFields=function(){var b=this.TitleFields.concat(this.Fields),a;a=this.EditFields||this.AdditionalFields;for(var h in a){var e=a[h];if(e.substring(0,4)==="$ADD"){var d=e.substring(4);for(var g in QCRM.addressFields){b.push(d+"_address_"+QCRM.addressFields[g])}}else{if(this.EditExcluded.indexOf(e)===-1){b.push(e)}}}return Array_unique(b)};SugarBean.prototype.RelateFields=function(e){var h,l,b=this.AllFields().slice();if(e){if(this.DefaultRelate){h=this.DefaultRelate.field;if(b.indexOf(h)===-1){b.push(h)}}if(this.DefaultParent){h=this.DefaultParent.field;if(b.indexOf(h)===-1){b.push(h)}}}var d=[];for(var g in b){h=b[g];l=sugar_mod_fields[this.name][h];if(l===undefined){}else{if(l.type==="relate"){if(l.id_name!==undefined&&l.id_name!==h){d.push(l.id_name)}}else{if(l.type==="parent"){d.push(l.id_name);d.push(l.id_type)}}}}return d};QCRM.getTotals=function(d,n,m,v,o,q){var u=Beans[d],l=$("<div/>"),b={},h={},r=0,p=u.ListTotals.length==1,a=u.GroupTotals&&(u.GroupTotals!=""),g=a?sugar_app_list_strings[sugar_mod_fields[d][u.GroupTotals].options]:{};function e(A,w,z){A.click(function(F){F.preventDefault();var C=JSON.parse(JSON.stringify(q)),E="Search"+d+"_";for(var D in C){var B=C[D];if(B.field==E+z){B.val=[w]}}Beans[d].CurrentSearchValues=C;$("body").pagecontainer("change","#"+d+"ListPage",{allowSamePageTransition:true});$("#"+d+"ES").val("0");$("#"+d+"EL").val("0")})}function s(z,w){z.click(function(G){var J=h[w],A=b[w],H=A.display.AVG+A.display.SUM+A.display.COUNT,N=a?"totalName":"",F=$("<tr/>").append($("<td/>").append(display_label(d,u.GroupTotals))),D=$('<table border="0" width="100%"/>'),B="#TotalsPopup"+(o=="H"?"H":(d+"L")),E=$(B+" .GroupTable"),M=(w=="id")?sugar_app_list_strings.moduleList[d]:display_label(d,w);G.preventDefault();$(B+" .GroupField").html(display_label(d,w));$.each(QCRM.TotalFunctions,function(O,P){if(A.display[P]){F.append($('<td class="groupValue"/>').append(sugar_app_list_strings.total_options[P]))}});D.append(F);for(var L in J){var I=$("<tr/>"),K=J[L],C=$('<td class="groupLink"/>').append(g[L]);I.append(C);e(C,L,u.GroupTotals);$.each(QCRM.TotalFunctions,function(O,P){if(A.display[P]){I.append($('<td class="groupValue"/>').append(K[P]))}});D.append(I)}E.html(D);$(B).popup("open")})}if(q==false&&a){q=[{field:"Search"+d+"_"+u.GroupTotals,type:"sel",val:null}]}QCRM.get_totals(d,m,QCRM.ListFieldsToSelect(d,n),u.ListTotals,u.GroupTotals||"",function(O){var C,A,R,z,N=p?"groupNameRight":"groupName";if(O&&O.entry_list){for(R in u.ListTotals){var P=u.ListTotals[R],H=(P.field=="id")?sugar_app_list_strings.moduleList[d]:display_label(d,P.field);field_type=(P.field=="id")?"":sugar_mod_fields[d][P.field].type;if(!b[P.field]){r++;b[P.field]={label:H.replace(":","").trim(),type:sugar_mod_fields[d][P.field].type,SUM:0,AVG:0,COUNT:0,display:{AVG:0,COUNT:0,SUM:0}}}if(a&&!h[P.field]){h[P.field]={}}}z=O.entry_list.totals;for(R in u.ListTotals){var S=u.ListTotals[R],w=S.field;for(var L in S.fnct){var E=S.fnct[L],T=z[w+E],B=b[w].type;if(E=="AVG"&&B=="int"){T=SugarFields["float"].display(d,w,T)}else{if(E!="COUNT"){T=SugarFields[B].display(d,w,T)}}b[w][E]=T;b[w].display[E]=1}}for(var w in b){var G=b[w],F=G.display.AVG+G.display.SUM+G.display.COUNT,Q=a?"totalName":"",M,K=$('<table border="0" width="100%"/>');tr=$("<tr/>");if(r>1||F>1){M=$("<tr/>").append($("<td/>"));$.each(QCRM.TotalFunctions,function(U,V){if(G.display[V]){M.append($('<td style="text-align: right"/>').append(sugar_app_list_strings.total_options[V]))}});K.append(M)}var I=$('<td class="'+Q+'"/>').append(G.label);tr.append(I);if(a){s(I,w)}$.each(QCRM.TotalFunctions,function(U,V){if(G.display[V]){if(!(r>1||F>1)){G[V]=sugar_app_list_strings.total_options[V]+": "+G[V]}tr.append($('<td style="text-align: right"/>').append(G[V]))}});K.append(tr);l.append(K)}if(a){var D=O.entry_list.groups[u.GroupTotals];for(var J=0;J<D.length;J++){var z=D[J];for(R in u.ListTotals){var S=u.ListTotals[R],w=S.field;for(var L in S.fnct){var E=S.fnct[L],T=z[w+E];if(E!="COUNT"){T=SugarFields[b[P.field].type].display(d,w,T)}if(!h[w][z[u.GroupTotals]]){h[w][z[u.GroupTotals]]={}}h[w][z[u.GroupTotals]][E]=T}}}}$(v).html(l);$(v).show()}else{$(v).html("")}})};QCRM.getRelationshipTotals=function(e,d,b,m,l,o){var h=$('<table border="0" width="100%"/>'),n=Beans[d],a=n.GroupTotals&&(n.GroupTotals!=""),g=a?sugar_app_list_strings[sugar_mod_fields[d][n.GroupTotals].options]:{};QCRM.get_relationships_totals(e,d,b,m,l,QCRM.ListFieldsToSelect(d,["id"]),n.ListTotals,n.GroupTotals||"",function(G){if(G&&G.entry_list){var q={},D={},w=0,u;function F(M,L){M.click(function(T){var W=D[L],N=q[L],U=N.display.AVG+N.display.SUM+N.display.COUNT,Z=a?"totalName":"",S=$("<tr/>").append($("<td/>").append(display_label(d,n.GroupTotals))),Q=$('<table border="0" width="100%"/>'),O="#TotalsPopup"+e+(Beans[e].fullPage?"D":"L"),R=$(O+" .GroupTable");T.preventDefault();$(O+" .GroupField").html(display_label(d,L));$.each(QCRM.TotalFunctions,function(aa,ab){if(N.display[ab]){S.append($('<td class="groupValue"/>').append(sugar_app_list_strings.total_options[ab]))}});Q.append(S);for(var Y in W){var V=$("<tr/>"),X=W[Y],P=$('<td class="groupName"/>').append(g[Y]);V.append(P);$.each(QCRM.TotalFunctions,function(aa,ab){if(N.display[ab]){V.append($('<td class="groupValue"/>').append(X[ab]))}});Q.append(V)}R.html(Q);$(O).popup("open")})}if(a&&G.entry_list.groups&&G.entry_list.groups[n.GroupTotals]){u=G.entry_list.groups[n.GroupTotals];for(var I in n.ListTotals){var H=n.ListTotals[I],A=(H.field=="id")?sugar_app_list_strings.moduleList[e]:display_label(d,H.field);if(!q[H.field]){w++;q[H.field]={label:A.replace(":","").trim(),type:sugar_mod_fields[d][H.field].type,SUM:0,AVG:0,COUNT:0,display:{AVG:0,COUNT:0,SUM:0}}}if(!D[H.field]){D[H.field]={}}}for(var C=0;C<u.length;C++){var r=u[C];for(I in n.ListTotals){var J=n.ListTotals[I],p=J.field;for(var E in J.fnct){var s=J.fnct[E],K=r[p+s];if(s!="COUNT"){K=SugarFields[q[H.field].type].display(e,p,K)}if(!D[p][r[n.GroupTotals]]){D[p][r[n.GroupTotals]]={}}D[p][r[n.GroupTotals]][s]=K;q[p].display[s]=1}}}}for(var I in n.ListTotals){var J=n.ListTotals[I],p=J.field,z=sugar_mod_fields[d][p].type,A=(p=="id")?sugar_app_list_strings.moduleList[e]:display_label(d,p);for(var E in J.fnct){var s=J.fnct[E],v=J.label,K=G.entry_list.totals[p+s],B;if(!v){v=A.replace(":","").trim()+": "+sugar_app_list_strings.total_options[s]}if(s!="COUNT"){K=SugarFields[z].display(d,p,K)}tr=$("<tr/>");B=$('<td class="'+(a?"totalName":"")+'"/>').append(v);tr.append(B);if(a){F(B,p)}tr.append($('<td style="text-align: right"/>').append(K));h.append(tr)}}$(o).html(h);$(o).show()}})};QCRM.ListFieldsToSelect=function(d,e){var b=Beans[d],a=b.ListFields.concat(b.name=="Users"?[]:["assigned_user_id"],b.RelateFields(false));if(e!==undefined){if(typeof e==="string"){if(e!==""){e=e.split(" ")[0];a=a.concat([e])}}else{a=a.concat(e)}}a=a.filter(function(l,h,g){return g.indexOf(l)===h});return a};SugarBean.prototype.ListFieldsToSelect=function(a){return'["'+QCRM.ListFieldsToSelect(this.name,a).join('","')+'"]'};SugarBean.prototype.Enabled=function(){var a=this.name;return(QCRM.beans.indexOf(a)!==-1&&this.access!=="none"&&(!QCRM.OffLine||Pref.SyncModules[a].sync!=="None")&&Pref.Disabled.indexOf(a)===-1)};function addEnteredVal(g,d,l,e){var b=QCRM.toDBField(d,l,e),h=sugar_mod_fields[d][l],a="";if(h.type==="relate"){if(Beans[h.module]===undefined){g[h.id_name]={name:h.id_name,value:b};g[l]={name:l,value:SimpleBeans[h.module].List[b]}}else{g[l]={name:l,value:b};if(b!=""){a=QCRM.toDBField(d,h.id_name,e)}g[h.id_name]={name:h.id_name,value:a}}}else{if(h.type==="parent"){g[l]={name:l,value:b};if(b!=""){a=QCRM.toDBField(d,h.id_name,e)}g[h.id_type]={name:h.id_type,value:QCRM.toDBField(d,h.id_type,e)};g[h.id_name]={name:h.id_name,value:a}}else{if((h.type==="enum"||h.type==="dynamicenum")&&b==="EMPTY"){b=""}if(b!==undefined){g[l]={name:l,value:b}}}}}SugarBean.prototype.EditValues=function(e){var l,d=this.name,m=this.AllEditFields().concat(this.RelateFields(false)),b={},h=true,o=(this.DefaultRelate?this.DefaultRelate.field:""),r=(this.DefaultParent?this.DefaultParent.field:""),q=true,n=true,p,a=toDBDateTime(new Date());if(this.CurrentId===""){b.date_entered={name:"date_entered",value:a}}else{b=this.CurrentData}b.date_modified={name:"date_modified",value:a};for(l in m){var p=m[l],g=sugar_mod_fields[d][p];if(g===undefined||this.EditExcluded.indexOf(p)>=0){continue}if(p==="assigned_user_name"){h=false}if(p===o){q=false}if(p===r){n=false}addEnteredVal(b,d,p,e)}if(this.CurrentId===""){if(h){b.assigned_user_id={name:"assigned_user_id",value:CurrentUserId}}if(this.DefaultRelate&&q){p=this.DefaultRelate.id_name;if(AttachTo===this.DefaultRelate.module){b[p]={name:p,value:Beans[AttachTo].CurrentId}}else{if(AttachTo==="Contacts"&&this.DefaultRelate.module==="Accounts"){b[p]={name:p,value:Beans.Contacts.CurrentParentId}}}}if(AttachTo!=""&&this.DefaultParent&&n){p=this.DefaultParent.id_name;if(AttachTo==="Contacts"&&this.DefaultRelate&&this.DefaultRelate.module==="Contacts"){b[p]={name:p,value:Beans[AttachTo].CurrentParentId};b[this.DefaultParent.module]={name:this.DefaultParent.module,value:"Accounts"}}else{b[this.DefaultParent.id_name]={name:this.DefaultParent.id_name,value:$("#"+d+"FromId").val()};b[this.DefaultParent.module]={name:this.DefaultParent.module,value:$("#"+d+"FromModule").val()};b[this.DefaultParent.field]={name:this.DefaultParent.field,value:$("#"+d+"FromName").val()}}}}$.extend(b,this.CustomValues(b,this.CurrentId===""));for(l in this.hooks.before_save){this.hooks.before_save[l](b,this.CurrentId===""?{}:CurrentRecordValues)}return b};function refreshPage(){currentPage=window.location.hash.substr(1);$("body").pagecontainer("change","#"+currentPage,{allowSamePageTransition:true})}SugarBean.prototype.Edit=function(A,l,m){var e=(this.CurrentId===""),q=[],r=A===""?{}:Beans[A].CurrentData;if(mobile_edition=="Pro"||this.available_CE){if(this.CheckEdit(e?{}:CurrentRecordValues)){if(this.CheckDuplicates){$("#"+module+"Dup").hide()}$.mobile.loading("show");this.CurrentSearch=false;var h={},n=this.name+(this.fullPage?"DP":"ListPage"),u=$("body").pagecontainer("getActivePage").attr("id");h={changeHash:false};$("body").pagecontainer("change","#Edit"+this.name,h);AttachTo=A;var o=this.AllEditFields(),z=this.name;for(var v in o){var b=o[v],p=sugar_mod_fields[this.name][b],d="#Edit"+z+"_",w=d+b,a,g;if(!p){return}a=d+p.id_name;init_form_field(z,b,"",e,CurrentRecordValues,d,A);if(p!==undefined&&p.source!=="non-db"&&p.type==="relate"&&Beans[p.module]!==undefined&&p.id_name!==b){if(p.module==="Accounts"){$("#"+z+b+"CG").hide()}if(e&&b!=="assigned_user_name"){if(A===p.module){$(w).val(HTMLDecode(Beans[A].CurrentName));$(a).val(Beans[A].CurrentId);if(p.copyfields!==undefined){q=q.concat(p.copyfields)}}else{if(l!==""&&p.module==="Accounts"){$(w).val(HTMLDecode(m));$(a).val(l)}else{$(w).val("");$(a).val("")}}}$("#"+z+b+"L").html("").listview("refresh")}else{if(p!==undefined&&p.source!=="non-db"&&p.type==="parent"){g=d+p.id_type;if(e){if(AttachTo===""){$(w).val("");$(a).val("");$(g).val("Accounts")}else{if(AttachTo==="Accounts"&&m!=""){$(w).val(m);$(a).val(l);$(g).val(AttachTo)}else{if(AttachTo!=="Contacts"||m===""){$(w).val(HTMLDecode(getFromTemplate(z,CurrentRecordValues,Beans[AttachTo].TitleTpl)));$(a).val(Beans[AttachTo].CurrentId);$(g).val(AttachTo)}else{$(w).val(HTMLDecode(m));$(a).val(l);$(g).val("Accounts")}}if(p.copyfields&&p.copyfields[AttachTo]){q=q.concat(p.copyfields[AttachTo])}}$(g).selectmenu("refresh")}$("#"+z+b+"L").html("").listview("refresh")}}}if(A!==""){CopyFieldsFromRelated(q,r,d,z)}this.EditHook(e,A,e?{}:CurrentRecordValues);for(var s in this.hooks.before_edit){this.hooks.before_edit[s](e?{}:CurrentRecordValues,e)}$.mobile.loading("hide")}}else{AlertPopup(RES_UNAVAILABLE)}};SugarBean.prototype.Update=function(h,b){var e=this,g="#"+this.name,a=(h==="")||(h===this.CurrentId&&(CurrentRecordValues.module===this.name));function d(){var l;e.UpdateBtnHook();$(g+"FromModule").val(e.CurrentParentType);$(g+"FromLnk").val("");$(g+"FromId").val(e.CurrentParentId);$(g+"FromName").val(e.CurrentParentName);$(g+"parentJJWG").val("");e.Edit("","","");for(l in e.hooks.before_update){e.hooks.before_update[l](h,CurrentRecordValues)}}PrevID=false;$(g+"PrevPage").val(b||(e.name+(e.fullPage?"DP":"ListPage")));if(!a){$.mobile.loading("show");this.get_entry(h,function(l){$.mobile.loading("hide");if(l){e.CurrentId=h;e.CurrentParentId="";e.CurrentParentName="";e.CurrentParentType="";CurrentRecordValues=l.entry_list[0].name_value_list;CurrentRecordValues.module=e.name;CurrentRecordLinks=[];if(l.relationship_list&&l.relationship_list[0]&&l.relationship_list[0].link_list){CurrentRecordLinks=l.relationship_list[0].link_list}d(h)}})}else{d()}};SugarBean.prototype.Duplicate=function(b){var a=this;if(b){this.CurrentId=b}PrevID=b;if(CurrentRecordValues.id){CurrentRecordValues.id.value=""}this.Update(this.CurrentId);setTimeout(function(){a.CurrentId=""},800)};SugarBean.prototype.Create=function(h,g,b){var d,n,l="",e,a="",o="",m="";for(n in HiddenFields){$("#"+this.name+HiddenFields[n]).val("")}PrevID=false;if($("body").pagecontainer("getActivePage").attr("id")==(this.name+"DP")){PrevID=this.CurrentId}if(h&&h!=""){e=Beans[h];l=e.CurrentId;a=e.CurrentName;$("#"+this.name+"PrevPage").val(h+(e.fullPage?"DP":"ListPage"));$("#"+this.name+"FromModule").val(h);$("#"+this.name+"FromLnk").val(g);$("#"+this.name+"FromId").val(l);$("#"+this.name+"FromName").val(e.CurrentName);if(h==="Contacts"){o=e.CurrentParentId;m=e.CurrentParentName}else{if(h==="Accounts"){o=l;m=e.CurrentName}}$("#"+this.name+"FromAccountId").val(o);this.CurrentParentType=h;this.CurrentParentId=l;this.CurrentParentName=e.CurrentName}else{h="";$("#"+this.name+"PrevPage").val(b||(this.name+"ListPage"));this.CurrentParentType="";this.CurrentParentId="";this.CurrentParentName=""}this.CurrentId="";this.CurrentName="";this.Edit(h,o,m);this.CreateBtnHook();for(d in this.hooks.before_create){this.hooks.before_create[d](h,l,a,g)}};QCRM.finalSave=function(g,e,d,b,a){g.set_entry(g.CurrentId,e,function(r){if(!r||r.id===undefined){var n="Save Error. Please check your server log";$.mobile.loading("hide");if(r&&r.name!==undefined){if(r.name==="Access Denied"){n=RES_ACCESS_DENIED_MSG}else{n=r.name}}AlertPopup(n);return}var p,l=g.CurrentId==="",v=Beans[d];var m=g.name,q=g.AllEditFields(),h=false;if(g.LastViewed){PushViewed(m,r.id,g.DisplayTitle(e))}for(var p in q){var u=q[p],o=sugar_mod_fields[m][u],s;if(o&&o.after_save){s=o.after_save(r.id,e);h=s||h}}if(d!==""&&a!==""&&v&&b!==""){QCRM.set_relationship(d,b,a,r.id);if(QCRM.OffLine&&v.Links[a].backlink){QCRM.set_relationship(g.name,r.id,v.Links[a].backlink,b)}}g.AfterSave(r.id,l,e);for(p in g.hooks.after_save){g.hooks.after_save[p](r.id,l,e)}g.CurrentId=r.id;setTimeout(function(){$.mobile.loading("hide");g.AfterSaveLandingPage(r.id,l)},h?8000:100)})};SugarBean.prototype.CheckForm=function(){var b=this.name,h=this.AllEditFields(),m="#Edit"+b+"_",o="",l=0,a={};for(var g in h){var n=h[g],d=$(m+n).val();var e=checkFormField(b,n,m);if(e!==""){if(l>0){o+="\r"}l+=1;o+=e}else{a[n]=d}}if(l>0){AlertPopup(o)}else{o=this.CustomCheck(a);if(o!==""){l+=1;AlertPopup(o)}}return l};SugarBean.prototype.Save=function(){var h=this,p=h.EditValues("#Edit"+h.name+"_"),g=$("#"+this.name+"FromLnk").val(),m=$("#"+this.name+"FromId").val(),a=$("#"+this.name+"FromModule").val(),e,o;if(this.CheckForm()>0){return}$.mobile.loading("show");if(mobile_edition=="Pro"&&QCRM.JJWG&&JJWG.modules.indexOf(h.name)!=-1){if(a!=""&&h.CurrentId===""&&(h.name=="Meetings"||h.name=="Opportunities")){if(JJWG.modules.indexOf(a)!=-1){e=Beans[a];if(e.CurrentId==m){o=e.CurrentData;if(o.jjwg_maps_geocode_status_c&&o.jjwg_maps_geocode_status_c.value==="OK"){p.jjwg_maps_geocode_status_c=o.jjwg_maps_geocode_status_c;p.jjwg_maps_address_c=o.jjwg_maps_address_c;p.jjwg_maps_lat_c=o.jjwg_maps_lat_c;p.jjwg_maps_lng_c=o.jjwg_maps_lng_c}}}}else{if(!p.jjwg_maps_geocode_status_c||(p.jjwg_maps_geocode_status_c.value!="OK"&&p.jjwg_maps_geocode_status_c.value!="APPROXIMATE")){var n="";if(h.template=="person"){n="primary"}else{if(h.template=="company"){n="billing"}}if(n!=""){var d=address_values(p,h.name,n);if(d.google!==""){try{QCRM.geocoder.geocode({address:d.google},function(r,q){if(q==google.maps.GeocoderStatus.OK&&r[0].geometry.location_type=="ROOFTOP"){p.jjwg_maps_geocode_status_c={name:"jjwg_maps_geocode_status_c",value:"OK"};p.jjwg_maps_lat_c={name:"jjwg_maps_lat_c",value:r[0].geometry.location.lat()};p.jjwg_maps_lng_c={name:"jjwg_maps_lng_c",value:r[0].geometry.location.lng()};p.jjwg_maps_address_c={name:"jjwg_maps_address_c",value:r[0].formatted_address}}QCRM.finalSave(h,p,a,m,g)});return}catch(b){}}}else{var l=$("#"+h.name+"parentJJWG").val();if(l){JJWG.decodeFields(h.name,h.name+"parentJJWG",p)}}}}}QCRM.finalSave(h,p,a,m,g)};SugarBean.prototype.ViewDetails=function(){var h=this,e="#"+h.name+"DetailsList",a=e,d="#"+this.name+"NameH1",b=$("#"+this.name+"Links");function g(m,l,n){if(m==="deleted"){AlertPopup(sugar_app_strings.ERROR_NO_RECORD)}else{if(m==="Access Denied"){AlertPopup(RES_ACCESS_DENIED_MSG)}else{AlertPopup(sugar_app_strings.ERROR_NO_RECORD)}}RemoveFromLastviewed(l,n);RemoveFromFavorites(l,n);h.CurrentId=""}QCRM.IEsavedContents="";if(!init_done){MobileInit();return}$(e+" li").remove();b.hide();if(!this.fullPage){$(d).parent().hide()}else{$(d).html(sugar_app_list_strings.moduleListSingular[this.name])}if(this.CurrentId==""){if(PrevID){this.CurrentId=PrevID}else{return}}$(a).data("identity",this.CurrentId);$.mobile.loading("show");this.get_entry(this.CurrentId,function(q){if(q){if(q.name!==undefined){g(q.name,h.name,q.id,h.CurrentId);return}else{if(q.entry_list!==undefined&&q.entry_list[0]!==undefined){var v=[];CurrentRecordLinks=[];if(q.relationship_list&&q.relationship_list[0]){v=q.relationship_list[0];if(q.relationship_list[0].link_list){CurrentRecordLinks=q.relationship_list[0].link_list}}q=q.entry_list[0];CurrentRecordValues=q.name_value_list;CurrentRecordValues.module=h.name;edit_data=CurrentRecordValues;if(CurrentRecordValues[1]!==undefined&&CurrentRecordValues[1].name!==undefined){g(CurrentRecordValues[1].name,h.name,q.id,h.CurrentId);return}if(CurrentRecordValues.edit_access!==undefined){enableMenuAction("editcurrent",CurrentRecordValues.edit_access);var o=CurrentRecordValues.edit_access;if(CurrentRecordValues.delete_access!==undefined){o=CurrentRecordValues.delete_access}enableMenuAction("delcurrent",o)}var l,p=h.DisplayTitle(CurrentRecordValues);h.StoreFields(CurrentRecordValues,p);$(d).html(p);if(!h.fullPage){$(d).parent().show()}if(h.LastViewed){PushViewed(h.name,h.CurrentId,p)}showFavoriteStatus(h.name,h.CurrentId,p);for(l in h.hooks.after_retrieve){h.hooks.after_retrieve[l](CurrentRecordValues)}h.ViewDetailsHook(CurrentRecordValues);h.ViewDetailsHdrHook(CurrentRecordValues);var r=$('<li data-role="list-divider">'+RES_OVERVIEW_LABEL+"</li>");for(l in h.hooks.before_display){h.hooks.before_display[l](CurrentRecordValues,$(a))}$(a).append(r);r.click(function(){QCRM.showEmptyFields=!QCRM.showEmptyFields;if(QCRM.showEmptyFields){$(a+" li[isempty='1']").show()}else{$(a+" li[isempty='1']").hide()}});if(typeof h.ViewDetailsCustom==="function"){h.ViewDetailsCustom(CurrentRecordValues,a)}else{displayFields(q.name_value_list,h.name,h.DetailFields||h.EditFields||h.TitleFields.concat(h.AdditionalFields),a)}for(l in h.hooks.actions){var n=h.hooks.actions[l];if(n.show){n.show(CurrentRecordValues)}}h.ViewDetailsFtrHook(CurrentRecordValues,a);for(l in h.hooks.after_display){h.hooks.after_display[l](CurrentRecordValues,$(a),v)}$(a).listview("refresh");var r=$("#"+h.name+"DetailsHdr");if($.trim(r.html())!=""){r.show()}else{r.hide()}b.show();var u=h.CustomLinks||h.Links;for(var m in u){var s=(h.CustomLinks&&h.CustomLinks[0]!==undefined)?u[m]:m;getRelatedList(h.name,s)}}}}});$.mobile.loading("hide")};SugarBean.prototype.CustomListStyle=function(o,d){if(this.ColoredField!==""){var g=this.ColoredField,e=this.CustomColors,h=sugar_mod_fields[this.name][g];if(e.length===0){e=(h&&h.options!==undefined)?ListColors:ListColorsBool}if(g==="assigned_user_id"){return((true?"background-color:":"background:")+e[(o.assigned_user_id.value===CurrentUserId)?1:0]+";")}else{if(o[g]!==undefined){var b=o[g].value,m=0;if((h.type==="bool"||h.type==="boolean")){m=(b===1||b==="1")?1:0}else{var n=sugar_app_list_strings[h.options],l=0;if(n===undefined){return""}for(var a in n){if(a===b){m=l;break}l++}}return(true?"background-color:":"background:")+e[m%e.length]+";"}}}return""};$(window).on("orientationchange",function(b){if(QCRM.beans){for(var a in QCRM.beans){if($("body").pagecontainer("getActivePage").attr("id")==(QCRM.beans[a]+"ListPage")){changeHeight(QCRM.beans[a]);break}}}});function changeHeight(a){function b(){if(QCRM.ScrollLists&&QCRM.mode==="tablet"&&!Beans[a].fullPage){try{var d=$(window).height(),h=screen.height>screen.width;if(QCRM.platform=="android"){if(h){if($(window).width()>d){d=$(window).width()}}else{if($(window).width()<d){d=$(window).width()}}}var g=d-$("#"+a+'ListPage [data-role="footer"]').height()-$("#"+a+'ListPage [data-role="header"]').height();$("#"+a+"GR").height(g);$("#"+a+"GL").height(g);$("#"+a+"Panel").height(d);if(QCRM.platform=="android"){$(".ui-footer-fixed").css("visibility","visible")}}catch(e){}}}if(QCRM.platform=="android"){setTimeout(function(){b()},200)}else{b()}}SugarBean.prototype.GetList=function(r){if(!init_done){MobileInit();return}var e=this.name,d=this,u=(QCRM.mode==="tablet"&&!Beans[e].fullPage),q="#"+e+"ListDiv",v=$(q),m="#"+e+"Grid",s=sugar_app_list_strings.moduleList[d.name],b=$("#"+e+"ListPageTitle"),l="",h="",p,n;if(this.CurrentSearchOrder&&this.CurrentSearchOrder!==""){p=this.CurrentSearchOrder.split(" ");h=p[0]}if(this.CurrentSearchValues==""){LoadLastSearch(e)}l=get_where(e,this.CurrentSearchValues);changeHeight(e);if(l!==this.CurrentSearch){$("#totals"+d.name).hide();r=0;this.NextOffset=0;this.PrevOffset=0;this.CurrentOffset=0}this.CurrentSearch=l;$.mobile.loading("show");if(u){$(v).empty()}else{$(q+" li").remove()}this.CurrentOffset=r;enableButton(e+"PreviousBtn",r>0);var g=QCRM.ListFieldsToSelect(e,h);this.get_entry_list(l,'["'+g.join('","')+'"]',this.link_phone_fields,r,RowsPerPage,(this.CurrentSearchOrder&&this.CurrentSearchOrder!=="")?this.CurrentSearchOrder:this.OrderBy,function(D){var z="#totals"+d.name;if(D&&D.entry_list!==undefined){if(D.result_count!==0&&D.next_offset===0){d.CurrentOffset=0}if(D.next_offset===0||D.result_count===0){v.append("<li>"+RES_NO_MORE_RECORDS+"</li>")}else{if(QCRM.ShowTotals.list&&D.result_count>=0&&d.ListTotals&&d.ShowTotals.list){if(d.CurrentOffset==0){QCRM.getTotals(d.name,h,l,z,"L",d.CurrentSearchValues)}}else{$(z).empty()}if(D.total_count!==undefined&&D.total_count!==-1){var C=1+d.CurrentOffset;var B=d.CurrentOffset+D.result_count;s+=" ("+C.toString()+"-&shy;"+B.toString()+"/"+D.total_count.toString()+")";enableButton(d.name+"NextBtn",D.next_offset<D.total_count)}d.NextOffset=D.next_offset;d.PrevOffset=r-RowsPerPage;if(d.PrevOffset<0){d.PrevOffset=0}}b.html(s);var a=0;for(a=0;a<D.entry_list.length;a++){var A=D.entry_list[a],o=A.module_name,w;if(u){w=AddLinkTablet(o,A.id,A.name_value_list)}else{w=AddLinkWithIcon(o,A.id,"",A.name_value_list,(D.relationship_list&&D.relationship_list[a]&&D.relationship_list[a].link_list)?D.relationship_list[a].link_list:[],d.name+"ListPage",false,"")}v.append(w)}v.listview("refresh");if(mobile_app){}}$.mobile.loading("hide")})};SugarBean.prototype.InitEditForm=function(){init_add_form(this.name,this.EditFields||this.TitleFields.concat(this.AdditionalFields),this.EditExcluded.concat(this.FooterFields||[]));if(this.FooterFields){init_add_form(this.name,this.FooterFields,this.EditExcluded,"#Edit"+module+"Ftr")}};SugarBean.prototype.DisplaySubpanelRecord=function(h,d,a,e,g){var b=(g&&Beans[e].Links[g].template!==undefined)?getFromTemplate(this.name,d,Beans[e].Links[g].template):"";return AddLinkWithIcon(this.name,h,b,d,[],a,false,e,g)};SugarBean.prototype.DisplayTitle=function(b){return getFromTemplate(this.name,b,this.TitleTpl)};SugarBean.prototype.DisplayTitleExtended=function(b){var d=this.ExtendedTitleTpl===undefined?this.TitleTpl:this.ExtendedTitleTpl;return getFromTemplate(this.name,b,d)};SugarBean.prototype.UpdateTitleField=function(a,b){this.SearchName=b;this.TitleFields=a;this.TitleTpl="{'"+a.join("'} {'")+"'}"};SugarBean.prototype.DisplaySubpanelFilter=function(b){return""};SugarBean.prototype.ViewDetailsHook=function(a){};SugarBean.prototype.ViewDetailsHdrHook=function(a){};SugarBean.prototype.ViewDetailsFtrHook=function(a){};SugarBean.prototype.EditHook=function(a,d,b){};SugarBean.prototype.CustomCheck=function(a){var d,b,e="";for(d in this.hooks.check_before_save){b=this.hooks.check_before_save[d](a);if(b!=""){e+="\r"+b}}return e};SugarBean.prototype.CheckEdit=function(d){var a,b=false;if(this.access==="edit"&&this.acl.edit){b=true;for(a in this.hooks.check_edit){if(!this.hooks.check_edit[a](d)){return false}}}return b};SugarBean.prototype.CheckDelete=function(d){var a,b=false;if(this.access==="edit"&&this.acl.del){b=true;for(a in this.hooks.check_delete){if(!this.hooks.check_delete[a](d)){return false}}}return b};SugarBean.prototype.AfterDelete=function(a){};SugarBean.prototype.AfterSave=function(d,a,b){};SugarBean.prototype.AfterSaveLandingPage=function(g,a){var b=this.name,d=$("#"+b+"PrevPage").val(),e=d.replace("ListPage","");if(a&&QCRM.mode==="mobile"&&e===this.name){d=e+"DP"}$.mobile.back();return};SugarBean.prototype.CustomValues=function(b,a){return{}};function SugarSimpleBean(a,b,d,e){this.name=a;this.table=b;this.DefValue="";this.query=d;this.OrderBy=e===undefined?"":e;this.Fields=["name"];this.link_fields="";this.List={};this.Columns=[];this.ListFields=["name"];this.ListViewTpl="<h4>{name}</h4>";this.TitleTpl="{name}";this.swipeType="noswipe";this.Enabled=function(){return true};this.ListFieldsToSelect=function(){return'["'+this.ListFields.concat(["id"]).join('","')+'"]'};this.DisplaySubpanelFilter=function(g){return""};this.DisplaySubpanelElt=function(g){return getFromTemplate(this.name,g,this.ListViewTpl)};this.DisplayTitle=function(g){return getFromTemplate(this.name,g,this.TitleTpl)};this.DisplayTitleExtended=this.DisplayTitle;this.AfterLoad=function(g){};this.search=function(l,n){var h=[],m,g=this.List;l=l.toUpperCase();for(m in g){if(g[m].toUpperCase().indexOf(l)!==-1){h.push({id:m,name_value_list:{id:{name:"id",value:m},name:{name:"name",value:g[m]}}})}}n({entry_list:h})}}SugarSimpleBean.prototype.Load=function(b){var a=this;QCRM.get_S_entry_list(this.name,this.query,this.Fields,this.link_fields,0,500,this.OrderBy,function(n){if(n){if(n.entry_list!=undefined){var e,h;for(e=0;e<n.entry_list.length;e++){var m=n.entry_list[e],l="";for(h=0;h<a.Fields.length;h++){var g=a.Fields[h];if(m.name_value_list[g]!==undefined){l+=(l!==""?" ":"")+m.name_value_list[g].value}}a.List[m.id]=l}b(n)}}})};QCRM.enableBeans=function(o){var e,b,n,l=((mobile_edition==="Pro"&&QCRM.mode!=="tablet")?"true":"false");function z(m){var A='<a data-link="clearsearch" href="#" '+button_defaults+' data-theme="c">'+RES_CLEAR+'</a><a data-link="search" data-rel="close" data-theme="b" href="#" '+button_defaults+">"+sugar_app_strings.LBL_SEARCH_BUTTON_LABEL+"</a>";return'<form class="searchsubmit" id="SForm'+m+'" data-ajax="false" data-module="'+m+'"><div id="'+m+'basic_search"></div><div id="'+m+'DivMoreOptions" data-role="collapsible" data-collapsed="'+l+'" data-theme="d"><h3>'+RES_OPTIONS+'</h3><div name="'+m+'MyItemsOption" class="ui-field-contain"><div data-role="controlgroup" data-mini="true"><input type="checkbox" name="'+m+'MyItems" id="'+m+'MyItems" class="custom" data-theme="c" ><label for="'+m+'MyItems">'+sugar_app_strings.LBL_CURRENT_USER_FILTER+'</label></div></div></div><div id="'+m+'SS" style="display: none;"></div><div class="CenterBtns" style="margin-top:10px;"><input type="hidden" id="'+m+'SI" value="0">'+A+'</div><input type="submit" style="opacity:0;" data-role="none"></form>'}PagesCreated=true;QCRM.beans=o.slice();for(b in Beans){if(!Beans[b].fullPage){Beans[b].fullPage=(QCRM.mode!=="tablet")}}if(sugar_app_strings.LBL_SAVED===undefined){sugar_app_strings.LBL_SAVED="Saved"}if(typeof sugar_mod!=="undefined"){for(e in o){b=o[e];if(Beans[b]===undefined){Beans[b]=new SugarBean(b,sugar_mod[b].table,sugar_mod[b].type,sugar_mod[b].custom)}if(b!=="Employees"){Beans[b].access="edit"}Beans[b].hasIconClass=true}for(e in o){b=o[e];if(sugar_mod[b]&&sugar_mod[b].links!==undefined){for(var q in sugar_mod[b].links){if(Beans[b].Links[q]===undefined){var a=sugar_mod_fields[b];var p=sugar_mod[b].links[q],h=false,d;if((typeof p)!=="string"){p=sugar_mod[b].links[q].module;h=sugar_mod[b].links[q].id_name;for(d in a){if(a[d].type==="relate"){if(a[d].id_name===h){sugar_mod_fields[b][d].ass_link=q}}}}Beans[b].Links[q]=new SugarLink(q,b,p,h,(p!=="Accounts"&&p!=="Documents"&&p!=="Emails"),(p!=="Emails"),false)}}for(q in Beans[b].Links){if(Beans[b].Links[q].SyncFollow===undefined){Beans[b].Links[q].SyncFollow=true}}}}}for(e in o.reverse()){b=o[e];if(b!==undefined&&sugar_app_list_strings.moduleList[b]!==undefined){if(!sugar_app_list_strings.moduleList[b]){sugar_app_list_strings.moduleList[b]=b}var u=sugar_app_list_strings.moduleList[b];if((u.length>(QCRM.mode==="mobile"?12:15))&&(u.indexOf(" ")===-1)){u='<span style="font-size: smaller;">'+u+"<span>"}$("<style type='text/css'> ."+b+"Icon{background-image:url('"+Beans[b].icon32+"');background-repeat: no-repeat;} </style>").appendTo("head");$("<style type='text/css'> ."+b+"SIcon{background-image:url('"+Beans[b].icon32+"');background-repeat: no-repeat;background-size: 16px 16px;font-size: 0.8em;background-position: 3px 50%;} </style>").appendTo("head");$("#HomeMenu").prepend('<li class="IconContainer" id="Icon'+b+'" style="display:none;"><a href="#'+b+'ListPage"><div class="HomeIcon '+b+'Icon"/><div>'+u+"</div></a></li>")}}o.reverse();for(e in o){if(Beans[o[e]]!==undefined&&sugar_app_list_strings.moduleList[o[e]]!==undefined){b=o[e];var s=QCRM.mode==="tablet"&&!Beans[b].fullPage;var r='<div class="'+b+'DetailsHdr" id="'+b+'DetailsHdr" style="display:none;margin-top:-1em;margin-bottom:1em"/><div><ul style="margin-bottom:0px" id="'+b+'DetailsList" data-role="listview" data-divider-theme="b" data-split-theme="c" /></div><div class="'+b+'DetailsFtr" id="'+b+'DetailsFtr"></div><div style="clear:both;" id="'+b+'Links"/>';var g='<a id="'+b+'Fav" data-link="favorite" data-mini="true" data-inline="true" data-iconpos="notext" class="'+b+'Fav md-icon mbsc-ic mbsc-ic-star" style="display:none"/><h1 id="'+b+'NameH1"/><a data-inline="true" id="'+b+'ActMenu" data-icon="action" href="#PopupMenu'+b+'" data-history="false" data-rel="popup" data-iconpos="notext" class="ui-alt-icon ui-nodisc-icon ui-btn-right"/><div class="'+b+'DetailsBtn" id="'+b+'DetailsBtn"></div>';var w='<div id="filters'+b+'"></div><ul id="'+b+'ListDiv" data-role="listview" data-split-theme="d" data-filter="false" '+(mobile_app?"":'style="margin-top:0px !important" ')+(s?'data-icon="false" data-theme="d"':"")+'/><div class="CRMTotals ListTotals" id="totals'+b+'"></div>';if(s){w='<div class="ui-grid-a" ><div class="ui-block-a listleft" id="'+b+'GL" style="overflow-y: auto;-webkit-overflow-scrolling: touch;">'+w+'</div><div class="ui-block-b listright" id="'+b+'GR" style="overflow-y: auto;">'+('<div data-role="header" data-theme="d" class="ui-nodisc-icon" style="margin-left:-1em;margin-right:-1em;margin-top:-1em;margin-bottom:1em;display:none;background:none;">'+g+"</div>"+r).replace(/h1/,"h3")+"</div></div>"}$.mobile.pageContainer.append('<div id="'+b+'ListPage" data-module="'+b+'" data-role="page" data-theme="d"><div data-role="panel" data-position="right" data-display="overlay" id="'+b+'Panel" style="overflow-y: auto;">'+z(b)+'</div><div data-role="header" data-theme="d"><h1 id="'+b+'ListPageTitle" style="text-shadow:none !important;"/><a href="#'+b+'Panel" data-role="button" data-icon="search" data-iconpos="notext" data-iconshadow="false" class="ui-alt-icon ui-btn-right ui-nodisc-icon"></a></div><div data-role="content" data-theme="d" '+(s?('style="padding: 0px !important;"'):'style="padding-top: 0px !important;padding-bottom: 0px !important;"')+">"+w+'</div><div id="'+b+'lLegend"/>'+FooterDef+'<div data-role="navbar"><ul id="'+b+'LFtr" data-module="'+b+'"><li><a data-link="previous" id="'+b+'PreviousBtn" href="#" data-role="button" data-icon="arrow-l" class="ui-alt-icon ui-nodisc-icon"></a></li><li><a id="'+b+'ListPageHomeBtn" href="#HomePage" data-role="button" data-icon="home" data-direction="reverse" class="ui-alt-icon ui-nodisc-icon"></a></li><li><a id="'+b+'LBackBtn" href="#" data-role="button" data-icon="back" data-rel="back" class="ui-alt-icon ui-nodisc-icon"/></li><li><a data-link="create" id="'+b+'ListPageAddBtn" href="#" data-role="button" data-icon="plus" class="ui-alt-icon ui-nodisc-icon"></a></li><li><a data-link="next" id="'+b+'NextBtn" href="#" data-role="button" data-icon="arrow-r" class="ui-alt-icon ui-nodisc-icon"></a></li></ul></div></div></div>');if(Beans[b].fullPage){$.mobile.pageContainer.append('<div id="'+b+'DP" data-module="'+b+'" data-role="page" data-theme="d"><div data-role="header" data-theme="d">'+g+'</div><div data-role="content" data-theme="d"><div style="display:none;"><a id="IE'+b+'" href="#InlineEdit" >&nbsp;</a></div>'+r+"</div>"+FooterDef+'<div data-role="navbar"><ul data-module="'+b+'"><li><a id="'+b+'HomeBtn" href="#HomePage" data-role="button" data-icon="home" data-direction="reverse" class="ui-alt-icon ui-nodisc-icon"/></li><li><a id="'+b+'BackBtn" href="javascript:void(0)" data-role="button" data-icon="back" data-rel="back" data-direction="reverse" class="ui-alt-icon ui-nodisc-icon"/></li><li><a id="'+b+'ListPageSearchBtn" href="#'+b+'ListPage" data-role="button" data-icon="search" data-direction="reverse" class="ui-alt-icon ui-nodisc-icon"></a></li><li><a id="'+b+'LastViewedBtn" href="#LastViewedListPage" data-role="button" data-icon="bars" class="ui-alt-icon ui-nodisc-icon"/></li><li><a id="'+b+'AllModulesBtn" href="#AllModulesListPage" data-role="button" data-icon="grid" class="ui-alt-icon ui-nodisc-icon"/></li></ul></div></div></div>')}if(Beans[b].Predefined.indexOf("Edit")==-1){$.mobile.pageContainer.append('<div data-module="'+b+'" id="Edit'+b+'" data-role="page" data-theme="b"><div data-role="header" data-theme="d" data-module="'+b+'"> <h1 id="Edit'+b+'Title"/> <a data-role="button" href="javascript:refreshPage()" data-theme="c">'+sugar_app_strings.LBL_CANCEL_BUTTON_LABEL+'</a> <a data-link="save" id="Edit'+b+'ConfirmTopBtn" href="#" data-role="button"  data-inline="true" class="ui-btn-right" data-theme="b">'+sugar_app_strings.LBL_SAVE_BUTTON_LABEL+'</a></div><div data-role="content" data-theme="d"> <div id="Edit'+b+'Btn"/><div id="'+b+'Dup" style="display:none"><input type="hidden" id="'+b+'isDup"><p id="'+b+'DupMsg"></p></div><div id="Edit'+b+'Additional"/><div id="Edit'+b+'Ftr"/><br> <div class="CenterBtns" data-module="'+b+'">  <a id="Edit'+b+'CancelBottomBtn" href="javascript:refreshPage()" data-role="button" data-inline="true" data-theme="c">'+sugar_app_strings.LBL_CANCEL_BUTTON_LABEL+'</a>  <a data-link="save" id="Edit'+b+'ConfirmBottomBtn" href="#" data-theme="b" data-role="button" data-inline="true" >'+sugar_app_strings.LBL_SAVE_BUTTON_LABEL+"</a> </div></div></div>");n=$("#Edit"+b+"Additional");for(var v in HiddenFields){n.append('<input id="'+b+HiddenFields[v]+'" type="hidden">')}}}}for(e in o){b=o[e];if(Beans[b]!==undefined&&sugar_app_list_strings.moduleList[b]!==undefined){QuickCRMAddDetailsPage(b);QuickCRMAddListPage(b)}}if(o.indexOf("AOS_Products_Quotes")===-1&&(js_plugins.indexOf("AOS.js")!==-1)&&(sugar_mod_fields.AOS_Products_Quotes!==undefined)&&(Beans.AOS_Products_Quotes!==undefined)&&(o.indexOf("AOS_Quotes")!==-1||o.indexOf("AOS_Invoices")!==-1)){QCRM.beans.push("AOS_Products_Quotes")}if(sugar_app_list_strings.moduleList.QCRM_SavedSearch&&mobile_edition==="Pro"){QCRM.beans.unshift("QCRM_SavedSearch")}QCRM.beans.unshift("Users");if(sugar_mod_fields.Favorites){QCRM.beans.unshift("Favorites")}};QCRM.jjwg_MarkersSetup=function(){var a,b=sugar_app_list_strings.marker_image_list,d=[];Beans.jjwg_Markers.ListFields=["name","city","description","jjwg_maps_lat","jjwg_maps_lng","marker_image"];for(a in b){d.push([a,b[a]])}d.sort(function(g,e){return g[1]<e[1]?-1:1});b={};for(a in d){b[d[a][0]]=d[a][1]}sugar_app_list_strings.marker_image_list=b;sugar_mod_fields.jjwg_Markers.jjwg_maps_lat.type="varchar";sugar_mod_fields.jjwg_Markers.jjwg_maps_lat.def="0.00000000";sugar_mod_fields.jjwg_Markers.jjwg_maps_lng.type="varchar";sugar_mod_fields.jjwg_Markers.jjwg_maps_lng.def="0.00000000";sugar_mod_fields.jjwg_Markers.marker_image.display=function(g,e){return sugar_app_list_strings.marker_image_list[g]+'<img style="margin-left:10px;vertical-align:middle" src="'+JJWG.MarkersDir+g+'.png"/>'};QCRM.SetModuleHook("jjwg_Markers","init_edit",function(){$("#Editjjwg_MarkersFtr").append('<a data-inline="true" data-role="button" data-mini="true" class="ui-alt-icon ui-nodisc-icon" id="MarkerGeo" href="#">Geocode</a>');$("#Editjjwg_MarkersFtr").append('<em id="MarkerStatus"></em>');$("#MarkerGeo").click(function(){QCRM.jjwg_MarkersGeoEdit($("#Editjjwg_Markers_description").val(),"Editjjwg_Markers_jjwg_maps_lat","Editjjwg_Markers_jjwg_maps_lng","MarkerStatus","Editjjwg_Markers_description")})});QCRM.jjwg_MarkersGeoEdit=function(h,g,l,m,e){if(QCRM.geocoder&&QCRM.geocoder.geocode){QCRM.geocoder.geocode({address:h},function(o,n){var p=sugar_app_strings.MSG_LIST_VIEW_NO_RESULTS_BASIC;if(n==google.maps.GeocoderStatus.OK){$("#"+g).val(o[0].geometry.location.lat());$("#"+l).val(o[0].geometry.location.lng());p=o[0].geometry.location_type;if(p=="ROOFTOP"){p="OK"}else{p="APPROXIMATE"}if(p=="OK"&&e){$("#"+e).val(o[0].formatted_address)}}if(m){$("#"+m).html(p);setTimeout(function(){$("#"+m).empty()},5000)}})}};QCRM.jjwg_MarkersGeoView=function(g,e,h,l){if(QCRM.geocoder&&QCRM.geocoder.geocode){QCRM.geocoder.geocode({address:g},function(n,m){if(m==google.maps.GeocoderStatus.OK){l[e].value=n[0].geometry.location.lat();l[h].value=n[0].geometry.location.lng()}})}};if(!mobile_app&&!/android|iphone|ipad/i.test(navigator.userAgent)){return}QCRM.jjwg_MarkersGet=function(){function e(h){}function g(h){var l={lat:h.coords.latitude,lng:h.coords.longitude};if(JJWG&&JJWG.position){JJWG.position.lat=h.coords.latitude;JJWG.position.lng=h.coords.longitude}$("#Editjjwg_Markers_jjwg_maps_lat").val(h.coords.latitude);$("#Editjjwg_Markers_jjwg_maps_lng").val(h.coords.longitude);QCRM.geocoder.geocode({location:l},function(n,m){if(m===google.maps.GeocoderStatus.OK){if(n[1]){$("#Editjjwg_Markers_description").val(n[1].formatted_address)}}})}if(navigator&&navigator.geolocation){navigator.geolocation.getCurrentPosition(g,e,{enableHighAccuracy:true})}};QCRM.SetModuleHook("jjwg_Markers","before_create",function(g,e,h,l){QCRM.jjwg_MarkersGet();$("#MarkerGPS").hide()});QCRM.SetModuleHook("jjwg_Markers","before_update",function(h,g){var e=true;if(g&&g.jjwg_maps_lat){if(g.jjwg_maps_lat.value!=0||g.jjwg_maps_lng.value!=0){e=false}}if(e){$("#MarkerGPS").show()}else{$("#MarkerGPS").hide()}});QCRM.SetModuleHook("jjwg_Markers","init_edit",function(){$("#Editjjwg_MarkersFtr").prepend('<a style="display:none;" data-inline="true" data-role="button" data-mini="true" class="ui-alt-icon ui-nodisc-icon" data-icon="location" id="MarkerGPS" href="#">'+RES_SAVE_COORD+"</a>");$("#MarkerGPS").click(QCRM.jjwg_MarkersGet)})};QCRM.EmailsSetup=function(){Beans.Emails.acl.edit=false;$.each(Beans.Emails.Links,function(a,b){this.select=false;this.create=false});Beans.Emails.OrderBy="date_entered desc"};QCRM.ProspectListsSetup=function(){if(Beans.Contacts.Links.prospect_lists){Beans.Contacts.Links.prospect_lists.create=false}if(Beans.Accounts.Links.prospect_lists){Beans.Accounts.Links.prospect_lists.create=false}if(Beans.Leads.Links.prospect_lists){Beans.Leads.Links.prospect_lists.create=false}};QCRM.CasesSetup=function(){if(sugar_mod_fields.Cases.update_text){sugar_mod_fields.Cases.update_text.type="text";sugar_mod_fields.Cases.update_text.source=""}if(sugar_mod_fields.Cases.internal){sugar_mod_fields.Cases.internal.type="bool";sugar_mod_fields.Cases.internal.source=""}if(sugar_mod_fields.Cases.aop_case_updates_threaded){sugar_mod_fields.Cases.aop_case_updates_threaded.type="text";sugar_mod_fields.Cases.aop_case_updates_threaded.source=""}else{if(sugar_mod_fields.Cases.update_text){sugar_mod_fields.Cases.aop_case_updates_threaded=sugar_mod_fields.Cases.update_text}}Beans.Cases.EditExcluded.push("aop_case_updates_threaded");Beans.Cases.DetailExcluded.push("update_text","internal")};QCRM.setProfile=function(){if(mobile_edition==="Pro"&&QCRM.Profiles&&CurrentProfileId!==""&&QCRM.Profiles[CurrentProfileId]){var b=QCRM.Profiles[CurrentProfileId],a={fields:"AdditionalFields",detail:"DetailFields",edit:"EditFields",list:"CustomListFields",search:"SearchFields",subpanels:"subpanels",marked:"ColoredField",basic_search:"basic_search",highlighted:"highlighted",ListTotals:"ListTotals"};$.each(a,function(e,d){if(b[e]){$.each(b[e],function(g,h){if(h){Beans[g][d]=h}})}})}};QCRM.defProfile=function(d,a,b,e){if(QCRM.Profiles[d]===undefined){QCRM.Profiles[d]={}}QCRM.Profiles[d][a]=e?jQuery.parseJSON(b):b};function ComputeFieldsToUpdate(e){var v,m,g=Beans[e],s={},q=[],d=false,a=sugar_mod_fields[e];for(var A in g.Links){var m=[],n=g.Links[A].module;if(Beans[n]!==undefined&&Beans[n].Enabled()){var r={name:A,value:["id"]};switch(Beans[n].template){case"person":r.value.push("first_name");r.value.push("last_name");break;case"file":r.value.push("document_name");break;default:r.value.push("name");break}q.push(r);if(Beans[e].Links[A].id_name){var o=g.Links[A].id_name,w;for(b in a){if(a[b].type==="relate"&&a[b].id_name===o){w=b;s[A]={id_name:o,id_value:w,person:(Beans[n].template==="person")};d=true;break}}}}else{if(SimpleBeans[n]!==undefined){q.push({name:A,value:["id"]})}}}Beans[e].toUpdate=d;Beans[e].toUpdateFields=s;Beans[e].link_fields=JSON.stringify(q);if(Beans[e].ListTotals){try{for(v in Beans[e].ListTotals){var b=Beans[e].ListTotals[v].field;p=sugar_mod_fields[e][b],cstm=((p.source===null||p.source===undefined)?"":p.source);Beans[e].ListTotals[v].table=Beans[e].table+cstm}}catch(h){delete Beans[e].ListTotals}}if(!Beans[e].EditFields){Beans[e].EditFields=Beans[e].TitleFields.concat(Beans[e].AdditionalFields)}Beans[e].EditFields=Array_unique(Beans[e].EditFields);if(!Beans[e].DetailFields){Beans[e].DetailFields=Beans[e].EditFields.slice()}Beans[e].DetailFields=Array_unique(Beans[e].DetailFields);m=Array_unique(Beans[e].EditFields.concat(Beans[e].DetailFields));if(Beans[e].template=="file"&&sugar_mod_fields[e].filename&&QCRM.ServerVersion>="4.9.5"){sugar_mod_fields[e].filename.type="file"}for(v in m){var z=m[v],p=a[z];if(z.substring(0,4)==="$ADD"){var u=z.substring(4),l="LBL_"+u.toUpperCase()+"_ADDRESS";sugar_mod_fields[e][z]={type:"address",key:u,label:sugar_mod_strings[e][l]||sugar_app_strings[l]||"Address"};if(sugar_mod_fields[e][u+"_address_street"]){sugar_mod_fields[e][u+"_address_street"].type="text"}}else{if(p){if(z=="duration_minutes"){p.type="hidden"}else{if(z=="duration_hours"){p.display=function(C,B){return B.duration_hours.value+"h&nbsp;"+B.duration_minutes.value+"m&nbsp;"}}else{if(z=="jjwg_maps_address_c"){p.type="jjwgaddress"}else{if(z=="description_html"){p.type="html"}}}}}}}}function ComputePhoneFields(b){var a=Beans[b],e=[],d=false;for(var l in a.Links){var h=a.Links[l].module;if(Beans[h]!==undefined&&Beans[h].Enabled()&&Beans[h].PhoneFields.length>0){var g={name:l,value:["id","assigned_user_id"]};switch(Beans[h].template){case"person":g.value.push("first_name");g.value.push("last_name");break;case"file":g.value.push("document_name");break;default:g.value.push("name");break}g.value=g.value.concat(Beans[h].PhoneFields);e.push(g);d=true}}if(d){Beans[b].link_phone_fields=JSON.stringify(e)}}Beans.Users=new SugarBean("Users","users","person");Beans.Users.Enabled=function(){return true};Beans.Users.CheckEdit=function(a){return false};Beans.Users.ShowTab=false;Beans.Users.HomeIcon=false;Beans.Users.access="view";Beans.Users.SyncOptions={sync:"All",max:false};Beans.Employees=new SugarBean("Employees","users","person");Beans.Employees.CheckEdit=function(a){return false};Beans.Employees.DuplicateButton=false;Beans.Employees.access="view";Beans.Employees.HomeIcon=false;Beans.Employees.Links.reportees=new SugarLink("reportees","Employees","Employees",false,false,false,[]);QCRM.SetFieldHook("Employees","reports_to_name","module","Employees");Beans.Employees.LimitWhere="(@table.show_on_employees = 1 AND @table.is_group = 0 AND @table.employee_status='Active')";Beans.Employees.SyncDefaults={sync:"All",max:false};if(QCRM.ServerVersion>="5.0"&&mobile_edition==="Pro"){Beans.QCRM_Tracker=new SugarBean("QCRM_Tracker","qcrm_tracker","basic");Beans.QCRM_Tracker.ShowTab=false;Beans.QCRM_Tracker.HomeIcon=false;Beans.QCRM_Tracker.ListFields=["name","date_entered","assigned_user_id","jjwg_maps_lat_c","jjwg_maps_lng_c","jjwg_maps_address_c","jjwg_maps_geocode_status_c"];Beans.QCRM_Tracker.SyncOptions={sync:"New",max:false};Beans.QCRM_Tracker.saveModule="QCRM_Tracker";Beans.QCRM_Tracker.cronGPSId=false;Beans.QCRM_Tracker.runOnPause=false;Beans.QCRM_Tracker.tracking=false;Beans.QCRM_Tracker.OffLine=true;Beans.QCRM_Tracker.frequency;Beans.QCRM_Tracker.changeOnly=true;Beans.QCRM_Tracker.storeAddress=true;Beans.QCRM_Tracker.FilterSameLocation=true;Beans.QCRM_Tracker.minAccuracy=50;Beans.QCRM_Tracker.last_lat=0;Beans.QCRM_Tracker.last_lng=0;Beans.QCRM_Tracker.last_date=false;Beans.QCRM_Tracker.offset=0;Beans.QCRM_Tracker.nbRecords=20;Beans.QCRM_Tracker.startCron=function(){};Beans.QCRM_Tracker.stopCron=function(){};Beans.QCRM_Tracker.storePosition=function(a){QCRM.set_entry(Beans.QCRM_Tracker.saveModule,"",Record2NVL(a),function(d){},null)};Beans.QCRM_Tracker.savePosition=function(){};Beans.QCRM_Tracker.enable=function(){}}if(sugar_app_list_strings.moduleList.QCRM_SavedSearch&&mobile_edition==="Pro"){Beans.QCRM_Homepage=new SugarBean("QCRM_Homepage","qcrm_homepage","basic");Beans.QCRM_Homepage.ListFields=["name","description","dashlets","icons","hidden","creates","assigned_user_id"];if(db_type!=="mssql"){Beans.QCRM_Homepage.ListFields.push(shared_field)}Beans.QCRM_Homepage.ShowTab=false;Beans.QCRM_Homepage.HomeIcon=false;Beans.QCRM_Homepage.SyncOptions={sync:"None",max:false};Beans.QCRM_Homepage.default_name=function(){var a=mobile_app?(iOS?"iOS":"Android"):"Web App";if(typeof device!=="undefined"&&device&&device.model){a=device.model}return a};Beans.QCRM_Homepage.SaveAll=function(d){if(GetDemo()){return}var a=getHomePageDef(),b=Record2NVL(a,this.ListFields);if(Pref.Today){b.dashlets.value.unshift({id:"Today",type:"Preset"})}b.icons.value=(b.icons.value.length===0)?"":btoa(JSON.stringify(b.icons.value));b.dashlets.value=(b.dashlets.value.length===0)?"":btoa(JSON.stringify(b.dashlets.value));b.hidden.value=(b.hidden.value.length===0)?"":btoa(JSON.stringify(b.hidden.value));b.creates.value=(b.creates.value.length===0)?"":btoa(JSON.stringify(b.creates.value));if(d&&a.id!==""){b.new_with_id={name:"new_with_id",value:"1"}}if(b.name.value===""){b.name.value=Beans.QCRM_Homepage.default_name()}if(b.assigned_user_id.value===""){b.assigned_user_id={name:"assigned_user_id",value:CurrentUserId}}QCRM.set_entry("QCRM_Homepage",a.id,b,function(e){if(e&&e.id){QCRM.homepage.id=e.id;QCRM.homepage.name=b.name.value}SaveHomePageDef()},null)};Beans.QCRM_SavedSearch=new SugarBean("QCRM_SavedSearch","qcrm_savedsearch","basic");Beans.QCRM_SavedSearch.ListFields=["name","fields","sort_order","date_modified","date_entered","assigned_user_id","type","description"];if(db_type!=="mssql"){Beans.QCRM_SavedSearch.ListFields.push(shared_field)}Beans.QCRM_SavedSearch.ShowTab=false;Beans.QCRM_SavedSearch.HomeIcon=false;Beans.QCRM_SavedSearch.SyncOptions={sync:"All",max:false};Beans.QCRM_SavedSearch.Init=function(){var b,a,d=[];for(b in QCRM.beans){a=QCRM.beans[b];if(Beans[a].Enabled()){d.push(a)}}if(db_type!=="mssql"){Beans.QCRM_SavedSearch.LimitWhere="((@table.assigned_user_id = '"+CurrentUserId+"') OR (@table."+shared_field+"=1)) AND @table.type IN ('"+d.join("','")+"')"}else{Beans.QCRM_SavedSearch.LimitWhere="(@table.assigned_user_id = '"+CurrentUserId+"') AND @table.type IN ('"+d.join("','")+"')"}};Beans.QCRM_SavedSearch.SaveAll=function(m){var a,g=false,l=false,e=QCRM.SavedSearches,h=[];for(a in e){var d=e[a];if(d&&(d.assigned_user_id===CurrentUserId||d.assigned_user_id==="")){if(d.assigned_user_id==""){d.assigned_user_id===CurrentUserId}var b=Record2NVL(d,Beans.QCRM_SavedSearch.ListFields.concat("id"));b.fields.value=btoa(JSON.stringify(b.fields.value));if(m){b.new_with_id={name:"new_with_id",value:"1"}}h.push(b);l=true}g=true}if(l&&!GetDemo()){SugarQuery("set_entries",JSON.stringify({session:SugarSessionId,module_name:"QCRM_SavedSearch",name_value_lists:h},null,2),function(n){Beans.QCRM_Homepage.SaveAll(m)},null)}else{Beans.QCRM_Homepage.SaveAll(m)}if(QCRM.saveToCRM){QCRM.saveToCRM=false;SaveHomePageDef()}};Beans.QCRM_SavedSearch.LoadAll=function(a,d){var g="";function l(m){cleanUpIconAndDashlet();SaveSearchesAndHomePage(false);if(m){updateDashlets();QCRM.UpdFavIcons=true;QCRM.UpdButtons=true;HomepageRefresh(false);$.mobile.loading("hide")}}if(!QCRM.OffLine){$.mobile.loading("show");if(d){var h={};for(var b in QCRM.SavedSearches){var e=QCRM.SavedSearches[b];if(e[shared_field]==0){h[b]=e}}QCRM.SavedSearches=h;if(db_type!=="mssql"){g=shared_field+"=1"}}else{QCRM.SavedSearches={}}QCRM.get_entry_list("QCRM_SavedSearch",g,this.ListFieldsToSelect(),'""',0,200,"name",function(u){if(u&&u.entry_list){var n,m=u.entry_list.length;for(n=0;n<m;n++){var q=u.entry_list[n],r=q.name_value_list,p,o={id:q.id};r.fields.value=jQuery.parseJSON(atob(r.fields.value));for(p in Beans.QCRM_SavedSearch.ListFields){var s=Beans.QCRM_SavedSearch.ListFields[p];o[s]=r[s].value}if(db_type==="mssql"){o[shared_field]==="0"}QCRM.SavedSearches[q.id]=o}if(a){QCRM.get_entry_list("QCRM_Homepage","qcrm_homepage.assigned_user_id ='"+CurrentUserId+"'",Beans.QCRM_Homepage.ListFieldsToSelect(),'""',0,100,"date_modified desc",function(D){var F=false,v,w=false,E,A;if(D){var z=D.entry_list.length,B,C=QCRM.homepage.name;if(C===""){C=Beans.QCRM_Homepage.default_name()}for(B=0;B<z;B++){var G=D.entry_list[B].name_value_list;if(G.id.value===QCRM.homepage.id||G.name.value===C){w=true;break}}if(z>0){if(w){QCRM.homepage={name:G.name.value,id:G.id.value,assigned_user_id:G.assigned_user_id.value};QCRM.homepage[shared_field]=(db_type==="mssql")?"0":G[shared_field].value}else{G=D.entry_list[0].name_value_list}F=true;QCRM.searchIcons=(G.icons.value==="")?[]:jQuery.parseJSON(atob(G.icons.value));QCRM.Dashlets=(G.dashlets.value==="")?[]:jQuery.parseJSON(atob(G.dashlets.value));Pref.Hidden=(G.hidden.value==="")?[]:jQuery.parseJSON(atob(G.hidden.value));Pref.Creates=(G.creates.value==="")?[]:jQuery.parseJSON(atob(G.creates.value));if(QCRM.DashletMember(QCRM.Dashlets,"Today")){Pref.Today=true;QCRM.DashletRemove(QCRM.Dashlets,"Today")}else{Pref.Today=false}}}l(F)})}else{l(true)}}else{$.mobile.loading("hide")}})}}}Beans.SugarFeed=new SugarBean("SugarFeed","sugarfeed","basic");Beans.SugarFeed.OrderBy="date_entered desc";Beans.SugarFeed.fullPage=true;Beans.Accounts=new SugarBean("Accounts","accounts","company");Beans.Accounts.ListFields=["name","billing_address_city","billing_address_state","billing_address_city","billing_address_postalcode"];if(Q_API>="3.0"){Beans.Accounts.ListFields.push("name","billing_address_street","shipping_address_street","shipping_address_city","shipping_address_state","shipping_address_city","shipping_address_postalcode")}Beans.Accounts.ListViewTpl="<h4>{name}</h4><p>{billing_address_city} {billing_address_state}</p>";Beans.Accounts.TableViewTpl=["billing_address_city","billing_address_state"];Beans.Accounts.Links={contacts:new SugarLink("contacts","Accounts","Contacts",false,true,true,false),opportunities:new SugarLink("opportunities","Accounts","Opportunities",false,true,true,false),calls:new SugarLink("calls","Accounts","Calls",false,true,false,false),meetings:new SugarLink("meetings","Accounts","Meetings",false,true,false,false),tasks:new SugarLink("tasks","Accounts","Tasks",false,true,false,false),leads:new SugarLink("leads","Accounts","Leads",false,false,false,false),cases:new SugarLink("cases","Accounts","Cases",false,true,false,false),notes:new SugarLink("notes","Accounts","Notes",false,true,false,false)};if(QCRM.OffLine){Beans.Accounts.Links.meetings.backlink="accounts";Beans.Accounts.Links.calls.backlink="accounts"}Beans.Contacts=new SugarBean("Contacts","contacts","person");Beans.Contacts.ListFields=["first_name","last_name","account_name","title","email1","account_id"];Beans.Contacts.ListViewTpl="<h4>{first_name} {last_name}</h4><p>{title} {account_name}</p>";Beans.Contacts.TableViewTpl=["title","account_name","email1"];Beans.Contacts.Links={calls:new SugarLink("calls","Contacts","Calls",false,true,false,false),meetings:new SugarLink("meetings","Contacts","Meetings",false,true,false,false),tasks:new SugarLink("tasks","Contacts","Tasks",false,true,false,false),opportunities:new SugarLink("opportunities","Contacts","Opportunities",false,true,true,false),cases:new SugarLink("cases","Contacts","Cases",false,true,false,false),notes:new SugarLink("notes","Contacts","Notes",false,true,false,false)};if(QCRM.OffLine){Beans.Contacts.Links.meetings.backlink="contacts";Beans.Contacts.Links.calls.backlink="contacts"}QCRM.SetFieldHook("Contacts","account_name","copyfields",[{copy:"phone_work",from:"phone_office"},{copy:"primary",from:"billing"}]);QCRM.SetModuleHook("Contacts","after_retrieve",function(d,a){var b=Beans.Contacts;if(d.account_id!==undefined&&d.account_id.value!==undefined){b.CurrentParentId=d.account_id.value;b.CurrentParentName=d.account_name.value;b.CurrentParentType="Accounts"}else{b.CurrentParentId="";b.CurrentParentName="";b.CurrentParentType=""}});Beans.Leads=new SugarBean("Leads","leads","person");Beans.Leads.ListFields=["first_name","last_name","title","account_name","account_id","contact_id","email1"];Beans.Leads.EditExcluded.push("converted");Beans.Leads.ListViewTpl="<h4>{first_name} {last_name}</h4><p>{title} {account_name}</p>";Beans.Leads.TableViewTpl=["title","account_name","email1"];Beans.Leads.Links={calls:new SugarLink("calls","Leads","Calls",false,true,false,false),meetings:new SugarLink("meetings","Leads","Meetings",false,true,false,false),tasks:new SugarLink("tasks","Leads","Tasks",false,true,false,false),notes:new SugarLink("notes","Leads","Notes",false,true,false,false)};if(QCRM.OffLine){Beans.Leads.Links.meetings.backlink="leads";Beans.Leads.Links.calls.backlink="leads"}Beans.Leads.ViewDetailsHdrHook=function(e){if(e.status!==undefined&&e.status.value==="Converted"){var a=[];var b,d;if(e.contact_id!==undefined&&e.contact_id.value!==""){a.push({module:"Contacts",id:e.contact_id.value,name:Beans.Contacts.DisplayTitle(e)})}if(e.account_id!==undefined&&e.account_id.value!==""){a.push({module:"Accounts",id:e.account_id.value,name:e.account_name.value})}if(e.opportunity_id!==undefined&&e.opportunity_id.value!==""){a.push({module:"Opportunities",id:e.opportunity_id.value,name:e.opportunity_name.value})}if(a.length>0){GetBeansList(a,"LeadsDetailsList",false,sugar_app_list_strings.lead_status_dom.Converted)}}};if(sugar_mod_strings.Leads&&sugar_mod_strings.Leads.LBL_CONVERTLEAD&&sugar_mod_strings.Contacts&&sugar_mod_strings.Accounts){$("#ConvertLead").on("pagebeforecreate",function(){var d,e,b,a="#ConvertLead";$(a+"Title").text(sugar_mod_strings.Leads.LBL_CONVERTLEAD);$(a+"CancelTopBtn").text(sugar_app_strings.LBL_CANCEL_BUTTON_LABEL);$(a+"ConfirmTopBtn").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL);$(a+"CancelBottomBtn").text(sugar_app_strings.LBL_CANCEL_BUTTON_LABEL);$(a+"ConfirmBottomBtn").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL);$('label[for="ConvOptCreateContact"]').html(QCRM.getModuleString("Leads","LNK_NEW_CONTACT","Create Contact"));$('label[for="ConvOptCreateAccount"]').html(QCRM.getModuleString("Leads","LNK_NEW_ACCOUNT","Create Account"));$('label[for="CLLeads_contact_name"]').html(QCRM.getModuleString("Leads","LNK_SELECT_CONTACTS","Or Select Contact"));$('label[for="CLLeads_account_name"]').html(QCRM.getModuleString("Leads","LNK_SELECT_ACCOUNTS","Or Select Account"));b=Beans.Contacts;init_add_form("Contacts",b.EditFields||b.TitleFields.concat(b.AdditionalFields),b.EditExcluded.concat(["account_name"]),$("#ConvertContactCreate"),"CLC_");b=Beans.Accounts;init_add_form("Accounts",b.EditFields||b.TitleFields.concat(b.AdditionalFields),b.EditExcluded,$("#ConvertAccountCreate"),"CLA_");$("#CLLeads_account_name").on("input",function(g){pickRelate("Leads","account_id","account_name","Accounts","",[],"CLLeads_")});$("#CLLeads_contact_name").on("input",function(g){pickRelate("Leads","contact_id","contact_name","Contacts","",[],"CLLeads_")})});$("#ConvertLead").on("pageshow",function(){$("#ConvOptCreateContact").prop("checked",true).checkboxradio("refresh");$("#ConvOptCreateAccount").prop("checked",true).checkboxradio("refresh");Beans.Leads.ToggleContact();Beans.Leads.ToggleAccount();$("#CLLeads_account_name").val("");$("#CLLeads_contact_name").val("");$("#CLLeads_account_id").val("");$("#CLLeads_contact_id").val("");$("#CLLeadscontact_nameL").empty();$("#CLLeadsaccount_nameL").empty()});Beans.Leads.ToggleContact=function(){if($("#ConvOptCreateContact").is(":checked")){$("#ConvertContactCreate").show();$("#ConvertContactSearch").hide()}else{$("#ConvertContactCreate").hide();$("#ConvertContactSearch").show()}};Beans.Leads.ToggleAccount=function(){if($("#ConvOptCreateAccount").is(":checked")){$("#ConvertAccountCreate").show();$("#ConvertAccountSearch").hide()}else{$("#ConvertAccountCreate").hide();$("#ConvertAccountSearch").show()}};Beans.Leads.ConvertDef={Accounts:{assigned_user_name:"assigned_user_name",assigned_user_id:"assigned_user_id",account_name:"name",account_description:"description",phone_work:"phone_office",primary_address_street:"billing_address_street",primary_address_city:"billing_address_city",primary_address_postalcode:"billing_address_postalcode",primary_address_state:"billing_address_state",primary_address_country:"billing_address_country"},Contacts:{assigned_user_name:"assigned_user_name",assigned_user_id:"assigned_user_id",description:"description"}};Beans.Leads.CopyValues=function(b){var a=CurrentRecordValues,m={},e,g,d,o=a.assigned_user_id.value,n=Beans[b].AllFields(),h=Beans.Leads.AllFields();for(e in Beans.Leads.ConvertDef[b]){var l=Beans.Leads.ConvertDef[b][e];if(h.indexOf(e)!==-1||e==="assigned_user_id"){m[l]={name:l,value:a[e].value}}}for(g in n){e=n[g];if(m[e]===undefined){m[e]={name:e,value:(h.indexOf(e)!==-1&&a[e]!==undefined)?a[e].value:""}}}return m};Beans.Leads.ConvertManual=function(){var g=Beans.Leads,d=g.CopyValues("Contacts"),h=g.CopyValues("Accounts"),e,b,a;$("body").pagecontainer("change","#ConvertLead");a=Beans.Contacts.AllEditFields();for(e in a){b=a[e];init_form_field("Contacts",b,"",false,d,"#CLC_","")}a=Beans.Accounts.AllEditFields();for(e in a){b=a[e];init_form_field("Accounts",b,"",false,h,"#CLA_","")}};Beans.Leads.SaveConverted=function(){function h(q,s,r){QCRM.set_entry("Leads",Beans.Leads.CurrentId,{assigned_user_id:{name:"assigned_user_id",value:q},converted:{name:"converted",value:"1"},status:{name:"status",value:"Converted"},account_id:{name:"account_id",value:r},contact_id:{name:"contact_id",value:s}},function(u){$.mobile.loading("hide");if(r!==""){QCRM.set_relationship("Accounts",r,"contacts",s)}$("body").pagecontainer("change","#Leads"+(Beans.Leads.fullPage?"DP":"ListPage"),{reverse:true});Beans.Leads.ViewDetails()})}function b(r,u,s,q){s.account_id={name:"account_id",value:r};s.account_name={name:"account_name",value:u};QCRM.set_entry("Contacts","",s,function(w){var v;if((w.name!==undefined)&&(w.name==="Access Denied")){$.mobile.loading("hide");AlertPopup(RES_ACCESS_DENIED_MSG);return}v=w.id;h(q,v,r)})}var e=$("#ConvOptCreateAccount").is(":checked"),d=$("#ConvOptCreateContact").is(":checked"),p=$("#CLLeads_account_id").val(),a=$("#CLLeads_contact_id").val(),o=$("#CLLeads_account_name").val(),l=$("#CLLeads_contact_name").val(),g=Beans.Accounts.EditValues("#CLA_"),m=Beans.Contacts.EditValues("#CLC_"),n=CurrentRecordValues.assigned_user_id.value;$.mobile.loading("show");if(e){QCRM.set_entry("Accounts","",g,function(q){var r;if((q.name!==undefined)&&(q.name==="Access Denied")){$.mobile.loading("hide");AlertPopup(RES_ACCESS_DENIED_MSG);return}r=q.id;if(d){b(r,g.name.value,m,n)}else{h(n,a,r)}})}else{if(d){b(p,o,m,n)}else{h(n,a,p)}}};Beans.Leads.ConvertAuto=function(){var d=CurrentRecordValues,b=this.CopyValues("Contacts"),g=this.CopyValues("Accounts"),a=d.assigned_user_id.value;function e(m,l,h){if(m!==""){l.account_id={name:"account_id",value:m}}QCRM.set_entry("Contacts","",l,function(o){var n;if((o.name!==undefined)&&(o.name==="Access Denied")){AlertPopup(RES_ACCESS_DENIED_MSG);return}n=o.id;QCRM.set_entry("Leads",Beans.Leads.CurrentId,{assigned_user_id:{name:"assigned_user_id",value:h},converted:{name:"converted",value:"1"},status:{name:"status",value:"Converted"},account_id:{name:"account_id",value:m},contact_id:{name:"contact_id",value:n}},function(p){Beans.Leads.ViewDetails();if(m!==""){QCRM.set_relationship("Accounts",m,"contacts",n)}})})}if(!Beans.Accounts.Enabled()||!d.account_name||d.account_name.value===""){e("",b,a)}else{QCRM.get_entry_list("Accounts","accounts.name LIKE '"+d.account_name.value+"'",'["id"]',"",0,1,"",function(h){var l=false;if(h!==undefined&&h.entry_list!==undefined){if(h.entry_list[0]!==undefined){l=h.entry_list[0].id}}if(l===false){QCRM.set_entry("Accounts","",g,function(m){if((m.name!==undefined)&&(m.name==="Access Denied")){AlertPopup(RES_ACCESS_DENIED_MSG);return}e(m.id,b,a)})}else{e(l,b,a)}})}};Beans.Leads.DisableConvert=(mobile_edition!=="Pro");if(!Beans.Leads.DisableConvert&&!QCRM.OffLine){QCRM.SetModuleHook("Leads","actions",{id:"LeadsConvert",icon:"",label:sugar_mod_strings.Leads.LBL_CONVERTLEAD,action:Beans.Leads.ConvertManual,show:function(d){var b=$("#LeadsConvert"),a=d.status.value;if(!Beans.Leads.DisableConvert&&Beans.Contacts.Enabled()&&(a!=="Converted"&&a!=="Dead")){b.show()}else{b.hide()}}})}}Beans.Opportunities=new SugarBean("Opportunities","opportunities","basic");Beans.Opportunities.ListFields=["name","amount","account_name","currency_name","currency_symbol","sales_stage"];Beans.Opportunities.OrderBy="date_closed desc";Beans.Opportunities.SyncOrderBy="date_closed desc";Beans.Opportunities.ListViewTpl="<h4>{name}</h4><p>{account_name} {amount} {sales_stage}</p>";Beans.Opportunities.TableViewTpl=["account_name","amount","sales_stage"];Beans.Opportunities.Links={contacts:new SugarLink("contacts","Opportunities","Contacts",false,false,true,false),calls:new SugarLink("calls","Opportunities","Calls",false,true,false,false),meetings:new SugarLink("meetings","Opportunities","Meetings",false,true,false,false),tasks:new SugarLink("tasks","Opportunities","Tasks",false,true,false,false),leads:new SugarLink("leads","Opportunities","Leads",false,false,false,false),notes:new SugarLink("notes","Opportunities","Notes",false,true,false,false)};if(Q_API>="3.0"){Beans.Opportunities.Links.contacts.filter={field:"account_name",value_field:"account_name"}}Beans.Opportunities.AfterSave=function(d,a,b){if(a){if(QCRM.OffLine&&b.account_id){}if(QCRM.OffLine&&AttachTo==="Contacts"&&Beans.Contacts.CurrentId!==""){}else{if(QCRM.OffLine&&AttachTo==="Accounts"&&Beans.Accounts.CurrentId!==""){}}}};Beans.Calls=new SugarBean("Calls","calls","basic");Beans.Calls.ListFields=["name","status","date_start"];if(sugar_mod_fields.Calls&&sugar_mod_fields.Calls.date_end){Beans.Calls.ListFields.push("date_end")}Beans.Calls.OrderBy="date_start desc";Beans.Calls.SyncOrderBy="date_start desc";Beans.Calls.ListViewTpl="<h4>{name}</h4><p>{status} - {date_start}</p>";Beans.Calls.TableViewTpl=["status","date_start"];Beans.Calls.Links={contacts:new SugarLink("contacts","Calls","Contacts",false,false,true,false),users:new SugarLink("users","Calls","Users",false,false,false,[]),leads:new SugarLink("leads","Calls","Leads",false,false,false,false),notes:new SugarLink("notes","Calls","Notes",false,true,false,false)};if(mobile_edition==="Pro"){Beans.Calls.Links.accounts=new SugarLink("accounts","Calls","Accounts",false,false,false,false);Beans.Calls.Links.accounts.force=true;function CloseActivity(a,b){QCRM.set_entry(a,Beans[a].CurrentId,{status:{name:"status",value:"Held"}},function(d){b()})}Beans.Calls.DisplaySubpanelFilter=function(b){return Pref.ActivitiesWhere};QCRM.SetFieldHook("Calls","status","Details",function(m){var l=sugar_mod_fields.Calls.status,g=m.status.value,h=sugar_app_list_strings[l.options][g],a=(h===undefined?g:h),d=sugar_app_strings.LBL_CLOSE_BUTTON_TITLE.replace(/\[.+/,""),b=sugar_app_strings.LBL_CLOSE_AND_CREATE_BUTTON_TITLE.replace(/\[.+/,"");if(g==="Planned"){a+='&nbsp;&nbsp;<a id="CallsHeld" href="#" '+button_defaults+">"+d+'</a>&nbsp;&nbsp;<a id="CallsNew" href="#" '+button_defaults+">"+b+"</a>"}return a});Beans.Calls.ViewDetailsFtrHook=function(d){if(sugar_mod_fields.Calls.status&&d.status.value==="Planned"){var b=$("#CallsHeld"),a=$("#CallsNew");b.button();a.button();b.unbind("click");a.unbind("click");b.click(function(e){CloseActivity("Calls",function(){Beans.Calls.ViewDetails()})});a.click(function(e){CloseActivity("Calls",function(){if(sugar_mod_fields.Calls.status&&sugar_mod_fields.Calls.status.def){CurrentRecordValues.status.value=sugar_mod_fields.Calls.status.def}CurrentRecordValues.date_start.value=toDBDateTime(new Date());Beans.Calls.Duplicate()})})}}}Beans.Calls.AfterSave=function(e,b,d){var a=CurrentUserId;if(sugar_version>="6.1"){if(d.assigned_user_id&&d.assigned_user_id.value){a=d.assigned_user_id.value}}if(b||a!=CurrentUserId){QCRM.set_relationship(this.name,e,"users",a)}};Beans.Calls.CustomValues=function(d,a){var b={};if(QCRM.OffLine&&(sugar_mod_fields.Calls&&sugar_mod_fields.Calls.date_end&&sugar_mod_fields.Meetings&&sugar_mod_fields.Meetings.date_end)){}return b};Beans.Calls.LoggedCall=function(b,a){return Record2NVL({assigned_user_id:CurrentUserId,name:sugar_app_list_strings.moduleListSingular.Calls+" "+a,direction:"Outbound",status:"Held",date_start:toDBDateTime(new Date()),duration_hours:"0",duration_minutes:"15"})};if(mobile_app||mobile_edition==="Pro"){Beans.Calls.CustomListStyle=function(b,a){if(b.status.value==="Planned"){if(b.date_start.value<toDBDateTime(new Date())){return(a?"background-color:#":"background:#")+HighlightedColor+";"}}return""}}Beans.Meetings=new SugarBean("Meetings","meetings","basic");Beans.Meetings.ListFields=["name","status","date_start"];if(sugar_mod_fields.Meetings&&sugar_mod_fields.Meetings.date_end){Beans.Meetings.ListFields.push("date_end"),Beans.Meetings.EditExcluded.push("contact_name")}Beans.Meetings.OrderBy="date_start desc";Beans.Meetings.SyncOrderBy="date_start desc";Beans.Meetings.ListViewTpl="<h4>{name}</h4><p>{status} - {date_start}</p>";Beans.Meetings.TableViewTpl=["status","date_start"];Beans.Meetings.Links={contacts:new SugarLink("contacts","Meetings","Contacts",false,false,true,false),users:new SugarLink("users","Meetings","Users",false,false,true,[]),leads:new SugarLink("leads","Meetings","Leads",false,false,false,false),notes:new SugarLink("notes","Meetings","Notes",false,true,false,false)};Beans.Meetings.Links.users.swipeType="remove";Beans.Meetings.Links.accounts=new SugarLink("accounts","Meetings","Accounts",false,false,false,false);Beans.Meetings.Links.accounts.force=true;Beans.Meetings.DisplaySubpanelFilter=function(b){return Pref.ActivitiesWhere};Beans.Meetings.EditHook=function(a,b){if(a){$("#EditMeetings_duration_hours").val("1").selectmenu("refresh");$("#EditMeetings_duration_minutes").val("0").selectmenu("refresh")}};if(mobile_edition==="Pro"){QCRM.SetFieldHook("Meetings","status","Details",function(h){var g=sugar_mod_fields.Meetings.status,b=h.status.value,d=sugar_app_list_strings[g.options][b],a=(d===undefined?b:d);if(b==="Planned"){a+='&nbsp;&nbsp;<a id="MeetingsHeld" href="#" '+button_defaults+">"+sugar_app_strings.LBL_CLOSE_BUTTON_TITLE+"</a>"}return a});Beans.Meetings.ViewDetailsFtrHook=function(b){if(sugar_mod_fields.Meetings.status&&b.status.value==="Planned"){var a=$("#MeetingsHeld");a.button();a.unbind("click");a.click(function(d){CloseActivity("Meetings",function(){Beans.Meetings.ViewDetails()})})}}}Beans.Meetings.AfterSave=function(g,d,e){var b=CurrentUserId,a=false;if(sugar_version>="6.1"){if(e.assigned_user_id&&e.assigned_user_id.value){b=e.assigned_user_id.value}if(d){a=true}else{a=(CurrentRecordValues.assigned_user_id.value!=b)}if(a){QCRM.set_relationship(this.name,g,"users",b);if(QCRM.OffLine){}}}};Beans.Meetings.CustomValues=function(d,a){var b=Beans.Calls.CustomValues(d,a);return b};if(mobile_app||mobile_edition==="Pro"){Beans.Meetings.CustomListStyle=function(b,a){if(b.status.value==="Planned"){if(b.date_start.value<toDBDateTime(new Date())){return(a?"background-color:#":"background:#")+HighlightedColor+";"}}return""}}Beans.Tasks=new SugarBean("Tasks","tasks","basic");Beans.Tasks.available_CE=false;Beans.Tasks.ListFields=["name","status","date_due"];Beans.Tasks.OrderBy="date_due desc";Beans.Tasks.ListViewTpl="<h4>{name}</h4><p>{status} - {date_due}</p>";Beans.Tasks.TableViewTpl=["status","date_due"];Beans.Tasks.Links={contacts:new SugarLink("contacts","Tasks","Contacts",false,false,false,false),notes:new SugarLink("notes","Tasks","Notes",false,true,false,false)};if(mobile_edition==="Pro"){Beans.Tasks.Links.accounts=new SugarLink("accounts","Tasks","Accounts",false,false,false,false);QCRM.SetFieldHook("Tasks","status","Details",function(h){var g=sugar_mod_fields.Tasks.status,b=h.status.value,d=sugar_app_list_strings[g.options][b],a=(d===undefined?b:d);if(b!=="Completed"){a+='&nbsp;&nbsp;<a id="TasksHeld" href="#" '+button_defaults+">"+sugar_app_strings.LBL_CLOSE_BUTTON_TITLE+"</a>"}return a});Beans.Tasks.ViewDetailsFtrHook=function(b){if(sugar_mod_fields.Tasks.status&&b.status.value!=="Completed"){var a=$("#TasksHeld");a.button();a.unbind("click");a.click(function(d){QCRM.set_entry("Tasks",Beans.Tasks.CurrentId,{status:{name:"status",value:"Completed"}},function(e){Beans.Tasks.ViewDetails()})})}}}Beans.Cases=new SugarBean("Cases","cases","basic");Beans.Cases.available_CE=false;Beans.Cases.ListFields=["name","status","priority"];Beans.Cases.ListViewTpl="<h4>{name}</h4><p>{status} - {priority}</p>";Beans.Cases.TableViewTpl=["status","priority"];Beans.Cases.Links={contacts:new SugarLink("contacts","Cases","Contacts",false,false,false,false),notes:new SugarLink("notes","Cases","Notes",false,true,false,false)};Beans.Cases.EditExcluded=["case_number","created_by_name","modified_by_name"];if(mobile_edition==="Pro"){Beans.Cases.Links.accounts=new SugarLink("accounts","Cases","Accounts",false,false,false,false)}Beans.Project=new SugarBean("Project","project","basic");Beans.Project.available_CE=false;Beans.Project.ListFields=["name","status","priority"];Beans.Project.ListViewTpl="<h4>{name}</h4><p>{status} - {priority}</p>";Beans.Project.TableViewTpl=["status","priority"];Beans.Project.Links={projecttask:new SugarLink("projecttask","Project","ProjectTask",false,true,false,false),notes:new SugarLink("notes","Project","Notes",false,true,false,false)};Beans.ProjectTask=new SugarBean("ProjectTask","project_task","basic");Beans.ProjectTask.available_CE=false;Beans.ProjectTask.HomeIcon=false;Beans.ProjectTask.ListFields=["name","status","assigned_user_name"];Beans.ProjectTask.ListViewTpl="<h4>{name}</h4><p>{status} - {assigned_user_name}</p>";Beans.ProjectTask.TableViewTpl=["status","assigned_user_name"];Beans.ProjectTask.Links={notes:new SugarLink("notes","ProjectTask","Notes",false,true,false,false)};Beans.Documents=new SugarBean("Documents","documents","file");Beans.Documents.Favorites=true;Beans.Documents.SyncDefaults={sync:"None",max:true};Beans.Documents.ListFields=["document_name","name","document_revision_id","filename","last_rev_mime_type"];QCRM.DocumentsSetup=function(){QCRM.SetSearchNameFields("Documents",["document_name","filename"])};Beans.Documents.CheckEdit=function(a){return false};Beans.Documents.ViewDetailsFtrHook=function(b,a){displayFields(b,"Documents",["filename"],a)};if(sugar_version<"6.3"){Beans.Documents.get_file_info=function(a){try{var e,b=/(?:\.([^.]+))?$/,g=b.exec(a)[1];g=g.toLowerCase();if(g==="pdf"){e="application/pdf"}else{if(a.match(QCRM.InAppExtensions)){if(a.match(QCRM.AudioExtensions)){e="audio/"+g}else{e="image/"+g}}}if(e){return{filename:{name:"filename",value:a},last_rev_mime_type:{name:"last_rev_mime_type",value:e}}}}catch(d){}return{}};Beans.Documents.get_entry=function(d,b){var a=this;SugarQuery("get_entry",'{"session":"'+SugarSessionId+'","module_name":"'+this.name+'","id":"'+d+'","select_fields":"","link_name_to_fields_array":""}',function(e){try{$.extend(e.entry_list[0].name_value_list,a.get_file_info(e.entry_list[0].name_value_list.document_name.value.replace(" ","_")))}catch(g){}b(e)})};Beans.Documents.get_entry_list=function(e,a,d,l,b,g,m){var h=this;QCRM.get_entry_list(this.name,e,a,d,l,b,g,function(o){if(o&&o.entry_list){for(var n=0;n<o.entry_list.length;n++){try{$.extend(o.entry_list[n].name_value_list,h.get_file_info(o.entry_list[n].name_value_list.document_name.value.replace(" ","_")))}catch(p){}}}m(o)})}}Beans.Notes=new SugarBean("Notes","notes","basic");Beans.Notes.Predefined=["Edit"];Beans.Notes.HomeIcon=false;Beans.Notes.LastViewed=false;Beans.Notes.SyncDefaults={sync:"Rel",max:true};Beans.Notes.DefaultRelate={field:"contact_name",id_name:"contact_id",module:"Contacts"};Beans.Notes.DefaultParent={field:"parent_name",id_name:"parent_id",module:"parent_type"};Beans.Notes.ListFields=["name","filename","file_mime_type"];QCRM.NotesSetup=function(){QCRM.SetSearchNameFields("Notes",["name","filename"])};Beans.Notes.TmpFile=EmptyFile;Beans.Notes.CustomValues=function(d,a){var b={};if(d.filename===undefined||d.filename.value==="---"){b.filename={name:"filename",value:""}}return b};Beans.Notes.InitEditForm=function(){if(this.access==="edit"){SugarBean.prototype.InitEditForm.call(this);document.getElementById("EditNotesAttach").addEventListener("change",function(a){handleFileSelect("EditNotes",a)},false);$('label[for="EditNotesAttach"]').html(sugar_app_strings.LBL_EDIT_BUTTON);$("#DelAttachBtn").html(RES_DEL_ATTACH);$('label[for="EditNotes_filename"]').html(display_label("Notes","filename"));$("#EditNotes_filename").attr("readonly",true)}};Beans.Notes.EditHook=function(a,b){var d=CurrentRecordValues.filename;if(OptUpload){$("#EditNotesAttach").val("");$("#EditNotesPict").empty();Beans.Notes.TmpFile=EmptyFile;$("#EditNotesFile").show();$("#DelAttachBtn").show()}else{$("#EditNotesFile").hide();$("#DelAttachBtn").hide()}$("#DelAttach").val(0);if(!a&&d&&d.value!==""){$("#EditNotes_filename").val(d.value)}else{$("#EditNotes_filename").val(" --- ");$("#DelAttachBtn").hide()}};function DelAttach(){$("#DelAttach").val(1);$("#EditNotes_filename").val(" --- ");Beans.Notes.TmpFile=EmptyFile;document.getElementById("EditNotesPict").innerHTML="";$("#EditNotesAttach").val("")}function CamAttach(a){function d(){}function b(g){var e="picture.jpeg";$("#DelAttach").val(0);Beans.Notes.TmpFile={name:escape(e),contents:g,mime_type:"image/jpeg"};$("#"+a+"_filename").val(e);document.getElementById(a+"Pict").innerHTML=['<img class="thumb" src="',"data:image/jpeg;base64,"+g,'" title="',escape(e),'"/>'].join("")}navigator.camera.getPicture(b,d,{quality:QCRM.imageResolution,destinationType:Camera.DestinationType.DATA_URL,correctOrientation:true})}function handleFileSelect(h,b){var e=b.target.files;Beans.Notes.TmpFile=EmptyFile;document.getElementById(h+"Pict").innerHTML="";if(!e.length){return}var g=e[0];if(g.type.match("image.*")){var a=new FileReader();a.onload=(function(l){return function(m){document.getElementById(h+"Pict").innerHTML=['<img class="thumb" src="',m.target.result,'" title="',escape(l.name),'"/>'].join("")}})(g);a.readAsDataURL(g)}var d=new FileReader();d.onload=(function(l){return function(o){$("#DelAttach").val(0);var n=o.target.result;try{n=window.btoa(n)}catch(m){window.btoa(unescape(encodeURIComponent(n)))}Beans.Notes.TmpFile={name:escape(l.name),contents:n,mime_type:g.type};$("#"+h+"_filename").val(l.name)}})(g);d.readAsBinaryString(g)}SimpleBeans.Users=new SugarSimpleBean("Users","users","users.status='Active'","");SimpleBeans.Users.Init=function(){};if(!QCRM.OffLine){SimpleBeans.Users.Fields=["first_name","last_name"];SimpleBeans.Users.OrderBy="last_name";SimpleBeans.Users.ListFields=["first_name","last_name"];SimpleBeans.Users.ListViewTpl="{first_name} {last_name}";SimpleBeans.Users.link_fields='[{"name":"reportees","value":["id"]}';SimpleBeans.Users.link_fields+="]";SimpleBeans.Users.AfterLoad=function(p){var e,d,q=false,n=false,o=false,r,b=p.entry_list,m=b.length,g=[],h=[CurrentUserId];for(e=0;e<m;e++){if(b[e].id===CurrentUserId&&p.relationship_list[e].link_list){for(d=0;d<2;d++){r=p.relationship_list[e].link_list[d];if(r&&r.records&&r.records[0]){if(r.name==="reportees"){o=r}}}if(o){for(d=0;d<o.records.length;d++){h.push(o.records[d].link_value.id.value)}}break}}if(!(QCRM.sugaroutfitters||QCRM.usersTable)){if(g.length>0){CurrentUserRoles=g;g=JSON.stringify(g)}else{g=""}localStorage.setItem(ServerAddress+"R"+CurrentUserId,g)}CurrentUserReports=h;if(SimpleBeans.Users.List[CurrentUserId]){CurrentUserName=SimpleBeans.Users.List[CurrentUserId]}localStorage.setItem("SugarName",CurrentUserName);if(typeof QuickCRMAfterLogin=="function"){QuickCRMAfterLogin()}SyncUsersUpdate()}}var JJWG={position:{lat:0,lng:0},unit:"km",viewmode:"map",defCountry:"",gps_enabled:false,googlemaps:false,modules:["Accounts","Contacts","Leads"],fields:["jjwg_maps_geocode_status_c","jjwg_maps_lat_c","jjwg_maps_lng_c","jjwg_maps_address_c"],MarkersDir:"images/jjwg_Markers/"};JJWG.encodeFields=function(b,e,d){var a={};if(d.jjwg_maps_geocode_status_c&&(d.jjwg_maps_geocode_status_c.value=="OK"||d.jjwg_maps_geocode_status_c.value=="APPROXIMATE")){$.each(JJWG.fields,function(g,h){a[h]=d[h].value});$("#"+e).val(encodeObject(a))}else{$("#"+e).val("")}};JJWG.decodeFields=function(d,g,e){var b=$("#"+g).val(),a={};if(b!=""){a=decodeObject(b);$.each(JJWG.fields,function(h,l){e[l]={name:l,value:a[l]}})}};if(!mobile_app){if(QCRM.SuiteCRM&&QCRM.SuiteCRM>"7.5"){JJWG.MarkersDir="../themes/default/"+JJWG.MarkersDir}else{JJWG.MarkersDir="../custom/themes/default/"+JJWG.MarkersDir}}JJWG.create_select=function(b,d,g,n){var h,a=JJWG.modules,l="",e=d?{here:RES_HERE,address:RES_ADDRESS_LABEL}:{};if(n===undefined){n=JJWG.gps_enabled?"here":"address"}if(g){for(h in a){var m=a[h];if(Beans[m].Enabled()){if(l===""){l=m}if(n===""){n=m}e[m]=sugar_app_list_strings.moduleList[m]}}}return create_select(b,e,n,true)};JJWG.updateFilters=function(){var d=0,b=$("#map_search_type").val(),g=getSavedSearchList(b),a=false,e="";if(g==false){g={"0":" --- "}}g.myitems=RES_MY_ITEMS;$.each(g,function(l,h){if(l!==""){d++;e+="<option "+(a===l?'selected="selected" ':"")+'value="'+l+'">'+h+"</option>"}});if(b==="Meetings"&&d==2&&JJWG.modules.indexOf(b)!==-1){e+='<option value="today">'+sugar_app_list_strings.date_search.today+"</option>";e+='<option value="next_7_days">'+sugar_app_list_strings.date_search.next_7_days+"</option>"}$("#map_filter_search").html(e);$("#map_filter_search").selectmenu("refresh")};$("#JJWG").on("pagebeforecreate",function(){$("#map_type_title").text(RES_SEARCH_LABEL);$("#map_filter_title").text(RES_FILTER);$("#JJWGTitle").text(RES_MAPS_TITLE);$("#mapSearchBtn").text(sugar_app_strings.LBL_SEARCH_BUTTON_LABEL);var b=$('<div data-role="controlgroup" data-type="horizontal"/>');b.append(JJWG.create_select("map_search_type",false,true));if(mobile_app||mobile_edition==="Pro"){b.append(create_select("map_filter_search",getSavedSearchList("Accounts"),false,true,false))}if(!Beans.jjwg_Markers||!Beans.jjwg_Markers.Enabled()){$("#map_markers_div").hide()}else{$('label[for="map_markers_opt"]').html(sugar_app_list_strings.moduleList.jjwg_Markers)}$("#map_type").html(b);$("#map_dist_title").text(RES_DIST+" ("+JJWG.unit+")");$("#map_dist").append("<input id='map_search_dist' data-mini='true' type='number' value='50'>");$("#map_from_title").text(RES_SEARCH_FROM);var e=$("<div class='ui-grid-a'/>"),d=$("<div id= 'map_from_type_div' class='ui-block-a'/>"),a=$("<div class='ui-block-b'/>");d.append(JJWG.create_select("map_from_type",true,(mobile_edition==="Pro")));d.append('<div id="MapErr"/>');a.append('<input type="text" data-mini="true" id="map_from_name">');e.append(d);e.append(a);$("#map_from").append(e);$("#map_from").append('<input type="hidden" id="map_from_id"><input type="hidden" id="map_from_adr"><input type="hidden" id="map_from_lat"><input type="hidden" id="map_from_lng"><ul id="map_from_nameL" data-role="listview" data-inset="true" data-theme="c"/>');if(mobile_app||mobile_edition==="Pro"){$("#map_search_type").bind("change",function(g){JJWG.updateFilters()})}$("#map_from_type").bind("change",function(g){$("#map_from_name").val("");$("#map_from_id").val("");$("#map_from_nameL").empty();if($("#map_from_type").val()==="here"){}else{}});$("#map_from_name").on("input",function(){var o=$("#map_from_name").val(),m=$("#map_from_type").val(),n=$("#map_from_nameL");$("#map_from_id").val("");if(o.length<1||m==="here"||m==="address"){n.html("");n.listview("refresh")}else{var g=Beans[m];var l=g.table+"_cstm";var h=" "+Beans[m].SearchName+" LIKE '%"+o.replace("'","''")+"%' AND (("+l+".jjwg_maps_lat_c != 0 OR "+l+".jjwg_maps_lng_c != 0) AND ("+l+".jjwg_maps_geocode_status_c IN ('OK','APPROXIMATE')))";QCRM.get_entry_list(m,h,g.ListFieldsToSelect(),"",0,10,Beans[m].OrderBy,function(u){var q=u.entry_list,p=q.length;n.html("");for(var s=0;s<p;s++){var v=q[s].name_value_list,z=$('<li data-icon="false"/>'),w=$("<a/>",{href:"#"}),r=Beans[m].DisplayTitle(v);w.click({id:q[s].id,adr:v.jjwg_maps_address_c.value,lng:v.jjwg_maps_lng_c.value,lat:v.jjwg_maps_lat_c.value,name:r},function(A){$("#map_from_adr").val(A.data.adr);$("#map_from_lat").val(A.data.lat);$("#map_from_lng").val(A.data.lng);$("#map_from_id").val(A.data.id);$("#map_from_name").val(A.data.name.replace(/&#039;/g,"'"));n.html("");n.listview("refresh")});w.append(r);z.append(w);n.append(z)}n.listview("refresh")})}})});$("#JJWG").on("pageshow",function(){QCRM.History.push("#JJWG");JJWG.updateFilters()});Beans.jjwg_Maps=new SugarBean("jjwg_Maps","jjwg_maps","basic");Beans.jjwg_Maps.fullPage=true;QCRM.jjwg_MapsSetup=function(){Beans.jjwg_Maps.CreateHook=function(){$("#jjwg_MapsDetailsHdr").append('<div id="jjwgmap_canvas" style="width: 100%; height: 400px;"></div>')};Beans.jjwg_Maps.ViewDetailsHook=function(b){var a={};if(b.parent_id&&b.parent_type){a.id=b.parent_id.value;a.module=b.parent_type.value;if(!Beans[a.module]||!Beans[a.module].Enabled()){return}Beans[a.module].get_entry(a.id,function(d){try{if(d&&d.entry_list&&d.entry_list[0]){d=d.entry_list[0].name_value_list;if(d.jjwg_maps_geocode_status_c&&(d.jjwg_maps_geocode_status_c.value==="OK"||d.jjwg_maps_geocode_status_c.value==="APPROXIMATE")){a.addr=d.jjwg_maps_address_c.value;a.lat=d.jjwg_maps_lat_c.value;a.lng=d.jjwg_maps_lng_c.value;a.name=Beans[a.module].DisplayTitle(d);JJWG.DisplayMap(b.module_type.value,b.distance.value,a,b.unit_type.value,"jjwgmap_canvas","",false,false)}}}catch(e){}})}}};JJWG.ShowMapSearch=function(){$("#mapsearchdiv").show();$("body").pagecontainer("change","#JJWG")};JJWG.AddressTpl=function(b,d){var e=d.id.value,a='<a data-link="bean" data-identity="'+e+'" data-module="'+b+'" href="#">'+Beans[b].DisplayTitle(d)+"</a>";if(mobile_app&&mobile_edition=="Pro"){}else{if(JJWG.gps_enabled){a+='<a href="#" onclick="JJWG.DisplayDirections(\''+b+"','"+e+"',"+d.jjwg_maps_lat_c.value+","+d.jjwg_maps_lng_c.value+');"><img style="float:right;" src="images/right_then_up.png"/></a>'}}a+="<br>"+d.jjwg_maps_address_c.value;if(d.parent_name&&d.parent_name.value!=""&&d.parent_id){a+='<br><a data-link="bean" data-identity="'+d.parent_id.value+'" data-module="'+d.parent_type.value+'" href="#">'+d.parent_name.value+"</a>"}if(b=="Meetings"){a+="<br>"+jQuery.mobiscroll.formatDate(datetime_format,fromDBDateTime(d.date_start.value))}return a};JJWG.MarkerAddressTpl=function(e){var b="jjwg_Markers",d="#",g=e.id.value,a="<b>"+Beans[b].DisplayTitle(e)+"</b>";if(mobile_app&&mobile_edition=="Pro"){d=QCRM.map_url[QCRM.map_source].buildLink(e,b,e.description.value+","+e.city.value,null,e.jjwg_maps_lat.value,e.jjwg_maps_lng.value,"OK");if(d!="#"){a+='<a href="'+d+'" target="_system"><img style="float:right;" src="images/right_then_up.png"/></a>'}}if(d=="#"&&JJWG.gps_enabled){a+='<a href="#" onclick="JJWG.DisplayDirections(\''+b+"','"+g+"',"+e.jjwg_maps_lat.value+","+e.jjwg_maps_lng.value+');"><img style="float:right;" src="images/right_then_up.png"/></a>'}a+="<br>"+e.description.value;return a};JJWG.AddMapLink=function(g,b,e,d,a){if(d===undefined){d=e.jjwg_maps_lat_c.value}if(a===undefined){a=e.jjwg_maps_lng_c.value}g.click({coord:{lat:d,lng:a},label:JJWG.AddressTpl(b,e),module:b,id:e.id.value},function(h){setTimeout(function(){JJWG.ShowMapBean(h.data.coord,h.data.label,h.data.module,h.data.id)},900)})};JJWG.ShowMapBean=function(m,d,g,l){$("#mapsearchdiv").hide();$("#map_legend").empty();var a=new google.maps.LatLng(m.lat,m.lng),h=new google.maps.Map(document.getElementById("map_canvas"),{zoom:14,center:a,zoomControl:true,mapTypeId:google.maps.MapTypeId.ROADMAP}),e=new google.maps.InfoWindow,b=new google.maps.Marker({position:a,map:h});google.maps.event.addListener(b,"click",(function(n,o){return function(){e.setContent(o);e.open(h,n)}})(b,d));google.maps.event.trigger(h,"resize")};JJWG.far_enough=function(e,d,b,a){return(Math.abs(e-b)+Math.abs(d-a)>0.0003)};JJWG.ShowBeansInMap=function(g,e,K,r,z,B){var H,F,o,s,b,a=false,I=e.length,N,E,J,v,n=false,q=new google.maps.LatLng(K.lat,K.lng),h=[],L=new google.maps.Map(document.getElementById(r),{zoom:10,center:q,zoomControl:true,mapTypeId:google.maps.MapTypeId.ROADMAP}),M=new google.maps.InfoWindow;if(Beans[g].ColoredField!==""){a=Beans[g].ColoredField}if(I<=1){B=false}for(H=0;H<I;H++){F=e[H].name_value_list;var D=F.jjwg_maps_lat_c.value,p=F.jjwg_maps_lng_c.value,C=new google.maps.LatLng(D,p);if(B){if(H==0){N=C;J=D;v=p}else{if(H==I-1){E=C}else{if(JJWG.far_enough(J,v,D,p)){J=D;v=p;h.push({location:C})}}}}s={position:C,map:L};if(z){s.icon=JJWG.markers[H%25]}else{if(e[H].id===K.id){n=true;s.icon=JJWG.centermarker}else{b=-1;if(a==="assigned_user_id"){b=(F.assigned_user_id.value===CurrentUserId)?1:0}else{if(F[a]!==undefined){var A=sugar_mod_fields[g][a],O=F[a].value;if((A.type==="bool"||A.type==="boolean")){b=(O===1||O==="1")?1:0}else{var w=sugar_app_list_strings[A.options],G=0;if(w!==undefined){for(var d in w){if(d===O){b=G;break}G++}}}}}if(b!==-1){s.icon=JJWG.markers[b%25]}}}o=new google.maps.Marker(s);google.maps.event.addListener(o,"click",(function(P,Q){return function(){var R=JJWG.AddressTpl(g,Q);M.setContent(R);M.open(L,P)}})(o,F))}if(B){var m,u=new google.maps.DirectionsService(),l={origin:N,destination:E,waypoints:h,travelMode:google.maps.DirectionsTravelMode.DRIVING};m=new google.maps.DirectionsRenderer({suppressMarkers:true});m.setMap(L);u.route(l,function(P,Q){if(Q==google.maps.DirectionsStatus.OK){m.setDirections(P)}})}if(K.id!==""&&!n&&!z){o=new google.maps.Marker({position:q,map:L,icon:JJWG.centermarker});google.maps.event.addListener(o,"click",(function(P){return function(){M.setContent('<a href="#" data-module="'+K.module+'" data-identity="'+K.id+'">'+K.name+"</a><br>"+K.addr);M.open(L,P)}})(o))}BuildMapLegend(g,z);return L};JJWG.ShowMarkersInMap=function(m,h,d){var e,g,b,a,l=new google.maps.InfoWindow;QCRM.get_entry_list("jjwg_Markers",h,Beans.jjwg_Markers.ListFieldsToSelect(),"",0,150,"",function(q){if(q){var o=q.entry_list,n=o.length,p;for(p=0;p<n;p++){nvl=o[p].name_value_list;g={position:new google.maps.LatLng(nvl.jjwg_maps_lat.value,nvl.jjwg_maps_lng.value),map:m,icon:JJWG.Mmarkers[nvl.marker_image.value]};e=new google.maps.Marker(g);google.maps.event.addListener(e,"click",(function(r,s){return function(){var u=JJWG.MarkerAddressTpl(s);l.setContent(u);l.open(m,r)}})(e,nvl))}}})};JJWG.distance=function(v,s,u){var e=3.1459/180;var l=6371,h=parseFloat(v.lat),g=parseFloat(s.lat),n=parseFloat(v.lng),m=parseFloat(s.lng),p=(g-h)*e,b=(m-n)*e,r=Math.sin(p/2)*Math.sin(p/2)+Math.cos(h*e)*Math.cos(g*e)*Math.sin(b/2)*Math.sin(b/2),q=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),o=l*q;if(u==="miles"){o=o*0.621371192}return o};JJWG.get_where=function(a,e,m,n){if(e!==""){var p=Beans[a].table+((QCRM.OffLine||a=="jjwg_Markers")?"":"_cstm"),b=p+".jjwg_maps_lat"+((a=="jjwg_Markers")?"":"_c"),o=p+".jjwg_maps_lng"+((a=="jjwg_Markers")?"":"_c"),l,h,g,d="(("+b+" != 0 OR "+o+" != 0)  AND ";if(a!="jjwg_Markers"){d+="("+p+".jjwg_maps_geocode_status_c IN ('OK','APPROXIMATE')) AND "}if(true){l="(69.1 * ABS("+b+" -("+m.lat+")))";h="(53.0 * ABS("+o+" -("+m.lng+")))";g="( "+l+" + "+h+")";e="( 2 * "+e+")"}else{l="(69.1 * ("+b+" -("+m.lat+")))";h="(53.0 * ("+o+" -("+m.lng+")) * COS(("+m.lat+")/57.1))";g="SQRT( "+l+" * "+l+" + "+h+" * "+h+")"}if(n=="km"){g+=" * 1.609"}d+="("+g+" < "+e+"))";return d}else{return""}};JJWG.DisplayDirections=function(g,e,o,p){var r,m,q=new google.maps.DirectionsService(),b,a=new google.maps.LatLng((JJWG.position.lat+o)/2,(JJWG.position.lng+p)/2),d=new google.maps.LatLng(JJWG.position.lat,JJWG.position.lng),l=new google.maps.LatLng(o,p),h={zoom:7,center:a},n=$("body").pagecontainer("getActivePage").attr("id");r=new google.maps.DirectionsRenderer();b=new google.maps.Map(document.getElementById(n=="CalendarListPage"?"calendar_canvas":"map_canvas"),h);r.setMap(b);m={origin:d,destination:l,travelMode:google.maps.TravelMode.DRIVING};q.route(m,function(s,u){if(u==google.maps.DirectionsStatus.OK){r.setDirections(s)}})};JJWG.DisplayMap=function(e,h,a,m,n,d,b,l){var g=JJWG.get_where(e,h,a,m);$("#MapErr").empty();if(h!==""){if(d&&d!=""){g="(("+g+") AND ("+d+"))"}QCRM.get_entry_list(e,g,Beans[e].ListFieldsToSelect(),"",0,150,"",function(z){if(z){var q=z.entry_list,s=[],u,r=0,v=q.length,w=parseFloat(h),p;for(u=0;u<v;u++){var o=q[u].name_value_list;if(JJWG.distance({lat:o.jjwg_maps_lat_c.value,lng:o.jjwg_maps_lng_c.value},a,m)<w){s[r]=q[u];r++}}q=s;p=JJWG.ShowBeansInMap(e,q,a,n,l,false);if(Beans.jjwg_Markers&&$("#map_markers_opt").is(":checked")){JJWG.ShowMarkersInMap(p,JJWG.get_where("jjwg_Markers",h,a,m),a)}}})}};JJWG.SearchMap=function(){var g=$("#map_search_type").val(),r=Beans[g].table,p=$("#map_from_type").val(),o=$("#map_search_dist").val(),a,l,b="",h=false,q=new Date(),e=new Date(),m="",n=false;function d(s,u){JJWG.DisplayMap(g,o,a,JJWG.unit,"map_canvas",b,s,u);if(QCRM.mode==="mobile"){$("html, body").animate({scrollTop:$("#map_canvas").offset().top})}}$("#MapErr").empty();if(o!==""){if(mobile_app||mobile_edition==="Pro"){h=$("#map_filter_search").val();if(h&&h!==""&&h!=="0"){if(h==="myitems"){b=r+".assigned_user_id = '"+CurrentUserId+"'"}else{if(h==="today"||h==="next_7_days"){q.setHours(0);q.setMinutes(0);e.setHours(23);e.setMinutes(59);n=true;m="date_start";if(h==="next_7_days"){e.setDate(q.getDate()+7)}b="("+r+".assigned_user_id = '"+CurrentUserId+"') AND ("+r+".date_start >= '"+toDBDateTime(q)+"') AND ("+r+".date_start <= '"+toDBDateTime(e)+"')"}else{h=QCRM.SavedSearches[h];b=get_where(h.type,h.fields)}}}}if(p==="address"){QCRM.geocoder.geocode({address:$("#map_from_name").val()},function(u,s){if(s==google.maps.GeocoderStatus.OK){a={lat:u[0].geometry.location.lat(),lng:u[0].geometry.location.lng(),id:"",module:"",name:"",addr:""};d()}else{var v=sugar_app_strings.MSG_LIST_VIEW_NO_RESULTS_BASIC===undefined?"No results found.":sugar_app_strings.MSG_LIST_VIEW_NO_RESULTS_BASIC;$("#MapErr").html("<em>"+$("#map_from_name").val()+": "+v+"</em>")}});return}else{if(p==="here"){if(!JJWG.gps_enabled){$("#MapErr").html("<em>Position not available</em>");return}a={lat:JJWG.position.lat,lng:JJWG.position.lng,id:"",module:"",name:"",addr:""}}else{l=$("#map_from_id").val();if(l===""){return}a={lat:$("#map_from_lat").val(),lng:$("#map_from_lng").val(),id:l,module:p,name:$("#map_from_name").val(),addr:$("#map_from_adr").val()}}}d(m,n)}};JJWG.jjwgInitModule=function(a){Beans[a].ListFields=Beans[a].ListFields.concat(["jjwg_maps_lat_c","jjwg_maps_lng_c","jjwg_maps_address_c","jjwg_maps_geocode_status_c"])};JJWG.jjwg_updatemodules=function(e){if(e!==""){var d,g=[],a=e.split(",");for(d in a){var b=a[d].trim();if(Beans[b]){g.push(b)}}JJWG.modules=g}};JJWG.jjwg_init=function(){var b,a,d=[];for(b in JJWG.modules){a=JJWG.modules[b];if(Beans[a]&&Beans[a].Enabled()){d.push(a);JJWG.jjwgInitModule(a)}}JJWG.modules=d};JJWG.getCurrentPosition=function(){var d=new Date();var b={};if(QCRM.gpsHighAccuracy){b={enableHighAccuracy:true}}function a(g){}function e(g){JJWG.position.lat=g.coords.latitude;JJWG.position.lng=g.coords.longitude;JJWG.gps_enabled=true;if(JJWG.onPositionUpdate){JJWG.onPositionUpdate(JJWG.position)}}if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,a,b)}};JJWG.jjwg_load=function(g){JJWG.gps_enabled=false;try{if(mobile_app||/android|iphone|ipad/i.test(navigator.userAgent)){CronGPS()}if(google){var a={callback:function(){var l,h=sugar_app_list_strings.marker_image_list;enableButton("MapsLinkLabel",true);JJWG.googlemaps=true;JJWG.centermarker=new google.maps.MarkerImage("images/marker_0.png",new google.maps.Size(20,34),new google.maps.Point(0,0),new google.maps.Point(10,34));JJWG.markers={};for(l=0;l<25;l++){JJWG.markers[l]=new google.maps.MarkerImage("images/marker_"+(l+1).toString()+".png",new google.maps.Size(20,34),new google.maps.Point(0,0),new google.maps.Point(10,34))}JJWG.Mmarkers={};if(Beans.jjwg_Markers&&h){for(l in h){JJWG.Mmarkers[l]=new google.maps.MarkerImage(JJWG.MarkersDir+l+".png")}}QCRM.geocoder=new google.maps.Geocoder()}};var e="3",b=QCRM.google_api_key||"AIzaSyBWa2TJ_7zL0VKMOKSh8ToSBkuIozlLrEI";a.other_params="key="+b;if(g){a.callback=g}google.load("maps",e,a)}}catch(d){}};QCRM.google_load=function(){try{if(google){google.load("maps","3",{callback:function(){QCRM.geocoder=new google.maps.Geocoder()}})}}catch(a){}};if(sugar_mod_fields.Favorites){Beans.Favorites=new SugarBean("Favorites","favorites","basic");Beans.Favorites.ShowTab=false;Beans.Favorites.Favorites=false;Beans.Favorites.SyncOptions={sync:"All",max:false};sugar_mod_fields.Favorites.parent_id="none";sugar_mod_fields.Favorites.parent_type="none";Beans.Favorites.ListFields.push("parent_id","parent_type");Beans.Favorites.OLExtraFields=["parent_id","parent_type"];Beans.Favorites.Init=function(){var a="'"+QCRM.beans.join("','")+"'";Beans.Favorites.LimitWhere="(@table.assigned_user_id = '"+CurrentUserId+"' AND parent_type IN ("+a+"))"}}if(typeof aos_installed!=="undefined"){if(aos_installed!==false&&Q_API>="2.5"&&js_plugins.indexOf("AOS.js")===-1){QCRM.AOS_standard=true;QCRM.AOS_show_image=!QCRM.OffLine;QCRM.AOS_groups=(aos_params&&aos_params.lineItems)?aos_params.lineItems.enableGroups:false;QCRM.AOSModValues=["total_amt","discount_amount","subtotal_amount","shipping_amount","shipping_tax_amt","shipping_tax","tax_amount","total_amount"];QCRM.AOSGroupValues=["name","id","deleted","total_amt","discount_amount","subtotal_amount","tax_amount","total_amount","group_number"];QCRM.AOSProdValues=["name","id","description","part_number","deleted","item_description","product_qty","product_cost_price","product_list_price","product_discount","product_discount_amount","discount","product_unit_price","vat_amt","product_total_price","vat","product_id","group_number"];QCRM.AOSServValues=["name","id","deleted","product_list_price","product_discount","product_discount_amount","discount","product_unit_price","vat_amt","product_total_price","vat","product_id","group_number"];QCRM.AOS_prodln=0;QCRM.AOS_servln=0;QCRM.AOS_groupn=0;QCRM.AOS_group_ids={};QCRM.CurrentModule="";QCRM.AOS_totaltax=(aos_params&&aos_params.lineItems)?aos_params.lineItems.totalTax:false;Beans.AOS_Products=new SugarBean("AOS_Products","aos_products","basic");Beans.AOS_Products.SyncDefaults={sync:"All",max:false};Beans.AOS_Products.ListFields=["name","product_list_price"];Beans.AOS_Products.EditExcluded.push("product_image");QCRM.Custom_AOS_Products_product_image=function(d,a){var b=ServerAddress+d.substring(d.indexOf("/upload/"));if(QCRM.AOS_show_image){return'<img class="productimage" src="'+b+'">'}return""};if(aos_installed>"5.3"){QCRM.SetSearchNameFields("AOS_Products",["name","part_number"]);Beans.AOS_Products.ListFields.push("part_number");Beans.AOS_Products.TitleTpl="{[part_number]} {name}"}Beans.AOS_Product_Categories=new SugarBean("AOS_Product_Categories","aos_product_categories","basic");Beans.AOS_Product_Categories.SyncDefaults={sync:"All",max:false};Beans.AOS_Product_Categories.HomeIcon=false;Beans.AOS_Product_Categories.ListFields=["name"];Beans.AOS_Line_Item_Groups=new SugarBean("AOS_Line_Item_Groups","aos_line_item_groups","basic");Beans.AOS_Line_Item_Groups.HomeIcon=false;Beans.AOS_Line_Item_Groups.ShowTab=false;Beans.AOS_Line_Item_Groups.ListFields=["name","total_amt","discount_amount","subtotal_amount","tax_amount","subtotal_tax_amount","total_amount","parent_type","parent_id"];Beans.AOS_Line_Item_Groups.SyncOptions={sync:"Rel",max:false};Beans.AOS_Line_Item_Groups.DisplaySubpanelElt=function(a){if(!QCRM.AOS_groups||!a){return""}return'<p style="text-align:right;font-weight:bold;">'+sugarLabel(QCRM.CurrentModule,"LBL_SUBTOTAL_AMOUNT")+": "+formatCurrency(a.subtotal_amount.value)+"<br>"+sugarLabel(QCRM.CurrentModule,"LBL_GROUP_TOTAL")+": "+formatCurrency(a.total_amount.value)+"</p>"};function findInsertBefore(b){var a=Beans[b].AdditionalFields;if(a){Beans[b].LinesBefore="";for(var e in a){var d=a[e];if(d==="subtotal_amount"||d==="total_amount"||d==="total_amt"){Beans[b].LinesBefore=d;break}}}}function AOSViewDetailsHook(a,d,b){Beans[a].CurrentCustomData.groups={}}function AOSViewDetailsFtrHook(b,p,u,A){var e=Beans[b],n,z,v,g,m,o,q="",w="",r="",d="",a="",h={},s,l;QCRM.CurrentModule=b;if(Q_API<"3.0"){if(e.CurrentCustomData.line_items.length>0&&sugar_mod_fields.AOS_Products_Quotes){n=$("<li/>");z=$("<div/>");for(var s=0;s<e.CurrentCustomData.line_items.length;s++){g=e.CurrentCustomData.line_items[s];z.append('<div class="ui-grid-b">'+Beans.AOS_Products_Quotes.DisplaySubpanelElt(g)+"</div>")}n.append(z);if(Beans[b].LinesBefore!==""){n.insertBefore("#"+b+Beans[b].LinesBefore+"V")}else{$(A).append(n)}}}else{$(".itemMain").remove();if(QCRM.OffLine){}if(QCRM.AOS_groups&&u.groups&&u.groups.length>0){for(s=0;s<u.groups.length;s++){var m=u.groups[s];if(QCRM.OffLine){m=Record2NVL(m)}if(m.id){h[m.id.value]=m}}}if(u.lineitems&&u.lineitems.length>0){n=$('<li class="itemTableLi" />');z=$("<div/>");for(s=0;s<u.lineitems.length;s++){g=u.lineitems[s];if(QCRM.OffLine){g=Record2NVL(g)}o=g.group_id.value;if(QCRM.AOS_groups&&o&&(q!=o||s==0)){if(s!=0){z.append(d+a+r)}m=h[o];d="";a="";if(m&&m.name.value!=""){z.append('<p style="font-weight:bold;">'+sugarLabel(b,"LBL_GROUP_NAME")+": "+m.name.value+"</p>")}q=o}r=Beans.AOS_Line_Item_Groups.DisplaySubpanelElt(m);l='<div class="ui-grid-b">'+Beans.AOS_Products_Quotes.DisplaySubpanelElt(g)+"</div>";if(g.product_id.value=="0"){a+=l}else{d+=l}}z.append(d+a+r);n.append(z);if(Beans[b].LinesBefore!==""){n.insertBefore("#"+b+Beans[b].LinesBefore+"V")}else{$(A).append(n)}}}}function AOSget_entry(b,g,e){var d=Beans[b],a='[{"name":"aos_products_quotes","value":["'+Beans.AOS_Products_Quotes.ListFields.join('","')+'"]}]';if(QCRM.OffLine){}else{if(Q_API>="3.0"){SugarQuery("AOSget_entry",'{"session":"'+SugarSessionId+'","module_name":"'+b+'","id":"'+g+'","select_fields":"","link_name_to_fields_array":""}',e,null)}else{QCRM.get_entry_list(b,d.table+".id='"+d.CurrentId+"'",'""',a,0,1,"",function(n){var l,h,o=[];try{if(n&&n.relationship_list[0].link_list[0]){l=n.relationship_list[0].link_list[0].records;h=l.length;for(var m=0;m<h;m++){o[m]=l[m].link_value}}}catch(p){}d.CurrentCustomData.line_items=o;e(n)})}}}function AOSset_entry(a,e,b,d){if(e===""){if(b.assigned_user_id===undefined||b.assigned_user_id.value===""){b.assigned_user_id={name:"assigned_user_id",value:CurrentUserId}}}else{if(b.id===undefined||b.id.value!==e){b.id={name:"id",value:e}}}if(QCRM.OffLine||Q_API<"3.0"){QCRM.webdb.set_entry(a,e,b,d)}else{SugarQuery("AOSset_entry",JSON.stringify({session:SugarSessionId,module_name:a,name_value_list:b},null,2),d,null)}}function AOSCheckForm(e){var g="",d;if(!QCRM.OffLine&&Q_API>="3.0"){for(d=0;d<QCRM.AOS_prodln;d++){var b="product_product_id"+d.toString(),a="product_deleted"+d.toString();if(document.getElementById(a).value!="1"&&document.getElementById(b).value==""){g+="<br>"+sugarLabel(e,"LBL_PRODUCT_NAME")+": "+RES_REQUIRED_MSG}}}return g}function AOSCustomValues(b,u,a){var o={},s="",r={},m,l,p;if(a){if(CurrentRecordValues.module==="Accounts"&&Beans.Accounts.CurrentId!==""){s=Beans.Accounts.CurrentId}else{if(CurrentRecordValues.module==="Contacts"&&Beans.Contacts.CurrentId!==""&&CurrentRecordValues.account_id!==undefined&&CurrentRecordValues.account_id.value!==""){s=CurrentRecordValues.account_id.value}}if(s!==""){o.billing_account_id={name:"billing_account_id",value:s}}if(CurrentRecordValues.module==="Contacts"&&Beans.Contacts.CurrentId!==""){o.billing_contact_id={name:"billing_contact_id",value:Beans.Contacts.CurrentId}}}if(!QCRM.OffLine&&Q_API>="3.0"){var g={},e={};for(m in QCRM.AOSModValues){p=QCRM.AOSModValues[m];o[p]={name:p,value:get_value(p)}}if(QCRM.AOS_groups){for(m=0;m<QCRM.AOS_groupn;m++){for(l in QCRM.AOSGroupValues){var q="group_"+QCRM.AOSGroupValues[l],h=document.getElementById("group"+m.toString()+QCRM.AOSGroupValues[l]),d=h.value||"",n=unformat2Number(d);if(format2Number(n)===d){d=n}if(g[q]===undefined){g[q]=[]}g[q].push(d)}}}for(m=0;m<QCRM.AOS_prodln;m++){for(l in QCRM.AOSProdValues){var q="product_"+QCRM.AOSProdValues[l],h=document.getElementById(q+m.toString()),d=h.value||"",n=unformat2Number(d);if(QCRM.AOSProdValues[l]!=="vat"&&QCRM.AOSProdValues[l]!=="group_number"&&(QCRM.AOSProdValues[l]==="product_discount_amount"||format2Number(n)===d)){d=n}if(g[q]===undefined){g[q]=[]}g[q].push(d)}}for(m=0;m<QCRM.AOS_servln;m++){for(l in QCRM.AOSServValues){var q="service_"+QCRM.AOSServValues[l],h=document.getElementById(q+m.toString()),d=h.value||"",n=unformat2Number(d);if(QCRM.AOSServValues[l]!=="vat"&&QCRM.AOSServValues[l]!=="group_number"&&(QCRM.AOSServValues[l]==="product_discount_amount"||format2Number(n)===d)){d=n}if(g[q]===undefined){g[q]=[]}g[q].push(d)}}o.lineitems={name:"lineitems",value:g}}else{if(QCRM.OffLine&&Q_API>="3.0"){}}return o}function AOSInitEditForm(a){Beans[a].LineItemsDiv="#Edit"+a+"Ftr"}function AOSInitEdit(b,o){QCRM.AOS_prodln=0;QCRM.AOS_servln=0;QCRM.AOS_groupn=0;QCRM.AOS_group_ids={};QCRM.CurrentModule=b;$(".LineItems").remove();var d,a={},e="<table width='100%' border='0' style='vertical-align:top;' class='LineItems' cellspacing='4' id='lineItems'></table>";if(QCRM.AOS_groups){e+="<div style='padding-top: 10px; padding-bottom:10px;'>";e+='<input type="button" tabindex="116" class="button" value="'+sugar_mod_strings[b]["LBL_ADD_GROUP"]+'" id="addGroup" onclick="insertGroup(0)" >';e+="</div>"}e+='<input type="hidden" name="vathidden" id="vathidden" value=\''+get_select_options(sugar_app_list_strings.vat_list,"",false)+"'>";e+='<input type="hidden" name="discounthidden" id="discounthidden" value=\''+get_select_options(sugar_app_list_strings.discount_list,"",false)+"'>";$(Beans[b].LineItemsDiv).html(e);if(!QCRM.AOS_groups){insertGroup()}for(d in QCRM.AOSModValues){var h=QCRM.AOSModValues[d];if(h!=="shipping_tax"){$(Beans[b].LineItemsDiv).append(create_text_form(h,display_label(b,h),false,false,true))}if(h==="shipping_tax_amt"){}}$("#shipping_amount").blur(function(){calculateTotal("lineItems")});$("#shipping_tax_amt").after("<select name='shipping_tax' data-mini='true' data-inline='true' id='shipping_tax' onchange='calculateTotal(\"lineItems\");' >"+get_select_options(sugar_app_list_strings.vat_list,"",false)+"</select>");$(Beans[b].LineItemsDiv).trigger("create");if(QCRM.OffLine){}if(o.groups&&o.groups.length>0){for(d=0;d<o.groups.length;d++){var m=o.groups[d],g="0";if(!QCRM.OffLine){m=NVL2Record(m)}a[m.id]=m;if(m.deleted=="1"){e="<input type='hidden' id='group"+d.toString()+"deleted' value='1'><input type='hidden' id='group"+d.toString()+"id' value='"+m.id+"'><input type='hidden' id='group"+d.toString+"group_number' value='"+d.toString()+"'>";if(m.new_with_id){e+="<input type='hidden' id='group"+d.toString()+"new_with_id' value='"+m.new_with_id+"'>"}$(Beans[b].LineItemsDiv).append(e)}}}if(o.lineitems&&o.lineitems.length>0){for(d=0;d<o.lineitems.length;d++){var n=o.lineitems[d];if(!QCRM.OffLine){n=NVL2Record(n)}var m="",l;if(n.group_id!=""){m=a[n.group_id]}insertLineItems(n,m)}}}function AOSSetup(a){QCRM.AddToListFields(a,QCRM.AOSModValues);QCRM.SetFieldHook(a,"billing_contact","initial_filter",function(b){var d=QCRM.toDBField(a,"billing_account",b);if(d&&d!==""){return"account_name LIKE '"+d.replace(/'/g,"''")+"'"}return""});QCRM.SetFieldHook(a,"billing_account","copyfields",[{copy:"shipping",from:"shipping"},{copy:"billing",from:"billing"}])}Beans.AOS_Quotes=new SugarBean("AOS_Quotes","aos_quotes","basic");Beans.AOS_Quotes.ListFields=["name","number","total_amount","billing_account"];Beans.AOS_Quotes.OLExtraFields=["lineitems","groups"];Beans.AOS_Quotes.EditExcluded=["created_by_name","modified_by_name","number"].concat(QCRM.AOSModValues);QCRM.AOS_QuotesSetup=function(){AOSSetup("AOS_Quotes")};Beans.AOS_Quotes.ListViewTpl="<h4>{number} - {name}</h4><p>{total_amount}&nbsp;{billing_account}</p>";Beans.AOS_Quotes.Links.aos_products_quotes={module:"AOS_Products_Quotes",create:false,select:false};Beans.AOS_Quotes.SearchFields=["number"];Beans.AOS_Quotes.OrderBy="number";Beans.AOS_Quotes.CurrentCustomData={};Beans.AOS_Quotes.default_group_id="";QCRM.SetModuleHook("AOS_Quotes","check_edit",function(a){return Q_API>="3.0"});Beans.AOS_Quotes.get_entry=function(b,a){AOSget_entry("AOS_Quotes",b,a)};if(Q_API>="3.0"){Beans.AOS_Quotes.set_entry=function(d,a,b){AOSset_entry(this.name,d,a,b)};Beans.AOS_Quotes.EditHook=function(a,d,b){AOSInitEdit("AOS_Quotes",b)};Beans.AOS_Quotes.CustomCheck=function(a){return AOSCheckForm("AOS_Quotes")};Beans.AOS_Quotes.CreateBtnHook=function(){this.CurrentCustomData={}};Beans.AOS_Quotes.CustomValues=function(b,a){return AOSCustomValues("AOS_Quotes",b,a)};QCRM.SetModuleHook("AOS_Quotes","init_edit",function(){AOSInitEditForm("AOS_Quotes")})}Beans.Accounts.Links.aos_quotes={module:"AOS_Quotes",create:true,select:false};Beans.Contacts.Links.aos_quotes={module:"AOS_Quotes",create:true,select:false};Beans.AOS_Invoices=new SugarBean("AOS_Invoices","aos_invoices","basic");Beans.AOS_Invoices.ListFields=["name","number","total_amount","billing_account"];Beans.AOS_Quotes.OLExtraFields=["lineitems","groups"];Beans.AOS_Invoices.EditExcluded=["created_by_name","modified_by_name","number"].concat(QCRM.AOSModValues);Beans.AOS_Invoices.ListViewTpl="<h4>{number} - {name}</h4><p>{total_amount}&nbsp;{billing_account}</p>";Beans.AOS_Invoices.OrderBy="number";QCRM.AOS_InvoicesSetup=function(){AOSSetup("AOS_Invoices")};Beans.AOS_Invoices.Links.aos_products_quotes={module:"AOS_Products_Quotes",create:false,select:false};Beans.AOS_Invoices.SearchFields=["number"];Beans.AOS_Invoices.default_group_id="";Beans.AOS_Invoices.CurrentCustomData={};QCRM.SetModuleHook("AOS_Invoices","check_edit",function(a){return Q_API>="3.0"});Beans.Accounts.Links.aos_invoices={module:"AOS_Invoices",create:true,select:false};Beans.Contacts.Links.aos_invoices={module:"AOS_Invoices",create:true,select:false};Beans.AOS_Invoices.CreateBtnHook=function(){this.CurrentCustomData={}};Beans.AOS_Invoices.get_entry=function(b,a){AOSget_entry("AOS_Invoices",b,a)};if(Q_API>="3.0"){Beans.AOS_Invoices.set_entry=function(d,a,b){AOSset_entry(this.name,d,a,b)};Beans.AOS_Invoices.CustomValues=function(b,a){return AOSCustomValues("AOS_Invoices",b,a)};Beans.AOS_Invoices.EditHook=function(a,d,b){AOSInitEdit("AOS_Invoices",b)};QCRM.SetModuleHook("AOS_Invoices","init_edit",function(){AOSInitEditForm("AOS_Invoices")});Beans.AOS_Invoices.CustomCheck=function(a){return AOSCheckForm("AOS_Invoices")}}function pickProduct(d,e,a,m){var l=Beans.AOS_Products,b="#",h=$(b+d),n=h.val(),g=$(b+d+"L");$(b+e).val("");if(n.length<1){g.hide();g.html("");g.listview("refresh")}else{QCRM.get_entry_list("AOS_Products",matchName(l,"default",n.replace("'","''")),l.ListFieldsToSelect(),"",0,10,l.OrderBy,function(r){var p=r.entry_list,o=p.length;g.html("");if(o>0){g.show()}else{g.hide()}for(var q=0;q<o;q++){var v=$('<li data-icon="false"/>'),s=$("<a/>",{href:"#"}),u=l.DisplayTitle(p[q].name_value_list);s.click({nvl:p[q].name_value_list,name:u},function(z){var w=z.data.nvl,A=w.id.value;$(b+e).val(A);$.each(a,function(B,D){var C=$(b+D.name);if(C&&w[D.copy]){C.val(HTMLDecode(w[D.copy].value))}});h.val(HTMLDecode(w.name.value));g.hide();g.html("");g.listview("refresh");if(m!==undefined){m(A)}});s.append('<span style="font-size: smaller;">'+u+"</span>");v.append(s);g.append(v)}g.listview("refresh")})}}Beans.AOS_Products_Quotes=new SugarBean("AOS_Products_Quotes","aos_products_quotes","basic");Beans.AOS_Products_Quotes.ShowTab=false;Beans.AOS_Products_Quotes.HomeIcon=false;Beans.AOS_Products_Quotes.LastViewed=false;Beans.AOS_Products_Quotes.SyncOptions={sync:"Rel",max:false};Beans.AOS_Products_Quotes.ListFields=["name","number","parent_name","product_id","product_qty","product_unit_price","product_discount","product_discount_amount","vat_amt","product_total_price","parent_type","parent_id","product_image_c"];Beans.AOS_Products_Quotes.OrderBy="number";Beans.AOS_Products_Quotes.DefaultParent={name:"parent_name",id_name:"parent_id",module:"parent_type"};QCRM.SetAppHook("after_login",function(){if(typeof QCRM.AOS==="function"){return}Beans.AOS_Products_Quotes.AddBtn=false;if(sugar_mod_fields.AOS_Products_Quotes){try{sugar_mod_fields.AOS_Products_Quotes.name.type="varchar";sugar_mod_fields.AOS_Products_Quotes.name.copyfields=[{copy:"product_list_price",from:"price"}];sugar_mod_fields.AOS_Products_Quotes.product_list_price.readonly=true;sugar_mod_fields.AOS_Products_Quotes.vat_amt.readonly=true;sugar_mod_fields.AOS_Products_Quotes.product_total_price.readonly=true;sugar_mod_fields.AOS_Products_Quotes.product_discount_amount.readonly=true}catch(a){}}if(aos_installed>"5.2"){if(sugar_mod_fields.AOS_Products_Quotes){sugar_mod_fields.AOS_Products_Quotes.name.copyfields.push({copy:"part_number",from:"part_number"})}Beans.AOS_Products_Quotes.ListFields.push("part_number");Beans.AOS_Products.ListFields.push("part_number")}updatePreferences(false);if(sugar_mod_strings.AOS_Product_Categories!==undefined){sugar_mod_strings.AOS_Product_Categories.LBL_AOS_PRODUCT_CATEGORIES_AOS_PRODUCTS_FROM_AOS_PRODUCTS_TITLE=sugar_app_list_strings.moduleList.AOS_Products}Beans.AOS_Quotes.Links.aos_products_quotes.display=function(b){};Beans.AOS_Invoices.Links.aos_products_quotes.display=function(b){};Beans.AOS_Quotes.ViewDetailsHook=function(b){AOSViewDetailsHook(this.name,this.CurrentId,b)};Beans.AOS_Quotes.ViewDetailsFtrHook=function(d,b){AOSViewDetailsFtrHook(this.name,this.CurrentId,d,b)};Beans.AOS_Invoices.ViewDetailsHook=function(b){AOSViewDetailsHook(this.name,this.CurrentId,b)};Beans.AOS_Invoices.ViewDetailsFtrHook=function(d,b){AOSViewDetailsFtrHook(this.name,this.CurrentId,d,b)};Beans.AOS_Products_Quotes.Templates={product:{name:"{name}{[part_number]}",details:"{product_qty} * {product_unit_price}",total:"{product_total_price}"},service:{name:"{name}",details:"",total:"{product_total_price}"}};Beans.AOS_Products_Quotes.DisplaySubpanelElt=function(b){var g="",d=(b.product_id.value==="0"||b.product_id.value===undefined||b.product_id.value==="")?"service":"product",e=Beans.AOS_Products_Quotes.Templates[d];if(d=="product"){if(QCRM.AOS_show_image&&b.product_image_c&&b.product_image_c.value!==""){g=b.product_image_c.value;g=ServerAddress+g.substring(g.indexOf("/upload/"));g='<p><img class="productimage" src="'+g+'"></p>'}return getFromTemplate(this.name,b,'<div class="ui-block-a" style="width:45%;"><p style="white-space:normal;font-weight:bold;">'+e.name+"</p>"+g+'</div><div class="ui-block-b" style="width:30%;text-align:right;"><p style="white-space:normal;">'+e.details+'</p></div><div class="ui-block-c" style="width:25%;text-align:right;"><p>'+e.total+"</p></div>")}else{return getFromTemplate(this.name,b,'<div class="ui-block-a" style="width:75%;"><p style="white-space:normal;font-weight:bold;">'+e.name+'</p></div><div class="ui-block-b" style="width:2%;"></div><div class="ui-block-c" style="width:23%;text-align:right;"><p>&nbsp;'+e.total+"</p></div>")}};findInsertBefore("AOS_Quotes");findInsertBefore("AOS_Invoices")})}}Beans.AOR_Reports=new SugarBean("AOR_Reports","aor_reports","basic");Beans.AOR_Reports.fullPage=true;QCRM.AOR_ReportsSetup=function(){Beans.AOR_Reports.Favorites=true;Pref.SyncModules.AOR_Reports={preset:true,sync:"None",max:false};if(QCRM.OffLine||Q_API<"2.8"){return}QCRM.SetModuleHook("AOR_Reports","init_view",function(){$("#AOR_ReportsDetailsList").append("<li>"+getNavButtons("AOR_ReportsDetailsList")+"</li>")});Beans.AOR_Reports.acl.edit=false;Beans.AOR_Reports.acl.del=false;Beans.AOR_Reports.ViewDetails=function(){var e=this,g=this.CurrentId,a=RowsPerPage,d=$("#AOR_ReportsDetailsHdr");function b(l){var h="AOR_ReportsDetailsList";$("#"+h+" li:gt(0)").remove();enableButton(h+"L",l>0);SugarQuery("get_report",'{"session":"'+SugarSessionId+'","id":"'+g+'", "offset":"'+l+'","max_results":"'+a.toString()+'","language":"'+getSugarLanguage(sugar_languages,default_language)+'"}',function(z){var w=0,n=$("#"+h),A=0,q=0,B=l+a;if(z&&z.entry_list){var s,r,o,v='<table data-role="table" data-mode="reflow" data-link="zoom" id="AOR_reportTable" class="ui-responsive table-stroke reportTable" style="width:100%;">',u=z.entry_list.header,C=z.entry_list.values,p=z.entry_list.values.length,D=z.entry_list.total;w=z.entry_list.count;$("#AOR_ReportsNameH1").html(z.entry_list.name);showFavoriteStatus("AOR_Reports",g,z.entry_list.name);if(e.LastViewed){PushViewed(e.name,e.CurrentId,z.entry_list.name)}$("#"+h+"T").html(w===0?"-":((l+1).toString()+"-"+(B>w?w:B).toString()+"/&shy;"+w.toString()));v+="<thead><tr>";for(s=0;s<u.length;s++){v+='<th class="reportCell" style="background-color: #c5c5c5;" align="left">'+u[s]+"</th>"}v+="</tr></thead><tbody>";for(s=0;s<p;s++){var m="";if(D){if(s==p-2){m=" class='report_totals_hdr'"}else{if(s==p-1){m=" class='report_totals_val'"}}}v+="<tr"+m+">";for(r=0;r<C[s].length;r++){v+="<td  class='reportCell'>";o=C[s][r];if(typeof o==="object"){o=o[0]}v+=o;v+="</td>"}v+="</tr>"}v+="</tbody></table>";n.append('<li data-theme="d" style="padding: 0 !important">'+v+"</li>");if($("#AOR_reportTable").width()>$("AOR_ReportsNameH1").width()){$("#AOR_reportTable").table().trigger("create")}q=l-20;enableButton(h+"L",q>=0);if(q<0){q=0}A=l+20;enableButton(h+"R",A<w);if(A>w){A=l}}else{$("#"+h+"T").empty()}n.listview("refresh");$("#"+h+"L").unbind("click");$("#"+h+"R").unbind("click");$("#"+h+"L").click({offset:q},function(E){b(E.data.offset)});$("#"+h+"R").click({offset:A},function(E){b(E.data.offset)})})}d.html("");SugarQuery("get_chart",'{"session":"'+SugarSessionId+'","id":"'+g+'", "chart_id":"", "width":"700","height":"700","language":"'+getSugarLanguage(sugar_languages,default_language)+'"}',function(m){var h,l="100";if(m&&m.entry_list&&m.entry_list.charts){if(m.entry_list.charts.length>1&&QCRM.mode==="tablet"){l="45"}for(h=0;h<m.entry_list.charts.length;h++){d.append(m.entry_list.charts[h].chart.replace("<img ",'<img width="'+l+'%" '))}d.show()}});b(0)}};Beans.KReports=new SugarBean("KReports","kreports","basic");Beans.KReports.fullPage=true;QCRM.KReportsSetup=function(){Beans.KReports.Favorites=true;Pref.SyncModules.KReports={preset:true,sync:"None",max:false};if(QCRM.OffLine||Q_API<"2.8"){return}QCRM.SetModuleHook("KReports","init_view",function(){var b="KReportsDetailsList",a=Beans.KReports;$("#"+b).append("<li>"+getNavButtons(b)+"</li>")});Beans.KReports.acl.edit=false;Beans.KReports.acl.del=false;Beans.KReports.CheckEdit=function(a){return false};Beans.KReports.ViewDetails=function(){var b=this,d=this.CurrentId;function a(h){var g="KReportsDetailsList",e=RowsPerPage;$("#"+g+" li:gt(0)").remove();enableButton(g+"L",h>0);SugarQuery("get_Kreport",'{"session":"'+SugarSessionId+'","id":"'+d+'", "offset":"'+h+'","max_results":"'+e.toString()+'","language":"'+getSugarLanguage(sugar_languages,default_language)+'"}',function(D){var o=0,E=0,q=$("#"+g),u=0,C=0,z=h+e;if(D&&D.entry_list){var B,w,p='<table data-role="table" data-mode="reflow" data-link="zoom" id="KreportTable" class="ui-responsive table-stroke reportTable" style="width:100%;">',A=D.entry_list.header,l=D.entry_list.values.records;o=parseInt(D.entry_list.values.count,10);$("#KReportsNameH1").html(D.entry_list.name);showFavoriteStatus("KReports",d,D.entry_list.name);if(b.LastViewed){PushViewed(b.name,b.CurrentId,D.entry_list.name)}$("#"+g+"T").html(o===0?"-":((h+1).toString()+"-"+(z>o?o:z).toString()+"/&shy;"+o.toString()));p+="<thead><tr>";for(B=0;B<A.length;B++){if(!A[B].hidden){if(typeof A[B].width==="number"){A[B].width=A[B].width.toString()}p+="<th class='reportCell' style='background-color: #c5c5c5;' align="+A[B].align+" width='"+A[B].width+"'>"+A[B].text.substring(1,A[B].text.length-1)+"</th>";A[B].renderer=A[B].renderer.substring(1,A[B].renderer.length-1);E+=parseInt(A[B].width,10)}}p+="</tr></thead><tbody>";for(B=0;B<l.length;B++){var n=l[B];p+="<tr>";for(w=0;w<A.length;w++){var m=A[w],F,v=m.dataIndex.substring(1,m.dataIndex.length-1),r=m.renderer;if(!m.hidden){F=n[v];p+="<td class='reportCell' align="+m.align+" width='"+m.width+"'>";if(F!==""&&F!==null){switch(m.renderer){case"kdateRenderer":F=jQuery.mobiscroll.formatDate(date_format,fromDBDate(F))+"&shy;";break;case"kdatetimeRenderer":F=jQuery.mobiscroll.formatDate(datetime_format,fromDBDateTime(F,false))+"&shy;";break;case"kcurrencyRenderer":var s=default_currency_symbol;F=parseFloat(F).formatCurrency(currency_digits,decimal_separator,number_separator,default_currency_symbol);break;case"knumberRenderer":F=parseFloat(F).formatNumber(2,decimal_separator,number_separator);break;default:F+="&shy;";break}p+=F}p+="</td>"}}p+="</tr>"}p+="</tbody></table>";q.append('<li data-theme="d" style="padding: 0 !important">'+p+"</li>");if($("#KreportTable").width()>$("#KReportsNameH1").width()){$("#KreportTable").table().trigger("create")}C=h-20;enableButton(g+"L",C>=0);if(C<0){C=0}u=h+20;enableButton(g+"R",u<o);if(u>o){u=h}}else{$("#"+g+"T").empty()}q.listview("refresh");$("#"+g+"L").unbind("click");$("#"+g+"R").unbind("click");$("#"+g+"L").click({offset:C},function(G){a(G.data.offset)});$("#"+g+"R").click({offset:u},function(G){a(G.data.offset)})})}a(0)}};Beans.asol_Reports=new SugarBean("asol_Reports","asol_reports","basic");Beans.asol_Reports.fullPage=true;QCRM.asol_ReportsSetup=function(){var a,b="",d=[];Beans.asol_Reports.Favorites=true;Beans.asol_Reports.LimitWhere="(report_charts_engine='nvd3' OR report_charts = 'Tabl')";if(!UserIsAdmin){b="report_scope = 'public' OR @table.assigned_user_id = '"+CurrentUserId+"' OR @table.created_by = '"+CurrentUserId+"'";if(CurrentUserRoleIds!=""&&CurrentUserRoleIds.length>0){for(a=0;a<CurrentUserRoleIds.length;a++){d.push("report_scope LIKE '%"+CurrentUserRoleIds[a]+"%'")}b+=" OR "+d.join(" OR ")}Beans.asol_Reports.LimitWhere="("+Beans.asol_Reports.LimitWhere+" AND ("+b+"))"}Pref.SyncModules.asol_Reports={preset:true,sync:"None",max:false};if(QCRM.OffLine||Q_API<"2.9"){return}$("#asol_ReportsDP").on("pagehide",function(){d3Reports.selectAll("svg").remove();nvReports.charts={};nvReports.graphs=[];nvReports.logs={};window.onresize=null;$("#asol_ReportsDetailsFtr").empty()});QCRM.SetModuleHook("asol_Reports","init_view",function(){$("#asol_ReportsDetailsList").append("<li>"+getNavButtons("asol_ReportsDetailsList")+"</li>")});Beans.asol_Reports.acl.edit=false;Beans.asol_Reports.acl.del=false;Beans.asol_Reports.getReport=function(e,g){QCRM.CustomRest("custom/QuickCRM/restasol.php","post","text",{method:"executeAlineaSolReport",input_type:"JSON",response_type:"TEXT",rest_data:JSON.stringify(e)},g)};window.SUGAR={util:{doWhen:function(e,g){g()}}};Beans.asol_Reports.ViewDetails=function(){var h=this,l=this.CurrentId,e=RowsPerPage;function g(o){var n="asol_ReportsDetailsList",m={session:SugarSessionId,reportId:l,vardefFilters:true,sortField:"",sortDirection:"",sortIndex:"",pageNumber:o.toString(),isDashlet:false,dashletId:"",getLibraries:false,overrideEntries:"20",externalFilters:"",currentUserId:CurrentUserId,currentLanguage:getSugarLanguage(sugar_languages,default_language),contextDomainId:""};$("#"+n+" li:gt(0)").remove();enableButton(n+"L",o>0);Beans.asol_Reports.getReport(m,function(A){if(!A){$.mobile.loading("hide");return}var z=0,r=A.indexOf('"asolReportsHeadersRow"')>=0,w=A.indexOf('"pagination"')>=0,D="&nbsp;",q=$("#"+n),B=0,v=0,C=o+e,p,s=A.replace(/(\r\n|\n|\r)/gm,"").replace('id="resultTable"','id="resultTable" data-link="zoom" data-role="table"').replace(/.+id..internalHtmlReport/,'<div id="internalHtmlReport');if(!mobile_app){s=s.replace(/modules\/asol_Reports/g,"../modules/asol_Reports")}s=s.replace(/div#detailContainer/g,"#asol_ReportsDetailsFtr");jQuery.blockUI=true;if(w){q.show()}else{q.hide()}$("#asol_ReportsDetailsFtr").hide();try{$("#asol_ReportsDetailsFtr").html(s)}catch(u){$("#asol_ReportsDetailsFtr").html("This report type is not supported");return}p=$("#asol_ReportsDP").find(".moduleTitle h2").html();if(!p){p=$("#moduleTitle h2").html()}$("#asol_ReportsNameH1").html(p);$(".pageNumbers").each(function(F,E){D=$(this).html()});$("#"+n+"T").html(D);showFavoriteStatus("asol_Reports",l,p);if(h.LastViewed){PushViewed(h.name,h.CurrentId,p)}$("#asol_ReportsDetailsFtr button").remove();$("#resultDiv_collapseImg").remove();$("#resultDivWrapper h4").remove();$("#resultDivWrapper .listViewThLinkS1").prop("onclick",null).off("click");$("#asolReportExportDiv").remove();$("#display_form").remove();$("#export_form").remove();if(r){$("#resultTable").addClass("ui-responsive table-stroke reportTable")}$("#resultTable img").remove();$("#moduleTitle").hide();$("#asol_ReportsDP").find(".moduleTitle").hide();$(".asolChartContainer").css("width","100%");$(".asolChartContainer").css("height","auto");$(".asolChartContainer").css("min-height","450px");$("#asol_ReportsDetailsFtr svg").css("width","100%");$("#asol_ReportsDetailsFtr svg").css("height","auto");$("#asol_ReportsDetailsFtr svg").css("min-height","450px");if(r&&$("#asol_ReportsTable").width()>$("#asol_ReportsNameH1").width()){$("#asol_ReportsTable").table().trigger("create")}$("#asol_ReportsDetailsFtr").show();$.mobile.loading("hide");z=$("#reportTable tr").length;if(z===1&&o>0){g(o-1);return}$("#asol_ReportsDetailsFtr .pagination").remove();v=o-1;enableButton(n+"L",v>=0);if(v<0){v=0}B=o+1;enableButton(n+"R",w);$("#"+n+"L").unbind("click");$("#"+n+"R").unbind("click");$("#"+n+"L").click({offset:v},function(E){g(E.data.offset)});$("#"+n+"R").click({offset:B},function(E){g(E.data.offset)})})}$.mobile.loading("show");g(0);for(a in h.hooks.after_display){h.hooks.after_display[a](CurrentRecordValues,$(JQList),rel)}}};QCRM.SugarFeedSetup=function(){var a=Beans.SugarFeed;a.acl.edit=false;a.acl.del=false;Pref.SyncModules.SugarFeed={preset:true,sync:"None",max:false};QCRM.AddToListFields("SugarFeed",["related_module","related_id","created_by_name","date_entered"]);a.DisplayTitle=function(h){var g=/{SugarFeed(.*?)}/g,d=/\[(.*?)\]/g,l,m,b,e=h.name.value,q=sugar_app_list_strings.moduleListSingular[h.related_module.value]||h.related_module.value;m=e.match(g);b=e.match(d);for(l in m){var n=m[l].substring(11,m[l].length-1);e=e.replace(m[l],sugar_mod_strings.SugarFeed[n].replace("{0}",q))}for(l in b){var p=b[l].substring(1,b[l].length-1).split(":"),o=(Beans[p[0]]&&Beans[p[0]].Enabled())?('<a class="QCRMActLinks" data-link="bean" data-module="'+p[0]+'" data-identity="'+p[1]+'">'+p[2]+"</a>"):p[2];e=e.replace(b[l],o)}e=e+"<br>"+jQuery.mobiscroll.formatDate(datetime_format,fromDBDateTime(h.date_entered.value));return'<span style="white-space:normal">'+e.replace("{this.CREATED_BY}",h.created_by_name.value).replace(/&lt;/g,"<").replace(/&gt;/g,">")+"</span>"};a.DisplaySubpanelElt=a.DisplayTitle};function insertLineItems(l,n){var d="product_";var h=0;var a="lineItems";var b=l.group_id;if(typeof QCRM.AOS_group_ids[b]==="undefined"){a=insertGroup();QCRM.AOS_group_ids[b]=a;for(var e in n){if(document.getElementById("group"+a+e)!==null){document.getElementById("group"+a+e).value=n[e]}}}else{a=QCRM.AOS_group_ids[b]}if(l.product_id!="0"&&l.product_id!==""){h=insertProductLine("product_group"+a,a);d="product_"}else{h=insertServiceLine("service_group"+a,a);d="service_"}for(var m in l){if(document.getElementById(d+m+h)!==null){if(l[m]!==""&&isNumeric(l[m])&&m!="vat"&&m!="group_number"&&m!="product_id"&&m!="name"&&m!="part_number"){document.getElementById(d+m+h).value=format2Number(l[m])}else{document.getElementById(d+m+h).value=l[m]}}}calculateLine(h,d)}function insertProductLine(h,l){if(!QCRM.AOS_groups){h="product_group0"}if(document.getElementById(h+"_head")!==null){document.getElementById(h+"_head").style.display=""}var r=document.getElementById("vathidden").value;var z=document.getElementById("discounthidden").value;colWidth=["7%","35%","17%","10%","7%","7%","8%","9%"];var A=document.getElementById(h+"_body");var w=A.insertRow(-1);w.id="product_line"+QCRM.AOS_prodln;w.className="itemLine";var v=w.insertCell(0);v.width=colWidth[0];v.className="Pcol0";v.innerHTML="<input type='text' name='product_product_qty["+QCRM.AOS_prodln+"]' id='product_product_qty"+QCRM.AOS_prodln+"' size='5' value='' title='' onblur='Quantity_format2Number("+QCRM.AOS_prodln+");calculateLine("+QCRM.AOS_prodln+',"product_");\'>';var s=w.insertCell(1);s.width=colWidth[1];s.className="Pcol1";s.innerHTML="<input autocomplete='off' type='text' data-clear-btn='true' name='product_name["+QCRM.AOS_prodln+"]' id='product_name"+QCRM.AOS_prodln+"' maxlength='50' title='' value=''><input type='hidden' name='product_product_id["+QCRM.AOS_prodln+"]' id='product_product_id"+QCRM.AOS_prodln+"' size='20' maxlength='50' value=''><ul style='display:none;' id='product_name"+QCRM.AOS_prodln+"L' data-theme='c' data-inset='true' data-role='listview'/>";s.innerHTML+="<textarea placeholder='"+sugarLabel(QCRM.CurrentModule,"LBL_PRODUCT_DESCRIPTION")+"' name='product_item_description["+QCRM.AOS_prodln+"]' id='product_item_description"+QCRM.AOS_prodln+"' rows='2' cols='23'></textarea>";var u=w.insertCell(2);u.width=colWidth[2];u.className="Pcol2";u.innerHTML="<input autocomplete='off' type='text' name='product_part_number["+QCRM.AOS_prodln+"]' id='product_part_number"+QCRM.AOS_prodln+"' maxlength='50' title='' value='' readonly='readonly'>";u.innerHTML+="<textarea placeholder='"+sugarLabel(QCRM.CurrentModule,"LBL_PRODUCT_NOTE")+"' name='product_description["+QCRM.AOS_prodln+"]' id='product_description"+QCRM.AOS_prodln+"' rows='2' cols='23'></textarea>";var q=w.insertCell(3);q.width=colWidth[3];q.className="Pcol3";q.innerHTML="<input class='itemNumber' type='text' name='product_product_list_price["+QCRM.AOS_prodln+"]' id='product_product_list_price"+QCRM.AOS_prodln+"' size='11' maxlength='50' value='' title='' onblur='calculateLine("+QCRM.AOS_prodln+",\"product_\");'><input type='hidden' name='product_product_cost_price["+QCRM.AOS_prodln+"]' id='product_product_cost_price"+QCRM.AOS_prodln+"' value=''  />";if(typeof currencyFields!=="undefined"){currencyFields.push("product_product_list_price"+QCRM.AOS_prodln);currencyFields.push("product_product_cost_price"+QCRM.AOS_prodln)}var p=w.insertCell(4);p.width=colWidth[4];p.className="Pcol4";p.innerHTML="<input type='text' class='itemNumber' name='product_product_discount["+QCRM.AOS_prodln+"]' id='product_product_discount"+QCRM.AOS_prodln+"' size='12' maxlength='50' value='' title='' onblur='calculateLine("+QCRM.AOS_prodln+",\"product_\");' onblur='calculateLine("+QCRM.AOS_prodln+",\"product_\");'><input type='hidden' name='product_product_discount_amount["+QCRM.AOS_prodln+"]' id='product_product_discount_amount"+QCRM.AOS_prodln+"' value=''  />";p.innerHTML+="<select data-mini='true' name='product_discount["+QCRM.AOS_prodln+"]' id='product_discount"+QCRM.AOS_prodln+"' onchange='calculateLine("+QCRM.AOS_prodln+',"product_");\'>'+z+"</select>";var o=w.insertCell(5);o.width=colWidth[5];o.className="Pcol5";o.innerHTML="<input type='text' class='itemNumber' name='product_product_unit_price["+QCRM.AOS_prodln+"]' id='product_product_unit_price"+QCRM.AOS_prodln+"' size='11' maxlength='50' value='' title='' readonly='readonly' onblur='calculateLine("+QCRM.AOS_prodln+",\"product_\");' onblur='calculateLine("+QCRM.AOS_prodln+',"product_");\'>';if(typeof currencyFields!=="undefined"){currencyFields.push("product_product_unit_price"+QCRM.AOS_prodln)}var n=w.insertCell(6);n.width=colWidth[6];n.className="Pcol6";n.innerHTML="<input type='text' class='itemNumber' name='product_vat_amt["+QCRM.AOS_prodln+"]' id='product_vat_amt"+QCRM.AOS_prodln+"' size='11' maxlength='250' value='' title='' readonly='readonly'>";n.innerHTML+="<select data-mini='true' name='product_vat["+QCRM.AOS_prodln+"]' id='product_vat"+QCRM.AOS_prodln+"' onchange='calculateLine("+QCRM.AOS_prodln+',"product_");\'>'+r+"</select>";if(typeof currencyFields!=="undefined"){currencyFields.push("product_vat_amt"+QCRM.AOS_prodln)}var m=w.insertCell(7);m.width=colWidth[7];m.className="Pcol7";m.innerHTML="<input type='text' class='itemNumber' name='product_product_total_price["+QCRM.AOS_prodln+"]' id='product_product_total_price"+QCRM.AOS_prodln+"' size='11' maxlength='50' value='' title='' readonly='readonly'><input type='hidden' name='product_group_number["+QCRM.AOS_prodln+"]' id='product_group_number"+QCRM.AOS_prodln+"' value='"+l+"'>";m.innerHTML+="<button type='button' data-icon='delete' data-mini='true' id='product_delete_line"+QCRM.AOS_prodln+"' data-theme='b' data-iconpos='notext' class='button'  onclick='markLineDeleted("+QCRM.AOS_prodln+',"product_")\'/>';if(typeof currencyFields!=="undefined"){currencyFields.push("product_product_total_price"+QCRM.AOS_prodln)}m.innerHTML+="<input type='hidden' name='product_currency["+QCRM.AOS_prodln+"]' id='product_currency"+QCRM.AOS_prodln+"' value=''><input type='hidden' name='product_deleted["+QCRM.AOS_prodln+"]' id='product_deleted"+QCRM.AOS_prodln+"' value='0'><input type='hidden' name='product_id["+QCRM.AOS_prodln+"]' id='product_id"+QCRM.AOS_prodln+"' value=''>";m.innerHTML+="<input type='hidden' id='product_new_with_id"+QCRM.AOS_prodln+"' value='0'>";$("#product_name"+QCRM.AOS_prodln+"L").listview();$("#product_name"+QCRM.AOS_prodln).unbind("input");$("#product_name"+QCRM.AOS_prodln).on("input",(function(a){return function(b){pickProduct("product_name"+a,"product_product_id"+a,[{name:"product_product_list_price"+a,copy:"price"},{name:"product_part_number"+a,copy:"part_number"}],function(d){formatListPrice(a)})}})(QCRM.AOS_prodln));$("#"+h).table().trigger("create");$("#"+h+"_body .ui-table-cell-label").remove();$("#"+h).table("refresh");QCRM.AOS_prodln++;return QCRM.AOS_prodln-1}function formatListPrice(e){if(typeof currencyFields!=="undefined"){var d=document.getElementById("product_currency"+e).value;d=d?d:-99;var b=get_rate(d);var g=ConvertToDollar(document.getElementById("product_product_list_price"+e).value,b);document.getElementById("product_product_list_price"+e).value=format2Number(ConvertFromDollar(g,lastRate));var a=ConvertToDollar(document.getElementById("product_product_cost_price"+e).value,b);document.getElementById("product_product_cost_price"+e).value=format2Number(ConvertFromDollar(a,lastRate))}else{document.getElementById("product_product_list_price"+e).value=format2Number(document.getElementById("product_product_list_price"+e).value);document.getElementById("product_product_cost_price"+e).value=format2Number(document.getElementById("product_product_cost_price"+e).value)}calculateLine(e,"product_")}function insertServiceLine(g,l){if(!QCRM.AOS_groups){g="service_group0"}if(document.getElementById(g+"_head")!==null){document.getElementById(g+"_head").style.display=""}var o=document.getElementById("vathidden").value;var s=document.getElementById("discounthidden").value;colWidth=["45%","11%","11%","11%","11%","11%"];var u=document.getElementById(g+"_body");var r=u.insertRow(-1);r.id="service_line"+QCRM.AOS_servln;r.className="itemLine";var q=r.insertCell(0);q.width=colWidth[0];q.className="Scol0";q.innerHTML="<textarea name='service_name["+QCRM.AOS_servln+"]' id='service_name"+QCRM.AOS_servln+"' size='16' cols='64' title='' tabindex='116'></textarea><input type='hidden' name='service_product_id["+QCRM.AOS_servln+"]' id='service_product_id"+QCRM.AOS_servln+"' size='20' maxlength='50' value='0'>";var h=r.insertCell(1);h.width=colWidth[1];h.className="Scol1";h.innerHTML="<input type='text' class='itemNumber' name='service_product_list_price["+QCRM.AOS_servln+"]' id='service_product_list_price"+QCRM.AOS_servln+"' size='11' maxlength='50' value='' title=''   onblur='calculateLine("+QCRM.AOS_servln+',"service_");\'>';if(typeof currencyFields!=="undefined"){currencyFields.push("service_product_list_price"+QCRM.AOS_servln)}var d=r.insertCell(2);d.width=colWidth[2];d.className="Scol2";d.innerHTML="<input type='text' class='itemNumber' name='service_product_discount["+QCRM.AOS_servln+"]' id='service_product_discount"+QCRM.AOS_servln+"' size='12' maxlength='50' value='' title='' onblur='calculateLine("+QCRM.AOS_servln+",\"service_\");' onblur='calculateLine("+QCRM.AOS_servln+",\"service_\");'><input type='hidden' name='service_product_discount_amount["+QCRM.AOS_servln+"]' id='service_product_discount_amount"+QCRM.AOS_servln+"' value=''  />";d.innerHTML+="<select data-mini='true' name='service_discount["+QCRM.AOS_servln+"]' id='service_discount"+QCRM.AOS_servln+"' onchange='calculateLine("+QCRM.AOS_servln+',"service_");\'>'+s+"</select>";var p=r.insertCell(3);p.width=colWidth[3];p.className="Scol3";p.innerHTML="<input type='text' class='itemNumber' name='service_product_unit_price["+QCRM.AOS_servln+"]' id='service_product_unit_price"+QCRM.AOS_servln+"' size='11' maxlength='50' value='' title=''   onblur='calculateLine("+QCRM.AOS_servln+',"service_");\'>';if(typeof currencyFields!=="undefined"){currencyFields.push("service_product_unit_price"+QCRM.AOS_servln)}var n=r.insertCell(4);n.width=colWidth[4];n.className="Scol4";n.innerHTML="<input type='text' class='itemNumber' name='service_vat_amt["+QCRM.AOS_servln+"]' id='service_vat_amt"+QCRM.AOS_servln+"' size='11' maxlength='250' value='' title='' readonly='readonly'>";n.innerHTML+="<select data-mini='true' name='service_vat["+QCRM.AOS_servln+"]' id='service_vat"+QCRM.AOS_servln+"' onchange='calculateLine("+QCRM.AOS_servln+',"service_");\'>'+o+"</select>";if(typeof currencyFields!=="undefined"){currencyFields.push("service_vat_amt"+QCRM.AOS_servln)}var m=r.insertCell(5);m.width=colWidth[5];m.className="Scol5";m.innerHTML="<input type='text' class='itemNumber' name='service_product_total_price["+QCRM.AOS_servln+"]' id='service_product_total_price"+QCRM.AOS_servln+"' size='11' maxlength='50' value='' title='' readonly='readonly'><input type='hidden' name='service_group_number["+QCRM.AOS_servln+"]' id='service_group_number"+QCRM.AOS_servln+"' value='"+l+"'>";m.innerHTML+="<input type='hidden' name='service_deleted["+QCRM.AOS_servln+"]' id='service_deleted"+QCRM.AOS_servln+"' value='0'><input type='hidden' name='service_id["+QCRM.AOS_servln+"]' id='service_id"+QCRM.AOS_servln+"' value=''>";m.innerHTML+="<input type='hidden' id='service_new_with_id"+QCRM.AOS_prodln+"' value='0'>";m.innerHTML+="<button type='button' data-icon='delete' data-mini='true' id='service_delete_line"+QCRM.AOS_servln+"' data-theme='b' data-iconpos='notext' class='button' onclick='markLineDeleted("+QCRM.AOS_servln+',"service_")\'/>';if(typeof currencyFields!=="undefined"){currencyFields.push("service_product_total_price"+QCRM.AOS_servln)}$("#"+g).table().trigger("create");$("#"+g+"_body .ui-table-cell-label").remove();$("#"+g).table("refresh");QCRM.AOS_servln++;return QCRM.AOS_servln-1}function insertProductHeader(l){var h=document.createElement("thead");h.id=l+"_head";h.style.display="none";document.getElementById(l).appendChild(h);var w=document.createElement("tbody");w.id=l+"_body";document.getElementById(l).appendChild(w);var v=h.insertRow(-1);v.id="product_head";v.className="itemHeader";var u=document.createElement("th");u.style.color="rgb(68,68,68)";u.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_PRODUCT_QUANITY");v.appendChild(u);var r=document.createElement("th");r.style.color="rgb(68,68,68)";r.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_PRODUCT_NAME");v.appendChild(r);var s=document.createElement("th");s.style.color="rgb(68,68,68)";s.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_PART_NUMBER");v.appendChild(s);var q=document.createElement("th");q.style.color="rgb(68,68,68)";q.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_LIST_PRICE");v.appendChild(q);var p=document.createElement("th");p.style.color="rgb(68,68,68)";p.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_DISCOUNT_AMT");v.appendChild(p);var o=document.createElement("th");o.style.color="rgb(68,68,68)";o.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_UNIT_PRICE");v.appendChild(o);var n=document.createElement("th");n.style.color="rgb(68,68,68)";n.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_VAT_AMT");v.appendChild(n);var m=document.createElement("th");m.style.color="rgb(68,68,68)";m.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_TOTAL_PRICE");v.appendChild(m)}function insertServiceHeader(h){var g=document.createElement("thead");g.id=h+"_head";g.style.display="none";document.getElementById(h).appendChild(g);var s=document.createElement("tbody");s.id=h+"_body";document.getElementById(h).appendChild(s);var r=g.insertRow(-1);r.id="service_head";r.className="itemHeader";var q=document.createElement("th");q.style.color="rgb(68,68,68)";q.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_SERVICE_NAME");r.appendChild(q);var p=document.createElement("th");p.style.color="rgb(68,68,68)";p.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_SERVICE_LIST_PRICE");r.appendChild(p);var o=document.createElement("th");o.style.color="rgb(68,68,68)";o.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_SERVICE_DISCOUNT");r.appendChild(o);var n=document.createElement("th");n.style.color="rgb(68,68,68)";n.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_SERVICE_PRICE");r.appendChild(n);var m=document.createElement("th");m.style.color="rgb(68,68,68)";m.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_VAT_AMT");r.appendChild(m);var l=document.createElement("th");l.style.color="rgb(68,68,68)";l.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_TOTAL_PRICE");r.appendChild(l)}function insertGroup(){if(!QCRM.AOS_groups&&QCRM.AOS_groupn>0){return}var v=document.createElement("tr");v.id="group_body"+QCRM.AOS_groupn;document.getElementById("lineItems").appendChild(v);var J=v.insertCell(0);J.colSpan="100";var H=document.createElement("table");H.id="group"+QCRM.AOS_groupn;if(QCRM.AOS_groups){H.style.border="1px grey solid";H.style.borderRadius="4px"}H.style.whiteSpace="normal";J.appendChild(H);tableheader=document.createElement("thead");H.appendChild(tableheader);var E=tableheader.insertRow(-1);if(QCRM.AOS_groups){var d=E.insertCell(0);d.scope="row";d.colSpan="8";d.innerHTML=sugarLabel(QCRM.CurrentModule,"LBL_GROUP_NAME")+":&nbsp;&nbsp;<input name='group_name[]' id='"+H.id+"name' size='30' maxlength='255'  title='' tabindex='120' type='text'><input type='hidden' name='group_id[]' id='"+H.id+"id' value=''><input type='hidden' name='group_group_number[]' id='"+H.id+"group_number' value='"+QCRM.AOS_groupn+"'>";var G=E.insertCell(1);G.scope="row";G.innerHTML="<span title='"+sugarLabel(QCRM.CurrentModule,"LBL_DELETE_GROUP")+"' style='float: right;'><a style='cursor: pointer;' id='deleteGroup' onclick='markGroupDeleted("+QCRM.AOS_groupn+")'><img src='themes/default/images/id-ff-clear.png' alt='X'></a></span><input type='hidden' name='group_deleted[]' id='"+H.id+"deleted' value='0'>"}var F=document.createElement("thead");H.appendChild(F);var I=F.insertRow(-1);var m=I.insertCell(0);m.colSpan="100";var q=document.createElement("table");q.id="product_group"+QCRM.AOS_groupn;q.width="100%";q.className="ui-responsive table-stroke";q.setAttribute("data-mode","reflow");q.setAttribute("data-role","table");m.appendChild(q);insertProductHeader(q.id);var p=document.createElement("thead");H.appendChild(p);var r=p.insertRow(-1);var n=r.insertCell(0);n.colSpan="100";var b=document.createElement("table");b.id="service_group"+QCRM.AOS_groupn;b.width="100%";b.className="ui-responsive table-stroke";b.setAttribute("data-mode","reflow");b.setAttribute("data-role","table");n.appendChild(b);insertServiceHeader(b.id);var u=document.createElement("tfoot");H.appendChild(u);var A=u.insertRow(-1);var s=A.insertCell(0);s.scope="row";s.colSpan="20";s.innerHTML="<input type='button' class='button' value='"+sugarLabel(QCRM.CurrentModule,"LBL_ADD_PRODUCT_LINE")+"' id='"+q.id+"addProductLine' onclick='insertProductLine(\""+q.id+'","'+QCRM.AOS_groupn+"\")' />";s.innerHTML+=" <input type='button' class='button' value='"+sugarLabel(QCRM.CurrentModule,"LBL_ADD_SERVICE_LINE")+"' id='"+b.id+"addServiceLine' onclick='insertServiceLine(\""+b.id+'","'+QCRM.AOS_groupn+"\")' />";if(QCRM.AOS_groups){s.innerHTML+="<span style='float: right;'>"+sugarLabel(QCRM.CurrentModule,"LBL_TOTAL_AMT")+":&nbsp;&nbsp;<input name='group_total_amt[]' id='"+H.id+"total_amt' size='21' maxlength='26' value='' title='' tabindex='120' type='text' readonly></span>";var o=u.insertRow(-1);var D=o.insertCell(0);D.scope="row";D.colSpan="20";D.innerHTML="<span style='float: right;'>"+sugarLabel(QCRM.CurrentModule,"LBL_DISCOUNT_AMOUNT")+":&nbsp;&nbsp;<input name='group_discount_amount[]' id='"+H.id+"discount_amount' size='21' maxlength='26' value='' title='' tabindex='120' type='text' readonly></span>";var l=u.insertRow(-1);var C=l.insertCell(0);C.scope="row";C.colSpan="20";C.innerHTML="<span style='float: right;'>"+sugarLabel(QCRM.CurrentModule,"LBL_SUBTOTAL_AMOUNT")+":&nbsp;&nbsp;<input name='group_subtotal_amount[]' id='"+H.id+"subtotal_amount' size='21' maxlength='26' value='' title='' tabindex='120' type='text' readonly></span>";var h=u.insertRow(-1);var B=h.insertCell(0);B.scope="row";B.colSpan="20";B.innerHTML="<span style='float: right;'>"+sugarLabel(QCRM.CurrentModule,"LBL_TAX_AMOUNT")+":&nbsp;&nbsp;<input name='group_tax_amount[]' id='"+H.id+"tax_amount' size='21' maxlength='26' value='' title='' tabindex='120' type='text' readonly></span>";if(document.getElementById("subtotal_tax_amount")!==null){var g=u.insertRow(-1);var z=g.insertCell(0);z.scope="row";z.colSpan="20";z.innerHTML="<span style='float: right;'>"+sugarLabel(QCRM.CurrentModule,"LBL_SUBTOTAL_TAX_AMOUNT")+":&nbsp;&nbsp;<input name='group_subtotal_tax_amount[]' id='"+H.id+"subtotal_tax_amount' size='21' maxlength='26' value='' title='' tabindex='120' type='text' readonly></span>";if(typeof currencyFields!=="undefined"){currencyFields.push(""+H.id+"subtotal_tax_amount")}}var e=u.insertRow(-1);var w=e.insertCell(0);w.scope="row";w.colSpan="20";w.innerHTML="<span style='float: right;'>"+sugarLabel(QCRM.CurrentModule,"LBL_GROUP_TOTAL")+":&nbsp;&nbsp;<input name='group_total_amount[]' id='"+H.id+"total_amount' size='21' maxlength='26' value='' title='' tabindex='120' type='text' readonly></span>";if(typeof currencyFields!=="undefined"){currencyFields.push(""+H.id+"total_amt");currencyFields.push(""+H.id+"discount_amount");currencyFields.push(""+H.id+"subtotal_amount");currencyFields.push(""+H.id+"tax_amount");currencyFields.push(""+H.id+"total_amount")}}QCRM.AOS_groupn++;return QCRM.AOS_groupn-1}function markGroupDeleted(d){document.getElementById("group_body"+d).style.display="none";document.getElementById("group"+d+"deleted").value="1";var b=document.getElementById("group_body"+d).getElementsByTagName("tbody");for(x=0;x<b.length;x++){var a=b[x].getElementsByTagName("button");for(y=0;y<a.length;y++){if(a[y].id.indexOf("delete_line")!=-1){a[y].click()}}}}function markLineDeleted(d,b){document.getElementById(b+"line"+d).style.display="none";document.getElementById(b+"deleted"+d).value="1";document.getElementById(b+"delete_line"+d).onclick="";var a="group"+document.getElementById(b+"group_number"+d).value;calculateTotal(a);calculateTotal()}function calculateLine(l,o){var h="product_list_price";if(document.getElementById(o+h+l)===null){h="product_unit_price"}if(document.getElementById(o+"name"+l).value===""||document.getElementById(o+h+l).value===""){return}if(o==="product_"&&document.getElementById(o+"product_qty"+l)!==null&&document.getElementById(o+"product_qty"+l).value===""){document.getElementById(o+"product_qty"+l).value=1}var m=unformat2Number(document.getElementById(o+"product_unit_price"+l).value);if(document.getElementById(o+"product_list_price"+l)!==null&&document.getElementById(o+"product_discount"+l)!==null&&document.getElementById(o+"discount"+l)!==null){var a=get_value(o+"product_list_price"+l);var q=get_value(o+"product_discount"+l);var d=document.getElementById(o+"discount"+l).value;if(d=="Amount"){if(q>a){document.getElementById(o+"product_discount"+l).value=a;q=a}m=a-q;document.getElementById(o+"product_unit_price"+l).value=format2Number(a-q)}else{if(d=="Percentage"){if(q>100){document.getElementById(o+"product_discount"+l).value=100;q=100}q=(q/100)*a;m=a-q;document.getElementById(o+"product_unit_price"+l).value=format2Number(a-q)}else{document.getElementById(o+"product_unit_price"+l).value=document.getElementById(o+"product_list_price"+l).value;document.getElementById(o+"product_discount"+l).value="";q=0}}document.getElementById(o+"product_list_price"+l).value=format2Number(a);document.getElementById(o+"product_discount_amount"+l).value=format2Number(-q,6)}var g=1;if(document.getElementById(o+"product_qty"+l)!==null){g=unformat2Number(document.getElementById(o+"product_qty"+l).value);Quantity_format2Number(l)}var n=unformatNumber(document.getElementById(o+"vat"+l).value,",","."),p=g*m,b=(p*n)/100;if(QCRM.AOS_totaltax){p=p+b}document.getElementById(o+"vat_amt"+l).value=format2Number(b);document.getElementById(o+"product_unit_price"+l).value=format2Number(m);document.getElementById(o+"product_total_price"+l).value=format2Number(p);var e=0;if(QCRM.AOS_groups){e=document.getElementById(o+"group_number"+l).value}e="group"+e;calculateTotal(e);calculateTotal()}function calculateAllLines(){var g=document.getElementById("lineItems").getElementsByTagName("tbody");var e=g.length;for(k=0;k<e;k++){var a=g[k].getElementsByTagName("input"),b=a[0].id.split("_")[0]+"_",d=a[0].id.slice(-1);calculateLine(d,b)}}function calculateTotal(B){if(typeof B==="undefined"){B="lineItems"}var g=document.getElementById(B).getElementsByTagName("tr");if(B=="lineItems"){B=""}var b=g.length,e={},a=0,l=0,p=0,u=0;for(i=0;i<b;i++){if((g[i].id=="")||(B==""&&g[i].id.indexOf("group")!==-1)){continue}var n=1,w=null,s=0,q=0,m=0,r=0,o=g[i].getElementsByTagName("input");for(j=0;j<o.length;j++){if(o[j].id.indexOf("product_qty")!=-1){n=unformat2Number(o[j].value)}if(o[j].id.indexOf("product_list_price")!=-1){w=unformat2Number(o[j].value)}if(o[j].id.indexOf("product_unit_price")!=-1){s=unformat2Number(o[j].value)}if(o[j].id.indexOf("product_discount_amount")!=-1){m=unformat2Number(o[j].value)}if(o[j].id.indexOf("vat_amt")!=-1){r=unformat2Number(o[j].value)}if(o[j].id.indexOf("deleted")!=-1){q=o[j].value}}if(q!=1&&B!==""){e[g[i].parentNode.id]=1}else{if(B!==""&&e[g[i].parentNode.id]!=1){e[g[i].parentNode.id]=0}}if(n!==0&&w!==null&&q!=1){a+=w*n}else{if(n!==0&&s!==0&&q!=1){a+=s*n}}if(m!==0&&q!=1){p+=m*n}if(r!==0&&q!=1){u+=r}}for(var v in e){if(e[v]!=1&&document.getElementById(v+"_head")!==null){document.getElementById(v+"_head").style.display="none"}}l=a+p;set_value(B+"total_amt",a);set_value(B+"subtotal_amount",l);set_value(B+"discount_amount",p);var d=get_value(B+"shipping_amount"),A=get_value(B+"shipping_tax"),z=d*(A/100);set_value(B+"shipping_tax_amt",z);u+=z;set_value(B+"tax_amount",u);set_value(B+"subtotal_tax_amount",l+u);set_value(B+"total_amount",l+u+d)}function set_value(b,a){if(document.getElementById(b)!==null){document.getElementById(b).value=format2Number(a)}}function get_value(a){if(document.getElementById(a)!==null){return unformat2Number(document.getElementById(a).value)}return 0}function Quantity_format2Number(a){var b="";var d=unformat2Number(document.getElementById("product_product_qty"+a).value);if(d===null){d=1}if(d===0){b="0"}else{b=format2Number(d);if(sig_digits){b=b.replace(/0*$/,"").replace(decimal_separator,"~").replace(/~$/,"").replace("~",decimal_separator)}}document.getElementById("product_product_qty"+a).value=b};