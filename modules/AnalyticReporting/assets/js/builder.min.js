/*! AnalyticReporting 26-06-2017 */
if(Ractive.components.reportBuilderModule=Ractive.extend({template:"#reportBuilderModule",data:{moduleName:"",children:[],parentModuleName:"",moduleFieldName:"",parentModuleFieldName:"",relation:"oneToMany",manyToMany:{tableName:"",mainModuleColumnName:"",subModuleColumnName:"",roleRequired:"",roleIndex:"",roleValue:""}},init:function(){var a=this;this.on("addModule",function(b){this.get("children").push({moduleName:this.get("defaults.moduleName"),moduleFieldName:this.get("defaults.moduleFieldName"),children:[],parentModuleName:a.get("moduleName"),parentModuleFieldName:this.get("types.modulesFieldTypes")[a.get("moduleName")][1].name,relation:"oneToMany",manyToMany:{tableName:"",mainModuleColumnName:"",subModuleColumnName:"",roleRequired:"",roleIndex:"",roleValue:""}})}),this.on("removeModule",function(a){this.set("children",[]),this.set("parentModuleName",""),this.set("parentModuleName","teardown")}),this.observe(this.observers,{init:!1})},idFieldNameMatcher:function(a,b){var c;switch(b){case"Opportunities":c="opportunity_id";break;default:c=b.toLowerCase().slice(0,-1)+"_id"}for(var d=this.get("types.modulesFieldTypes")[a],e=0,f=d.length;e<f;e++)if(d[e].name==c)return c;return!1},observers:{moduleName:function(a,b){this.set("relation","oneToMany");for(var c=this.get("children"),d=0,e=c.length;d<e;d++)c[d].parentModuleName=a,this.set("children["+d+"].parentModuleName",a),this.set("children["+d+"].parentModuleFieldName",this.get("types.modulesFieldTypes")[a][1].name);if(this.set("moduleFieldName",this.get("types.modulesFieldTypes")[a][1].name),this.set("manyToMany.roleValue",this.get("moduleName")),void 0!==this.get("types.modulesFieldTypes")[this.get("parentModuleName")]){var f=this.idFieldNameMatcher(a,this.get("parentModuleName"));f!==!1&&this.set("moduleFieldName",f)}},"children.*.parentModuleName":function(a,b,c,d){"teardown"==a&&this.splice("children",d,1)},parentModuleName:function(a,b,c){if(this.set("relation","oneToMany"),void 0!==this.get("types.modulesFieldTypes")[a]){for(var d=this.get("types.modulesFieldTypes")[a][1].name,e=this.get("types.modulesFieldTypes")[this.get("moduleName")],f=0,g=e.length;f<g;f++)if(e[f].name==d){this.set("moduleFieldName",d);break}var h=this.idFieldNameMatcher(this.get("moduleName"),a);h!==!1&&this.set("moduleFieldName",h)}},relation:function(a,b,c){if("oneToMany"!=a){var d=this.get("manyToManyTableTypesComputed");if(d.length>0){this.set("manyToMany.tableName",d[0].tableName);var e=this.get("selectedManyToManyTable");void 0!==e.columns[0]&&(this.set("manyToMany.mainModuleColumnName",e.columns[0].name),this.set("manyToMany.subModuleColumnName",e.columns[0].name),this.set("manyToMany.roleIndex",e.columns[0].name)),void 0!==e.columns[1]&&this.set("manyToMany.subModuleColumnName",e.columns[1].name),void 0!==e.columns[2]&&this.set("manyToMany.roleIndex",e.columns[2].name),this.set("manyToMany.roleValue",this.get("moduleName")),this.set("manyToMany.roleRequired",e.relModule)}this.set("moduleFieldName",this.get("types.modulesFieldTypes")[this.get("moduleName")][1].name)}else{var f=this.idFieldNameMatcher(this.get("moduleName"),this.get("parentModuleName"));f!==!1&&this.set("moduleFieldName",f)}},"manyToMany.tableName":function(a,b,c){this.set("manyToMany.roleRequired",this.get("selectedManyToManyTable").relModule)}},computed:{manyToManyTableTypesComputed:function(){var a=[],b=this.get("types.manyToManyTypes")[this.get("parentModuleName")],c=this.get("types.manyToManyTypes")[this.get("moduleName")],d=this.get("types.manyToManyTypes").all;if(void 0!==d&&(a=a.concat(d)),void 0!==b)for(var e=0,f=b.length;e<f;e++)jQuery.inArray(this.get("moduleName"),b[e].applicableModules)==-1&&jQuery.inArray("all",b[e].applicableModules)==-1||(a=a.concat(b[e]));if(void 0!==c)for(var e=0,f=c.length;e<f;e++)jQuery.inArray(this.get("parentModuleName"),c[e].applicableModules)==-1&&jQuery.inArray("all",c[e].applicableModules)==-1||(a=a.concat(c[e]));return a},selectedManyToManyTable:function(){for(var a=this.get("manyToManyTableTypesComputed"),b=0,c=a.length;b<c;b++)if(a[b].tableName==this.get("manyToMany.tableName"))return a[b]}}}),void 0===reportBuilderOptions)var reportBuilderOptions={};var reportBuilder=new Ractive({el:"#ar-report-builder",template:"#reportBuilderOptionsTemplate",data:{types:reportBuilderOptions.types,internal:reportBuilderOptions.internal,reportTitle:"",reportDescription:"",selectedReportType:"standard",selectedCategory:-1,depth:0,selectedModules:[],defaults:{moduleName:"",moduleFieldName:""},customTables:{enableAudit:!1,enableCustomTables:!1}},init:function(){for(var a=this.get("types.moduleTypes"),b=this.get("types.modulesFieldTypes"),c=0,d=a.length;c<d;c++)if(void 0!==a[c].name&&void 0!==b[a[c].name][1]&&void 0!==b[a[c].name][1].name){this.set("defaults.moduleName",a[c].name),this.set("defaults.moduleFieldName",b[a[c].name][1].name);break}var e=this;this.get("selectedModules").push({moduleName:this.get("defaults.moduleName"),children:[],parentModuleName:""}),this.on("addModule",function(a){this.get("selectedModules").push({moduleName:this.get("defaults.moduleName"),children:[],parentModuleName:""})}),this.on("saveReport",function(a){var b={};for(var c in this.data){switch(c){case"types":continue;case"depth":continue;case"internal":continue;case"defaults":continue}b[c]=this.get(c)}e.set("internal.response",{}),jQuery.post(e.get("internal.postUrl"),b,function(a){e.set("internal.response",JSON.parse(a))})})}});if(void 0===loadedSettings)var loadedSettings={};var reportBuilderSettings=new Ractive({el:"#ar-settings",template:"#reportBuilderSettingsEditorTemplate",data:{types:loadedSettings.types},init:function(){this.get("types.moduleTypes").unshift({name:"all",title:"Add to all modules"})}});